(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{1178:function(t,e,i){},1431:function(t,e,i){"use strict";i(1178)},593:function(t,e,i){"use strict";i.r(e);i(26),i(38),i(37),i(49),i(22),i(50);var n=i(16),s=i.n(n),a=i(0),r=i.n(a),o=i(5),c=i.n(o),u=i(4),l=i.n(u),d=(i(183),i(127),i(23),i(80),i(137)),p=i.n(d),m=i(7),h=i(12),f=i(1),g=i(666);function b(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?b(Object(i),!0).forEach((function(e){c()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):b(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var y=[{name:f.a.t("流程统计"),routerName:"statisticsTemplate"},{name:f.a.t("任务统计"),routerName:"statisticsInstance"},{name:f.a.t("标准插件统计"),routerName:"statisticsAtom"},{name:f.a.t("轻应用统计"),routerName:"statisticsAppmaker"}],P={name:"Statistics",components:{PageHeader:g.a},data:function(){var t=[p()().subtract(1,"month").format("YYYY-MM-DD"),p()().format("YYYY-MM-DD")];return{hasViewPerm:!1,routers:y,dateRange:t.slice(0),projectList:[]}},computed:v(v({},Object(m.e)({hasStatisticsPerm:function(t){return r()(this,void 0),t.hasStatisticsPerm}.bind(void 0),permissionMeta:function(t){return r()(this,void 0),t.permissionMeta}.bind(void 0),categorys:function(t){return r()(this,void 0),t.categorys}.bind(void 0)})),{},{categoryList:function(){var t=this;return this.categorys.map(function(e){return r()(this,t),{id:e.value,name:e.name}}.bind(this))},dateStamp:function(){var t=this;return this.dateRange.map(function(e){return r()(this,t),p()(e).valueOf()}.bind(this))}}),watch:{hasStatisticsPerm:function(t){null!==t&&(t?(this.hasViewPerm=!0,this.getProjectList(),this.getCategorys()):this.showPermissionApplyPage())}},mounted:function(){null!==this.hasStatisticsPerm&&(!1===this.hasStatisticsPerm?this.showPermissionApplyPage():(this.hasViewPerm=!0,this.getProjectList(),this.getCategorys()))},methods:v(v(v({},Object(m.b)(["getCategorys"])),Object(m.b)("project",["loadUserProjectList"])),{},{showPermissionApplyPage:function(){var t=this,e=this.permissionMeta.system.find(function(e){return r()(this,t),"bk_sops"===e.id}.bind(this)),i=this.permissionMeta.actions.find(function(e){return r()(this,t),"statistics_view"===e.id}.bind(this)).name,n={system_id:e.id,system_name:e.name,actions:[{id:"statistics_view",name:i,related_resource_types:[]}]};h.a.$emit("togglePermissionApplyPage",!0,"other",n)},getProjectList:function(){var t=this;return s()(l.a.mark((function e(){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.loadUserProjectList({limit:0});case 4:i=e.sent,t.projectList=i.objects,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:return e.prev=11,t.loading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,8,11,14]])})))()},onChangeDateRange:function(t){this.dateRange=t}})},w=(i(1431),i(9)),j=Object(w.a)(P,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:null===t.hasStatisticsPerm,opacity:0,zIndex:100},expression:"{ isLoading: hasStatisticsPerm === null, opacity: 0, zIndex: 100 }"}],staticClass:"page-statistics"},[t.hasViewPerm?[i("page-header",{attrs:{"tab-list":t.routers},scopedSlots:t._u([{key:"expand",fn:function(){return[i("div",{staticClass:"date-picker"},[i("bk-form",{attrs:{"form-type":"inline"}},[i("bk-form-item",{attrs:{label:t.$t("时间范围")}},[i("bk-date-picker",{attrs:{value:t.dateRange,type:"daterange",placement:"top-end",clearable:!1},on:{change:t.onChangeDateRange}})],1)],1)],1)]},proxy:!0}],null,!1,3113815819)}),t._v(" "),i("div",{staticClass:"statistics-content"},[i("router-view",{attrs:{"date-range":t.dateStamp,"project-list":t.projectList,"category-list":t.categoryList}})],1)]:t._e()],2)}),[],!1,null,"2eea3d07",null);e.default=j.exports},621:function(t,e){"function"!=typeof window.gettext&&(window.gettext=function(t){return t})},645:function(t,e,i){},666:function(t,e,i){"use strict";var n=i(0),s=i.n(n),a=(i(23),i(621),{name:"PageHeader",inject:["reload"],props:{selfReload:{type:Boolean,default:!1},tabList:{type:Array,default:function(){return s()(this,void 0),[]}.bind(void 0)}},methods:{tabChange:function(t){if(this.$route.name===t.routerName)return this.selfReload?this.$emit("tabChange",t):this.reload(),!1;this.$router.push({name:t.routerName,params:t.params,query:t.query})}}}),r=(i(667),i(9)),o=Object(r.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-header"},[t._t("default",(function(){return[t.tabList.length?i("ul",{staticClass:"tab-list"},t._l(t.tabList,(function(e,n){return i("li",{key:n,class:["tab-item",{active:t.$route.name===e.routerName}],on:{click:function(i){return t.tabChange(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])})),0):t._e()]})),t._v(" "),i("div",{staticClass:"expand"},[t._t("expand")],2)],2)}),[],!1,null,"7b08c71f",null);e.a=o.exports},667:function(t,e,i){"use strict";i(645)}}]);