(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1187:function(e,t,a){},1188:function(e,t,a){},1441:function(e,t,a){"use strict";a(1187)},1442:function(e,t,a){"use strict";a(1188)},579:function(e,t,a){"use strict";a.r(t);a(26),a(38),a(37),a(49),a(50);var i=a(0),n=a.n(i),r=a(16),s=a.n(r),c=a(5),o=a.n(c),u=(a(22),a(127),a(23),a(4)),d=a.n(u),p=a(1),g=a(7),h=a(28),l={name:"EditHeader"},v=(a(1441),a(9));function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"SourceEdit",components:{EditHeader:Object(v.a)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"edit-header"},[a("div",{class:["step-item",{active:"packageEdit"===e.$route.name,finished:"cacheEdit"===e.$route.name}]},[a("div",{staticClass:"step-content"},[a("div",{staticClass:"num"},[e._v("1")]),e._v(" "),a("div",{staticClass:"title"},[e._v(e._s(e.$t("配置")+e.$t("主包源")))])])]),e._v(" "),a("div",{class:["step-item",{active:"cacheEdit"===e.$route.name}]},[a("div",{staticClass:"step-content"},[a("div",{staticClass:"num"},[e._v("2")]),e._v(" "),a("div",{staticClass:"title"},[e._v(e._s(e.$t("配置")+e.$t("本地缓存")))])])])])}),[],!1,null,"35ba7ecd",null).exports},props:{hasEditPerm:Boolean,editPermLoading:Boolean},data:function(){return{sourceData:[],emptyData:!1,isCreating:!1,originList:[],cacheList:[],loading:!0,pending:!1}},created:function(){this.loadData()},methods:m(m({},Object(g.b)("manage",["loadPackageSource","createPackageSource","updatePackageSource","deletePackageSource"])),{},{loadData:function(){var e=this;return s()(d.a.mark((function t(){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.loadPackageSource();case 4:(a=t.sent).objects.length?(e.sourceData=a.objects,e.transformData(a.objects)):(e.emptyData=!0,e.isCreating=!0),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.log(t.t0);case 11:return t.prev=11,e.loading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},transformData:function(e){var t=this,a=[],i=[];e.forEach(function(e){n()(this,t),"origin"===e.category?a.push(e):i.push(e)}.bind(this)),this.originList=a,this.cacheList=i},updateList:function(e,t){var a=h.a.deepClone(t);"originList"===e?this.originList=a:this.cacheList=a},saveSetting:function(){this.pending||(this.cacheList.length>0&&0===this.originList.length?this.$bkMessage({theme:"error",message:p.a.t("请添加主包源"),delay:1e4}):0===this.originList.length&&0===this.cacheList.length?this.isCreating?this.$bkMessage({theme:"error",message:p.a.t("请添加主包源"),delay:1e4}):this.deleteSetting():this.createOrUpdateSetting())},deleteSetting:function(){var e=this;return s()(d.a.mark((function t(){var a,i=this;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.pending=!0,a=e.sourceData.map(function(e){return n()(this,i),{origin_source_id:e.origin_source_id,type:e.type,name:e.name}}.bind(this)),t.prev=2,t.next=5,e.deletePackageSource(a);case 5:e.$router.push({name:"sourceManage"}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),console.log(t.t0);case 11:return t.prev=11,e.pending=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[2,8,11,14]])})))()},createOrUpdateSetting:function(){var e=this;return s()(d.a.mark((function t(){var a,i,r=this;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.pending=!0,a=e.originList.map(function(e){return n()(this,r),{id:e.id,name:e.name,desc:e.desc,type:e.type,packages:e.packages,details:e.details}}.bind(this)),i={origins:a,caches:e.cacheList},t.prev=3,!e.isCreating){t.next=9;break}return t.next=7,e.createPackageSource(i);case 7:t.next=11;break;case 9:return t.next=11,e.updatePackageSource(i);case 11:e.$router.push({name:"sourceManage"}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),console.log(t.t0);case 17:return t.prev=17,e.pending=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[3,14,17,20]])})))()}})},k=(a(1442),Object(v.a)(b,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,opacity:1,zIndex:100},expression:"{ isLoading: loading, opacity: 1, zIndex: 100 }"}],staticClass:"source-edit"},[a("edit-header"),e._v(" "),a("router-view",{attrs:{"origin-list":e.originList,"cache-list":e.cacheList,pending:e.pending,"has-edit-perm":e.hasEditPerm,"edit-perm-loading":e.editPermLoading},on:{updateList:e.updateList,saveSetting:e.saveSetting}})],1)}),[],!1,null,"5f05be92",null));t.default=k.exports}}]);