(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{1189:function(e,t,a){},1190:function(e,t,a){},1443:function(e,t,a){"use strict";a(1189)},1444:function(e,t,a){"use strict";a(1190)},580:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),r=(a(37),a(23),a(127),a(101),a(39),a(104),a(128),a(185),a(184),a(28)),n=a(677),o=a.n(n),l=(a(67),a(314),a(80),a(82),a(22),a(27),a(81),a(70),a(26),a(1)),u=a(99),c=a(788),d=a(6),p={name:"PackageForm",props:{value:{type:Object,default:function(){return{id:void 0,name:"",type:"git",desc:"",details:{repo_address:"",repo_raw_address:"",branch:""},packages:{}}}},sourceIndex:{type:Number,default:0}},data:function(){var e=this.getSourceTypeList(),t=this.value,a=t.name,s=t.type,i=t.desc,r=t.details,n=t.packages,l=this.getPackageValues(n),u=this.getSourceKeys(s);return{name:a,type:s,desc:i,details:r,packages:n,list:e,detailFields:o()(u,1)[0],packageValues:l,isSettingPanelShow:!0,showError:!1,showModuleError:!1,packageNameRule:{required:!0,max:d.i.SOURCE_NAME_MAX_LENGTH,regex:d.g},moduleNameRule:{required:!0,nameMax:d.i.SOURCE_NAME_MAX_LENGTH,nameReg:d.g,nameRepeat:!0},valueRule:{required:!0}}},computed:{isEditing:function(){return"number"==typeof this.value.id},isShowDelete:function(){return this.packageValues&&this.packageValues.length>1},modulesOptName:function(){return this.isShowDelete?l.a.t("删除"):"--"}},created:function(){var e=this;this.validator=new u.a({}),this.validator.extend("nameMax",{getMessage:function(t){return i()(this,e),l.a.t("名称长度不能超过")+d.i.SOURCE_NAME_MAX_LENGTH+l.a.t("个字符")}.bind(this),validate:function(t){return i()(this,e),t.length<=d.i.SOURCE_NAME_MAX_LENGTH}.bind(this)}),this.validator.extend("nameReg",{getMessage:function(t){return i()(this,e),l.a.t("名称由英文字母、数字、下划线组成，且不能以数字开头")}.bind(this),validate:function(t){return i()(this,e),d.g.test(t)}.bind(this)}),this.validator.extend("nameRepeat",{getMessage:function(t){return i()(this,e),l.a.t("子模块名称不能重复")}.bind(this),validate:function(t){var a=this;return i()(this,e),!(this.packageValues.filter(function(e){return i()(this,a),e.key===t.trim()}.bind(this)).length>1)}.bind(this)})},methods:{getSourceTypeList:function(){var e=this;return c.a.map(function(t){return i()(this,e),{id:t.type,name:t.name}}.bind(this))},getSourceKeys:function(e){var t=this,a=[],s={},r=c.a.find(function(a){return i()(this,t),a.type===e}.bind(this));for(var n in r.keys)a.push({id:n,name:r.keys[n].name,placeholder:r.keys[n].placeholder,validate:{required:"source_dir"!==n}}),s[n]="";return[a,s]},getPackageValues:function(e){var t=[];for(var a in"{}"===JSON.stringify(e)&&t.push({key:"",version:"",modules:""}),e){var s=e[a];t.push({key:a,version:s.version,modules:Array.isArray(s.modules)?s.modules.join("\n"):s.modules})}return t},getPackages:function(){var e=this,t={};return this.packageValues.forEach(function(a){var s,r=this;i()(this,e),s=Array.isArray(a.modules)?a.modules:a.modules.replace("/,/g","\n").split("\n").filter(function(e){return i()(this,r),""!==e.trim()}.bind(this)),a.key&&(t[a.key]={version:a.version,modules:s})}.bind(this)),t},updateValue:function(e,t){this.$emit("updateSource",e,t,this.sourceIndex)},validate:function(){var e=this;return this.$validator.validateAll().then(function(t){return i()(this,e),0===this.packageValues.length&&(this.showModuleError=!0),t&&!this.showModuleError}.bind(this))},onTogglePanelShow:function(){var e=this;this.isSettingPanelShow=!this.isSettingPanelShow,this.isSettingPanelShow?this.showError=!1:this.validate().then(function(t){i()(this,e),t||(this.showError=!0)}.bind(this))},onTypeSelect:function(e){this.type=e;var t=this.getSourceKeys(e),a=o()(t,2);this.detailFields=a[0],this.details=a[1],this.updateValue("type",this.type),this.updateValue("details",this.details)},onAddPackage:function(){this.packageValues.push({key:"",version:"",modules:[]}),this.showModuleError=!1},onDeletePackage:function(e){if(this.isShowDelete){this.packageValues.splice(e,1);var t=this.getPackages();this.updateValue("packages",t),0===Object.keys(t).length&&(this.showModuleError=!0)}},onPackageNameBlur:function(){this.updateValue("name",this.name)},onPackageDescBlur:function(){this.updateValue("desc",this.desc)},onDetailInputBlur:function(e){this.updateValue("details",this.details)},onPackageInputBlur:function(e,t,a){var s=e.target.value.trim();this.packageValues[a][t]=s;var i=this.getPackages();this.updateValue("packages",i)},onDeleteSource:function(){this.$emit("deleteSource")}}},m=(a(1443),a(9)),v={name:"PackageEdit",components:{PackageForm:Object(m.a)(p,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"package-form"},[a("div",{staticClass:"form-header"},[a("div",{class:["title",{fold:!e.isSettingPanelShow}],on:{click:e.onTogglePanelShow}},[e._v("\n            "+e._s(e.$t("包源名"))+": "+e._s(e.name||e.$t("未命名"))+"\n        ")]),e._v(" "),a("bk-button",{staticClass:"delete-btn",attrs:{theme:"default",size:"small"},on:{click:e.onDeleteSource}},[e._v("\n            "+e._s(e.$t("删除"))+"\n        ")]),e._v(" "),e.showError?a("div",{staticClass:"error-msg"},[e._v(e._s(e.$t("输入有误，请展开检查")))]):e._e()],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isSettingPanelShow,expression:"isSettingPanelShow"}],staticClass:"package-setting"},[a("table",{staticClass:"form-table"},[a("tbody",[a("tr",[a("th",[a("div",{staticClass:"form-label required"},[a("label",[e._v(e._s(e.$t("名称")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"form-content"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"},{name:"validate",rawName:"v-validate",value:e.packageNameRule,expression:"packageNameRule"}],staticClass:"package-name",class:{"error-border":e.veeErrors.first("packageName")},attrs:{type:"text",name:"packageName",disabled:e.isEditing},domProps:{value:e.name},on:{blur:e.onPackageNameBlur,input:function(t){t.target.composing||(e.name=t.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.veeErrors.first("packageName"),expression:"veeErrors.first('packageName')",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"})])])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label required"},[a("label",[e._v(e._s(e.$t("类型")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"form-content"},[a("bk-select",{staticClass:"bk-select-inline",attrs:{disabled:e.isEditing,"popover-width":260,searchable:!0},on:{selected:e.onTypeSelect},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.list,(function(e,t){return a("bk-option",{key:t,attrs:{id:e.id,name:e.name}})})),1)],1)])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label"},[a("label",[e._v(e._s(e.$t("描述")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"form-content"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.desc,expression:"desc"}],staticClass:"package-desc",attrs:{rows:"4"},domProps:{value:e.desc},on:{blur:e.onPackageDescBlur,input:function(t){t.target.composing||(e.desc=t.target.value)}}})])])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label"},[a("label",[e._v(e._s(e.$t("详细信息")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("table",{staticClass:"detail-table"},[a("tbody",e._l(e.detailFields,(function(t){return a("tr",{key:t.id},[a("th",[e._v(e._s(t.name))]),e._v(" "),a("td",{staticClass:"td-with-input",class:{"error-border":e.veeErrors.first("detailValue"+t.id)}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.details[t.id],expression:"details[field.id]"},{name:"validate",rawName:"v-validate",value:t.validate,expression:"field.validate"}],staticClass:"table-input",attrs:{type:"text",name:"detailValue"+t.id,placeholder:t.placeholder},domProps:{value:e.details[t.id]},on:{blur:function(a){return e.onDetailInputBlur(t.id)},input:function(a){a.target.composing||e.$set(e.details,t.id,a.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.$t("必填项"),expression:"$t('必填项')",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"})])])})),0)])])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label"},[a("label",[e._v(e._s(e.$t("模块配置")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"module-table-wrapper"},[a("table",{staticClass:"module-table"},[a("thead",[a("tr",[a("th",[e._v(e._s(e.$t("子模块名称")))]),e._v(" "),a("th",[e._v(e._s(e.$t("版本")))]),e._v(" "),a("th",[e._v(e._s(e.$t("导入模块")))]),e._v(" "),a("th",[e._v(e._s(e.$t("操作")))])])]),e._v(" "),a("tbody",e._l(e.packageValues,(function(t,s){return a("tr",{key:s},[a("td",{staticClass:"td-with-input",class:{"error-border":e.veeErrors.first("moduleName"+s)}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"item.key"},{name:"validate",rawName:"v-validate",value:e.moduleNameRule,expression:"moduleNameRule"}],staticClass:"table-input",attrs:{type:"text",name:"moduleName"+s,placeholder:e.$t("请输入")},domProps:{value:t.key},on:{blur:function(t){return e.onPackageInputBlur(t,"key",s)},input:function(a){a.target.composing||e.$set(t,"key",a.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.veeErrors.first("moduleName"+s),expression:"veeErrors.first('moduleName' + index)",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"})]),e._v(" "),a("td",{staticClass:"td-with-input",class:{"error-border":e.veeErrors.first("moduleVersion"+s)}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.version,expression:"item.version"},{name:"validate",rawName:"v-validate",value:e.valueRule,expression:"valueRule"}],staticClass:"table-input",attrs:{type:"text",name:"moduleVersion"+s,placeholder:e.$t("请输入")},domProps:{value:t.version},on:{blur:function(t){return e.onPackageInputBlur(t,"version",s)},input:function(a){a.target.composing||e.$set(t,"version",a.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.veeErrors.first("moduleVersion"+s),expression:"veeErrors.first('moduleVersion' + index)",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"})]),e._v(" "),a("td",{staticClass:"td-with-input",class:{"error-border":e.veeErrors.first("modules"+s)}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.modules,expression:"item.modules"},{name:"validate",rawName:"v-validate",value:e.valueRule,expression:"valueRule"}],staticClass:"table-textarea",attrs:{row:"3",name:"modules"+s,placeholder:e.$t("请输入模块绝对路径，如a.b.c，多个用换行分隔")},domProps:{value:t.modules},on:{blur:function(t){return e.onPackageInputBlur(t,"modules",s)},input:function(a){a.target.composing||e.$set(t,"modules",a.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.veeErrors.first("modules"+s),expression:"veeErrors.first('modules' + index)",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"})]),e._v(" "),a("td",[a("bk-button",{staticClass:"delete-btn",class:{"default-color":!e.isShowDelete},attrs:{size:"small"},on:{click:function(t){return e.onDeletePackage(s)}}},[e._v("\n                                                "+e._s(e.modulesOptName)+"\n                                            ")])],1)])})),0)]),e._v(" "),a("div",{staticClass:"add-module"},[a("bk-button",{staticClass:"add-btn",attrs:{theme:"default",size:"small"},on:{click:e.onAddPackage}},[e._v(e._s(e.$t("添加")))])],1),e._v(" "),e.showModuleError?a("div",{staticClass:"common-error-tip error-msg"},[e._v(e._s(e.$t("必填项")))]):e._e()])])])])])])])}),[],!1,null,"0669b8c0",null).exports},props:{originList:{type:Array,default:function(){return[]}}},data:function(){return{list:r.a.deepClone(this.originList)}},watch:{originList:function(e){this.list=r.a.deepClone(e)}},methods:{onCreateSource:function(){this.list.push({id:void 0,name:"",desc:"",type:"git",packages:{},details:{repo_address:"",repo_raw_address:"",branch:""}})},onNextStepClick:function(){var e=this,t=this.$children.filter(function(t){return i()(this,e),"PackageForm"===t.$options.name}.bind(this)).map(function(t){return i()(this,e),t.validate()}.bind(this));Promise.all(t).then(function(t){var a=this;i()(this,e),t.every(function(e){return i()(this,a),e}.bind(this))&&this.$router.push({name:"cacheEdit"})}.bind(this))},deleteSource:function(e){this.list.splice(e,1),this.$emit("updateList","originList",this.list)},updateSource:function(e,t,a){var s=r.a.deepClone(t),i=r.a.deepClone(this.list[a]);i[e]=s,this.list.splice(a,1,i),this.$emit("updateList","originList",this.list)}}},h=(a(1444),Object(m.a)(v,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"package-edit"},[a("div",{staticClass:"source-centent"},[e._l(e.list,(function(t,s){return[a("package-form",{key:t.id,attrs:{"source-index":s,value:t},on:{updateSource:e.updateSource,deleteSource:function(t){return e.deleteSource(s)}}})]})),e._v(" "),a("div",{staticClass:"add-package",on:{click:e.onCreateSource}},[e._v(e._s(e.$t("添加主包源")))])],2),e._v(" "),a("div",{staticClass:"operate-area"},[a("bk-button",{staticClass:"next-step",attrs:{theme:"primary"},on:{click:e.onNextStepClick}},[e._v("\n            "+e._s(e.$t("下一步"))+"\n        ")]),e._v(" "),a("router-link",{staticClass:"bk-button bk-default",attrs:{to:{name:"sourceManage"}}},[e._v(e._s(e.$t("取消")))])],1)])}),[],!1,null,"42dcd89a",null));t.default=h.exports},677:function(e,t,a){var s=a(793),i=a(794),r=a(329),n=a(795);e.exports=function(e,t){return s(e)||i(e,t)||r(e,t)||n()},e.exports.default=e.exports,e.exports.__esModule=!0},788:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var s=a(1),i=[{type:"git",name:s.a.t("GIT"),keys:{repo_address:{name:s.a.t("仓库链接"),placeholder:s.a.t("请输入 GIT 仓库地址，如 https://github.com/bk-sops/plugins_example.git")},repo_raw_address:{name:s.a.t("文件托管仓库链接"),placeholder:s.a.t("请输入仓库中文件的 Raw 链接的前缀，如 https://raw.githubusercontent.com/bk-sops/plugins_example/")},branch:{name:s.a.t("分支名"),placeholder:s.a.t("请输入分支名")}}},{type:"s3",name:s.a.t("S3"),keys:{service_address:{name:s.a.t("对象存储服务地址"),placeholder:s.a.t("请输入")},bucket:{name:s.a.t("Bucket"),placeholder:s.a.t("请输入")},source_dir:{name:s.a.t("子目录"),placeholder:s.a.t("请输入")},access_key:{name:s.a.t("Access Key"),placeholder:s.a.t("请输入")},secret_key:{name:s.a.t("Secret Key"),placeholder:s.a.t("请输入")}}},{type:"fs",name:s.a.t("文件系统"),keys:{path:{name:s.a.t("服务器文件系统路径"),placeholder:s.a.t("请输入")}}}]},793:function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},794:function(e,t){e.exports=function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var s,i,r=[],n=!0,o=!1;try{for(a=a.call(e);!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}},e.exports.default=e.exports,e.exports.__esModule=!0},795:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}}]);