(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{594:function(t,a,e){"use strict";e.r(a);e(26),e(38),e(37),e(49),e(22),e(50);var n=e(16),r=e.n(n),i=e(0),o=e.n(i),l=e(5),s=e.n(l),c=e(4),p=e.n(c),d=e(1),u=e(7),g=e(750),h=e(611);function b(t,a){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),e.push.apply(e,n)}return e}function f(t){for(var a=1;a<arguments.length;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?b(Object(e),!0).forEach((function(a){s()(t,a,e[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b(Object(e)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))}))}return t}var m=[{label:d.a.t("流程ID"),prop:"templateId",sortable:!0,width:100},{label:d.a.t("流程名称"),prop:"templateName"},{label:d.a.t("项目"),prop:"projectName",width:150},{label:d.a.t("分类"),prop:"category",width:120},{label:d.a.t("创建人"),prop:"creator",width:120},{label:d.a.t("插件数"),prop:"atomTotal",sortable:!0,width:100},{label:d.a.t("子流程"),prop:"subprocessTotal",sortable:!0,width:100},{label:d.a.t("网关数"),prop:"gatewaysTotal",sortable:!0,width:100},{label:d.a.t("已执行"),prop:"instanceTotal",sortable:!0,width:100},{label:d.a.t("被引用"),prop:"relationshipTotal",sortable:!0,width:100},{label:d.a.t("周期任务"),prop:"periodicTotal",sortable:!0,width:110}],y={name:"StatisticsTemplate",components:{HorizontalBarChart:g.a,NoData:h.a},props:{dateRange:{type:Array,default:function(){return["",""]}},projectList:{type:Array,default:function(){return[]}},categoryList:{type:Array,default:function(){return[]}}},data:function(){return{categoryData:[],categoryDataProject:"",categorySelector:[{id:"category",options:this.categoryList,placeholder:d.a.t("请选择分类")}],categoryDataLoading:!0,projectData:[],projectDataCategory:"",projectSelector:[{id:"project",options:this.projectList,placeholder:d.a.t("请选择项目")}],projectDataLoading:!0,tplData:[],tplProject:"",tplCategory:"",tplSort:"",tplDataLoading:!0,tableColumn:m,pagination:{current:1,count:0,"limit-list":[15,30,50,100],limit:15}}},computed:f({},Object(u.e)({site_url:function(t){return o()(this,void 0),t.site_url}.bind(void 0)})),watch:{dateRange:function(t){this.pagination.current=1,this.getData()},projectList:function(t){this.projectSelector[0].options=t},categoryList:function(t){this.categorySelector[0].options=t}},created:function(){this.getData()},methods:f(f({},Object(u.b)("admin",["queryTemplateData"])),{},{getData:function(){this.getCategoryData(),this.getProjectData(),this.getTplData()},loadAnalysisData:function(t){var a=arguments,e=this;return r()(p.a.mark((function n(){var r,i;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"",n.prev=1,n.next=4,e.queryTemplateData(t);case 4:if(!(i=n.sent).result){n.next=8;break}return"tpl"===r&&(e.pagination.count=i.data.total),n.abrupt("return",i.data.groups);case 8:n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),console.log(n.t0);case 13:case"end":return n.stop()}}),n,null,[[1,10]])})))()},getCategoryData:function(){var t=this;return r()(p.a.mark((function a(){var e;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.categoryDataLoading=!0,e={group_by:"category",conditions:{create_time:t.dateRange[0],finish_time:t.dateRange[1],project_id:t.categoryDataProject}},a.next=5,t.loadAnalysisData(e);case 5:t.categoryData=a.sent,a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:return a.prev=11,t.categoryDataLoading=!1,a.finish(11);case 14:case"end":return a.stop()}}),a,null,[[0,8,11,14]])})))()},getProjectData:function(){var t=this;return r()(p.a.mark((function a(){var e;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.projectDataLoading=!0,e={group_by:"project_id",conditions:{create_time:t.dateRange[0],finish_time:t.dateRange[1],category:t.projectDataCategory}},a.next=5,t.loadAnalysisData(e);case 5:t.projectData=a.sent,a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:return a.prev=11,t.projectDataLoading=!1,a.finish(11);case 14:case"end":return a.stop()}}),a,null,[[0,8,11,14]])})))()},getTplData:function(){var t=this;return r()(p.a.mark((function a(){var e;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.tplDataLoading=!0,e={group_by:"template_node",conditions:{create_time:t.dateRange[0],finish_time:t.dateRange[1],project_id:t.tplProject,category:t.tplCategory,order_by:t.tplSort},pageIndex:t.pagination.current,limit:t.pagination.limit},""===t.tplSort&&delete e.conditions.order_by,a.next=6,t.loadAnalysisData(e,"tpl");case 6:t.tplData=a.sent,a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),console.log(a.t0);case 12:return a.prev=12,t.tplDataLoading=!1,a.finish(12);case 15:case"end":return a.stop()}}),a,null,[[0,9,12,15]])})))()},categoryFilterChange:function(t){this.categoryDataProject=t,this.getCategoryData()},projectFilterChange:function(t){this.projectDataCategory=t,this.getProjectData()},tplFilterChange:function(){this.pagination.current=1,this.getTplData()},handleSortChange:function(t){"ascending"===t.order?this.tplSort=t.prop:"descending"===t.order?this.tplSort="-".concat(t.prop):this.tplSort="",this.getTplData()},handlePageChange:function(t){this.pagination.current=t,this.getTplData()},handlePageLimitChange:function(t){this.pagination.limit=t,this.pagination.current=1,this.getTplData()}})},v=e(9),_=Object(v.a)(y,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"statistics-template"},[e("div",{staticClass:"bar-chart-area"},[e("horizontal-bar-chart",{attrs:{title:t.$t("分类统计"),"selector-list":t.projectSelector,"data-list":t.categoryData,"data-loading":t.categoryDataLoading},on:{onFilterClick:t.categoryFilterChange}}),t._v(" "),e("horizontal-bar-chart",{attrs:{title:t.$t("分项目统计"),"selector-list":t.categorySelector,"data-list":t.projectData,"data-loading":t.projectDataLoading},on:{onFilterClick:t.projectFilterChange}})],1),t._v(" "),e("div",{staticClass:"tab-content-area"},[e("bk-tab",[e("bk-tab-panel",t._b({},"bk-tab-panel",{name:"template",label:t.$t("流程详情")},!1),[e("bk-form",{attrs:{"form-type":"inline"}},[e("bk-form-item",{attrs:{label:t.$t("所属项目")}},[e("bk-select",{staticClass:"statistics-select",attrs:{placeholder:t.$t("请选择项目"),searchable:!0,clearable:!0,disabled:0===t.projectList.length},on:{change:t.tplFilterChange},model:{value:t.tplProject,callback:function(a){t.tplProject=a},expression:"tplProject"}},t._l(t.projectList,(function(t){return e("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1)],1),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("所属分类")}},[e("bk-select",{staticClass:"statistics-select",attrs:{placeholder:t.$t("请选择分类"),searchable:!0,clearable:!0,disabled:0===t.categoryList.length},on:{change:t.tplFilterChange},model:{value:t.tplCategory,callback:function(a){t.tplCategory=a},expression:"tplCategory"}},t._l(t.categoryList,(function(t){return e("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1)],1)],1),t._v(" "),e("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tplDataLoading,opacity:1,zIndex:100},expression:"{ isLoading: tplDataLoading, opacity: 1, zIndex: 100 }"}],staticClass:"tab-data-table",attrs:{data:t.tplData,pagination:t.pagination},on:{"sort-change":t.handleSortChange,"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange}},[t._l(t.tableColumn,(function(a){return e("bk-table-column",{key:a.prop,attrs:{label:a.label,prop:a.prop,width:a.hasOwnProperty("width")?a.width:"auto",sortable:a.sortable},scopedSlots:t._u([{key:"default",fn:function(n){return["templateName"===a.prop?e("a",{staticClass:"table-link",attrs:{target:"_blank",title:n.row.templateName,href:t.site_url+"template/edit/"+n.row.projectId+"/?template_id="+n.row.templateId}},[t._v("\n                                "+t._s(n.row.templateName)+"\n                            ")]):[e("span",{attrs:{title:n.row[a.prop]}},[t._v(t._s(n.row[a.prop]))])]]}}],null,!0)})})),t._v(" "),e("div",{staticClass:"empty-data",attrs:{slot:"empty"},slot:"empty"},[e("no-data")],1)],2)],1)],1)],1)])}),[],!1,null,null,null);a.default=_.exports},611:function(t,a,e){"use strict";var n={name:"NoData",props:{message:{type:String,default:function(){return""}}}},r=(e(634),e(9)),i=Object(r.a)(n,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"no-data-wrapper"},[e("div",{staticClass:"no-data"},[e("i",{staticClass:"common-icon-no-data"}),t._v(" "),e("p",{staticClass:"no-data-wording"},[t._t("default",(function(){return[t._v(t._s(t.message||t.$t("无数据")))]}))],2)])])}),[],!1,null,"03c0cb01",null);a.a=i.exports},625:function(t,a,e){},634:function(t,a,e){"use strict";e(625)},674:function(t,a,e){},749:function(t,a,e){"use strict";e(674)},750:function(t,a,e){"use strict";var n=e(0),r=e.n(n),i=(e(67),e(315),e(1)),o=e(611),l=[{id:"descending",name:i.a.t("降序排列")},{id:"ascending",name:i.a.t("升序排列")}],s={name:"HorizontalBarChart",components:{NoData:o.a},props:{title:{type:String,default:""},selectorList:{type:Array,default:function(){return[]}},dataLoading:{type:Boolean,default:!1},dataList:{type:Array,default:function(){return[]}},labelWidth:{type:Number,default:150}},data:function(){return{sortList:l,selectedSortType:l[0].id,selectedValue:"",isDialogShow:!1}},computed:{totalNumber:function(){var t=this;return this.dataList.reduce(function(a,e){return r()(this,t),Number(a)+Number(e.value)}.bind(this),0)},sortedData:function(){var t=this;return"descending"===this.selectedSortType?this.dataList.sort(function(a,e){return r()(this,t),e.value-a.value}.bind(this)):this.dataList.sort(function(a,e){return r()(this,t),a.value-e.value}.bind(this))}},methods:{getBlockStyle:function(t){return 0===this.totalNumber||0===t?{width:"1px",background:"#c0c4cc"}:{width:t/this.totalNumber*100+"%","min-width":"2px"}},onOptionClick:function(t,a){this.$emit("onFilterClick",a,t)},onViewAllClick:function(){this.isDialogShow=!0}}},c=(e(749),e(9)),p=Object(c.a)(s,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"horizontal-bar-chart"},[e("h3",{staticClass:"chart-title"},[t._v(t._s(t.title))]),t._v(" "),e("bk-form",{staticClass:"select-wrapper",attrs:{"form-type":"inline"}},[e("bk-form-item",[e("bk-select",{staticStyle:{width:"120px"},attrs:{clearable:!1},model:{value:t.selectedSortType,callback:function(a){t.selectedSortType=a},expression:"selectedSortType"}},t._l(t.sortList,(function(a){return e("bk-option",{key:a.id,attrs:{id:a.id,name:a.name}},[t._v("\n                    "+t._s(a.name)+"\n                ")])})),1)],1),t._v(" "),t._l(t.selectorList,(function(a){return e("bk-form-item",{key:a.id},[e("bk-select",{staticClass:"statistics-select",attrs:{searchable:!0,clearable:!1!==a.clearable,placeholder:a.placeholder,disabled:0===a.options.length,value:a.selected},on:{change:function(e){return t.onOptionClick(a.id,e)}}},t._l(a.options,(function(a){return e("bk-option",{key:a.id,attrs:{id:a.id,name:a.name}},[t._v("\n                    "+t._s(a.name)+"\n                ")])})),1)],1)}))],2),t._v(" "),e("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.dataLoading,opacity:1,zIndex:100},expression:"{ isLoading: dataLoading, opacity: 1, zIndex: 100 }"}],staticClass:"content-wrapper"},[e("div",{staticClass:"chart-content"},[t.dataLoading||t.sortedData.length>0?t._l(t.sortedData,(function(a,n){return e("div",{key:n,staticClass:"data-item"},[e("span",{staticClass:"data-label",style:{width:t.labelWidth+"px"},attrs:{title:a.name}},[t._v(t._s(a.name))]),t._v(" "),e("div",{staticClass:"data-bar",style:{width:"calc(100% - "+(t.labelWidth+100)+"px)"}},[e("div",{staticClass:"block",style:t.getBlockStyle(a.value)},[e("span",{staticClass:"num"},[t._v(t._s(a.value))])])])])})):e("no-data")],2)]),t._v(" "),!t.dataLoading&&t.sortedData.length>7?e("div",{staticClass:"view-all-btn",on:{click:t.onViewAllClick}},[t._v(t._s(t.$t("查看全部")))]):t._e(),t._v(" "),e("bk-dialog",{attrs:{fullscreen:!0,title:t.title,"header-position":"left","close-icon":!1},scopedSlots:t._u([{key:"footer",fn:function(){return[e("bk-button",{attrs:{theme:"default"},on:{click:function(a){t.isDialogShow=!1}}},[t._v(t._s(t.$t("关闭")))])]},proxy:!0}]),model:{value:t.isDialogShow,callback:function(a){t.isDialogShow=a},expression:"isDialogShow"}},[e("div",{staticClass:"dialog-content"},t._l(t.sortedData,(function(a,n){return e("div",{key:n,staticClass:"data-item"},[e("span",{staticClass:"data-label",style:{width:t.labelWidth+"px"},attrs:{title:a.name}},[t._v(t._s(a.name))]),t._v(" "),e("div",{staticClass:"data-bar",style:{width:"calc(100% - "+(t.labelWidth+100)+"px)"}},[e("div",{staticClass:"block",style:t.getBlockStyle(a.value)},[e("span",{staticClass:"num"},[t._v(t._s(a.value))])])])])})),0)])],1)}),[],!1,null,"70109276",null);a.a=p.exports}}]);