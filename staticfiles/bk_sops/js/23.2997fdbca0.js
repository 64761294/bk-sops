(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1182:function(t,e,a){},1183:function(t,e,a){},1436:function(t,e,a){"use strict";a(1182)},1437:function(t,e,a){"use strict";a(1183)},578:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=(a(26),a(38),a(49),a(50),a(16)),s=a.n(i),o=a(5),c=a.n(o),l=a(4),p=a.n(l),u=(a(27),a(678),a(80),a(37),a(127),a(184),a(22),a(23),a(1)),d=a(7),h=a(102),m=a(611);function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function v(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(Object(a),!0).forEach((function(e){c()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var f=[{label:u.a.t("ID"),prop:"id",width:100},{label:u.a.t("流程名称"),prop:"name"},{label:u.a.t("项目"),prop:"projectName",width:200},{label:u.a.t("更新时间"),prop:"edit_time",width:200},{label:u.a.t("创建时间"),prop:"create_time",width:200},{label:u.a.t("是否已删除"),prop:"is_deleted",width:100},{label:u.a.t("操作"),prop:"operation",width:100}],k=[{label:u.a.t("ID"),prop:"id",width:90},{label:u.a.t("任务名称"),prop:"name"},{label:u.a.t("项目"),prop:"projectName"},{label:u.a.t("执行开始"),prop:"start_time",width:200},{label:u.a.t("执行结束"),prop:"finish_time",width:200},{label:u.a.t("创建时间"),prop:"create_time",width:200},{label:u.a.t("创建人"),prop:"creator_name",width:100},{label:u.a.t("执行人"),prop:"executor_name",width:100},{label:u.a.t("创建方式"),prop:"create_method",width:100},{label:u.a.t("状态"),prop:"status",width:100}],_={name:"SearchResult",components:{NoData:m.a},mixins:[h.a],props:{keyword:String,hasEditPerm:Boolean,editPermLoading:Boolean},data:function(){return{searchStr:this.keyword,searchLoading:!0,tplListColumn:f,taskListColumn:k,tplDataLoading:!1,taskDataLoading:!1,matchedList:[],methodList:{},templateResultTotal:0,taskResultTotal:0,tplFilter:{},tplResource:{},taskFilter:{},tplData:[],taskData:[],executeStatus:[],taskOperations:[],taskResource:{},isRestoreDialogShow:!1,restoreData:{},restorePending:!1,tplPagination:{current:1,count:0,"limit-list":[15,30,50,100],limit:15},taskPagination:{current:1,count:0,"limit-list":[15,30,50,100],limit:15}}},computed:v(v({},Object(d.e)({site_url:function(t){return r()(this,void 0),t.site_url}.bind(void 0)})),{},{searchResultTotal:function(){return this.templateResultTotal+this.taskResultTotal}}),created:function(){this.getSearchResult()},methods:v(v(v({},Object(d.b)("task/",["getInstanceStatus","loadCreateMethod"])),Object(d.b)("admin/",["search","template","templateRestore","taskflow"])),{},{getSearchResult:function(){var t=this;return s()(p.a.mark((function e(){var a,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.searchLoading=!0,t.templateResultTotal=0,t.taskResultTotal=0,e.next=6,t.search({keyword:t.searchStr});case 6:(a=e.sent).result&&(t.matchedList=a.data.matched,t.tplFilter=t.matchedList.find(function(t){return r()(this,n),"flow"===t.type}.bind(this)),t.taskFilter=t.matchedList.find(function(t){return r()(this,n),"task"===t.type}.bind(this)),t.tplFilter&&t.getAdminTemplate(),t.taskFilter&&(t.getAdminTask(),t.getCreateMethod())),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:return e.prev=13,t.searchLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[0,10,13,16]])})))()},getAdminTemplate:function(){var t=this;return s()(p.a.mark((function e(){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.tplDataLoading=!0,a=v({limit:t.tplPagination.limit,offset:(t.tplPagination.current-1)*t.tplPagination.limit},t.tplFilter.filter),e.next=5,t.template(a);case 5:n=e.sent,t.tplData=n.objects,t.templateResultTotal=n.meta.total_count,t.tplResource=n.meta.auth_resource,t.tplPagination.count=n.meta.total_count,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:return e.prev=15,t.tplDataLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})))()},getAdminTask:function(){var t=this;return s()(p.a.mark((function e(){var a,n,i=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.taskDataLoading=!0,a=v({limit:t.taskPagination.limit,offset:(t.taskPagination.current-1)*t.taskPagination.limit},t.taskFilter.filter),e.next=5,t.taskflow(a);case 5:n=e.sent,t.taskData=n.objects,t.taskResultTotal=n.meta.total_count,t.taskOperations=n.meta.auth_operations,t.taskResource=n.meta.auth_resource,t.taskPagination.count=n.meta.total_count,t.executeStatus=n.objects.map(function(e,a){r()(this,i);var n={};return e.is_finished?(n.cls="finished bk-icon icon-check-circle-shape",n.text=u.a.t("完成")):e.is_revoked?(n.cls="revoke common-icon-dark-circle-shape",n.text=u.a.t("撤销")):e.is_started?(n.cls="loading common-icon-loading",t.getExecuteDetail(e,a)):(n.cls="created common-icon-dark-circle-shape",n.text=u.a.t("未执行")),n}.bind(this)),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0);case 17:return e.prev=17,t.taskDataLoading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[0,14,17,20]])})))()},getExecuteDetail:function(t,e){var a=this;return s()(p.a.mark((function n(){var r,i,s,o;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={instance_id:t.id,project_id:t.project.id},n.prev=1,n.next=4,a.getInstanceStatus(r);case 4:if(!(i=n.sent).result){n.next=28;break}s=i.data.state,o={},n.t0=s,n.next="RUNNING"===n.t0||"BLOCKED"===n.t0?11:"READY"===n.t0?14:"SUSPENDED"===n.t0?17:"NODE_SUSPENDED"===n.t0?20:"FAILED"===n.t0?23:26;break;case 11:return o.cls="running common-icon-dark-circle-ellipsis",o.text=u.a.t("执行中"),n.abrupt("break",27);case 14:return o.cls="running common-icon-dark-circle-ellipsis",o.text=u.a.t("排队中"),n.abrupt("break",27);case 17:return o.cls="execute common-icon-dark-circle-pause",o.text=u.a.t("暂停"),n.abrupt("break",27);case 20:return o.cls="execute common-icon-dark-circle-pause",o.text=u.a.t("节点暂停"),n.abrupt("break",27);case 23:return o.cls="failed common-icon-dark-circle-close",o.text=u.a.t("失败"),n.abrupt("break",27);case 26:o.text=u.a.t("未知");case 27:a.executeStatus.splice(e,1,o);case 28:n.next=33;break;case 30:n.prev=30,n.t1=n.catch(1),console.log(n.t1);case 33:case"end":return n.stop()}}),n,null,[[1,30]])})))()},getCreateMethod:function(){var t=this;return s()(p.a.mark((function e(){var a,n,i=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={},e.next=4,t.loadCreateMethod();case 4:(n=e.sent).result&&(n.data.forEach(function(t){r()(this,i),a[t.value]=t.name}.bind(this)),t.methodList=a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})))()},onSearch:function(){this.getSearchResult()},onApplyPerm:function(t,e,a){var n={project:[{id:e.project.id,name:e.project.name}]},r={id:e.id,name:e.name};"tpl"===a?n.flow=[r]:n.task=[r],this.applyForPermission(t,e.auth_actions,n)},onRestoreTemplate:function(t){this.editPermLoading||(this.hasEditPerm?(this.isRestoreDialogShow=!0,this.restoreData=t):this.applyForPermission(["admin_edit"]))},onRestoreConfirm:function(){var t=this;return s()(p.a.mark((function e(){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.restorePending){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t.restorePending=!0,a={template_id:t.restoreData.id},e.next=7,t.templateRestore(a);case 7:e.sent.result&&(t.isRestoreDialogShow=!1,t.getAdminTemplate()),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log(e.t0);case 14:return e.prev=14,t.restorePending=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})))()},handlePageChange:function(t,e){"tpl"===e?(this.tplPagination.current=t,this.getAdminTemplate()):(this.taskPagination.current=t,this.getAdminTask())},handlePageLimitChange:function(t,e){"tpl"===e?(this.tplPagination.limit=t,this.tplPagination.current=1,this.getAdminTemplate()):(this.taskPagination.limit=t,this.taskPagination.current=1,this.getAdminTask())}})},b=(a(1436),a(9)),w={name:"AdminSearch",components:{SearchResult:Object(b.a)(_,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search-result"},[a("div",{staticClass:"search-input"},[a("bk-input",{attrs:{"right-icon":"bk-icon icon-search"},on:{enter:t.onSearch},model:{value:t.searchStr,callback:function(e){t.searchStr="string"==typeof e?e.trim():e},expression:"searchStr"}})],1),t._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.searchLoading,opacity:1,zIndex:100},expression:"{ isLoading: searchLoading, opacity: 1, zIndex: 100 }"}],staticClass:"result-wrapper"},[a("div",{staticClass:"result-title"},[a("h3",[t._v(t._s(t.$t("搜索结果")))]),t._v(" "),a("span",[t._v(t._s(t.$t("找到")))]),t._v(t._s(t.searchResultTotal)),a("span",[t._v(t._s(t.$t("条结果")))])]),t._v(" "),t.matchedList.length?[t.tplDataLoading||t.tplData.length?a("div",{staticClass:"list-table template-list-table"},[a("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tplDataLoading,opacity:1,zIndex:100},expression:"{ isLoading: tplDataLoading, opacity: 1, zIndex: 100 }"}],attrs:{data:t.tplData,pagination:t.tplPagination},on:{"page-change":function(e){return t.handlePageChange(e,"tpl")},"page-limit-change":function(e){return t.handlePageLimitChange(e,"tpl")}}},[t._l(t.tplListColumn,(function(e){return a("bk-table-column",{key:e.props,attrs:{label:e.label,prop:e.prop,width:e.hasOwnProperty("width")?e.width:"auto",sortable:e.sortable},scopedSlots:t._u([{key:"default",fn:function(n){return["name"===e.prop?[t.hasPermission(["flow_view"],n.row.auth_actions)?a("a",{staticClass:"table-link",attrs:{target:"_blank",title:n.row.name,href:t.site_url+"template/edit/"+n.row.project.id+"/?template_id="+n.row.id}},[t._v("\n                                    "+t._s(n.row.name)+"\n                                ")]):a("span",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!0},expression:"{ active: true }"}],staticClass:"text-permission-disable",on:{click:function(e){return t.onApplyPerm(["flow_view"],n.row,"tpl")}}},[t._v("\n                                    "+t._s(n.row.name)+"\n                                ")])]:"projectName"===e.prop?[a("span",{attrs:{title:n.row[e.prop]}},[t._v(t._s(n.row.project.name))])]:"is_deleted"===e.prop?[a("span",[t._v(t._s(n.row.is_deleted?t.$t("是"):t.$t("否")))])]:"operation"===e.prop?[n.row.is_deleted?a("span",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasEditPerm},expression:"{ active: !hasEditPerm }"}],class:["table-link",{"text-permission-disable":!t.hasEditPerm}],on:{click:function(e){return t.onRestoreTemplate(n.row)}}},[t._v("\n                                    "+t._s(t.$t("恢复模板"))+"\n                                ")]):[t.hasPermission(["flow_edit"],n.row.auth_actions)?a("a",{staticClass:"table-link",attrs:{target:"_blank",href:t.site_url+"template/edit/"+n.row.project.id+"/?template_id="+n.row.id}},[t._v("\n                                        "+t._s(t.$t("编辑"))+"\n                                    ")]):a("span",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!0},expression:"{ active: true }"}],staticClass:"text-permission-disable",on:{click:function(e){return t.onApplyPerm(["flow_edit"],n.row,"tpl")}}},[t._v("\n                                        "+t._s(t.$t("编辑"))+"\n                                    ")])]]:[t._v(t._s(n.row[e.prop]))]]}}],null,!0)})})),t._v(" "),a("div",{attrs:{slot:"empty"},slot:"empty"},[a("no-data")],1)],2)],1):t._e(),t._v(" "),t.taskDataLoading||t.taskData.length?a("div",{staticClass:"list-table task-list-table"},[a("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.taskDataLoading,opacity:1,zIndex:100},expression:"{ isLoading: taskDataLoading, opacity: 1, zIndex: 100 }"}],attrs:{data:t.taskData,pagination:t.taskPagination},on:{"page-change":function(e){return t.handlePageChange(e,"task")},"page-limit-change":function(e){return t.handlePageLimitChange(e,"task")}}},[t._l(t.taskListColumn,(function(e){return a("bk-table-column",{key:e.props,attrs:{label:e.label,prop:e.prop,width:e.hasOwnProperty("width")?e.width:"auto",sortable:e.sortable},scopedSlots:t._u([{key:"default",fn:function(n){return["name"===e.prop?[t.hasPermission(["task_view"],n.row.auth_actions,t.taskOperations)?a("a",{staticClass:"table-link",attrs:{target:"_blank",title:n.row.name,href:t.site_url+"taskflow/execute/"+n.row.project.id+"/?instance_id="+n.row.id+"&is_admin=true"}},[t._v("\n                                    "+t._s(n.row.name)+"\n                                ")]):a("span",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!0},expression:"{ active: true }"}],staticClass:"text-permission-disable",on:{click:function(e){return t.onApplyPerm(["task_view"],n.row,"task")}}},[t._v("\n                                    "+t._s(n.row.name)+"\n                                ")])]:"projectName"===e.prop?[a("span",{attrs:{title:n.row[e.prop]}},[t._v(t._s(n.row.project.name))])]:["start_time","finish_time","executor_name"].includes(e.prop)?[a("span",{attrs:{title:n.row[e.prop]}},[t._v(t._s(n.row[e.prop]||"--"))])]:"create_method"===e.prop?[a("span",[t._v(t._s(t.methodList[n.row.create_method]||n.row.create_method))])]:"status"===e.prop?[a("div",{staticClass:"task-status"},[a("span",{class:t.executeStatus[n.$index]&&t.executeStatus[n.$index].cls}),t._v(" "),t.executeStatus[n.$index]?a("span",{staticClass:"task-status-text"},[t._v(t._s(t.executeStatus[n.$index].text))]):t._e()])]:[t._v(t._s(n.row[e.prop]))]]}}],null,!0)})})),t._v(" "),a("div",{attrs:{slot:"empty"},slot:"empty"},[a("no-data")],1)],2)],1):t._e()]:a("div",{staticClass:"no-data-matched",attrs:{slot:"empty"},slot:"empty"},[a("no-data",{attrs:{message:t.$t("没有找到相关内容")}})],1)],2),t._v(" "),a("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog",theme:"primary","mask-close":!1,"header-position":"left",title:t.$t("恢复模板"),value:t.isRestoreDialogShow,loading:t.restorePending},on:{confirm:t.onRestoreConfirm,cancel:function(e){t.isRestoreDialogShow=!1}}},[a("div",{staticClass:"dialog-content"},[t._v("\n            "+t._s(t.$t("确认恢复")+'"'+t.restoreData.name+'"?')+"\n        ")])])],1)}),[],!1,null,"0e202b7a",null).exports},props:{hasEditPerm:Boolean,editPermLoading:Boolean},data:function(){return{showResultComp:!1,searchStr:"",timer:null}},methods:{onChange:function(){var t=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){r()(this,t),this.onSearchInput()}.bind(this),1e3)},onSearchInput:function(){this.showResultComp=!0}}},x=(a(1437),Object(b.a)(w,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"admin-search"},[t.showResultComp?a("search-result",{attrs:{keyword:t.searchStr,"has-edit-perm":t.hasEditPerm,"edit-perm-loading":t.editPermLoading},on:{onSearch:t.onSearchInput}}):a("div",{staticClass:"search-wrapper"},[a("p",{staticClass:"tips"},[t._v(t._s(t.$t("输入项目名、模板ID或任务ID进行搜索")))]),t._v(" "),a("bk-input",{staticClass:"search-input",attrs:{"right-icon":"bk-icon icon-search"},on:{change:t.onChange,enter:t.onSearchInput},model:{value:t.searchStr,callback:function(e){t.searchStr="string"==typeof e?e.trim():e},expression:"searchStr"}})],1)],1)}),[],!1,null,"22de57b1",null));e.default=x.exports},611:function(t,e,a){"use strict";var n={name:"NoData",props:{message:{type:String,default:function(){return""}}}},r=(a(634),a(9)),i=Object(r.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"no-data-wrapper"},[a("div",{staticClass:"no-data"},[a("i",{staticClass:"common-icon-no-data"}),t._v(" "),a("p",{staticClass:"no-data-wording"},[t._t("default",(function(){return[t._v(t._s(t.message||t.$t("无数据")))]}))],2)])])}),[],!1,null,"03c0cb01",null);e.a=i.exports},625:function(t,e,a){},634:function(t,e,a){"use strict";a(625)},678:function(t,e,a){"use strict";var n=a(138),r=a(17),i=a(45),s=a(688),o=a(139);n("search",(function(t,e,a){return[function(e){var a=i(this),n=null==e?void 0:e[t];return void 0!==n?n.call(e,a):new RegExp(e)[t](String(a))},function(t){var n=a(e,this,t);if(n.done)return n.value;var i=r(this),c=String(t),l=i.lastIndex;s(l,0)||(i.lastIndex=0);var p=o(i,c);return s(i.lastIndex,l)||(i.lastIndex=l),null===p?-1:p.index}]}))},688:function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}}}]);