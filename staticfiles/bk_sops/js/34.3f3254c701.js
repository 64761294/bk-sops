(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1147:function(e,t,i){},1399:function(e,t,i){"use strict";i(1147)},586:function(e,t,i){"use strict";i.r(t);i(38),i(49),i(50);var n=i(51),a=i.n(n),o=i(16),r=i.n(o),s=i(5),c=i.n(s),l=i(0),m=i.n(l),p=i(4),d=i.n(p),u=(i(127),i(27),i(81),i(67),i(183),i(80),i(37),i(68),i(103),i(43),i(23),i(82),i(22),i(26),i(24),i(1)),h=i(7),f=i(28),g=i(675),v=i(1217),b=i(1218),_=i(695),w=i(611),C=i(102),y=i(992),k=i(687),j=i.n(k);function P(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?P(Object(i),!0).forEach((function(t){c()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var L=[{type:"dateRange",key:"queryTime",placeholder:u.a.t("选择日期时间范围"),label:u.a.t("更新时间"),value:[]},{type:"select",label:u.a.t("子流程更新"),key:"subprocessUpdateVal",placeholder:u.a.t("请选择"),list:[{value:1,name:u.a.t("是")},{value:-1,name:u.a.t("否")},{value:0,name:u.a.t("无子流程")}],value:""},{type:"input",key:"creator",label:u.a.t("创建人"),placeholder:u.a.t("请输入创建人"),value:""},{type:"select",label:u.a.t("分类"),key:"category",loading:!0,placeholder:u.a.t("请选择分类"),tips:u.a.t("模板分类即将下线，建议使用标签"),list:[],value:""}],x=[{id:"id",label:u.a.t("ID"),width:80},{id:"name",label:u.a.t("流程名称"),disabled:!0,min_width:400},{id:"create_time",label:u.a.t("创建时间"),sortable:"custom",width:200},{id:"edit_time",label:u.a.t("更新时间"),sortable:"custom",width:200},{id:"subprocess_has_update",label:u.a.t("子流程更新"),width:200},{id:"category_name",label:u.a.t("分类"),min_width:180},{id:"creator_name",label:u.a.t("创建人"),width:160},{id:"editor_name",label:u.a.t("更新人"),width:160}],D={name:"TemplateList",components:{Skeleton:g.a,ImportTemplateDialog:v.a,ExportTemplateDialog:b.a,SelectProjectModal:y.a,AdvanceSearchForm:_.a,NoData:w.a},mixins:[C.a],data:function(){var e=this,t=this.$route.query,i=t.page,n=void 0===i?1:i,a=t.limit,o=void 0===a?15:a,r=t.category,s=void 0===r?"":r,c=t.queryTime,l=void 0===c?"":c,p=t.subprocessUpdateVal,d=void 0===p?"":p,u=t.creator,h=void 0===u?"":u,f=t.keyword,g=void 0===f?"":f;return{firstLoading:!0,listLoading:!1,projectInfoLoading:!0,searchForm:L.map(function(t){return m()(this,e),this.$route.query[t.key]&&(Array.isArray(t.value)?t.value=this.$route.query[t.key].split(","):t.value=this.$route.query[t.key]),t}.bind(this)),isSearchFormOpen:L.some(function(t){return m()(this,e),this.$route.query[t.key]}.bind(this)),expiredSubflowTplList:[],isDeleteDialogShow:!1,isImportDialogShow:!1,isExportDialogShow:!1,isAuthorityDialogShow:!1,isSelectProjectShow:!1,theDeleteTemplateId:void 0,theAuthorityManageId:void 0,active:!0,pending:{export:!1,delete:!1},templateCategoryList:[],collectListLoading:!1,collectionList:[],category:void 0,editEndTime:void 0,templateType:this.common_template,deleteTemplateName:"",requestData:{category:s,subprocessUpdateVal:""!==d?Number(d):"",creator:h,queryTime:l?l.split(","):["",""],flowName:g},totalPage:1,pagination:{current:Number(n),count:0,limit:Number(o),"limit-list":[15,30,50,100]},collectingId:"",hasCreateCommonTplPerm:!1,permissionLoading:!1,hasCreateTaskPerm:!0,selectedProject:{},selectedTpl:{},ordering:null,tableFields:x,defaultSelected:["id","name","label","edit_time","subprocess_has_update","creator_name"],setting:{fieldList:x,selectedFields:x.slice(0),size:"small"}}},computed:T(T({},Object(h.e)({site_url:function(e){return m()(this,void 0),e.site_url}.bind(void 0),templateList:function(e){return m()(this,void 0),e.templateList.templateListData}.bind(void 0),commonTemplateData:function(e){return m()(this,void 0),e.templateList.commonTemplateData}.bind(void 0),projectBaseInfo:function(e){return m()(this,void 0),e.template.projectBaseInfo}.bind(void 0),v1_import_flag:function(e){return m()(this,void 0),e.v1_import_flag}.bind(void 0),permissionMeta:function(e){return m()(this,void 0),e.permissionMeta}.bind(void 0)})),Object(h.e)("project",{timeZone:function(e){return m()(this,void 0),e.timezone}.bind(void 0),projectName:function(e){return m()(this,void 0),e.projectName}.bind(void 0),project_id:function(e){return m()(this,void 0),e.project_id}.bind(void 0)})),watch:{page:function(e,t){e!==t&&(this.pagination.current=Number(e)||1,this.getTemplateList())}},created:function(){var e=this;return r()(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.getFields(),e.getCollectList(),e.getProjectBaseInfo(),e.queryCreateCommonTplPerm(),e.onSearchInput=f.a.debounce(e.searchInputhandler,500),t.next=7,e.getTemplateList();case 7:e.firstLoading=!1;case 8:case"end":return t.stop()}}),t)})))()},methods:T(T(T(T(T(T({},Object(h.b)(["queryUserPermission","addToCollectList","deleteCollect","loadCollectList"])),Object(h.b)("template/",["loadProjectBaseInfo"])),Object(h.b)("templateList/",["loadTemplateList","deleteTemplate","templateImport","templateExport"])),Object(h.d)("template/",["setProjectBaseInfo"])),Object(h.d)("templateList/",["setTemplateListData"])),{},{queryCreateCommonTplPerm:function(){var e=this;return r()(d.a.mark((function t(){var i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.queryUserPermission({action:"common_flow_create"});case 3:i=t.sent,e.hasCreateCommonTplPerm=i.data.is_allow,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getTemplateList:function(){var e=this;return r()(d.a.mark((function t(){var i,n,a,o,r,s,c,l,m,p,u,h;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.prev=1,i=e.requestData,n=i.subprocessUpdateVal,a=i.creator,o=i.category,r=i.queryTime,s=i.flowName,c=1===n||-1===n||0!==n&&void 0,l=1===n||-1!==n&&void 0,m={limit:e.pagination.limit,offset:(e.pagination.current-1)*e.pagination.limit,common:"1",pipeline_template__name__icontains:s||void 0,pipeline_template__creator__contains:a||void 0,category:o||void 0,subprocess_has_update:l,has_subprocess:c,order_by:e.ordering||void 0},r[0]&&r[1]&&(m.pipeline_template__edit_time__gte=j()(r[0]).format("YYYY-MM-DD"),m.pipeline_template__edit_time__lte=j()(r[1]).add("1","d").format("YYYY-MM-DD")),t.next=9,e.loadTemplateList(m);case 9:p=t.sent,u=p.objects,e.setTemplateListData({list:u,isCommon:!0}),e.pagination.count=p.meta.total_count,h=Math.ceil(e.pagination.count/e.pagination.limit),e.totalPage=h||1,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),console.log(t.t0);case 20:return t.prev=20,e.listLoading=!1,t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[1,17,20,23]])})))()},getProjectBaseInfo:function(){var e=this;return r()(d.a.mark((function t(){var i,n,a=this;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.projectInfoLoading=!0,e.categoryLoading=!0,t.prev=2,t.next=5,e.loadProjectBaseInfo();case 5:i=t.sent,e.setProjectBaseInfo(i.data),e.templateCategoryList=i.data.task_categories,(n=e.searchForm.find(function(e){return m()(this,a),"category"===e.key}.bind(this))).list=e.templateCategoryList,n.loading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),console.log(t.t0);case 16:return t.prev=16,e.projectInfoLoading=!1,e.categoryLoading=!1,t.finish(16);case 20:case"end":return t.stop()}}),t,this,[[2,13,16,20]])})))()},getFields:function(){var e,t=this,i=localStorage.getItem("commonTemplateList");if(i){var n=JSON.parse(i),a=n.fieldList,o=n.size;this.setting.size=o,e=a}else e=this.defaultSelected;this.setting.selectedFields=this.tableFields.slice(0).filter(function(i){return m()(this,t),e.includes(i.id)}.bind(this))},getCollectList:function(){var e=this;return r()(d.a.mark((function t(){var i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.collectListLoading=!0,t.next=4,e.loadCollectList();case 4:i=t.sent,e.collectionList=i.objects,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:return t.prev=11,e.collectListLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[0,8,11,14]])})))()},checkCreatePermission:function(){this.hasCreateCommonTplPerm?this.$router.push({name:"commonTemplatePanel",params:{type:"new"}}):this.applyForPermission(["common_flow_create"])},searchInputhandler:function(e){this.requestData.flowName=e,this.pagination.current=1,this.getTemplateList()},onSearchFormSubmit:function(e){this.requestData=Object.assign({},this.requestData,e),this.pagination.current=1,this.updateUrl(),this.getTemplateList()},onImportTemplate:function(){this.isImportDialogShow=!0},onImportConfirm:function(){this.isImportDialogShow=!1,this.getTemplateList()},onImportCancel:function(){this.isImportDialogShow=!1},onExportTemplate:function(){this.isExportDialogShow=!0},onExportConfirm:function(e){var t=this;return r()(d.a.mark((function i(){var n;return d.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.pending.export){i.next=2;break}return i.abrupt("return");case 2:return t.pending.export=!0,i.prev=3,n={common:"1",list:e},i.next=7,t.templateExport(n);case 7:i.sent.result&&(t.isExportDialogShow=!1),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(3),console.log(i.t0);case 14:return i.prev=14,t.pending.export=!1,i.finish(14);case 17:case"end":return i.stop()}}),i,null,[[3,11,14,17]])})))()},onExportCancel:function(){this.isExportDialogShow=!1},onDeleteTemplate:function(e){this.hasPermission(["common_flow_delete"],e.auth_actions)?(this.theDeleteTemplateId=e.id,this.deleteTemplateName=e.name,this.isDeleteDialogShow=!0):this.onTemplatePermissonCheck(["common_flow_delete"],e)},handleSortChange:function(e){var t=e.prop,i=e.order,n="pipeline_template__"+t;this.ordering="ascending"===i?n:"descending"===i?"-"+n:"",this.pagination.current=1,this.getTemplateList()},onPageChange:function(e){this.pagination.current=e,this.updateUrl(),this.getTemplateList()},onPageLimitChange:function(e){this.pagination.limit=e,this.pagination.current=1,this.updateUrl(),this.getTemplateList()},handleSettingChange:function(e){var t=this,i=e.fields,n=e.size;this.setting.size=n,this.setting.selectedFields=i;var a=i.map(function(e){return m()(this,t),e.id}.bind(this));localStorage.setItem("commonTemplateList",JSON.stringify({fieldList:a,size:n}))},updateUrl:function(){var e=this,t=this.pagination,i=t.current,n=t.limit,a=this.requestData,o=a.category,r=a.queryTime,s=a.subprocessUpdateVal,c=a.creator,l=a.flowName,p={limit:n,category:o,subprocessUpdateVal:s,creator:c,page:i,queryTime:r.every(function(t){return m()(this,e),t}.bind(this))?r.join(","):"",keyword:l},d={};Object.keys(p).forEach(function(t){m()(this,e);var i=p[t];(i||0===i||!1===i)&&(d[t]=i)}.bind(this)),this.$router.push({name:"commonProcessList",query:d})},onTemplatePermissonCheck:function(e,t){var i=t.auth_actions.slice(0),n={common_flow:[{id:t.id,name:t.name}]};this.applyForPermission(e,i,n)},onDeleteConfirm:function(){var e=this;return r()(d.a.mark((function t(){var i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.pending.delete){t.next=2;break}return t.abrupt("return");case 2:return e.pending.delete=!0,t.prev=3,i={templateId:e.theDeleteTemplateId,common:"1"},t.next=7,e.deleteTemplate(i);case 7:e.theDeleteTemplateId=void 0,e.isDeleteDialogShow=!1,e.pagination.current>1&&e.totalPage===e.pagination.current&&e.pagination.count-(e.totalPage-1)*e.pagination.limit==1&&(e.pagination.current-=1),e.getTemplateList(),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),console.log(t.t0);case 16:return t.prev=16,e.pending.delete=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[3,13,16,19]])})))()},onDeleteCancel:function(){this.theDeleteTemplateId=void 0,this.isDeleteDialogShow=!1},getJumpUrl:function(e,t){var i={edit:{name:"commonTemplatePanel",params:{type:"edit"}},newTemplate:{name:"commonTemplatePanel",params:{type:"new"}},newTask:{name:"taskCreate",params:{project_id:this.project_id,step:"selectnode"}},clone:{name:"commonTemplatePanel",params:{type:"clone"}}}[e];i.query={template_id:t,common:"1"},this.$router.push(i)},getExecuteHistoryUrl:function(e){return{name:"taskList",params:{project_id:this.project_id},query:{template_id:e,template_source:"common"}}},getSubflowContent:function(e){return e.has_subprocess?e.subprocess_has_update?u.a.t("是"):u.a.t("否"):"--"},onCollectTemplate:function(e){var t=this;return r()(d.a.mark((function i(){var n,a=this;return d.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t.hasPermission(["common_flow_view"],e.auth_actions)){i.next=3;break}return t.onTemplatePermissonCheck(["common_flow_view"],e),i.abrupt("return");case 3:if("number"!=typeof t.collectingId){i.next=5;break}return i.abrupt("return");case 5:if(i.prev=5,t.collectingId=e.id,t.isCollected(e.id)){i.next=14;break}return i.next=10,t.addToCollectList([{extra_info:{template_id:e.template_id,name:e.name,id:e.id},category:"common_flow"}]);case 10:i.sent.objects.length&&t.$bkMessage({message:u.a.t("添加收藏成功！"),theme:"success"}),i.next=18;break;case 14:return n=t.collectionList.find(function(t){return m()(this,a),t.extra_info.id===e.id&&"common_flow"===t.category}.bind(this)).id,i.next=17,t.deleteCollect(n);case 17:t.$bkMessage({message:u.a.t("取消收藏成功！"),theme:"success"});case 18:t.getCollectList(),i.next=24;break;case 21:i.prev=21,i.t0=i.catch(5),console.log(i.t0);case 24:return i.prev=24,t.collectingId="",i.finish(24);case 27:case"end":return i.stop()}}),i,this,[[5,21,24,27]])})))()},isCollected:function(e){var t=this;return!!this.collectionList.find(function(i){return m()(this,t),i.extra_info.id===e&&"common_flow"===i.category}.bind(this))},handleCreateTaskClick:function(e){this.selectedTpl=e,this.isSelectProjectShow=!0,this.permissionLoading=!1,this.hasCreateTaskPerm=!0},handleProjectChange:function(e){var t=this;return r()(d.a.mark((function i(){var n,a,o,r=this;return d.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,t.permissionLoading=!1,t.selectedProject=e,n=t.permissionMeta.system.find(function(e){return m()(this,r),"bk_sops"===e.id}.bind(this)),a={action:"common_flow_create_task",resources:[{system:n.id,type:"project",id:t.selectedProject.id,attributes:{}},{system:n.id,type:"common_flow",id:t.selectedTpl.id,attributes:{}}]},i.next=7,t.queryUserPermission(a);case 7:o=i.sent,t.hasCreateTaskPerm=o.data.is_allow,i.next=14;break;case 11:i.prev=11,i.t0=i.catch(0),console.log(i.t0);case 14:return i.prev=14,t.permissionLoading=!1,i.finish(14);case 17:case"end":return i.stop()}}),i,this,[[0,11,14,17]])})))()},handleCreateTaskConfirm:function(){if(this.hasCreateTaskPerm)this.$router.push({name:"taskCreate",query:{template_id:this.selectedTpl.id,common:"1"},params:{project_id:this.selectedProject.id,step:"selectnode"}});else{var e=[].concat(a()(this.selectedTpl.auth_actions),a()(this.selectedProject.auth_actions)),t={common_flow:[{id:this.selectedTpl.id,name:this.selectedTpl.name}],project:[{id:this.selectedProject.id,name:this.selectedProject.name}]};this.applyForPermission(["common_flow_create_task"],e,t)}},handleCreateTaskCancel:function(){this.selectedTpl={},this.selectedProject={},this.isSelectProjectShow=!1}})},S=(i(1399),i(9)),I=Object(S.a)(D,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"template-container"},[i("skeleton",{attrs:{loading:e.firstLoading,loader:"templateList"}},[i("div",{staticClass:"list-wrapper"},[i("advance-search-form",{ref:"advanceSearch",attrs:{id:"commonTplList",open:e.isSearchFormOpen,"search-form":e.searchForm,"search-config":{placeholder:e.$t("请输入流程名称")}},on:{onSearchInput:e.onSearchInput,submit:e.onSearchFormSubmit},scopedSlots:e._u([{key:"operation",fn:function(){return[i("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasCreateCommonTplPerm},expression:"{ active: !hasCreateCommonTplPerm }"}],class:{"btn-permission-disable":!e.hasCreateCommonTplPerm},staticStyle:{"min-width":"120px"},attrs:{theme:"primary"},on:{click:e.checkCreatePermission}},[e._v("\n                        "+e._s(e.$t("新建"))+"\n                    ")]),e._v(" "),i("bk-button",{staticClass:"template-btn",attrs:{theme:"default"},on:{click:e.onExportTemplate}},[e._v("\n                        "+e._s(e.$t("导出"))+"\n                    ")]),e._v(" "),i("bk-button",{staticClass:"template-btn",attrs:{theme:"default"},on:{click:e.onImportTemplate}},[e._v("\n                        "+e._s(e.$t("导入"))+"\n                    ")])]},proxy:!0}])}),e._v(" "),i("div",{staticClass:"template-table-content"},[i("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:!e.firstLoading&&e.listLoading,opacity:1,zIndex:100},expression:"{ isLoading: !firstLoading && listLoading, opacity: 1, zIndex: 100 }"}],staticClass:"template-table",attrs:{data:e.commonTemplateData,pagination:e.pagination,size:e.setting.size},on:{"sort-change":e.handleSortChange,"page-change":e.onPageChange,"page-limit-change":e.onPageLimitChange}},[e._l(e.setting.selectedFields,(function(t){return i("bk-table-column",{key:t.id,attrs:{label:t.label,prop:t.id,width:t.width,"min-width":t.min_width,sortable:t.sortable},scopedSlots:e._u([{key:"default",fn:function(n){var a=n.row;return["name"===t.id?i("div",{staticClass:"name-column"},[e.hasPermission(["common_flow_view"],a.auth_actions)?i("a",{staticClass:"template-name",attrs:{title:a.name},on:{click:function(t){return t.preventDefault(),e.getJumpUrl("edit",a.id)}}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")]):i("a",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"text-permission-disable",on:{click:function(t){return e.onTemplatePermissonCheck(["common_flow_view"],a)}}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")])]):"subprocess_has_update"===t.id?i("div",{class:["subflow-update",{"subflow-has-update":a.subprocess_has_update}]},[e._v("\n                                "+e._s(e.getSubflowContent(a))+"\n                            ")]):[i("span",{attrs:{title:a[t.id]}},[e._v(e._s(a[t.id]||"--"))])]]}}],null,!0)})})),e._v(" "),i("bk-table-column",{staticClass:"operation-cell",attrs:{label:e.$t("操作"),width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"template-operation"},[[i("a",{staticClass:"template-operate-btn",on:{click:function(i){return i.preventDefault(),e.handleCreateTaskClick(t.row)}}},[e._v("\n                                        "+e._s(e.$t("新建任务"))+"\n                                    ")]),e._v(" "),e.hasPermission(["common_flow_view"],t.row.auth_actions)?i("a",{staticClass:"template-operate-btn",on:{click:function(i){return i.preventDefault(),e.getJumpUrl("clone",t.row.id)}}},[e._v("\n                                        "+e._s(e.$t("克隆"))+"\n                                    ")]):i("a",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"text-permission-disable",on:{click:function(i){return e.onTemplatePermissonCheck(["common_flow_view"],t.row)}}},[e._v("\n                                        "+e._s(e.$t("克隆"))+"\n                                    ")]),e._v(" "),i("router-link",{staticClass:"template-operate-btn",attrs:{to:e.getExecuteHistoryUrl(t.row.id)}},[e._v(e._s(e.$t("执行历史")))]),e._v(" "),i("bk-popover",{attrs:{theme:"light",placement:"bottom-start","ext-cls":"common-dropdown-btn-popver","z-index":2e3,distance:0,arrow:!1,"tippy-options":{boundary:"window",duration:[0,0]}}},[i("i",{staticClass:"bk-icon icon-more drop-icon-ellipsis"}),e._v(" "),i("ul",{attrs:{slot:"content"},slot:"content"},[i("li",{staticClass:"opt-btn"},[i("a",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["common_flow_view"],t.row.auth_actions)},expression:"{ active: !hasPermission(['common_flow_view'], props.row.auth_actions) }"}],class:{disable:e.collectingId===t.row.id||e.collectListLoading,"text-permission-disable":!e.hasPermission(["common_flow_view"],t.row.auth_actions)},attrs:{href:"javascript:void(0);"},on:{click:function(i){return e.onCollectTemplate(t.row,i)}}},[e._v("\n                                                    "+e._s(e.isCollected(t.row.id)?e.$t("取消收藏"):e.$t("收藏"))+"\n                                                ")])]),e._v(" "),i("li",{staticClass:"opt-btn"},[e.hasPermission(["common_flow_edit"],t.row.auth_actions)?i("a",{staticClass:"template-operate-btn",on:{click:function(i){return i.preventDefault(),e.getJumpUrl("edit",t.row.id)}}},[e._v("\n                                                    "+e._s(e.$t("编辑"))+"\n                                                ")]):i("a",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"text-permission-disable",on:{click:function(i){return e.onTemplatePermissonCheck(["common_flow_edit"],t.row)}}},[e._v("\n                                                    "+e._s(e.$t("编辑"))+"\n                                                ")])]),e._v(" "),i("li",{staticClass:"opt-btn"},[i("a",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["common_flow_delete"],t.row.auth_actions)},expression:"{ active: !hasPermission(['common_flow_delete'], props.row.auth_actions) }"}],class:{"text-permission-disable":!e.hasPermission(["common_flow_delete"],t.row.auth_actions)},attrs:{href:"javascript:void(0);"},on:{click:function(i){return e.onDeleteTemplate(t.row,i)}}},[e._v("\n                                                    "+e._s(e.$t("删除"))+"\n                                                ")])])])])]],2)]}}])}),e._v(" "),i("bk-table-column",{attrs:{type:"setting"}},[i("bk-table-setting-content",{attrs:{fields:e.setting.fieldList,selected:e.setting.selectedFields,size:e.setting.size},on:{"setting-change":e.handleSettingChange}})],1),e._v(" "),i("div",{staticClass:"empty-data",attrs:{slot:"empty"},slot:"empty"},[i("NoData",{attrs:{message:e.$t("无数据")}})],1)],2)],1)],1)]),e._v(" "),i("ImportTemplateDialog",{attrs:{common:"1","has-create-common-tpl-perm":e.hasCreateCommonTplPerm,"is-import-dialog-show":e.isImportDialogShow},on:{onImportConfirm:e.onImportConfirm,onImportCancel:e.onImportCancel}}),e._v(" "),i("ExportTemplateDialog",{attrs:{common:"1","is-export-dialog-show":e.isExportDialogShow,"project-info-loading":e.projectInfoLoading,pending:e.pending.export},on:{onExportConfirm:e.onExportConfirm,onExportCancel:e.onExportCancel}}),e._v(" "),i("SelectProjectModal",{attrs:{title:e.$t("创建任务"),show:e.isSelectProjectShow,"confirm-loading":e.permissionLoading,"confirm-cursor":!e.hasCreateTaskPerm},on:{onChange:e.handleProjectChange,onConfirm:e.handleCreateTaskConfirm,onCancel:e.handleCreateTaskCancel}}),e._v(" "),i("bk-dialog",{attrs:{"mask-close":!1,"header-position":"left","ext-cls":"common-dialog",title:e.$t("删除"),width:"400",value:e.isDeleteDialogShow},on:{confirm:e.onDeleteConfirm,cancel:e.onDeleteCancel}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.pending.delete,opacity:1},expression:"{ isLoading: pending.delete, opacity: 1 }"}],staticClass:"dialog-content"},[e._v("\n            "+e._s(e.$t("确认删除")+'"'+e.deleteTemplateName+'"?')+"\n        ")])])],1)}),[],!1,null,"7425f960",null);t.default=I.exports},796:function(e,t,i){},911:function(e,t,i){"use strict";i(796)},992:function(e,t,i){"use strict";i(26),i(38),i(37),i(49),i(50);var n=i(0),a=i.n(n),o=i(5),r=i.n(o),s=(i(67),i(22),i(80),i(7)),c=i(1);function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){r()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var p={name:"SelectProjectModal",props:{title:String,show:Boolean,project:Number,confirmLoading:{type:Boolean,default:!1},confirmCursor:{type:Boolean,default:!1}},data:function(){return{id:this.project,hasError:!1}},computed:m(m({},Object(s.e)("project",{projectList:function(e){return a()(this,void 0),e.userProjectList}.bind(void 0)})),{},{projects:function(){var e=this,t=[],i=[{name:c.a.t("业务"),id:1,children:[]},{id:2,name:c.a.t("项目"),children:[]}];return this.projectList.forEach(function(t){a()(this,e),t.from_cmdb?i[0].children.push(t):i[1].children.push(t)}.bind(this)),i.forEach(function(i){a()(this,e),i.children.length&&t.push(i)}.bind(this)),t}}),watch:{project:function(e){this.id=e}},methods:{handleProjectSelect:function(e){var t=this;this.id=e,this.hasError=!1;var i=this.projectList.find(function(e){return a()(this,t),e.id===this.id}.bind(this));this.$emit("onChange",i)},handleConfirm:function(){var e=this;if(!this.confirmLoading)if("number"==typeof this.id){var t=this.projectList.find(function(t){return a()(this,e),t.id===this.id}.bind(this));this.$emit("onConfirm",t)}else this.hasError=!0},handleCancel:function(){this.id="",this.hasError=!1,this.$emit("onCancel")}}},d=(i(911),i(9)),u=Object(d.a)(p,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("bk-dialog",{attrs:{width:"600","render-directive":"if","ext-cls":"common-dialog",title:e.title,"header-position":"left","mask-close":!1,"auto-close":!1,value:e.show},on:{cancel:e.handleCancel}},[i("div",{staticClass:"select-wrapper"},[i("bk-form",[i("bk-form-item",{attrs:{label:e.$t("选择项目")}},[i("bk-select",{staticClass:"project-select",attrs:{clearable:!1,searchable:!0,value:e.id},on:{change:e.handleProjectSelect}},e._l(e.projects,(function(t,n){return i("bk-option-group",{key:n,attrs:{name:t.name}},e._l(t.children,(function(e){return i("bk-option",{key:e.id,staticClass:"project-item",attrs:{id:e.id,name:e.name}})})),1)})),1),e._v(" "),e.hasError?i("div",{staticClass:"common-error-tip error-msg"},[e._v(e._s(e.$t("请选择项目")))]):e._e()],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:e.confirmCursor},expression:"{ active: confirmCursor }"}],class:{"btn-permission-disable":e.confirmCursor},attrs:{theme:"primary",loading:e.confirmLoading},on:{click:e.handleConfirm}},[e._v("\n            "+e._s(e.$t("确定"))+"\n        ")]),e._v(" "),i("bk-button",{on:{click:e.handleCancel}},[e._v(e._s(e.$t("取消")))])],1)])}),[],!1,null,"35e47392",null);t.a=u.exports}}]);