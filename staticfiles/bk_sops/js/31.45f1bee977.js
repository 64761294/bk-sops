(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{595:function(t,a,e){"use strict";e.r(a);e(26),e(38),e(37),e(49),e(22),e(50);var n=e(16),i=e.n(n),r=e(0),o=e.n(r),s=e(5),l=e.n(s),c=(e(127),e(24),e(23),e(27),e(81),e(80),e(4)),d=e.n(c),u=e(1),p=e(7),b=e(750),h=e(611);function m(t,a){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),e.push.apply(e,n)}return e}function g(t){for(var a=1;a<arguments.length;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?m(Object(e),!0).forEach((function(a){l()(t,a,e[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):m(Object(e)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))}))}return t}var f=[{id:"atom_template",name:u.a.t("流程引用详情")},{id:"atom_instance",name:u.a.t("任务执行详情")}],v={atom_template:[{label:u.a.t("流程ID"),prop:"templateId",sortable:!0,width:100},{label:u.a.t("流程名称"),prop:"templateName"},{label:u.a.t("项目"),prop:"projectName",width:150},{label:u.a.t("分类"),prop:"category",width:180},{label:u.a.t("创建人"),prop:"creator",width:120},{label:u.a.t("创建时间"),prop:"createTime",width:200,sortable:!0}],atom_instance:[{label:u.a.t("任务ID"),prop:"instanceId",sortable:!0,width:100},{label:u.a.t("任务名称"),prop:"instanceName"},{label:u.a.t("项目"),prop:"projectName"},{label:u.a.t("分类"),prop:"category",width:180},{label:u.a.t("创建人"),prop:"creator",width:120},{label:u.a.t("创建时间"),prop:"createTime",sortable:!0}]},k=[{id:"atom_cite",name:u.a.t("流程引用次数(次)")},{id:"atom_execute_times",name:u.a.t("任务执行次数(次)")},{id:"atom_execute_fail_times",name:u.a.t("执行失败次数(次)")},{id:"atom_avg_execute_time",name:u.a.t("执行平均耗时(秒)")},{id:"atom_fail_percent",name:u.a.t("执行失败率(%)")}],_={name:"StatisticsTemplate",components:{HorizontalBarChart:b.a,NoData:h.a},props:{dateRange:{type:Array,default:function(){return["",""]}},projectList:{type:Array,default:function(){return[]}},categoryList:{type:Array,default:function(){return[]}}},data:function(){return{atomListData:[],atomListLoading:!0,rankData:[],rankSelector:[{id:"cite",options:k,selected:k[0].id,clearable:!1},{id:"project",options:this.projectList,placeholder:u.a.t("请选择项目")}],rankDataCite:k[0].id,rankDataProject:"",rankDataLoading:!0,tabs:f,activeTab:f[0].id,tableData:[],tableAtom:"",tableProject:"",tableCategory:"",tableSort:"",tableDataLoading:!0,tableColumn:v,pagination:{current:1,count:0,"limit-list":[15,30,50,100],limit:15}}},computed:g({},Object(p.e)({site_url:function(t){return o()(this,void 0),t.site_url}.bind(void 0)})),watch:{dateRange:function(t){this.pagination.current=1,this.getData()},projectList:function(t){this.rankSelector[1].options=t}},created:function(){this.getData(),this.getAtomList()},methods:g(g(g({},Object(p.b)("atomForm",["loadSingleAtomList"])),Object(p.b)("admin",["queryAtomData"])),{},{getData:function(){this.getRankData(),this.getTableData()},loadAnalysisData:function(t){var a=arguments,e=this;return i()(d.a.mark((function n(){var i,r;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=a.length>1&&void 0!==a[1]?a[1]:"",n.prev=1,n.next=4,e.queryAtomData(t);case 4:if(!(r=n.sent).result){n.next=8;break}return"table"===i&&(e.pagination.count=r.data.total),n.abrupt("return",r.data.groups);case 8:n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),console.log(n.t0);case 13:case"end":return n.stop()}}),n,null,[[1,10]])})))()},getAtomList:function(){var t=this;return i()(d.a.mark((function a(){var e,n=this;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.atomListLoading=!0,a.next=4,t.loadSingleAtomList();case 4:e=a.sent,t.atomListData=e.map(function(t){return o()(this,n),{id:t.code,name:"".concat(t.group_name,"-").concat(t.name,"-").concat(t.version),version:t.version}}.bind(this)),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:return a.prev=11,t.atomListLoading=!1,a.finish(11);case 14:case"end":return a.stop()}}),a,this,[[0,8,11,14]])})))()},getRankData:function(){var t=this;return i()(d.a.mark((function a(){var e;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.rankDataLoading=!0,e={group_by:t.rankDataCite,conditions:{create_time:t.dateRange[0],finish_time:t.dateRange[1],project_id:t.rankDataProject}},a.next=5,t.loadAnalysisData(e);case 5:t.rankData=a.sent,a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:return a.prev=11,t.rankDataLoading=!1,a.finish(11);case 14:case"end":return a.stop()}}),a,null,[[0,8,11,14]])})))()},getTableData:function(){var t=this;return i()(d.a.mark((function a(){var e,n,i,r=this;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.tableDataLoading=!0,e=t.tableAtom.split("&"),n=t.atomListData.find(function(t){return o()(this,r),t.id===e[0]&&t.version===e[1]}.bind(this)),i={group_by:t.activeTab,conditions:{create_time:t.dateRange[0],finish_time:t.dateRange[1],component_code:e[0],version:n?n.version:void 0,project_id:t.tableProject,category:t.tableCategory,order_by:t.tableSort},pageIndex:t.pagination.current,limit:t.pagination.limit},""===t.tableSort&&delete i.conditions.order_by,a.next=8,t.loadAnalysisData(i,"table");case 8:t.tableData=a.sent,a.next=14;break;case 11:a.prev=11,a.t0=a.catch(0),console.log(a.t0);case 14:return a.prev=14,t.tableDataLoading=!1,a.finish(14);case 17:case"end":return a.stop()}}),a,this,[[0,11,14,17]])})))()},rankFilterChange:function(t,a){"cite"===a?this.rankDataCite=t:this.rankDataProject=t,this.getRankData()},onTabChange:function(t){this.pagination.current=1,this.tableSort="",this.getTableData()},tableFilterChange:function(){this.pagination.current=1,this.getTableData()},handleSortChange:function(t){"ascending"===t.order?this.tableSort=t.prop:"descending"===t.order?this.tableSort="-".concat(t.prop):this.tableSort="",this.getTableData()},handlePageChange:function(t){this.pagination.current=t,this.getTableData()},handlePageLimitChange:function(t){this.pagination.limit=t,this.pagination.current=1,this.getTableData()}})},y=e(9),w=Object(y.a)(_,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"statistics-atom"},[e("horizontal-bar-chart",{attrs:{title:t.$t("插件统计"),"selector-list":t.rankSelector,"label-width":400,"data-list":t.rankData,"data-loading":t.rankDataLoading},on:{onFilterClick:t.rankFilterChange}}),t._v(" "),e("div",{staticClass:"tab-content-area"},[e("bk-tab",{attrs:{active:t.activeTab},on:{"update:active":function(a){t.activeTab=a},"tab-change":t.onTabChange}},[e("bk-form",{attrs:{"form-type":"inline"}},[e("bk-form-item",{attrs:{label:t.$t("标准插件")}},[e("bk-select",{staticClass:"statistics-select",attrs:{placeholder:t.$t("请选择标准插件"),searchable:!0,clearable:!0,disabled:0===t.atomListData.length},on:{change:t.tableFilterChange},model:{value:t.tableAtom,callback:function(a){t.tableAtom=a},expression:"tableAtom"}},t._l(t.atomListData,(function(t){return e("bk-option",{key:t.id,attrs:{name:t.name,id:t.id+"&"+t.version}})})),1)],1),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("所属项目")}},[e("bk-select",{staticClass:"statistics-select",attrs:{placeholder:t.$t("请选择项目"),searchable:!0,clearable:!0,disabled:0===t.projectList.length},on:{change:t.tableFilterChange},model:{value:t.tableProject,callback:function(a){t.tableProject=a},expression:"tableProject"}},t._l(t.projectList,(function(t){return e("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1)],1),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("所属分类")}},[e("bk-select",{staticClass:"statistics-select",attrs:{placeholder:t.$t("请选择分类"),disabled:0===t.categoryList.length,searchable:!0,clearable:!0},on:{change:t.tableFilterChange},model:{value:t.tableCategory,callback:function(a){t.tableCategory=a},expression:"tableCategory"}},t._l(t.categoryList,(function(t){return e("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1)],1)],1),t._v(" "),t._l(t.tabs,(function(a){return e("bk-tab-panel",t._b({key:a.id},"bk-tab-panel",{name:a.id,label:a.name},!1),[e("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableDataLoading,opacity:1,zIndex:100},expression:"{ isLoading: tableDataLoading, opacity: 1, zIndex: 100 }"}],staticClass:"tab-data-table",attrs:{data:t.tableData,pagination:t.pagination},on:{"sort-change":t.handleSortChange,"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange}},[t._l(t.tableColumn[t.activeTab],(function(a){return e("bk-table-column",{key:a.prop,attrs:{label:a.label,prop:a.prop,width:a.hasOwnProperty("width")?a.width:"auto",sortable:a.sortable},scopedSlots:t._u([{key:"default",fn:function(n){return["templateName"===a.prop?e("a",{staticClass:"table-link",attrs:{target:"_blank",title:n.row.templateName,href:t.site_url+"template/edit/"+n.row.projectId+"/?template_id="+n.row.templateId}},[t._v("\n                                "+t._s(n.row.templateName)+"\n                            ")]):"instanceName"===a.prop?e("a",{staticClass:"table-link",attrs:{target:"_blank",title:n.row.instanceName,href:t.site_url+"taskflow/execute/"+n.row.projectId+"/?instance_id="+n.row.instanceId}},[t._v("\n                                "+t._s(n.row.instanceName)+"\n                            ")]):[e("span",{attrs:{title:n.row[a.prop]}},[t._v(t._s(n.row[a.prop]))])]]}}],null,!0)})})),t._v(" "),e("div",{staticClass:"empty-data",attrs:{slot:"empty"},slot:"empty"},[e("no-data")],1)],2)],1)}))],2)],1)],1)}),[],!1,null,null,null);a.default=w.exports},611:function(t,a,e){"use strict";var n={name:"NoData",props:{message:{type:String,default:function(){return""}}}},i=(e(634),e(9)),r=Object(i.a)(n,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"no-data-wrapper"},[e("div",{staticClass:"no-data"},[e("i",{staticClass:"common-icon-no-data"}),t._v(" "),e("p",{staticClass:"no-data-wording"},[t._t("default",(function(){return[t._v(t._s(t.message||t.$t("无数据")))]}))],2)])])}),[],!1,null,"03c0cb01",null);a.a=r.exports},625:function(t,a,e){},634:function(t,a,e){"use strict";e(625)},674:function(t,a,e){},749:function(t,a,e){"use strict";e(674)},750:function(t,a,e){"use strict";var n=e(0),i=e.n(n),r=(e(67),e(315),e(1)),o=e(611),s=[{id:"descending",name:r.a.t("降序排列")},{id:"ascending",name:r.a.t("升序排列")}],l={name:"HorizontalBarChart",components:{NoData:o.a},props:{title:{type:String,default:""},selectorList:{type:Array,default:function(){return[]}},dataLoading:{type:Boolean,default:!1},dataList:{type:Array,default:function(){return[]}},labelWidth:{type:Number,default:150}},data:function(){return{sortList:s,selectedSortType:s[0].id,selectedValue:"",isDialogShow:!1}},computed:{totalNumber:function(){var t=this;return this.dataList.reduce(function(a,e){return i()(this,t),Number(a)+Number(e.value)}.bind(this),0)},sortedData:function(){var t=this;return"descending"===this.selectedSortType?this.dataList.sort(function(a,e){return i()(this,t),e.value-a.value}.bind(this)):this.dataList.sort(function(a,e){return i()(this,t),a.value-e.value}.bind(this))}},methods:{getBlockStyle:function(t){return 0===this.totalNumber||0===t?{width:"1px",background:"#c0c4cc"}:{width:t/this.totalNumber*100+"%","min-width":"2px"}},onOptionClick:function(t,a){this.$emit("onFilterClick",a,t)},onViewAllClick:function(){this.isDialogShow=!0}}},c=(e(749),e(9)),d=Object(c.a)(l,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"horizontal-bar-chart"},[e("h3",{staticClass:"chart-title"},[t._v(t._s(t.title))]),t._v(" "),e("bk-form",{staticClass:"select-wrapper",attrs:{"form-type":"inline"}},[e("bk-form-item",[e("bk-select",{staticStyle:{width:"120px"},attrs:{clearable:!1},model:{value:t.selectedSortType,callback:function(a){t.selectedSortType=a},expression:"selectedSortType"}},t._l(t.sortList,(function(a){return e("bk-option",{key:a.id,attrs:{id:a.id,name:a.name}},[t._v("\n                    "+t._s(a.name)+"\n                ")])})),1)],1),t._v(" "),t._l(t.selectorList,(function(a){return e("bk-form-item",{key:a.id},[e("bk-select",{staticClass:"statistics-select",attrs:{searchable:!0,clearable:!1!==a.clearable,placeholder:a.placeholder,disabled:0===a.options.length,value:a.selected},on:{change:function(e){return t.onOptionClick(a.id,e)}}},t._l(a.options,(function(a){return e("bk-option",{key:a.id,attrs:{id:a.id,name:a.name}},[t._v("\n                    "+t._s(a.name)+"\n                ")])})),1)],1)}))],2),t._v(" "),e("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.dataLoading,opacity:1,zIndex:100},expression:"{ isLoading: dataLoading, opacity: 1, zIndex: 100 }"}],staticClass:"content-wrapper"},[e("div",{staticClass:"chart-content"},[t.dataLoading||t.sortedData.length>0?t._l(t.sortedData,(function(a,n){return e("div",{key:n,staticClass:"data-item"},[e("span",{staticClass:"data-label",style:{width:t.labelWidth+"px"},attrs:{title:a.name}},[t._v(t._s(a.name))]),t._v(" "),e("div",{staticClass:"data-bar",style:{width:"calc(100% - "+(t.labelWidth+100)+"px)"}},[e("div",{staticClass:"block",style:t.getBlockStyle(a.value)},[e("span",{staticClass:"num"},[t._v(t._s(a.value))])])])])})):e("no-data")],2)]),t._v(" "),!t.dataLoading&&t.sortedData.length>7?e("div",{staticClass:"view-all-btn",on:{click:t.onViewAllClick}},[t._v(t._s(t.$t("查看全部")))]):t._e(),t._v(" "),e("bk-dialog",{attrs:{fullscreen:!0,title:t.title,"header-position":"left","close-icon":!1},scopedSlots:t._u([{key:"footer",fn:function(){return[e("bk-button",{attrs:{theme:"default"},on:{click:function(a){t.isDialogShow=!1}}},[t._v(t._s(t.$t("关闭")))])]},proxy:!0}]),model:{value:t.isDialogShow,callback:function(a){t.isDialogShow=a},expression:"isDialogShow"}},[e("div",{staticClass:"dialog-content"},t._l(t.sortedData,(function(a,n){return e("div",{key:n,staticClass:"data-item"},[e("span",{staticClass:"data-label",style:{width:t.labelWidth+"px"},attrs:{title:a.name}},[t._v(t._s(a.name))]),t._v(" "),e("div",{staticClass:"data-bar",style:{width:"calc(100% - "+(t.labelWidth+100)+"px)"}},[e("div",{staticClass:"block",style:t.getBlockStyle(a.value)},[e("span",{staticClass:"num"},[t._v(t._s(a.value))])])])])})),0)])],1)}),[],!1,null,"70109276",null);a.a=d.exports}}]);