(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1191:function(e,t,a){},1192:function(e,t,a){},1445:function(e,t,a){"use strict";a(1191)},1446:function(e,t,a){"use strict";a(1192)},581:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),n=(a(184),a(37),a(23),a(127),a(101),a(39),a(104),a(128),a(185),a(28)),r=a(102),l=a(677),o=a.n(l),c=(a(80),a(788)),d=a(6),u={name:"CacheForm",props:{value:{type:Object,default:function(){return{id:void 0,name:"",type:"s3",desc:"",details:{access_key:"",bucket:"",secret_key:"",service_address:""}}}}},data:function(){var e=this.getCacheTypeList(),t=this.value,a=t.id,s=t.name,i=t.type,n=t.desc,r=t.details,l=this.getCacheKeys("s3");return{id:a,name:s,type:i,desc:n,details:r,detailFields:o()(l,1)[0],list:e,cacheValid:!1,nameRule:{required:!0,max:d.i.SOURCE_NAME_MAX_LENGTH,regex:d.g},valueRule:{required:!0}}},computed:{isEditing:function(){return"number"==typeof this.value.id}},methods:{getCacheTypeList:function(){var e=this;return c.a.filter(function(t){return i()(this,e),"git"!==t.type}.bind(this)).map(function(t){return i()(this,e),{id:t.type,name:t.name}}.bind(this))},getCacheKeys:function(e){var t=this,a=[],s={},n=c.a.find(function(a){return i()(this,t),a.type===e}.bind(this));for(var r in n.keys)a.push({id:r,name:n.keys[r].name,placeholder:n.keys[r].placeholder}),s[r]="";return[a,s]},validate:function(){var e=this;return this.$validator.validateAll().then(function(t){return i()(this,e),t}.bind(this))},updateValue:function(){var e={id:this.id,name:this.name,type:this.type,desc:this.desc,details:this.details};this.$emit("updateCache",e)},onTypeSelect:function(e){this.type=e;var t=this.getCacheKeys(e);this.detailFields=t[0],this.details=t[1],this.updateValue()},onDeleteCache:function(){this.$emit("deleteCache")}}},p=(a(1445),a(9)),h={name:"CacheEdit",components:{CacheForm:Object(p.a)(u,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cache-form"},[a("bk-button",{staticClass:"delete-btn",attrs:{theme:"default",size:"small"},on:{click:e.onDeleteCache}},[e._v("\n        "+e._s(e.$t("删除"))+"\n    ")]),e._v(" "),a("table",{staticClass:"form-table"},[a("tbody",[a("tr",[a("th",[a("div",{staticClass:"form-label required"},[a("label",[e._v(e._s(e.$t("名称")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"form-content"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"},{name:"validate",rawName:"v-validate",value:e.nameRule,expression:"nameRule"}],staticClass:"cache-name",class:{"error-border":e.veeErrors.first("cacheName")},attrs:{type:"text",name:"cacheName",disabled:e.isEditing},domProps:{value:e.name},on:{blur:e.updateValue,input:function(t){t.target.composing||(e.name=t.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.veeErrors.first("cacheName"),expression:" veeErrors.first('cacheName')",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"})])])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label required"},[a("label",[e._v(e._s(e.$t("类型")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"form-content"},[a("bk-select",{staticClass:"bk-select-inline",attrs:{"popover-width":260,disabled:e.isEditing,searchable:!0},on:{selected:e.onTypeSelect},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.list,(function(e,t){return a("bk-option",{key:t,attrs:{id:e.id,name:e.name}})})),1)],1)])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label"},[a("label",[e._v(e._s(e.$t("描述")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("div",{staticClass:"form-content"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.desc,expression:"desc"}],staticClass:"cache-desc",attrs:{rows:"4"},domProps:{value:e.desc},on:{blur:e.updateValue,input:function(t){t.target.composing||(e.desc=t.target.value)}}})])])]),e._v(" "),a("tr",[a("th",[a("div",{staticClass:"form-label"},[a("label",[e._v(e._s(e.$t("详细信息")))])])]),e._v(" "),a("td",{staticClass:"value"},[a("table",{staticClass:"detail-table"},[a("tbody",e._l(e.detailFields,(function(t){return a("tr",{key:t.id},[a("th",[e._v(e._s(t.name))]),e._v(" "),a("td",{staticClass:"td-with-input",class:{"error-border":e.veeErrors.first("detailValue"+t.id)}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.details[t.id],expression:"details[field.id]"},{name:"validate",rawName:"v-validate",value:e.valueRule,expression:"valueRule "}],staticClass:"table-input",attrs:{type:"text",name:"detailValue"+t.id,placeholder:t.placeholder},domProps:{value:e.details[t.id]},on:{blur:e.updateValue,input:function(a){a.target.composing||e.$set(e.details,t.id,a.target.value)}}}),e._v(" "),a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.$t("必填项"),expression:"$t('必填项')",modifiers:{top:!0}}],staticClass:"common-icon-info common-error-tip"}),e._v(" "),a("span",{staticClass:"common-error-tip error-msg"},[e._v("\n                                        "+e._s(e.$t("必填项"))+"\n                                    ")])])])})),0)])])])])])],1)}),[],!1,null,"ae108d40",null).exports},mixins:[r.a],props:{cacheList:Array,pending:Boolean,hasEditPerm:Boolean,editPermLoading:Boolean},data:function(){return{list:n.a.deepClone(this.cacheList)}},computed:{isEditing:function(){return this.cacheList.length>0&&"number"==typeof this.cacheList[0].id}},watch:{cacheList:function(e){this.list=n.a.deepClone(e)}},methods:{onCreateCache:function(){this.list.push({id:void 0,name:"",type:"s3",desc:"",details:{access_key:"",bucket:"",secret_key:"",service_address:""}})},updateCache:function(e){var t=n.a.deepClone(e);this.list.splice(0,1,t),this.$emit("updateList","cacheList",this.list)},deleteCache:function(){this.list=[],this.$emit("updateList","cacheList",[])},onSaveSetting:function(){var e=this,t=this.$children.filter(function(t){return i()(this,e),"CacheForm"===t.$options.name}.bind(this)).map(function(t){return i()(this,e),t.validate()}.bind(this));Promise.all(t).then(function(t){var a=this;i()(this,e),t.every(function(e){return i()(this,a),e}.bind(this))&&this.$emit("saveSetting")}.bind(this))},applyEditPerm:function(){this.editPermLoading||this.applyForPermission(["admin_edit"])}}},m=(a(1446),Object(p.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cache-edit"},[a("div",{staticClass:"cache-content"},[e._l(e.list,(function(t,s){return a("cache-form",{key:s,attrs:{value:t},on:{updateCache:e.updateCache,deleteCache:e.deleteCache}})})),e._v(" "),0===e.list.length?a("div",{staticClass:"add-cache",on:{click:e.onCreateCache}},[e._v(e._s(e.$t("添加本地缓存")))]):e._e()],2),e._v(" "),a("div",{staticClass:"operate-area"},[a("router-link",{staticClass:"bk-button bk-default",attrs:{to:{name:"packageEdit"}}},[e._v(e._s(e.$t("上一步")))]),e._v(" "),e.hasEditPerm?a("bk-button",{staticClass:"save-btn",attrs:{theme:"primary",loading:e.pending},on:{click:e.onSaveSetting}},[e._v("\n            "+e._s(e.$t("完成"))+"\n        ")]):a("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!0},expression:"{ active: true }"}],staticClass:"btn-permission-disable save-btn",attrs:{theme:"primary"},on:{click:e.applyEditPerm}},[e._v("\n            "+e._s(e.$t("完成"))+"\n        ")]),e._v(" "),a("router-link",{staticClass:"bk-button bk-default",attrs:{to:{name:"sourceManage"}}},[e._v(e._s(e.$t("取消")))])],1)])}),[],!1,null,"9507373c",null));t.default=m.exports},677:function(e,t,a){var s=a(793),i=a(794),n=a(329),r=a(795);e.exports=function(e,t){return s(e)||i(e,t)||n(e,t)||r()},e.exports.default=e.exports,e.exports.__esModule=!0},788:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var s=a(1),i=[{type:"git",name:s.a.t("GIT"),keys:{repo_address:{name:s.a.t("仓库链接"),placeholder:s.a.t("请输入 GIT 仓库地址，如 https://github.com/bk-sops/plugins_example.git")},repo_raw_address:{name:s.a.t("文件托管仓库链接"),placeholder:s.a.t("请输入仓库中文件的 Raw 链接的前缀，如 https://raw.githubusercontent.com/bk-sops/plugins_example/")},branch:{name:s.a.t("分支名"),placeholder:s.a.t("请输入分支名")}}},{type:"s3",name:s.a.t("S3"),keys:{service_address:{name:s.a.t("对象存储服务地址"),placeholder:s.a.t("请输入")},bucket:{name:s.a.t("Bucket"),placeholder:s.a.t("请输入")},source_dir:{name:s.a.t("子目录"),placeholder:s.a.t("请输入")},access_key:{name:s.a.t("Access Key"),placeholder:s.a.t("请输入")},secret_key:{name:s.a.t("Secret Key"),placeholder:s.a.t("请输入")}}},{type:"fs",name:s.a.t("文件系统"),keys:{path:{name:s.a.t("服务器文件系统路径"),placeholder:s.a.t("请输入")}}}]},793:function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},794:function(e,t){e.exports=function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var s,i,n=[],r=!0,l=!1;try{for(a=a.call(e);!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){l=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(l)throw i}}return n}},e.exports.default=e.exports,e.exports.__esModule=!0},795:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}}]);