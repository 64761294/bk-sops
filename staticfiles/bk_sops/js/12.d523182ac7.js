(window.webpackJsonp=window.webpackJsonp||[]).push([[12,5],{1038:function(t,e,n){},1039:function(t,e,n){"use strict";var i=n(0),o=n.n(i),s=(n(80),n(22),n(26),{checkbox:null,datatable:["remote_data_init","remote_url"],datetime:null,input:["showVarList"],int:null,ipSelector:null,memberSelector:null,password:null,radio:null,select:["remote","remote_url","remote_data_init"],text:null,textarea:null,logDisplay:null,tree:["remote","remote_url","remote_data_init"],upload:["url","headers","auto_upload","limit","text"]}),a={getSchema:function(t,e){var n=this,i=e.find(function(e){return o()(this,n),e.tag_code===t}.bind(this));if(!i)return{};var a=i.type,r=i.attrs,l=s[a],c={};return l?(Object.keys(r).forEach(function(t){o()(this,n),-1===l.indexOf(t)&&(c[t]=r[t])}.bind(this)),{type:a,attrs:c}):{type:a,attrs:r}}};e.a=a},1126:function(t,e,n){},1127:function(t,e,n){},1128:function(t,e,n){},1129:function(t,e,n){},1130:function(t,e,n){},1131:function(t,e,n){},1132:function(t,e,n){},1133:function(t,e,n){},1134:function(t,e,n){},1135:function(t,e,n){},1136:function(t,e,n){},1137:function(t,e,n){},1138:function(t,e,n){},1139:function(t,e,n){},1140:function(t,e,n){},1141:function(t,e,n){},1142:function(t,e,n){},1143:function(t,e,n){},1144:function(t,e,n){},1145:function(t,e,n){},1146:function(t,e,n){},1215:function(t,e,n){"use strict";var i=n(5),o=n.n(i),s=n(0),a=n.n(s),r=(n(26),n(22),n(68),n(103),n(27),n(81),n(24),n(23),n(80),n(43),n(28)),l=n(1039),c=n(676),u=(n(38),n(37),n(49),n(50),n(16)),d=n.n(u),h=n(4),p=n.n(h),f=n(1),m=n(7),v=n(6);function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y={name:"ReuseVarDialog",props:{isShow:Boolean,createNew:Boolean,variables:Array},data:function(){var t=this;return{formData:{reused:this.variables.length>0?this.variables[0].id:"",isReuse:!0,name:"",key:""},rules:{name:[{required:!0,message:f.a.t("必填项"),trigger:"blur"},{max:v.i.VARIABLE_NAME_MAX_LENGTH,message:f.a.t("变量名称长度不能超过")+v.i.VARIABLE_NAME_MAX_LENGTH+f.a.t("个字符"),trigger:"blur"},{regex:v.e,message:f.a.t("变量名称不能包含")+v.c+f.a.t("非法字符"),trigger:"blur"}],key:[{required:!0,message:f.a.t("必填项"),trigger:"blur"},{validator:function(t){var e=/^\$\{\w+\}$/.test(t)?v.i.VARIABLE_KEY_MAX_LENGTH+3:v.i.VARIABLE_KEY_MAX_LENGTH;return t.length<=e},message:f.a.t("变量KEY值长度不能超过")+v.i.VARIABLE_KEY_MAX_LENGTH+f.a.t("个字符"),trigger:"blur"},{regex:/(^\${[a-zA-Z_]\w*}$)|(^[a-zA-Z_]\w*$)/,message:f.a.t("变量KEY由英文字母、数字、下划线组成，且不能以数字开头"),trigger:"blur"},{validator:function(e){return!((/^\$\{\w+\}$/.test(e)?e:"${".concat(e,"}"))in t.constants)},message:f.a.t("变量KEY值已存在"),trigger:"blur"}]}}},computed:b(b({},Object(m.e)({constants:function(t){return a()(this,void 0),t.template.constants}.bind(void 0)})),{},{title:function(){return this.createNew?f.a.t("创建新变量"):f.a.t("是否复用变量")}}),watch:{variables:function(t){this.formData.reused=t.length>0?this.variables[0].id:""}},methods:b(b({},Object(m.b)("template/",["checkKey"])),{},{toggleReuse:function(t){this.formData.isReuse=!t},onConfirm:function(t){var e=this;!this.createNew&&this.formData.isReuse?this.$emit("confirm","reuse",this.formData.reused):this.$refs.form.validate().then(function(){var t=d()(p.a.mark((function t(n){var i,o,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}return i=e.formData,o=i.name,s=i.key,t.next=4,e.checkKey({key:s});case 4:if(t.sent.data){t.next=8;break}return e.$bkMessage({message:f.a.t("变量KEY为特殊标志符变量，请修改"),theme:"warning"}),t.abrupt("return");case 8:e.$emit("confirm","new",{name:o,key:s});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},onCancel:function(){this.$emit("cancel")}})},_=(n(1387),n(9)),w=Object(_.a)(y,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-dialog",{attrs:{"ext-cls":"common-dialog",theme:"primary","mask-close":!1,"render-directive":"if","header-position":"left",title:t.title,"auto-close":!1,value:t.isShow,width:"600"},on:{confirm:t.onConfirm,cancel:t.onCancel}},[n("div",{staticClass:"reuse-variable-dialog"},[t.createNew?n("p",{staticClass:"new-var-notice"},[t._v(t._s(t.$t("已存在相同Key的变量，请新建变量")))]):t._e(),t._v(" "),n("bk-form",{ref:"form",attrs:{model:t.formData,"form-type":t.createNew?"vertical":"horizontal",rules:t.rules}},[t.createNew?t._e():[n("bk-form-item",{attrs:{label:t.$t("复用变量"),property:"reused"}},[n("bk-select",{attrs:{disabled:!t.formData.isReuse,"popover-options":{appendTo:"parent"},clearable:!1},model:{value:t.formData.reused,callback:function(e){t.$set(t.formData,"reused",e)},expression:"formData.reused"}},t._l(t.variables,(function(t,e){return n("bk-option",{key:e,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("新建变量"),property:"isReuse"}},[n("bk-switcher",{attrs:{value:!t.formData.isReuse,size:"small",theme:"primary"},on:{change:t.toggleReuse}})],1)],t._v(" "),!t.formData.isReuse||t.createNew?[n("bk-form-item",{attrs:{label:t.$t("变量名称"),property:"name",required:!0}},[n("bk-input",{attrs:{name:"variableName"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("变量KEY"),property:"key",required:!0}},[n("bk-input",{attrs:{name:"variableKey"},model:{value:t.formData.key,callback:function(e){t.$set(t.formData,"key",e)},expression:"formData.key"}})],1)]:t._e()],2)],1)])}),[],!1,null,"464fdd70",null).exports,C=/^\$\{(\w+)\}$/,S={name:"InputParams",components:{RenderForm:c.a,ReuseVarDialog:w},props:{scheme:Array,showHook:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},value:Object,plugin:String,version:String,isSubflow:Boolean,subflowForms:Object,nodeId:String,constants:Object},data:function(){return{formData:r.a.deepClone(this.value),hooked:{},hookingVarForm:"",isKeyExist:!1,isReuseDialogShow:!1,reuseableVarList:[],option:{showGroup:!1,showHook:this.showHook,showLabel:!0,showVarList:!0,formEdit:this.editable}}},watch:{value:function(t){this.formData=r.a.deepClone(t)}},created:function(){this.hooked=this.getFormsHookState()},methods:{getFormsHookState:function(){var t=this,e={},n=Object.keys(this.constants);return this.scheme.forEach(function(i){var o=this;a()(this,t);var s=n.some(function(t){a()(this,o);var e=this.constants[t];if("component_inputs"===e.source_type){var n=e.source_info[this.nodeId];if(n&&n.includes(i.tag_code))return!0}}.bind(this));e[i.tag_code]=s}.bind(this)),e},onInputsValChange:function(t){this.$emit("update",r.a.deepClone(t))},onInputHookChange:function(t,e){e?this.hookForm(t):this.unhookForm(t)},hookForm:function(t){var e,n,i=this,o=[];if(this.isSubflow){var s=this.subflowForms[t];e=t,n=s.source_tag.split(".")[1]}else e="${".concat(t,"}"),n=t;var r=!1;if(this.hookingVarForm=t,this.hooked[t]=!0,Object.keys(this.constants).forEach(function(t){a()(this,i);var s=this.constants[t],l=s.source_tag;l&&(l.split(".")[1]===n&&o.push({name:"".concat(s.name,"(").concat(s.key,")"),id:s.key}));t===e&&(r=!0)}.bind(this)),o.length>0)this.reuseableVarList=o,this.isKeyExist=!1,this.isReuseDialogShow=!0;else if(r)this.isKeyExist=!0,this.isReuseDialogShow=!0;else{var l=this.scheme.find(function(e){return a()(this,i),e.tag_code===t}.bind(this)),c=this.getNewVarConfig(l.attrs.name,e);this.createVariable(c)}},unhookForm:function(t){var e=this.formData[t],n=this.constants[e];if(n){var i={type:"delete",id:this.nodeId,key:e,tagCode:t};this.formData[t]=r.a.deepClone(n.value),this.hooked[t]=!1,this.$emit("update",r.a.deepClone(this.formData)),this.$emit("hookChange","delete",i)}},getNewVarConfig:function(t,e){var n={name:t,key:C.test(e)?e:"${".concat(e,"}"),source_info:o()({},this.nodeId,[this.hookingVarForm]),value:r.a.deepClone(this.formData[this.hookingVarForm]),form_schema:l.a.getSchema(this.hookingVarForm,this.scheme)};if(this.isSubflow){var i=this.subflowForms[this.hookingVarForm],s=i.desc,a=i.custom_type,c=i.source_tag,u=i.validation,d=i.is_meta,h=i.meta,p=i.version;Object.assign(n,{desc:s,custom_type:a,source_tag:c,validation:u,version:p}),d&&(n.is_meta=!0,n.meta=r.a.deepClone(h))}else Object.assign(n,{custom_type:"",source_tag:"".concat(this.plugin,".").concat(this.hookingVarForm),version:this.version});return n},createVariable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.keys(this.constants).length,n={name:"",key:"",desc:"",custom_type:"",source_info:{},source_tag:"",value:"",show_type:"show",source_type:"component_inputs",validation:"",index:e,version:"legacy",form_schema:{}},i=Object.assign({},n,t);this.formData[this.hookingVarForm]=i.key,this.$emit("hookChange","create",i),this.$emit("update",r.a.deepClone(this.formData)),this.hookingVarForm=""},onConfirmReuseVar:function(t,e){if(this.isReuseDialogShow=!1,"new"===t){var n=e.name,i=e.key,o=this.getNewVarConfig(n,i);this.createVariable(o)}else{var s=e,a={type:"add",id:this.nodeId,key:s,tagCode:this.hookingVarForm};this.formData[this.hookingVarForm]=s,this.$emit("hookChange","reuse",a),this.$emit("update",r.a.deepClone(this.formData)),this.hookingVarForm=""}},onCancelReuseVar:function(t){this.hooked[this.hookingVarForm]=!1,this.isReuseDialogShow=!1,this.isKeyExist=!1,this.hookingVarForm="",this.reuseableVarList=[]},validate:function(){return this.$refs.renderForm.validate()}}},k=Object(_.a)(S,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-params"},[n("render-form",{ref:"renderForm",attrs:{scheme:t.scheme,hooked:t.hooked,constants:t.constants,"form-option":t.option,"form-data":t.formData},on:{change:t.onInputsValChange,onHookChange:t.onInputHookChange}}),t._v(" "),n("reuse-var-dialog",{attrs:{"is-show":t.isReuseDialogShow,variables:t.reuseableVarList,"create-new":t.isKeyExist},on:{confirm:t.onConfirmReuseVar,cancel:t.onCancelReuseVar}})],1)}),[],!1,null,null,null);e.a=k.exports},1219:function(t,e,n){"use strict";n(26),n(37),n(49),n(50);var i=n(677),o=n.n(i),s=n(16),a=n.n(s),r=n(0),l=n.n(r),c=n(5),u=n.n(c),d=n(4),h=n.n(d),p=(n(67),n(68),n(27),n(81),n(80),n(38),n(187),n(22),n(83),n(52),n(183),n(43),n(23),n(314),n(103),n(1)),f=n(7),m=n(99),v=n(6),g=n(28),b=n(655),y=n(1039),_=n(676);function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={name:"VariableEdit",components:{RenderForm:_.a},props:{variableData:Object,common:[String,Number]},data:function(){var t=g.a.deepClone(this.variableData),e=["component_inputs","component_outputs"].includes(t.source_type);return{theEditingData:t,isHookedVar:e,currentValType:e?"component":t.custom_type,showTypeList:[{id:"show",name:p.a.t("显示")},{id:"hide",name:p.a.t("隐藏")}],preRenderList:[{id:"true",name:p.a.t("是")},{id:"false",name:p.a.t("否")}],metaTag:void 0,renderData:{},renderConfig:[],renderOption:{showHook:!1,showGroup:!1,showLabel:!0,showVarList:!0,validateSet:["custom","regex"]},varTypeListLoading:!1,varTypeList:[],atomConfigLoading:!1,atomTypeKey:"",isSaveConfirmDialogShow:!1,variableNameRule:{required:!0,max:v.i.VARIABLE_NAME_MAX_LENGTH,regex:v.e},validationRule:{validReg:!0}}},computed:C(C(C({},Object(f.e)({atomFormConfig:function(t){return l()(this,void 0),t.atomForm.config}.bind(void 0),constants:function(t){return l()(this,void 0),t.template.constants}.bind(void 0),outputs:function(t){return l()(this,void 0),t.template.outputs}.bind(void 0)})),Object(f.e)("project",{project_id:function(t){return l()(this,void 0),t.project_id}.bind(void 0)})),{},{isSystemVar:function(){return"system"===this.variableData.source_type},atomType:function(){var t=this.theEditingData,e=t.custom_type,n=t.source_tag;return"component_inputs"===t.source_type?e||n.split(".")[0]:e},varPhase:function(){var t=this,e="",n={1:p.a.t("即将下线"),2:p.a.t("已下线")};return"component"!==this.currentValType&&this.varTypeList.length&&this.varTypeList.some(function(i){var o=this;return l()(this,t),i.children.some(function(t){if(l()(this,o),t.code===this.currentValType)return e=n[t.phase],!0}.bind(this))}.bind(this)),e},variableKeyRule:function(){var t={required:!0,regex:/(^\${[a-zA-Z_]\w*}$)|(^[a-zA-Z_]\w*$)/,keyLength:!0,keyRepeat:!0};return this.isHookedVar&&""!==this.variableData.key&&delete t.max,t},variableDesc:function(){var t=this,e="";if(this.isHookedVar){var n=this.varTypeList.find(function(e){return l()(this,t),e.code===this.currentValType}.bind(this));n&&(e=n.description)}else this.varTypeList.some(function(n){var i=this;l()(this,t);var o=n.children.find(function(t){return l()(this,i),t.code===this.currentValType}.bind(this));if(o)return e=o.description,!0}.bind(this));return e}}),created:function(){this.variableData.key||(this.theEditingData.pre_render_mako=!1),this.extendFormValidate()},mounted:function(){var t=this;return a()(h.a.mark((function e(){var n,i,o,s,a,r,c,d=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.theEditingData,i=n.is_meta,o=n.custom_type,s=n.source_tag,a=n.source_type,!t.isHookedVar){e.next=5;break}t.varTypeList=[{code:"component",name:p.a.t("组件")}],e.next=8;break;case 5:return e.next=7,t.getVarTypeList();case 7:i&&"custom"===a&&t.varTypeList.find(function(t){return l()(this,d),"meta"===t.type}.bind(this)).children.some(function(e){if(l()(this,d),e.code===o)return t.metaTag=e.meta_tag,!0}.bind(this));case 8:["component_outputs","system"].includes(t.theEditingData.source_type)||(t.theEditingData.hasOwnProperty("value")&&(r=i&&"custom"===a?t.metaTag:s,c=r.split(".")[1],t.renderData=u()({},c,t.theEditingData.value)),t.getAtomConfig());case 9:case"end":return e.stop()}}),e,this)})))()},methods:C(C(C(C({},Object(f.b)("template/",["loadCustomVarCollection","checkKey"])),Object(f.b)("atomForm/",["loadAtomConfig"])),Object(f.d)("template/",["addVariable","editVariable","setOutputs"])),{},{getVarTypeList:function(){var t=this;return a()(h.a.mark((function e(){var n,i,o=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.varTypeListLoading=!0,e.prev=1,e.next=4,t.loadCustomVarCollection();case 4:n=e.sent,i=[{name:p.a.t("普通变量"),type:"general",children:[]},{name:p.a.t("动态变量"),type:"dynamic",children:[]},{name:p.a.t("元变量"),type:"meta",children:[]}],n.forEach(function(t){l()(this,o),"general"===t.type?i[0].children.push(t):"dynamic"===t.type?i[1].children.push(t):i[2].children.push(t)}.bind(this)),t.varTypeList=i,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:return e.prev=13,t.varTypeListLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[1,10,13,16]])})))()},getAtomConfig:function(){var t=this;return a()(h.a.mark((function e(){var n,i,o,s,a,r,c,u,d=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.theEditingData,i=n.source_tag,o=n.custom_type,s=n.version,a=void 0===s?"legacy":s,r=t.metaTag?t.metaTag:i,c=r.split(".")[0]||o,u="",t.atomConfigLoading=!0,t.atomTypeKey=c,u=t.theEditingData.custom_type?"variable":"component",!b.a.isConfigExists(c,a,t.atomFormConfig)){e.next=11;break}return t.getRenderConfig(),t.$nextTick(function(){l()(this,d),t.atomConfigLoading=!1}.bind(this)),e.abrupt("return");case 11:return e.prev=11,e.next=14,t.loadAtomConfig({classify:u,name:t.atomType,project_id:t.common?void 0:t.project_id,version:a,atom:c});case 14:t.getRenderConfig(),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(11),console.log(e.t0);case 20:return e.prev=20,t.atomConfigLoading=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[11,17,20,23]])})))()},getRenderConfig:function(){var t=this.theEditingData,e=t.source_tag,n=t.custom_type,i=t.source_type,s=t.is_meta,a=t.meta,r=t.version,l=void 0===r?"legacy":r,c=(this.metaTag||e).split("."),u=o()(c,2),d=u[0],h=u[1];n&&(d=d||n,h=h||n);var f=this.atomFormConfig[d][l],m=g.a.deepClone(b.a.formFilter(h,f));s&&"component_inputs"===i&&m.meta_transform&&(m=m.meta_transform(a)),["input","textarea"].includes(n)&&""!==this.theEditingData.validation&&m.attrs.validation.push({type:"regex",args:this.getInputDefaultValueValidation(),error_message:p.a.t("默认值不符合正则规则")}),this.renderConfig=[m],this.variableData.key||(this.theEditingData.value=b.a.getFormItemDefaultValue(this.renderConfig))},extendFormValidate:function(){var t=this;this.validator=new m.a({}),this.validator.extend("keyRepeat",function(e){return l()(this,t),e=/^\$\{\w+\}$/.test(e)?e:"${"+e+"}",this.variableData.key===e||!(e in this.constants)}.bind(this)),this.validator.extend("keyLength",function(e){l()(this,t);var n=/^\$\{\w+\}$/.test(e)?v.i.VARIABLE_KEY_MAX_LENGTH+3:v.i.VARIABLE_KEY_MAX_LENGTH;return e.length<=n}.bind(this)),this.validator.extend("validReg",function(e){l()(this,t);try{new RegExp(e)}catch(t){return console.error(t),!1}return!0}.bind(this)),this.validator.extend("customValueCheck",function(e){l()(this,t);try{return!!new RegExp(this.theEditingData.validation).test(e)}catch(t){return console.error(t),!1}}.bind(this))},getValidateSet:function(){var t=this.theEditingData,e=t.show_type,n=t.custom_type,i=["required","custom","regex"];return"show"===e||"hide"===e&&["input","textarea"].includes(n)?i.slice(1):i},getInputDefaultValueValidation:function(){var t=this.theEditingData.validation;return"show"===this.theEditingData.show_type&&(t="(^$)|(".concat(t,")")),t},onValTypeChange:function(t){var e,n=this;this.varTypeList.some(function(i){var o=this;l()(this,n);var s=i.children.find(function(e){return l()(this,o),e.code===t}.bind(this));if(s)return e=s,!0}.bind(this)),this.renderData={},["input","textarea"].includes(t)?this.theEditingData.validation="^.+$":this.theEditingData.validation="",this.theEditingData.custom_type=e.code,this.theEditingData.source_tag=e.tag,this.theEditingData.is_meta="meta"===e.type,this.metaTag=e.meta_tag;var i=this.getValidateSet();this.$set(this.renderOption,"validateSet",i),this.getAtomConfig()},onBlurValidation:function(){var t=this,e=g.a.deepClone(this.renderConfig[0]),n=e.attrs.validation.find(function(e){return l()(this,t),"regex"===e.type}.bind(this));this.veeErrors.has("valueValidation")?n.args="":n.args=this.getInputDefaultValueValidation(),this.$set(this.renderConfig,0,e),this.$nextTick(function(){l()(this,t),this.$refs.renderForm.validate()}.bind(this))},onToggleShowType:function(t,e){var n=this;this.theEditingData.show_type=t,this.variableData.hasOwnProperty("pre_render_mako")||(this.theEditingData.pre_render_mako=!1);var i=this.getValidateSet();if(this.$set(this.renderOption,"validateSet",i),["input","textarea"].includes(this.theEditingData.custom_type)&&""!==this.theEditingData.validation){var o=g.a.deepClone(this.renderConfig[0]);o.attrs.validation.find(function(t){return l()(this,n),"regex"===t.type}.bind(this)).args=this.getInputDefaultValueValidation(),this.$set(this.renderConfig,0,o),this.$nextTick(function(){l()(this,n),this.$refs.renderForm.validate()}.bind(this))}},onSelectPreRenderMako:function(t){this.theEditingData.pre_render_mako="true"===t},handleMaskClick:function(){if(this.variableData.key){var t=this.renderConfig[0].tag_code,e=Object.assign({},this.theEditingData,{value:this.renderData[t]});e.key=/^\$\{\w+\}$/.test(e.key)?e.key:"${"+e.key+"}",g.a.isDataEqual(e,this.variableData)?this.$emit("closeEditingPanel"):this.isSaveConfirmDialogShow=!0}else this.isSaveConfirmDialogShow=!0},onConfirmClick:function(){this.isSaveConfirmDialogShow=!1,this.onSaveVariable()},onSaveVariable:function(){var t=this;return this.$validator.validateAll().then(function(){var e=a()(h.a.mark((function e(n){var i,o,s,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!0,t.$refs.renderForm&&(i=t.$refs.renderForm.validate()),n&&i){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,t.checkKey({key:t.theEditingData.key});case 6:if(e.sent.result){e.next=10;break}return t.$bkMessage({message:p.a.t("变量KEY为特殊标志符变量，请修改"),theme:"warning"}),e.abrupt("return");case 10:return t.theEditingData.pre_render_mako&&(t.theEditingData.pre_render_mako=Boolean(t.theEditingData.pre_render_mako)),o=t.theEditingData,t.renderConfig.length>0&&(s=t.renderConfig[0].tag_code,a={},a=t.renderData.hasOwnProperty(s)?t.renderData:b.a.getFormItemDefaultValue(t.renderConfig),/^\$\{\w+\}$/.test(o.key)||(o.key="${"+o.key+"}"),t.theEditingData.value=a[s]),t.theEditingData.name=t.theEditingData.name.trim(),t.variableData.key?(t.editVariable({key:t.variableData.key,variable:o}),t.variableData.key!==t.theEditingData.key&&t.outputs.includes(t.variableData.key)&&t.setOutputs({changeType:"edit",key:t.variableData.key,newKey:t.theEditingData.key})):(t.isHookedVar||(o.version="legacy",o.form_schema=y.a.getSchema(o.custom_type,t.atomFormConfig[t.atomTypeKey][o.version])),t.addVariable(g.a.deepClone(o))),t.$emit("onSaveEditing"),e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}})},k=(n(1377),n(9)),x=Object(k.a)(S,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"variable-edit"},[n("div",{staticClass:"variable-edit-content"},[n("section",{staticClass:"form-section"},[n("h3",[t._v(t._s(t.$t("基础信息")))]),t._v(" "),n("div",{staticClass:"form-item clearfix"},[n("label",{staticClass:"required"},[t._v(t._s(t.$t("名称")))]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-input",{directives:[{name:"validate",rawName:"v-validate",value:t.variableNameRule,expression:"variableNameRule"}],attrs:{name:"variableName",readonly:t.isSystemVar},model:{value:t.theEditingData.name,callback:function(e){t.$set(t.theEditingData,"name",e)},expression:"theEditingData.name"}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.veeErrors.has("variableName"),expression:"veeErrors.has('variableName')"}],staticClass:"common-error-tip error-msg"},[t._v(t._s(t.veeErrors.first("variableName")))])],1)]),t._v(" "),n("div",{staticClass:"form-item clearfix"},[n("label",{staticClass:"required"},[t._v("KEY")]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-input",{directives:[{name:"validate",rawName:"v-validate",value:t.variableKeyRule,expression:"variableKeyRule"}],attrs:{name:"variableKey",readonly:t.isSystemVar,disabled:t.isHookedVar&&""!==t.variableData.key},model:{value:t.theEditingData.key,callback:function(e){t.$set(t.theEditingData,"key",e)},expression:"theEditingData.key"}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.veeErrors.has("variableKey"),expression:"veeErrors.has('variableKey')"}],staticClass:"common-error-tip error-msg"},[t._v(t._s(t.veeErrors.first("variableKey")))])],1)]),t._v(" "),t.isSystemVar?t._e():n("div",{staticClass:"form-item variable-type clearfix"},[n("label",[t._v(t._s(t.$t("类型")))]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-select",{attrs:{disabled:t.isHookedVar,clearable:!1},on:{change:t.onValTypeChange},model:{value:t.currentValType,callback:function(e){t.currentValType=e},expression:"currentValType"}},[t.isHookedVar?t._l(t.varTypeList,(function(t,e){return n("bk-option",{key:e,attrs:{id:t.code,name:t.name}})})):t._l(t.varTypeList,(function(e,i){return n("bk-option-group",{key:i,attrs:{name:e.name}},t._l(e.children,(function(t,e){return n("bk-option",{key:e,attrs:{id:t.code,name:t.name}})})),1)}))],2),t._v(" "),t.varPhase?n("div",{staticClass:"phase-tag"},[t._v(t._s(t.varPhase))]):t._e()],1),t._v(" "),t.variableDesc?n("div",{staticClass:"variable-type-desc"},[t._v(t._s(t.variableDesc))]):t._e()]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:["input","textarea"].includes(t.theEditingData.custom_type),expression:"['input', 'textarea'].includes(theEditingData.custom_type)"}],staticClass:"form-item clearfix"},[n("label",{staticClass:"form-label"},[t._v(t._s(t.$t("正则校验")))]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-input",{directives:[{name:"validate",rawName:"v-validate",value:t.validationRule,expression:"validationRule"}],attrs:{name:"valueValidation"},on:{blur:t.onBlurValidation},model:{value:t.theEditingData.validation,callback:function(e){t.$set(t.theEditingData,"validation",e)},expression:"theEditingData.validation"}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.veeErrors.has("valueValidation"),expression:"veeErrors.has('valueValidation')"}],staticClass:"common-error-tip error-msg"},[t._v(t._s(t.veeErrors.first("valueValidation")))])],1)]),t._v(" "),t.isSystemVar?t._e():n("div",{staticClass:"form-item clearfix"},[n("label",[t._v(t._s(t.$t("显示")))]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-select",{attrs:{disabled:"component_outputs"===t.theEditingData.source_type,clearable:!1},on:{change:t.onToggleShowType},model:{value:t.theEditingData.show_type,callback:function(e){t.$set(t.theEditingData,"show_type",e)},expression:"theEditingData.show_type"}},t._l(t.showTypeList,(function(t,e){return n("bk-option",{key:e,attrs:{id:t.id,name:t.name}})})),1)],1)]),t._v(" "),t.isSystemVar?t._e():n("div",{staticClass:"form-item clearfix"},[n("label",{staticClass:"form-label"},[t._v(t._s(t.$t("模板预渲染")))]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-select",{attrs:{value:String(t.theEditingData.pre_render_mako),clearable:!1},on:{selected:t.onSelectPreRenderMako}},t._l(t.preRenderList,(function(t,e){return n("bk-option",{key:e,attrs:{id:t.id,name:t.name}})})),1)],1)]),t._v(" "),n("div",{staticClass:"form-item clearfix"},[n("label",{staticClass:"form-label"},[t._v(t._s(t.$t("说明")))]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-input",{attrs:{type:"textarea",placeholder:t.isSystemVar?" ":t.$t("请输入"),readonly:t.isSystemVar},model:{value:t.theEditingData.desc,callback:function(e){t.$set(t.theEditingData,"desc",e)},expression:"theEditingData.desc"}})],1)])]),t._v(" "),"component_outputs"===t.theEditingData.source_type||t.isSystemVar?t._e():n("section",{staticClass:"form-section"},[n("h3",[t._v(t._s(t.theEditingData.is_meta?t.$t("配置"):t.$t("默认值")))]),t._v(" "),n("div",{staticClass:"form-item value-form clearfix"},[n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.atomConfigLoading,opacity:1,zIndex:100},expression:"{ isLoading: atomConfigLoading, opacity: 1, zIndex: 100 }"}],staticClass:"form-content"},[!t.atomConfigLoading&&t.renderConfig.length?[n("RenderForm",{ref:"renderForm",attrs:{scheme:t.renderConfig,"form-option":t.renderOption},model:{value:t.renderData,callback:function(e){t.renderData=e},expression:"renderData"}})]:t._e()],2)])])]),t._v(" "),n("div",{staticClass:"btn-wrap"},[t.isSystemVar?n("bk-button",{attrs:{theme:"primary"},on:{click:function(e){return t.$emit("closeEditingPanel")}}},[t._v(t._s(t.$t("返回")))]):[n("bk-button",{attrs:{theme:"primary",disabled:t.atomConfigLoading||t.varTypeListLoading},on:{click:t.onSaveVariable}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{on:{click:function(e){return t.$emit("closeEditingPanel")}}},[t._v(t._s(t.$t("取消")))])]],2),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.isSaveConfirmDialogShow},on:{cancel:function(e){t.isSaveConfirmDialogShow=!1}}},[n("div",{staticClass:"variable-confirm-dialog-content"},[n("div",{staticClass:"leave-tips"},[t._v(t._s(t.$t("保存已修改的变量信息吗？")))]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary",disabled:t.atomConfigLoading},on:{click:t.onConfirmClick}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:function(e){return t.$emit("closeEditingPanel")}}},[t._v(t._s(t.$t("不保存")))])],1)])])],1)}),[],!1,null,"5a239ca3",null);e.a=x.exports},1221:function(t,e,n){"use strict";var i=n(5),o=n.n(i),s=n(0),a=n.n(s),r=(n(26),n(22),n(68),n(103),n(23),n(38),n(187),n(43),n(1)),l=n(28),c=n(6),u={name:"OutputParams",props:{params:Array,constants:Object,isSubflow:Boolean,nodeId:String,version:String},data:function(){var t=this.getOutputsList(this.params),e=this;return{list:t,isShow:!1,formData:{},selectIndex:"",rules:{name:[{required:!0,message:r.a.t("必填项"),trigger:"blur"},{max:c.i.VARIABLE_NAME_MAX_LENGTH,message:r.a.t("变量名称长度不能超过")+c.i.VARIABLE_NAME_MAX_LENGTH+r.a.t("个字符"),trigger:"blur"},{regex:c.e,message:r.a.t("变量名称不能包含")+c.c+r.a.t("非法字符"),trigger:"blur"}],key:[{required:!0,message:r.a.t("必填项"),trigger:"blur"},{max:c.i.VARIABLE_KEY_MAX_LENGTH,message:r.a.t("变量KEY值长度不能超过")+c.i.VARIABLE_KEY_MAX_LENGTH+r.a.t("个字符"),trigger:"blur"},{regex:/(^\${[a-zA-Z_]\w*}$)|(^[a-zA-Z_]\w*$)/,message:r.a.t("变量KEY由英文字母、数字、下划线组成，且不能以数字开头"),trigger:"blur"},{validator:function(t){return!((/^\$\{\w+\}$/.test(t)?t:"${".concat(t,"}"))in e.constants)},message:r.a.t("变量KEY值已存在"),trigger:"blur"}]}}},watch:{params:function(t){this.list=this.getOutputsList(t)}},methods:{getOutputsList:function(){var t=this,e=[],n=Object.keys(this.constants);return this.params.forEach(function(i){var o=this;a()(this,t);var s=i.key,r=n.some(function(t){a()(this,o);var e=this.constants[t];if("component_outputs"===e.source_type){var n=e.source_info[this.nodeId];if(n&&n.includes(i.key))return s=t,!0}}.bind(this));e.push({key:s,name:i.name,type:i.type||"--",description:i.schema?i.schema.description:"--",version:i.version,hooked:r})}.bind(this)),e},onHookChange:function(t,e){var n=t.$index;if(e)this.isShow=!0,this.formData=l.a.deepClone(t.row),this.selectIndex=n;else{var i={type:"delete",id:this.nodeId,key:t.row.key,tagCode:t.row.key};this.$emit("hookChange","delete",i),this.list[n].key=this.params[n].key,this.list[n].name=this.params[n].name}},onConfirm:function(t){var e=this;this.$refs.form.validate().then(function(t){if(a()(this,e),t){var n=this.formData,i=n.name,s=n.key;this.isShow=!1;var r=this.isSubflow?this.list[this.selectIndex].version:this.version,l="";/^\$\{((?!\{).)*\}$/.test(s)?(this.list[this.selectIndex].key=s,l=s):(this.list[this.selectIndex].key="${".concat(s,"}"),l="${".concat(s,"}"));var c={name:i,key:l,source_info:o()({},this.nodeId,[this.params[this.selectIndex].key]),version:r};this.createVariable(c)}}.bind(this))},onCancel:function(){this.isShow=!1,this.list[this.selectIndex].hooked=!1},createVariable:function(t){var e={name:"",key:"",desc:"",custom_type:"",source_info:{},source_tag:"",value:"",show_type:"hide",source_type:"component_outputs",validation:"",index:Object.keys(this.constants).length,version:""},n=Object.assign({},e,t);this.$emit("hookChange","create",n)}}},d=(n(1388),n(9)),h=Object(d.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"output-params"},[n("bk-table",{attrs:{data:t.list,border:!0}},[n("bk-table-column",{attrs:{label:t.$t("名称"),width:180,align:"center",prop:"name"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("说明"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.description?n("span",{attrs:{title:e.row.description}},[t._v("\n                    "+t._s(e.row.description)+"\n                ")]):n("span",[t._v("--")])]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:"type",width:90,align:"center",prop:"type"}}),t._v(" "),n("bk-table-column",{attrs:{label:"KEY",width:180,align:"center",prop:"key"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("引用"),width:100,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("bk-checkbox",{on:{change:function(n){return t.onHookChange(e,n)}},model:{value:e.row.hooked,callback:function(n){t.$set(e.row,"hooked",n)},expression:"props.row.hooked"}})]}}])})],1),t._v(" "),n("bk-dialog",{attrs:{"ext-cls":"common-dialog",theme:"primary","mask-close":!1,"render-directive":"if","header-position":"left",title:t.$t("新建变量"),"auto-close":!1,value:t.isShow,width:"600"},on:{confirm:t.onConfirm,cancel:t.onCancel}},[n("div",{staticClass:"variable-dialog"},[n("bk-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[[n("bk-form-item",{attrs:{label:t.$t("变量名称"),property:"name",required:!0}},[n("bk-input",{attrs:{name:"variableName"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("变量KEY"),property:"key",required:!0}},[n("bk-input",{attrs:{name:"variableKey"},model:{value:t.formData.key,callback:function(e){t.$set(t.formData,"key",e)},expression:"formData.key"}})],1)]],2)],1)])],1)}),[],!1,null,"1c16085c",null);e.a=h.exports},1250:function(t,e,n){"use strict";n(1038)},1377:function(t,e,n){"use strict";n(1126)},1378:function(t,e,n){"use strict";n(1127)},1379:function(t,e,n){"use strict";n(1128)},1380:function(t,e,n){"use strict";n(1129)},1381:function(t,e,n){"use strict";n(1130)},1382:function(t,e,n){"use strict";n(1131)},1383:function(t,e,n){"use strict";n(1132)},1384:function(t,e,n){"use strict";n(1133)},1385:function(t,e,n){"use strict";n(1134)},1386:function(t,e,n){"use strict";n(1135)},1387:function(t,e,n){"use strict";n(1136)},1388:function(t,e,n){"use strict";n(1137)},1389:function(t,e,n){"use strict";n(1138)},1390:function(t,e,n){"use strict";n(1139)},1391:function(t,e,n){"use strict";n(1140)},1392:function(t,e,n){"use strict";n(1141)},1393:function(t,e,n){"use strict";n(1142)},1394:function(t,e,n){"use strict";n(1143)},1395:function(t,e,n){"use strict";n(1144)},1396:function(t,e,n){t.exports=n.p+"images/node-double-click-guide.51cb03b375.gif"},1397:function(t,e,n){"use strict";n(1145)},1398:function(t,e,n){"use strict";n(1146)},1503:function(t,e,n){"use strict";n(26),n(38),n(49),n(50);var i=n(16),o=n.n(i),s=n(0),a=n.n(s),r=n(5),l=n.n(r),c=n(4),u=n.n(c),d=(n(67),n(37),n(80),n(22),n(129),n(23),n(101),n(39),n(185),n(1)),h=n(7),p=n(6);function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){l()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={name:"BasicInfo",props:{nodeConfig:Object,basicInfo:Object,versionList:Array,isSubflow:Boolean,updateSubflow:Boolean,inputLoading:Boolean},data:function(){return{labelData:[],labelLoading:!1,formData:m({},this.basicInfo),pluginRules:{plugin:[{required:!0,message:d.a.t("请选择插件"),trigger:"blur"}],version:[{required:!0,message:d.a.t("请选择插件版本"),trigger:"blur"}],nodeName:[{required:!0,message:d.a.t("节点名称不能为空"),trigger:"blur"},{regex:p.e,message:d.a.t("节点名称不能包含")+p.c+d.a.t("非法字符"),trigger:"blur"},{max:p.i.TEMPLATE_NODE_NAME_MAX_LENGTH,message:d.a.t("节点名称长度不能超过")+p.i.TEMPLATE_NODE_NAME_MAX_LENGTH+d.a.t("个字符"),trigger:"blur"}],stageName:[{max:p.i.STAGE_NAME_MAX_LENGTH,message:d.a.t("步骤名称长度不能超过")+p.i.STAGE_NAME_MAX_LENGTH+d.a.t("个字符"),trigger:"blur"}]},subflowRules:{tpl:[{required:!0,message:d.a.t("请选择流程模板"),trigger:"blur"}],nodeName:[{required:!0,message:d.a.t("节点名称不能为空"),trigger:"blur"},{regex:p.e,message:d.a.t("节点名称不能包含")+p.c+d.a.t("非法字符"),trigger:"blur"},{max:p.i.TEMPLATE_NODE_NAME_MAX_LENGTH,message:d.a.t("节点名称长度不能超过")+p.i.TEMPLATE_NODE_NAME_MAX_LENGTH+d.a.t("个字符"),trigger:"blur"}],stageName:[{max:p.i.STAGE_NAME_MAX_LENGTH,message:d.a.t("步骤名称长度不能超过")+p.i.STAGE_NAME_MAX_LENGTH+d.a.t("个字符"),trigger:"blur"}]},errorHandleTipsConfig:{allowHtml:!0,width:400,content:"#html-error-ingored-tootip",placement:"bottom-end"}}},computed:m(m({},Object(h.e)({subprocessInfo:function(t){return a()(this,void 0),t.template.subprocess_info}.bind(void 0)})),{},{subflowHasUpdate:function(){var t=this;return this.subprocessInfo.details.some(function(e){if(a()(this,t),e.expired&&e.template_id===Number(this.formData.tpl)&&e.subprocess_node_id===this.nodeConfig.id)return!0}.bind(this))},labelList:function(){var t=this;return this.labelLoading||0===this.labelData.length?[]:this.labelData.filter(function(e){var n=this;return a()(this,t),!this.formData.nodeLabel.find(function(t){return a()(this,n),e.code===t.group}.bind(this))}.bind(this))}}),watch:{basicInfo:function(t){this.formData=m({},t)}},created:function(){this.isSubflow||this.getNodeLabelList()},methods:m(m(m({},Object(h.d)("template/",["setNodeBasicInfo"])),Object(h.b)("template/",["getLabels"])),{},{getNodeLabelList:function(){var t=this;return o()(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.labelLoading=!0,e.next=4,t.getLabels({limit:0});case 4:n=e.sent,t.labelData=t.transLabelListToGroup(n.objects),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.labelLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},transLabelListToGroup:function(t){var e=this,n=[],i=[];return t.forEach(function(t){var o=this;a()(this,e);var s=i.findIndex(function(e){return a()(this,o),e===t.group.code}.bind(this));if(s>-1)n[s].children.push(t);else{var r=t.group,l=r.code,c=r.name;n.push({code:l,name:c,children:[m({},t)]}),i.push(t.group.code)}}.bind(this)),n},filterLabelTree:function(t){var e=this;if(this.labelLoading)return[];var n=[];return t.forEach(function(t){var i=this;a()(this,e);var o=this.labelData.find(function(e){return a()(this,i),e.code===t.group}.bind(this)),s=o.children.find(function(e){return a()(this,i),e.code===t.label}.bind(this));n.push({code:o.code,name:o.name,values:[{code:s.code,name:s.name}]})}.bind(this)),n},onLabelChange:function(t){var e=this,n=[];t.forEach(function(t){a()(this,e),t.values&&t.values.length>0&&n.push({label:t.values[0].code,group:t.code})}.bind(this)),this.formData.nodeLabel=n,this.updateData()},onLabelClear:function(){this.formData.nodeLabel=[],this.updateData()},onErrorHandlerChange:function(t,e){this.formData[e]=t,"ignorable"===e&&t&&(this.formData.retryable=!1,this.formData.skippable=!1),this.updateData()},onSelectableChange:function(t){this.formData.selectable=t,this.updateData()},updateData:function(){var t,e=this.formData,n=e.version,i=e.nodeName,o=e.stageName,s=e.nodeLabel,a=e.ignorable,r=e.skippable,l=e.retryable,c=e.selectable;t=this.isSubflow?{nodeName:i,stageName:o,nodeLabel:s,selectable:c}:{version:n,nodeName:i,stageName:o,nodeLabel:s,ignorable:a,skippable:r,retryable:l,selectable:c},this.$emit("update",t)},onUpdateSubflowVersion:function(){this.inputLoading||this.$emit("updateSubflowVersion")},validate:function(){var t=this.isSubflow?this.$refs.subflowForm:this.$refs.pluginForm;return t.clearError(),t.validate()}})},g=(n(1386),n(9)),b=Object(g.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"basic-info"},[t.isSubflow?n("bk-form",{ref:"subflowForm",attrs:{"label-width":130,model:t.formData,rules:t.subflowRules}},[n("bk-form-item",{attrs:{label:t.$t("流程模板"),required:!0,property:"tpl"}},[n("bk-input",{attrs:{value:t.formData.name,readonly:""}},[n("template",{slot:"append"},[t.basicInfo.tpl?n("div",{staticClass:"view-subflow",on:{click:function(e){return t.$emit("viewSubflow",t.basicInfo.tpl)}}},[n("i",{staticClass:"bk-icon common-icon-box-top-right-corner"})]):t._e(),t._v(" "),n("div",{staticClass:"operate-btn",on:{click:function(e){return t.$emit("openSelectorPanel")}}},[t._v("\n                        "+t._s(t.formData.tpl?t.$t("重选"):t.$t("选择"))+"\n                    ")])])],2),t._v(" "),t.inputLoading||!t.subflowHasUpdate||t.updateSubflow?t._e():n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("版本更新"),placements:["bottom-end"]},expression:"{\n                    content: $t('版本更新'),\n                    placements: ['bottom-end']\n                }"}],staticClass:"common-icon-clock-inversion update-tooltip",on:{click:t.onUpdateSubflowVersion}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("节点名称"),required:!0,property:"nodeName"}},[n("bk-input",{on:{change:t.updateData},model:{value:t.formData.nodeName,callback:function(e){t.$set(t.formData,"nodeName",e)},expression:"formData.nodeName"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("步骤名称"),property:"stageName"}},[n("bk-input",{on:{change:t.updateData},model:{value:t.formData.stageName,callback:function(e){t.$set(t.formData,"stageName",e)},expression:"formData.stageName"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("是否可选")}},[n("bk-switcher",{attrs:{theme:"primary",size:"small",value:t.formData.selectable},on:{change:t.onSelectableChange}})],1)],1):n("bk-form",{ref:"pluginForm",attrs:{"label-width":130,model:t.formData,rules:t.pluginRules}},[n("bk-form-item",{staticClass:"choose-plugin-input",attrs:{label:t.$t("标准插件"),required:!0,property:"plugin"}},[n("bk-input",{attrs:{value:t.formData.name,readonly:""}},[n("template",{slot:"append"},[n("div",{staticClass:"operate-btn",on:{click:function(e){return t.$emit("openSelectorPanel")}}},[t._v("\n                        "+t._s(t.formData.plugin?t.$t("重选"):t.$t("选择"))+"\n                    ")])])],2),t._v(" "),t.formData.desc?n("p",{staticClass:"plugin-info-desc",domProps:{innerHTML:t._s(t.formData.desc)}}):t._e()],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("插件版本"),required:!0,property:"version"}},[n("bk-select",{attrs:{clearable:!1},on:{selected:function(e){return t.$emit("versionChange",e)}},model:{value:t.formData.version,callback:function(e){t.$set(t.formData,"version",e)},expression:"formData.version"}},t._l(t.versionList,(function(t){return n("bk-option",{key:t.version,attrs:{id:t.version,name:t.version}})})),1)],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("节点名称"),required:!0,property:"nodeName"}},[n("bk-input",{on:{change:t.updateData},model:{value:t.formData.nodeName,callback:function(e){t.$set(t.formData,"nodeName",e)},expression:"formData.nodeName"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("步骤名称"),property:"stageName"}},[n("bk-input",{on:{change:t.updateData},model:{value:t.formData.stageName,callback:function(e){t.$set(t.formData,"stageName",e)},expression:"formData.stageName"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("节点标签"),property:"label"}},[n("bk-search-select",{attrs:{"primary-key":"code",clearable:!0,"popover-zindex":2300,data:t.labelList,"show-condition":!1,"show-popover-tag-change":!1,values:t.filterLabelTree(t.formData.nodeLabel)},on:{change:t.onLabelChange,clear:t.onLabelClear}})],1),t._v(" "),n("bk-form-item",{staticClass:"error-handle",attrs:{label:t.$t("失败处理")}},[n("bk-checkbox",{attrs:{value:t.formData.ignorable},on:{change:function(e){return t.onErrorHandlerChange(e,"ignorable")}}},[n("i",{staticClass:"error-handle-icon common-icon-dark-circle-i"}),t._v("\n                "+t._s(t.$t("自动忽略"))+"\n            ")]),t._v(" "),n("bk-checkbox",{attrs:{value:t.formData.skippable,disabled:t.formData.ignorable},on:{change:function(e){return t.onErrorHandlerChange(e,"skippable")}}},[n("i",{staticClass:"error-handle-icon common-icon-dark-circle-s"}),t._v("\n                "+t._s(t.$t("手动跳过"))+"\n            ")]),t._v(" "),n("bk-checkbox",{attrs:{value:t.formData.retryable,disabled:t.formData.ignorable},on:{change:function(e){return t.onErrorHandlerChange(e,"retryable")}}},[n("i",{staticClass:"error-handle-icon common-icon-dark-circle-r"}),t._v("\n                "+t._s(t.$t("手动重试"))+"\n            ")]),t._v(" "),t.formData.ignorable||t.formData.skippable||t.formData.retryable?t._e():n("p",{staticClass:"error-handle-tips"},[t._v("\n                "+t._s(t.$t("未选择失败处理方式，标准插件节点如果执行失败，会导致任务中断后不可继续"))+"\n            ")]),t._v(" "),n("div",{staticClass:"tips-item",staticStyle:{"white-space":"normal"},attrs:{id:"html-error-ingored-tootip"}},[n("p",[t._v(t._s(t.$t("自动忽略：标准插件节点如果执行失败，会自动忽略错误并把节点状态设置为成功。")))]),t._v(" "),n("p",[t._v(t._s(t.$t("手动跳过：标准插件节点如果执行失败，可以人工干预，直接跳过节点的执行。")))]),t._v(" "),n("p",[t._v(t._s(t.$t("手动重试：标准插件节点如果执行失败，可以人工干预，填写参数后重试节点。")))])]),t._v(" "),n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.errorHandleTipsConfig,expression:"errorHandleTipsConfig"}],ref:"tooltipsHtml",staticClass:"common-icon-info form-item-tips"})],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("是否可选")}},[n("bk-switcher",{attrs:{theme:"primary",size:"small",value:t.formData.selectable},on:{change:t.onSelectableChange}})],1)],1)],1)}),[],!1,null,"c78e6c0a",null);e.a=b.exports},1504:function(t,e,n){"use strict";var i=n(5),o=n.n(i),s=n(0),a=n.n(s),r=(n(67),n(80),n(183),n(23),n(83),n(27),n(52),n(68),n(103),n(22),n(70),n(26),n(38),n(37),n(49),n(50),n(611)),l=n(28),c=n(1),u=n(102),d=n(6);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={name:"SelectorPanel",components:{NoData:r.a},mixins:[u.a],props:{templateLabels:Array,atomTypeList:Object,isSubflow:Boolean,basicInfo:Object,common:[String,Number]},data:function(){var t=this.isSubflow?this.atomTypeList.subflow:this.atomTypeList.tasknode;return{listData:t,listInPanel:t,darkColorList:d.b,searchStr:"",searchResult:[],isLabelSelectorOpen:!1,activeGroup:this.isSubflow?"":this.getDefaultActiveGroup()}},computed:{activeList:function(){var t=this;if(!this.isSubflow){var e=this.listInPanel.find(function(e){return a()(this,t),e.type===this.activeGroup}.bind(this));return e?e.list:[]}return[]},labels:function(){var t=this.templateLabels.slice(0);return t.unshift({id:0,name:c.a.t("默认全部")}),t},selectedLabelName:function(){var t=this;return this.isSubflow&&this.activeGroup?this.templateLabels.find(function(e){return a()(this,t),e.id===this.activeGroup}.bind(this)).name:""}},created:function(){this.onSearchInput=l.a.debounce(this.searchInputhandler,500)},methods:{getDefaultActiveGroup:function(){var t=this,e="",n=this.isSubflow?this.atomTypeList.subflow.groups:this.atomTypeList.tasknode,i=this.isSubflow?"id":"code",o=this.isSubflow?"tpl":"plugin";return this.basicInfo[o]?n.some(function(n){var s=this;if(a()(this,t),n.list.find(function(t){return a()(this,s),String(t[i])===String(this.basicInfo[o])}.bind(this)))return e=n.type,!0}.bind(this)):n.length>0&&(e=n[0].type),e},getIconCls:function(t){var e=this,n=d.j.find(function(n){return a()(this,e),new RegExp(n).test(t)}.bind(this));return this.isSubflow?"common-icon-subflow-mark":n?"common-icon-sys-".concat(n.toLowerCase()):"common-icon-sys-default"},getLabelStyle:function(t){var e=this;if(t){var n=this.templateLabels.find(function(n){return a()(this,e),n.id===Number(t)}.bind(this));return{background:n.color,color:this.darkColorList.includes(n.color)?"#fff":"#262e4f"}}return{color:"#000000",minWidth:"unset",padding:"2px"}},onSelectGroup:function(t){this.activeGroup=t,this.isSubflow?this.searchInputhandler():this.$refs.selectorArea.scrollTop=0},onClearSearch:function(){this.searchInputhandler()},searchInputhandler:function(){var t=this,e=[];if(this.isSubflow){var n=new RegExp(this.searchStr,"i");this.listData.forEach(function(i){var o=this;a()(this,t);var s=!0,r=!0,l=p({},i);this.activeGroup&&(s=i.template_labels.find(function(t){return a()(this,o),t.label_id===Number(this.activeGroup)}.bind(this))),""!==this.searchStr&&(n.test(i.name)?l.highlightName=l.name.replace(n,'<span style="color: #ff5757;">'.concat(this.searchStr,"</span>")):r=!1),s&&r&&e.push(l)}.bind(this))}else if(""===this.searchStr)e=this.listData.slice(0),this.activeGroup=this.getDefaultActiveGroup();else{var i=new RegExp(this.searchStr,"i");this.listData.forEach(function(n){var o=this;a()(this,t);var s=n.group_icon,r=n.group_name,l=n.type,c=[];if(i.test(r)){var u=r.replace(i,'<span style="color: #ff5757;">'.concat(this.searchStr,"</span>"));e.push(p(p({},n),{},{group_name:u}))}else n.list.length>0&&(n.list.forEach(function(t){if(a()(this,o),i.test(t.name)){var e=p({},t);e.highlightName=t.name.replace(i,'<span style="color: #ff5757;">'.concat(this.searchStr,"</span>")),c.push(e)}}.bind(this)),c.length>0&&e.push({group_icon:s,group_name:r,type:l,list:c}))}.bind(this)),e.length>0&&(this.activeGroup=e[0].type)}this.listInPanel=e},handleLabelSelectorOpen:function(){this.isLabelSelectorOpen=!0},handleLabelSelectorClose:function(){this.isLabelSelectorOpen=!1},onTplClick:function(t){t.hasPermission?this.$emit("select",t):this.onApplyPermission(t)},getSelectedStatus:function(t){return this.isSubflow?String(t.id)===String(this.basicInfo.tpl):t.code===this.basicInfo.plugin},onApplyPermission:function(t){var e,n;this.common?(e="common_flow_view",n={common_flow:[{id:t.id,name:t.name}]}):(e="flow_view",n={flow:[{id:t.id,name:t.name}],project:[{id:t.project.id,name:t.project.name}]}),this.applyForPermission([e],[],n)}}},m=(n(1389),n(1390),n(9)),v=Object(m.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"selector-panel"},[n("bk-input",{staticClass:"search-input",attrs:{"right-icon":"bk-icon icon-search",placeholder:t.$t("请输入名称"),clearable:!0},on:{input:t.onSearchInput,clear:t.onClearSearch},model:{value:t.searchStr,callback:function(e){t.searchStr="string"==typeof e?e.trim():e},expression:"searchStr"}}),t._v(" "),n("div",{staticClass:"list-wrapper"},[t.isSubflow?n("div",{staticClass:"subflow-list"},[n("div",{staticClass:"list-table"},[n("div",{staticClass:"table-head"},[n("div",{staticClass:"th-item tpl-name"},[t._v(t._s(t.$t("流程名称")))]),t._v(" "),n("div",{staticClass:"th-item tpl-label"},[n("span",[t._v(t._s(t.$t("标签")))]),t._v(" "),t.common?t._e():n("div",{staticClass:"label-select-wrap"},[n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{placement:"bottom-left",allowHtml:"true",theme:"light",hideOnClick:!1,extCls:"tpl-label-popover",content:"#tpl-label-popover-content",onShow:t.handleLabelSelectorOpen,onHide:t.handleLabelSelectorClose},expression:"{\n                                    placement: 'bottom-left',\n                                    allowHtml: 'true',\n                                    theme: 'light',\n                                    hideOnClick: false,\n                                    extCls: 'tpl-label-popover',\n                                    content: '#tpl-label-popover-content',\n                                    onShow: handleLabelSelectorOpen,\n                                    onHide: handleLabelSelectorClose\n                                }"}],staticClass:"selected-label-name"},[n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"label-content",style:t.getLabelStyle(t.activeGroup)},[t._v(t._s(t.selectedLabelName))]),t._v(" "),n("i",{class:["bk-icon","icon-angle-down",{active:t.isLabelSelectorOpen}]})]),t._v(" "),n("div",{attrs:{id:"tpl-label-popover-content"}},t._l(t.labels,(function(e){return n("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],key:e.id,class:["tpl-label-item",{active:t.activeGroup===e.id}],on:{click:function(n){return t.onSelectGroup(e.id)}}},[n("span",{staticClass:"label-content",style:t.getLabelStyle(e.id)},[t._v("\n                                        "+t._s(e.name)+"\n                                    ")])])})),0)])])]),t._v(" "),n("div",{staticClass:"tpl-list"},[t.listInPanel.length>0?t._l(t.listInPanel,(function(e){return n("div",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission},expression:"{ active: !item.hasPermission }"}],key:e.id,class:["tpl-item",{active:t.getSelectedStatus(e),"text-permission-disable":!e.hasPermission}],on:{click:function(n){return t.onTplClick(e)}}},[n("div",{staticClass:"tpl-name name-content"},[e.highlightName?n("div",{staticClass:"name",domProps:{innerHTML:t._s(e.highlightName)}}):n("div",{staticClass:"name"},[t._v(t._s(e.name))]),t._v(" "),n("span",{staticClass:"view-tpl",on:{click:function(n){return n.stopPropagation(),t.$emit("viewSubflow",e.id)}}},[n("i",{staticClass:"common-icon-box-top-right-corner"})])]),t._v(" "),!t.common&&e.template_labels.length>0?n("div",{staticClass:"tpl-label labels-wrap"},t._l(e.template_labels,(function(e){return n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],key:e.id,staticClass:"label-item",style:t.getLabelStyle(e.label_id)},[t._v("\n                                    "+t._s(e.name)+"\n                                ")])})),0):t._e()])})):n("no-data")],2)])]):[t.listInPanel.length>0?[n("div",{staticClass:"group-area"},t._l(t.listInPanel,(function(e){return n("div",{key:e.type,class:["group-item",{active:e.type===t.activeGroup}],on:{click:function(n){return t.onSelectGroup(e.type)}}},[e.group_icon?n("img",{staticClass:"group-icon-img",attrs:{src:e.group_icon}}):n("i",{class:["group-icon-font",t.getIconCls(e.type)]}),t._v(" "),n("span",{domProps:{innerHTML:t._s(e.group_name)}}),t._v(" "),n("span",[t._v(t._s("("+e.list.length+")"))])])})),0),t._v(" "),n("div",{ref:"selectorArea",staticClass:"selector-area"},[t.activeList.length>0?t._l(t.activeList,(function(e,i){return n("li",{key:i,class:["list-item",{active:t.getSelectedStatus(e)}],attrs:{title:e.name},on:{click:function(n){return t.$emit("select",e)}}},[e.highlightName?n("span",{staticClass:"node-name",domProps:{innerHTML:t._s(e.highlightName)}}):n("span",{staticClass:"node-name"},[t._v(t._s(e.name))])])})):n("no-data")],2)]:n("no-data")]],2)],1)}),[],!1,null,"2e6e9e6c",null);e.a=v.exports},568:function(t,e,n){"use strict";n.r(e);n(38),n(37),n(49),n(50);var i=n(677),o=n.n(i),s=n(865),a=n.n(s),r=n(16),l=n.n(r),c=n(0),u=n.n(c),d=n(5),h=n.n(d),p=n(4),f=n.n(p),m=(n(23),n(43),n(127),n(80),n(68),n(22),n(183),n(101),n(39),n(185),n(184),n(315),n(24),n(67),n(26),n(83),n(27),n(52),n(1)),v=n(7),g=n(687),b=n.n(g),y=n(46),_=n(28),w=n(12),C=n(655),S=n(1037),k=n(193),x=n(51),P=n.n(x),E=n(102),D=n(666),j=n(992),O=[{id:"operationFlowTab",icon:"common-icon-branchs",title:m.a.t("操作流水")},{id:"globalVariableTab",icon:"common-icon-square-code",title:m.a.t("全局变量"),desc:m.a.t()},{id:"templateConfigTab",icon:"common-icon-square-attribute",title:m.a.t("基础信息")},{id:"tplSnapshootTab",icon:"common-icon-clock-reload",title:m.a.t("本地快照"),desc:m.a.t("可自动保存最近的50次快照，每5分钟一次。仅在本地浏览器存储。")},{id:"templateDataEditTab",icon:"common-icon-paper",title:m.a.t("模板数据")}];function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var N={name:"TemplateHeader",components:{PageHeader:D.a,SelectProjectModal:j.a},mixins:[E.a],props:{type:String,name:String,template_id:[String,Number],project_id:[String,Number],common:String,templateSaving:Boolean,createTaskSaving:Boolean,activeTab:String,isGlobalVariableUpdate:Boolean,isTemplateDataChanged:Boolean,isFromTplListRoute:Boolean,isEditProcessPage:Boolean,isPreviewMode:Boolean,executeSchemeSaving:Boolean,tplActions:{type:Array,default:function(){return[]}}},data:function(){return{settingTabs:O.slice(0),isSelectProjectShow:!1,saveBtnActive:!1,createTaskBtnActive:!1,hasCreateCommonTplPerm:!1,hasCommonTplCreateTaskPerm:!1,createCommonTplPermLoading:!1,commonTplCreateTaskPermLoading:!1,selectedProject:{}}},computed:L(L(L({},Object(v.e)({permissionMeta:function(t){return u()(this,void 0),t.permissionMeta}.bind(void 0)})),Object(v.e)("project",{authActions:function(t){return u()(this,void 0),t.authActions}.bind(void 0),projectName:function(t){return u()(this,void 0),t.projectName}.bind(void 0)})),{},{title:function(){return void 0===this.$route.query.template_id?m.a.t("新建流程"):m.a.t("编辑流程")},isSaveAndCreateTaskType:function(){return!0===this.isTemplateDataChanged||"new"===this.type||"clone"===this.type},createTaskBtnText:function(){return this.isSaveAndCreateTaskType?m.a.t("保存并新建任务"):m.a.t("新建任务")},saveRequiredPerm:function(){return["new","clone"].includes(this.type)?this.common?["common_flow_create"]:["flow_create"]:this.common?["common_flow_edit"]:["flow_edit"]},saveAndCreateRequiredPerm:function(){return["new","clone"].includes(this.type)?this.common?["common_flow_create"]:["flow_create"]:this.isTemplateDataChanged?this.common?["common_flow_edit"]:["flow_edit","flow_create_task"]:this.common?[]:["flow_create_task"]}}),watch:{type:function(t,e){var n=this;["new","clone"].includes(e)&&"edit"===t&&this.common&&this.isSelectProjectShow&&this.queryCommonTplCreateTaskPerm().then(function(){u()(this,n),this.hasCommonTplCreateTaskPerm&&this.saveTemplate(!0)}.bind(this))}},mounted:function(){var t=this;return l()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.common){e.next=7;break}return e.next=3,t.queryCreateCommonTplPerm();case 3:t.setSaveBtnPerm(),t.setCreateTaskBtnPerm(),e.next=9;break;case 7:t.setSaveBtnPerm(),t.setCreateTaskBtnPerm();case 9:case"end":return e.stop()}}),e)})))()},methods:L(L({},Object(v.b)(["queryUserPermission"])),{},{onSaveClick:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.createCommonTplPermLoading||this.commonTplCreateTaskPermLoading||(t?this.createTaskBtnActive?this.saveTemplate(t):this.common?this.applyCreateCommonTplPerm():this.applyTplPerm(this.saveAndCreateRequiredPerm):this.saveBtnActive?this.saveTemplate(t):this.common?this.applyCreateCommonTplPerm():this.applyTplPerm(this.saveRequiredPerm),this.$emit("onOpenExecuteScheme",!1))},saveTemplate:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$validator.validateAll().then(function(n){if(u()(this,t),n){var i=this.common?this.selectedProject.id:this.project_id;e&&!this.isSaveAndCreateTaskType?this.common&&void 0===i?this.setProjectSelectDialogShow():this.goTaskCreate(i):this.$emit("onSaveTemplate",e,i)}}.bind(this))},getPermissionData:function(){var t,e;return["new","clone"].includes(this.type)?(t={id:this.project_id,name:m.a.t("项目"),auth_actions:this.authActions},e=this.authActions):(t={id:this.template_id,name:this.name,auth_actions:this.tplActions},e=this.tplActions),{resourceData:t,actions:e}},onBackClick:function(){this.isEditProcessPage?this.goBackTplList():this.goBackToTplEdit()},onSaveExecuteSchemeClick:function(){this.$emit("onSaveExecuteSchemeClick")},goBackTplList:function(){if(this.isFromTplListRoute)this.$router.back();else{var t=this.common?{name:"commonProcessList"}:{name:"process",params:{project_id:this.project_id}};this.$router.push(t)}},goBackToTplEdit:function(){this.$emit("goBackToTplEdit")},goTaskCreate:function(t){this.$router.push({name:"taskCreate",params:{step:"selectnode",project_id:t},query:{template_id:this.template_id,common:this.common||void 0,entrance:"templateEdit"}})},onClosePreview:function(){this.$emit("onClosePreview")},handleProjectChange:function(t){this.selectedProject=t,"new"!==this.type&&"clone"!==this.type&&this.queryCommonTplCreateTaskPerm()},handleCreateTaskConfirm:function(){if("new"===this.type||"clone"===this.type){var t=this.common?this.selectedProject.id:this.project_id;this.$emit("onSaveTemplate",!1,t)}else this.hasCommonTplCreateTaskPerm?this.saveTemplate(!0):this.applyCommonTplCreateTaskPerm()},handleCreateTaskCancel:function(){this.selectedProject={},this.isSelectProjectShow=!1},setSaveBtnPerm:function(){if(this.common&&["new","clone"].includes(this.type))this.saveBtnActive=this.hasCreateCommonTplPerm;else{var t=[].concat(P()(this.authActions),P()(this.tplActions));this.saveBtnActive=this.hasPermission(this.saveRequiredPerm,t)}},setCreateTaskBtnPerm:function(){if(this.common&&["new","clone"].includes(this.type))this.createTaskBtnActive=this.hasCreateCommonTplPerm;else{var t=[].concat(P()(this.authActions),P()(this.tplActions));this.createTaskBtnActive=this.hasPermission(this.saveAndCreateRequiredPerm,t)}},queryCreateCommonTplPerm:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.createCommonTplPermLoading=!0,e.next=4,t.queryUserPermission({action:"common_flow_create"});case 4:n=e.sent,t.hasCreateCommonTplPerm=n.data.is_allow,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.createCommonTplPermLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},queryCommonTplCreateTaskPerm:function(){var t=this;return l()(f.a.mark((function e(){var n,i,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.commonTplCreateTaskPermLoading=!0,n=t.permissionMeta.system.find(function(t){return u()(this,o),"bk_sops"===t.id}.bind(this)),e.next=5,t.queryUserPermission({action:"common_flow_create_task",resources:[{system:n.id,type:"project",id:t.selectedProject.id,attributes:{}},{system:n.id,type:"common_flow",id:t.template_id,attributes:{}}]});case 5:i=e.sent,t.hasCommonTplCreateTaskPerm=i.data.is_allow,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:return e.prev=12,t.commonTplCreateTaskPermLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])})))()},setProjectSelectDialogShow:function(){this.isSelectProjectShow=!0},applyCreateCommonTplPerm:function(){this.applyForPermission(["common_flow_create"])},applyCommonTplCreateTaskPerm:function(){var t=[].concat(P()(this.tplActions),P()(this.selectedProject.auth_actions)),e={common_flow:[{id:this.template_id,name:this.name}],project:[{id:this.selectedProject.id,name:this.selectedProject.name}]};this.applyForPermission(["common_flow_create_task"],t,e)},applyTplPerm:function(t){var e=P()(this.authActions),n={project:[{id:this.project_id,name:this.projectName}]};"edit"===this.type&&(e=P()(this.tplActions),n.flow=[{id:this.template_id,name:this.name}]),this.applyForPermission(t,e,n)},onOpenExecuteScheme:function(){this.saveTemplate(),this.$emit("onOpenExecuteScheme",!0)}})},A=(n(1250),n(9)),I=Object(A.a)(N,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("page-header",{staticClass:"template-header-wrapper"},[n("div",{staticClass:"header-left-area"},[n("i",{staticClass:"bk-icon icon-arrows-left back-icon",on:{click:t.onBackClick}}),t._v(" "),n("div",{staticClass:"title"},[t._v(t._s(t.isEditProcessPage?t.title:t.$t("编辑执行方案")))]),t._v(" "),n("h3",{staticClass:"template-name"},[t._v(t._s(t.name))]),t._v(" "),t.isEditProcessPage?n("span",{staticClass:"common-icon-edit",on:{click:function(e){return t.$emit("onChangePanel","templateConfigTab")}}}):t._e(),t._v(" "),!t.common&&t.isEditProcessPage?n("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:t.$t("执行方案"),expression:"$t('执行方案')",modifiers:{bottom:!0}}],staticClass:"common-icon-file-setting execute-scheme-icon",on:{click:t.onOpenExecuteScheme}}):t._e()]),t._v(" "),n("div",{staticClass:"header-right-area",attrs:{slot:"expand"},slot:"expand"},[t.isEditProcessPage?n("div",{staticClass:"button-area"},[n("div",{staticClass:"setting-tab-wrap"},t._l(t.settingTabs,(function(e){return n("span",{key:e.id,class:["setting-item",{active:t.activeTab===e.id,update:"globalVariableTab"===e.id&&t.isGlobalVariableUpdate}],on:{click:function(n){return t.$emit("onChangePanel",e.id)}}},[n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:e.title,expression:"tab.title",modifiers:{bottom:!0}}],class:e.icon})])})),0),t._v(" "),n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.saveBtnActive},expression:"{ active: !saveBtnActive }"}],class:["save-canvas","task-btn",{"btn-permission-disable":!t.saveBtnActive}],attrs:{theme:"primary",loading:t.templateSaving},on:{click:function(e){return e.stopPropagation(),t.onSaveClick(!1)}}},[t._v("\n                "+t._s(t.$t("保存"))+"\n            ")]),t._v(" "),n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.createTaskBtnActive},expression:"{ active: !createTaskBtnActive }"}],class:["task-btn",{"btn-permission-disable":!t.createTaskBtnActive}],attrs:{theme:"primary",loading:t.createTaskSaving},on:{click:function(e){return e.stopPropagation(),t.onSaveClick(!0)}}},[t._v("\n                "+t._s(t.createTaskBtnText)+"\n            ")])],1):t._e(),t._v(" "),t.isEditProcessPage||t.isPreviewMode?t._e():n("div",{staticClass:"button-area execute-scheme"},[n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.saveBtnActive},expression:"{ active: !saveBtnActive }"}],class:["save-execute-scheme","task-btn",{"btn-permission-disable":!t.saveBtnActive}],attrs:{theme:"primary",loading:t.executeSchemeSaving},on:{click:function(e){return e.stopPropagation(),t.onSaveExecuteSchemeClick.apply(null,arguments)}}},[t._v("\n                "+t._s(t.$t("保存"))+"\n            ")])],1),t._v(" "),!t.isEditProcessPage&&t.isPreviewMode?n("div",{staticClass:"button-area preview"},[n("bk-button",{attrs:{theme:"primary"},on:{click:t.onClosePreview}},[t._v(t._s("关闭预览"))])],1):t._e()]),t._v(" "),n("SelectProjectModal",{attrs:{title:t.$t("创建任务"),show:t.isSelectProjectShow,"confirm-loading":t.commonTplCreateTaskPermLoading||t.templateSaving,"confirm-cursor":!["new","clone"].includes(t.type)&&!t.hasCommonTplCreateTaskPerm},on:{onChange:t.handleProjectChange,onConfirm:t.handleCreateTaskConfirm,onCancel:t.handleCreateTaskCancel}})],1)}),[],!1,null,"46a59c1b",null).exports,M=n(694),$=n(825),F=n.n($),R=n(1219);n(103),n(70),n(317);function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var H={name:"VariableCitedList",props:{citedList:Object},data:function(){return{groups:[{id:"activities",name:"任务节点"},{id:"conditions",name:"分支条件"},{id:"constants",name:"全局变量"}]}},computed:V(V({},Object(v.e)({activities:function(t){return u()(this,void 0),t.template.activities}.bind(void 0),lines:function(t){return u()(this,void 0),t.template.line}.bind(void 0),gateways:function(t){return u()(this,void 0),t.template.gateways}.bind(void 0),constants:function(t){return u()(this,void 0),t.template.constants}.bind(void 0),systemConstants:function(t){return u()(this,void 0),t.template.systemConstants}.bind(void 0)})),{},{variableList:function(){return V(V({},this.systemConstants),this.constants)},list:function(){var t=this;return this.groups.map(function(e){var n=this;u()(this,t);var i=e.id,o=this.citedList[i].map(function(t){var e=this;u()(this,n);var o=t,s="";if("activities"===i)s=this.activities[t].name;else if("conditions"===i){var a=this.lines.find(function(n){return u()(this,e),n.id===t}.bind(this)).source.id;s=this.gateways[a].conditions[o].name}else s=this.variableList[t].name;return{id:o,name:s}}.bind(this));return{title:e.name,key:i,data:o}}.bind(this))}}),methods:{onCitedNodeClick:function(t,e){this.$emit("onCitedNodeClick",{group:t,id:e})}}},G=(n(1378),Object(A.a)(H,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"variable-cited-wrap"},[t._l(t.list,(function(e){return[e.data.length>0?n("div",{key:e.key,staticClass:"variable-cited-list"},[n("p",{staticClass:"group-title"},[t._v(t._s(t.$t("引用变量的"))+t._s(t.$t(""+e.title))+t._s(t.$t("（"))+t._s(e.data.length)+t._s(t.$t("）")))]),t._v(" "),t._l(e.data,(function(i){return n("div",{key:i.id,staticClass:"variable-cited-item"},[n("span",{class:["cited-name",{"name-error":!i.name}],attrs:{title:i.name},on:{click:function(n){return n.stopPropagation(),t.onCitedNodeClick(e.key,i.id)}}},[t._v("\n                    "+t._s(i.name)+"\n                ")])])}))],2):t._e()]}))],2)}),[],!1,null,"341873c6",null).exports);function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var z={name:"VariablePreviewValue",props:{keyid:String,params:Object},data:function(){return{valueStr:"",loading:!1}},created:function(){this.keyid&&this.getVaribleValue()},methods:Y(Y({},Object(v.b)("template",["getConstantsPreviewResult"])),{},{getVaribleValue:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,t.getConstantsPreviewResult(t.params);case 4:(n=e.sent).result&&(t.valueStr=n.data[t.keyid]),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.loading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()}})},W=(n(1379),Object(A.a)(z,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:this.loading,zIndex:100},expression:"{ isLoading: loading, zIndex: 100 }"}],staticClass:"variable-preview-value"},[e("div",{staticClass:"content"},[this._v(this._s(this.valueStr))])])}),[],!1,null,"40b43dce",null).exports);function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var K={name:"VariableItem",components:{VariableCitedList:G,VariablePreviewValue:W},props:{outputed:Boolean,variableData:Object,common:[String,Number],variableCited:Object},data:function(){return{showCitedList:!1,showPreviewValue:!1,copyText:"",previewParams:{}}},computed:q(q({},Object(v.e)({username:function(t){return u()(this,void 0),t.username}.bind(void 0),activities:function(t){return u()(this,void 0),t.template.activities}.bind(void 0),constants:function(t){return u()(this,void 0),t.template.constants}.bind(void 0),project_id:function(t){return u()(this,void 0),t.project.project_id}.bind(void 0),bizId:function(t){return u()(this,void 0),t.project.bizId}.bind(void 0)})),{},{isSystemVar:function(){return"system"===this.variableData.source_type},citedList:function(){return this.variableCited[this.variableData.key]||{activities:[],conditions:[],constants:[]}},citedNum:function(){var t=this.citedList,e=t.activities,n=t.conditions,i=t.constants;return e.length+n.length+i.length}}),methods:{setCitingVarNodes:function(t,e,n){var i=this;if(!e.includes(n))if("string"==typeof t){var o=this.variableData.key.replace(/[\$\{\}]/g,""),s=t.match(/\$\{[\S\s]*?\}/gm);s&&s.length&&s.some(function(t){if(u()(this,i),t.includes(o))return e.push(n),!0}.bind(this))}else"object"===a()(t)&&(Array.isArray(t)?t.forEach(function(t){u()(this,i),this.setCitingVarNodes(t,e,n)}.bind(this)):"[object Object]"===Object.prototype.toString.call(t)&&Object.keys(t).forEach(function(o){u()(this,i);var s=t[o];this.setCitingVarNodes(s,e,n)}.bind(this)))},onCopyKey:function(t){this.copyText=t,document.addEventListener("copy",this.copyHandler),document.execCommand("copy"),document.removeEventListener("copy",this.copyHandler),this.copyText=""},copyHandler:function(t){t.preventDefault(),t.clipboardData.setData("text/html",this.copyText),t.clipboardData.setData("text/plain",this.copyText),this.$bkMessage({message:m.a.t("已复制"),theme:"success"})},onViewCitedList:function(){this.showPreviewValue=!1,this.citedNum>0&&!this.showCitedList?this.showCitedList=!0:this.showCitedList=!1},onChangeVariableOutput:function(t,e){this.$emit("onChangeVariableOutput",{key:t,checked:e})},onPreviewValue:function(){this.showCitedList=!1,this.showPreviewValue?this.showPreviewValue=!1:(this.previewParams={constants:this.constants,extra_data:{executor:this.username,project_id:this.common?void 0:this.project_id,biz_cc_id:this.common?void 0:this.bizId}},this.showPreviewValue=!0)},onDeleteVariable:function(t){this.$emit("onDeleteVariable",t)},onEditVariable:function(t,e){this.$emit("onEditVariable",t,e)},onCloneVariable:function(){this.$emit("onCloneVariable",this.variableData)}}},Z=(n(1380),Object(A.a)(K,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"variable-item"},[n("div",{staticClass:"variable-content",on:{click:function(e){return t.onEditVariable(t.variableData.key,t.variableData.index)}}},[t.isSystemVar||t.showCitedList?t._e():n("i",{staticClass:"col-item-drag bk-icon icon-sort"}),t._v(" "),t.isSystemVar?n("i",{staticClass:"common-icon-lock-disable"}):t._e(),t._v(" "),n("span",{staticClass:"col-item col-name",attrs:{title:t.variableData.name}},[t._v("\n            "+t._s(t.variableData.name)+"\n        ")]),t._v(" "),n("span",{staticClass:"col-item col-key"},[t._v("\n            "+t._s(t.variableData.key)+"\n            "),n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:t.$t("复制"),expression:"$t('复制')",modifiers:{bottom:!0}}],staticClass:"common-icon-double-paper-2 copy-icon",on:{click:function(e){return e.stopPropagation(),t.onCopyKey(t.variableData.key)}}})]),t._v(" "),n("span",{staticClass:"col-item col-attributes"},[n("span",{staticClass:"icon-wrap"},["component_outputs"!==t.variableData.source_type?n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("输入"),placements:["bottom"]},expression:"{\n                        content: $t('输入'),\n                        placements: ['bottom']\n                    }"}],staticClass:"common-icon-show-left"}):n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("输出"),placements:["bottom"]},expression:"{\n                        content: $t('输出'),\n                        placements: ['bottom']\n                    }"}],staticClass:"common-icon-hide-right color-org"}),t._v(" "),"show"===t.variableData.show_type?n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("显示"),placements:["bottom"]},expression:"{\n                        content: $t('显示'),\n                        placements: ['bottom']\n                    }"}],staticClass:"common-icon-eye-show"}):n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("隐藏"),placements:["bottom"]},expression:"{\n                        content: $t('隐藏'),\n                        placements: ['bottom']\n                    }"}],staticClass:"common-icon-eye-hide color-org"})])]),t._v(" "),n("span",{staticClass:"col-item col-output"},[n("div",{on:{click:function(t){t.stopPropagation()}}},[n("bk-switcher",{attrs:{size:"small",theme:"primary",value:t.outputed},on:{change:function(e){return t.onChangeVariableOutput(t.variableData.key,e)}}})],1)]),t._v(" "),n("span",{class:["col-item","col-cited",{disabled:0===t.citedNum}],on:{click:function(e){return e.stopPropagation(),t.onViewCitedList.apply(null,arguments)}}},[t._v("\n            "+t._s(t.citedNum)+"\n        ")]),t._v(" "),n("span",{staticClass:"col-item col-operation"},[t.isSystemVar?n("span",{staticClass:"col-operation-item",on:{click:function(e){return e.stopPropagation(),t.onEditVariable(t.variableData.key,t.variableData.index)}}},[t._v("\n                "+t._s(t.$t("查看"))+"\n            ")]):[n("span",{staticClass:"col-operation-item",on:{click:function(e){return e.stopPropagation(),t.onPreviewValue(t.variableData.key)}}},[t._v("\n                    "+t._s(t.$t("预览值"))+"\n                ")]),t._v(" "),n("span",{staticClass:"col-operation-item",on:{click:function(e){return e.stopPropagation(),t.onCloneVariable()}}},[t._v("\n                    "+t._s(t.$t("克隆"))+"\n                ")]),t._v(" "),n("i",{staticClass:"bk-icon icon-close delete-icon",on:{click:function(e){return e.stopPropagation(),t.onDeleteVariable(t.variableData.key)}}})]],2)]),t._v(" "),t.showCitedList?n("VariableCitedList",{attrs:{"cited-list":t.citedList},on:{onCitedNodeClick:function(e){return t.$emit("onCitedNodeClick",e)}}}):t._e(),t._v(" "),t.showPreviewValue?n("VariablePreviewValue",{attrs:{keyid:t.variableData.key,params:t.previewParams}}):t._e()],1)}),[],!1,null,"deca83fa",null).exports),J=n(611);function Q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var et={name:"TabGlobalVariables",components:{VariableEdit:R.a,VariableItem:Z,draggable:F.a,NoData:J.a},props:{common:[String,Number]},data:function(){return{isHideSystemVar:!1,variableList:[],variableData:null,deleteConfirmDialogShow:!1,deleteVarKey:"",variableCited:{}}},computed:tt({},Object(v.e)({activities:function(t){return u()(this,void 0),t.template.activities}.bind(void 0),gateways:function(t){return u()(this,void 0),t.template.gateways}.bind(void 0),outputs:function(t){return u()(this,void 0),t.template.outputs}.bind(void 0),constants:function(t){return u()(this,void 0),t.template.constants}.bind(void 0),systemConstants:function(t){return u()(this,void 0),t.template.systemConstants}.bind(void 0)})),watch:{constants:function(){this.setVariableList()},systemConstants:function(){this.setVariableList()}},created:function(){this.setVariableList(),this.getVariableCitedData()},methods:tt(tt(tt({},Object(v.b)("template",["getVariableCite"])),Object(v.d)("template/",["editVariable","deleteVariable","setOutputs"])),{},{getVariableCitedData:function(){var t=this;return l()(f.a.mark((function e(){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={activities:t.activities,gateways:t.gateways,constants:tt(tt({},t.systemConstants),t.constants)},e.next=4,t.getVariableCite(n);case 4:(i=e.sent).result&&(t.variableCited=i.data.defined),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},setVariableList:function(){var t=this,e=Object.keys(this.constants).map(function(e){return u()(this,t),_.a.deepClone(this.constants[e])}.bind(this)).sort(function(e,n){return u()(this,t),e.index-n.index}.bind(this));if(this.isHideSystemVar)this.variableList=e;else{var n=Object.keys(this.systemConstants).map(function(e){return u()(this,t),_.a.deepClone(this.systemConstants[e])}.bind(this)).sort(function(e,n){return u()(this,t),e.index-n.index}.bind(this));this.variableList=[].concat(P()(n),P()(e))}},onBackToList:function(){this.variableData&&this.closeEditingPanel()},onAddVariable:function(){this.variableData={custom_type:"input",desc:"",form_schema:{},index:Object.keys(this.constants).length+1,key:"",name:"",show_type:"show",source_info:{},source_tag:"input.input",source_type:"custom",validation:"^.+$",value:"",version:"legacy"},this.$emit("templateDataChanged")},onToggleSystemVar:function(t){this.isHideSystemVar=t,this.setVariableList()},onDragEnd:function(t){var e=this,n=t.newIndex,i=t.oldIndex;if(n!==i){var o=Math.min(n,i),s=Math.max(n,i)+1,a=this.isHideSystemVar?o:o-Object.keys(this.systemConstants).length;this.variableList.slice(o,s).forEach(function(t,n){u()(this,e),t.index=n+a,console.log(t.index),this.editVariable({key:t.key,variable:_.a.deepClone(t)})}.bind(this))}},onEditVariable:function(t){this.variableData=_.a.deepClone(this.constants[t]||this.systemConstants[t])},onCitedNodeClick:function(t){var e=t.group,n=t.id;"constants"===e?this.onEditVariable(n):this.$emit("onCitedNodeClick",t)},onChangeVariableOutput:function(t){var e=t.key,n=t.checked?"add":"delete";this.setOutputs({changeType:n,key:e}),this.$emit("templateDataChanged")},onDeleteVariable:function(t){this.deleteVarKey=t,this.deleteConfirmDialogShow=!0},onDeleteConfirm:function(){this.deleteConfirmDialogShow=!1,this.deleteVariable(this.deleteVarKey),this.deleteVarKey="",this.$emit("templateDataChanged"),this.getVariableCitedData()},onDeleteCancel:function(){this.deleteConfirmDialogShow=!1,this.deleteVarKey=""},onCloneVariable:function(t){var e=_.a.deepClone(t);e.source_info={},e.key="",e.index=Object.keys(this.constants).length+1,this.variableData=e},onSaveEditing:function(){this.closeEditingPanel(),this.$emit("templateDataChanged"),this.getVariableCitedData()},closeEditingPanel:function(){this.variableData=null},closeTab:function(){if(this.variableData){if("system"===this.variableData.source_type)return void this.closeEditingPanel();this.$refs.variableEdit.handleMaskClick()}else this.$emit("closeTab")}})},nt=(n(1381),Object(A.a)(et,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-sideslider",{attrs:{"is-show":!0,width:800,"quick-close":!0,"before-close":t.closeTab}},[n("div",{staticClass:"setting-header",attrs:{slot:"header"},slot:"header"},[n("span",{class:[t.variableData?"active":""],on:{click:t.onBackToList}},[t._v(t._s(t.$t("全局变量")))]),t._v(" "),t.variableData?n("span",[t._v(" > "+t._s("system"!==t.variableData.source_type?t.variableData.key?t.$t("编辑"):t.$t("新建"):t.$t("查看")))]):t._e(),t._v(" "),n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{allowHtml:!0,content:"#var-desc",placement:"bottom-end",duration:0,width:400},expression:"{\n                allowHtml: true,\n                content: '#var-desc',\n                placement: 'bottom-end',\n                duration: 0,\n                width: 400\n            }"}],staticClass:"common-icon-info"}),t._v(" "),n("div",{attrs:{id:"var-desc"}},[n("div",{staticClass:"tips-item"},[n("h4",[t._v(t._s(t.$t("属性：")))]),t._v(" "),n("p",[t._v("\n                    "+t._s(t.$t('"来源/是否显示"格式，来源是输入类型'))+"\n                    "),n("i",{staticClass:"common-icon-show-left",staticStyle:{color:"#219f42"}}),t._v("\n                    "+t._s(t.$t("表示变量来自用户添加的变量或者标准插件/子流程节点输入参数引用的变量，来源是输出类型"))+"\n                    "),n("i",{staticClass:"common-icon-hide-right",staticStyle:{color:"#de9524"}}),t._v("\n                    "+t._s(t.$t("表示变量来自标准插件/子流程节点输出参数引用的变量；是否显示表示该变量在新建任务填写参数时是否展示给用户，"))+"\n                    "),n("i",{staticClass:"common-icon-eye-show",staticStyle:{color:"#219f42","vertical-align":"middle"}}),t._v("\n                    "+t._s(t.$t("表示显示，"))+"\n                    "),n("i",{staticClass:"common-icon-eye-hide",staticStyle:{color:"#de9524","vertical-align":"middle"}}),t._v("\n                    "+t._s(t.$t("表示隐藏，输出类型的变量一定是隐藏的。"))+"\n                ")])]),t._v(" "),n("div",{staticClass:"tips-item"},[n("h4",[t._v(t._s(t.$t("输出：")))]),t._v(" "),n("p",[t._v(t._s(t.$t("表示该变量会作为该流程模板的输出参数，在被其他流程模板当做子流程节点时可以引用。")))])]),t._v(" "),n("div",{staticClass:"tips-item"},[n("h4",[t._v(t._s(t.$t("模板预渲染：")))]),t._v(" "),n("p",[t._v("\n                    "+t._s(t.$t("模板预渲染为“是”时，任务会在执行前将变量中的 MAKO 段进行渲染，"))+"\n                    "+t._s(t.$t("而不是在第一个引用该变量的节点执行前才进行渲染；"))+"\n                    "+t._s(t.$t("如果需要预渲染的变量引用了别的变量，"))+"\n                    "+t._s(t.$t("那么被引用变量的预渲染也要设置为“是”，否则预渲染不生效。"))+"\n                ")])])])]),t._v(" "),n("div",{staticClass:"global-variable-panel",attrs:{slot:"content"},slot:"content"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.variableData,expression:"!variableData"}],class:{"is-hidden":t.variableData}},[n("div",{staticClass:"add-variable"},[n("bk-button",{staticClass:"add-variable-btn",attrs:{theme:"default"},on:{click:t.onAddVariable}},[t._v(t._s(t.$t("新建")))]),t._v(" "),n("div",{staticClass:"toggle-system-var"},[n("bk-checkbox",{attrs:{value:t.isHideSystemVar},on:{change:t.onToggleSystemVar}},[t._v(t._s(t.$t("隐藏系统变量")))])],1)],1),t._v(" "),n("div",{staticClass:"global-variable-content"},[n("div",{staticClass:"variable-header clearfix"},[n("span",{staticClass:"col-name t-head"},[t._v(t._s(t.$t("名称")))]),t._v(" "),n("span",{staticClass:"col-key t-head"},[t._v("KEY")]),t._v(" "),n("span",{staticClass:"col-attributes t-head"},[t._v(t._s(t.$t("属性")))]),t._v(" "),n("span",{staticClass:"col-output t-head"},[t._v(t._s(t.$t("输出")))]),t._v(" "),n("span",{staticClass:"col-cited t-head"},[t._v("\n                        "+t._s(t.$t("引用"))+"\n                        "),n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{allowHtml:!0,content:t.$t("直接引用全局变量的节点数量，点击数字查看引用详情"),placement:"bottom-end",duration:0,width:200},expression:"{\n                                allowHtml: true,\n                                content: $t('直接引用全局变量的节点数量，点击数字查看引用详情'),\n                                placement: 'bottom-end',\n                                duration: 0,\n                                width: 200\n                            }"}],staticClass:"common-icon-info global-variable-tootip quote-info"})]),t._v(" "),n("span",{staticClass:"col-operation t-head"},[t._v(t._s(t.$t("操作")))]),t._v(" "),n("span",{staticClass:"col-delete t-head"})]),t._v(" "),n("div",{staticClass:"variable-list"},[n("draggable",{staticClass:"variable-drag",attrs:{handle:".col-item-drag",list:t.variableList},on:{end:function(e){return t.onDragEnd(e)}}},t._l(t.variableList,(function(e){return n("variable-item",{key:e.key,attrs:{outputed:t.outputs.indexOf(e.key)>-1,"variable-data":e,"variable-cited":t.variableCited,common:t.common},on:{onEditVariable:t.onEditVariable,onDeleteVariable:t.onDeleteVariable,onCloneVariable:t.onCloneVariable,onChangeVariableOutput:t.onChangeVariableOutput,onCitedNodeClick:t.onCitedNodeClick}})})),1),t._v(" "),0===t.variableList.length?n("div",{staticClass:"empty-variable-tips"},[n("NoData",[n("p",[t._v(t._s(t.$t("无数据，请手动新增变量或者勾选标准插件参数自动生成")))])])],1):t._e()],1)])]),t._v(" "),t.variableData?n("variable-edit",{ref:"variableEdit",attrs:{"variable-data":t.variableData,common:t.common},on:{closeEditingPanel:t.closeEditingPanel,onSaveEditing:t.onSaveEditing}}):t._e(),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog delete-variable-dialog",theme:"primary","mask-close":!1,"header-position":"left",title:t.$t("删除变量"),value:t.deleteConfirmDialogShow},on:{confirm:t.onDeleteConfirm,cancel:t.onDeleteCancel}},[n("div",[t._v(t._s(t.$t("确认删除该变量？")))])])],1)])}),[],!1,null,"a1f72fde",null).exports),it=(n(187),n(1224)),ot=n(6);function st(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?st(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var rt={name:"TabTemplateConfig",components:{MemberSelect:it.a},props:{projectInfoLoading:Boolean,templateLabelLoading:Boolean,templateLabels:Array,isShow:Boolean,common:[String,Number]},data:function(){var t=this.$store.state.template,e=t.name,n=t.category,i=t.notify_type,o=t.notify_receivers,s=t.description,a=t.executor_proxy,r=t.template_labels,l=t.default_flow_type;return{formData:{name:e,category:n,description:s,executorProxy:a?[a]:[],receiverGroup:o.receiver_group.slice(0),notifyType:i.slice(0),labels:r,defaultFlowType:l},notifyTypeList:[],projectNotifyGroup:[],isSaveConfirmDialogShow:!1,notifyTypeLoading:!1,notifyGroupLoading:!1,rules:{name:[{required:!0,message:m.a.t("必填项"),trigger:"blur"},{max:ot.i.TEMPLATE_NAME_MAX_LENGTH,message:m.a.t("流程名称长度不能超过")+ot.i.TEMPLATE_NAME_MAX_LENGTH+m.a.t("个字符"),trigger:"blur"},{regex:ot.e,message:m.a.t("流程名称不能包含")+"'‘\"”$&<>"+m.a.t("非法字符"),trigger:"blur"}]}}},computed:at(at(at({},Object(v.e)({projectBaseInfo:function(t){return u()(this,void 0),t.template.projectBaseInfo}.bind(void 0),timeout:function(t){return u()(this,void 0),t.template.time_out}.bind(void 0)})),Object(v.e)("project",{authActions:function(t){return u()(this,void 0),t.authActions}.bind(void 0)})),{},{notifyGroup:function(){var t=this,e=[];if(this.projectBaseInfo.notify_group){var n=e.concat(this.projectBaseInfo.notify_group.map(function(e){return u()(this,t),{id:e.value,name:e.text}}.bind(this)));e=n.concat(this.projectNotifyGroup)}return e},taskCategories:function(){var t=this;return this.projectBaseInfo.task_categories?this.projectBaseInfo.task_categories.map(function(e){return u()(this,t),{id:e.value,name:e.name}}.bind(this)):[]}}),created:function(){this.getNotifyTypeList(),this.common||this.getProjectNotifyGroup()},mounted:function(){this.$refs.nameInput.focus()},methods:at(at(at({},Object(v.d)("template/",["setTplConfig"])),Object(v.b)(["getNotifyTypes","getNotifyGroup"])),{},{getNotifyTypeList:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.notifyTypeLoading=!0,e.next=4,t.getNotifyTypes();case 4:n=e.sent,t.notifyTypeList=n.data,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.notifyTypeLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},onSelectCategory:function(t){t&&window.reportInfo({page:"templateEdit",zone:"selectCategory",event:"click"})},onSelectLabel:function(t){t&&window.reportInfo({page:"templateEdit",zone:"selectLabel",event:"click"})},onEditLabel:function(){var t=this.$router.resolve({name:"projectConfig",params:{id:this.$route.params.project_id}}).href;window.open(t,"_blank")},getProjectNotifyGroup:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.notifyGroupLoading=!0,e.next=4,t.getNotifyGroup({project_id:t.$route.params.project_id});case 4:n=e.sent,t.projectNotifyGroup=n.data,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.notifyGroupLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},getTemplateConfig:function(){var t=this.formData,e=t.name,n=t.category,i=t.description,o=t.executorProxy,s=t.receiverGroup,a=t.notifyType,r=t.labels,l=t.defaultFlowType;return{name:e,category:n,description:i,template_labels:r,executor_proxy:1===o.length?o[0]:"",receiver_group:s,notify_type:a,default_flow_type:l}},jumpProjectManagement:function(){this.authActions.includes("project_edit")&&this.$router.push({name:"projectConfig",params:{id:this.$route.params.project_id}})},onSaveConfig:function(){var t=this;this.$refs.configForm.validate().then(function(e){if(u()(this,t),e){var n=this.getTemplateConfig();this.setTplConfig(n),this.closeTab(),this.$emit("templateDataChanged")}}.bind(this))},onConfirmClick:function(){this.isSaveConfirmDialogShow=!1,this.onSaveConfig()},beforeClose:function(){var t=this.$store.state.template,e=t.name,n=t.category,i=t.description,o=t.template_labels,s=t.executor_proxy,a=t.notify_receivers,r=t.notify_type,l=t.default_flow_type,c={name:e,category:n,description:i,template_labels:o,executor_proxy:s,receiver_group:a.receiver_group,notify_type:r,default_flow_type:l},u=this.getTemplateConfig();return _.a.isDataEqual(c,u)?(this.closeTab(),!0):(this.isSaveConfirmDialogShow=!0,!1)},closeTab:function(){this.$emit("closeTab")}})},lt=(n(1382),Object(A.a)(rt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-sideslider",{attrs:{title:t.$t("基础信息"),"is-show":!0,width:800,"quick-close":!0,"before-close":t.beforeClose}},[n("div",{staticClass:"config-wrapper",attrs:{slot:"content"},slot:"content"},[n("bk-form",{ref:"configForm",staticClass:"form-area",attrs:{model:t.formData,"label-width":140,rules:t.rules}},[n("section",{staticClass:"form-section"},[n("h4",[t._v(t._s(t.$t("基础")))]),t._v(" "),n("bk-form-item",{attrs:{property:"name",label:t.$t("流程名称"),required:!0}},[n("bk-input",{ref:"nameInput",attrs:{placeholder:t.$t("请输入流程模板名称")},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name","string"==typeof e?e.trim():e)},expression:"formData.name"}})],1),t._v(" "),t.common?t._e():n("bk-form-item",{attrs:{label:t.$t("标签")}},[n("bk-select",{attrs:{"ext-popover-cls":"label-select","display-tag":!0,multiple:!0},on:{toggle:t.onSelectLabel},model:{value:t.formData.labels,callback:function(e){t.$set(t.formData,"labels",e)},expression:"formData.labels"}},[t._l(t.templateLabels,(function(e,i){return n("bk-option",{key:i,attrs:{id:e.id,name:e.name}},[n("div",{staticClass:"label-select-option"},[n("span",{staticClass:"label-select-color",style:{background:e.color}}),t._v(" "),n("span",[t._v(t._s(e.name))]),t._v(" "),n("i",{staticClass:"bk-option-icon bk-icon icon-check-1"})])])})),t._v(" "),n("div",{staticClass:"label-select-extension",attrs:{slot:"extension"},on:{click:t.onEditLabel},slot:"extension"},[n("i",{staticClass:"common-icon-edit"}),t._v(" "),n("span",[t._v(t._s(t.$t("编辑标签")))])])],2)],1),t._v(" "),n("bk-form-item",{attrs:{property:"category",label:t.$t("分类")}},[n("bk-select",{staticClass:"category-select",attrs:{clearable:!1},on:{toggle:t.onSelectCategory},model:{value:t.formData.category,callback:function(e){t.$set(t.formData,"category",e)},expression:"formData.category"}},t._l(t.taskCategories,(function(t,e){return n("bk-option",{key:e,attrs:{id:t.id,name:t.name}})})),1),t._v(" "),t.common?t._e():n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("模板分类即将下线，建议使用标签"),placement:"bottom",theme:"light",showOnInit:!0},expression:"{\n                            content: $t('模板分类即将下线，建议使用标签'),\n                            placement: 'bottom',\n                            theme: 'light',\n                            showOnInit: true\n                        }"}],staticClass:"common-icon-info category-tips"})],1)],1),t._v(" "),n("section",{staticClass:"form-section"},[n("h4",[t._v(t._s(t.$t("通知")))]),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("通知方式")}},[n("bk-checkbox-group",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.notifyTypeLoading,opacity:1,zIndex:100},expression:"{ isLoading: notifyTypeLoading, opacity: 1, zIndex: 100 }"}],model:{value:t.formData.notifyType,callback:function(e){t.$set(t.formData,"notifyType",e)},expression:"formData.notifyType"}},[t._l(t.notifyTypeList,(function(e){return[e.is_active?n("bk-checkbox",{key:e.type,attrs:{value:e.type}},[n("img",{staticClass:"notify-icon",attrs:{src:"data:image/png;base64,"+e.icon}}),t._v(" "),n("span",{staticStyle:{"word-break":"break-all"}},[t._v(t._s(e.label))])]):t._e()]}))],2)],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("通知分组")}},[n("bk-checkbox-group",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.notifyGroupLoading,opacity:1,zIndex:100},expression:"{ isLoading: notifyGroupLoading, opacity: 1, zIndex: 100 }"}],model:{value:t.formData.receiverGroup,callback:function(e){t.$set(t.formData,"receiverGroup",e)},expression:"formData.receiverGroup"}},t._l(t.notifyGroup,(function(e){return n("bk-checkbox",{key:e.id,attrs:{value:e.id}},[t._v("\n                            "+t._s(e.name)+"\n                        ")])})),1)],1)],1),t._v(" "),n("section",{staticClass:"form-section"},[n("h4",[t._v(t._s(t.$t("其他")))]),t._v(" "),t.common?t._e():n("bk-form-item",{attrs:{label:t.$t("执行代理人")}},[n("member-select",{attrs:{multiple:!1,value:t.formData.executorProxy},on:{change:function(e){t.formData.executorProxy=e}}}),t._v(" "),n("div",{staticClass:"executor-proxy-desc"},[n("div",[t._v("\n                            "+t._s(t.$t("仅支持本流程的执行代理，可在项目配置中"))+"\n                            "),n("span",{class:{"project-management":t.authActions&&t.authActions.length},on:{click:t.jumpProjectManagement}},[t._v(t._s(t.$t("设置项目执行代理人")))]),t._v("。\n                        ")]),t._v("\n                        "+t._s(t.$t("模板级别的执行代理人会覆盖业务级别的执行代理人配置，")+t.$t("若模板配置了执行代理人，业务的执行代理人白名单不会生效。"))+"\n                    ")])],1),t._v(" "),n("bk-form-item",{attrs:{property:"notifyType",label:t.$t("备注")}},[n("bk-input",{attrs:{type:"textarea",rows:5,placeholder:t.$t("请输入流程模板备注信息")},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description","string"==typeof e?e.trim():e)},expression:"formData.description"}})],1),t._v(" "),n("bk-form-item",{attrs:{property:"defaultFlowType",label:t.$t("任务类型偏好")}},[n("bk-select",{attrs:{clearable:!1},model:{value:t.formData.defaultFlowType,callback:function(e){t.$set(t.formData,"defaultFlowType",e)},expression:"formData.defaultFlowType"}},[n("bk-option",{attrs:{id:"common",name:t.$t("默认任务")}}),t._v(" "),n("bk-option",{attrs:{id:"common_func",name:t.$t("职能化任务")}})],1)],1)],1)]),t._v(" "),n("div",{staticClass:"btn-wrap"},[n("bk-button",{staticClass:"save-btn",attrs:{theme:"primary",disabled:t.notifyTypeLoading||t.notifyGroupLoading},on:{click:t.onSaveConfig}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.closeTab}},[t._v(t._s(t.$t("取消")))])],1),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.isSaveConfirmDialogShow},on:{cancel:function(e){t.isSaveConfirmDialogShow=!1}}},[n("div",{staticClass:"template-config-dialog-content"},[n("div",{staticClass:"leave-tips"},[t._v(t._s(t.$t("保存已修改的配置信息吗？")))]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary",disabled:t.notifyTypeLoading||t.notifyGroupLoading},on:{click:t.onConfirmClick}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.closeTab}},[t._v(t._s(t.$t("不保存")))])],1)])])],1)])}),[],!1,null,"b863bda0",null).exports),ct=n(137),ut=n.n(ct);function dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var pt={name:"TabTemplateSnapshoot",components:{NoData:J.a},filters:{timestampToDatetime:function(t){return ut.a.unix(t/1e3).format("YYYY-MM-DD HH:mm:ss")}},props:{isShow:Boolean,snapshoots:Array},data:function(){return{editingData:{key:null,name:""},nameRule:{required:!0,max:ot.i.DRAFT_NAME_MAX_LENGTH,regex:ot.e}}},methods:{onCreateSnapshoot:function(){this.$emit("createSnapshoot")},onUseSnapshoot:function(t,e){this.$emit("useSnapshoot",t.template,e)},onEditName:function(t){this.editingData.key=t.timestamp,this.editingData.name=t.name},onSaveName:function(t){var e=this;return this.$validator.validateAll().then(function(n){if(u()(this,e),n){var i=ht(ht({},t),{},{name:this.editingData.name});this.$emit("updateSnapshoot",i),this.editingData.key=null,this.editingData.name=""}}.bind(this))},closeTab:function(){var t=this;return l()(f.a.mark((function e(){var n,i=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.editingData.key){e.next=4;break}return n=t.snapshoots.find(function(e){return u()(this,i),e.timestamp===t.editingData.key}.bind(this)),e.next=4,t.onSaveName(n);case 4:t.$emit("closeTab");case 5:case"end":return e.stop()}}),e,this)})))()}}},ft=(n(1383),Object(A.a)(pt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-sideslider",{attrs:{"is-show":!0,"quick-close":!0,width:800,"before-close":t.closeTab}},[n("div",{staticClass:"setting-header",attrs:{slot:"header"},slot:"header"},[n("span",[t._v(t._s(t.$t("本地快照")))]),t._v(" "),n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("可自动保存最近的50次快照，每5分钟一次。仅在本地浏览器存储。"),placement:"bottom-end",duration:0,width:400},expression:"{\n                content: $t('可自动保存最近的50次快照，每5分钟一次。仅在本地浏览器存储。'),\n                placement: 'bottom-end',\n                duration: 0,\n                width: 400\n            }"}],staticClass:"common-icon-info"})]),t._v(" "),n("div",{staticClass:"template-snapshoot-panel",attrs:{slot:"content"},slot:"content"},[n("table",{staticClass:"snapshoot-table"},[n("thead",[n("tr",[n("th",{staticClass:"col-number"},[t._v(t._s(t.$t("序号")))]),t._v(" "),n("th",{staticClass:"col-name"},[t._v(t._s(t.$t("名称")))]),t._v(" "),n("th",{staticClass:"col-time"},[t._v(t._s(t.$t("保存时间")))]),t._v(" "),n("th",{staticClass:"col-operation-group"},[t._v(t._s(t.$t("操作")))])])]),t._v(" "),n("tbody",[n("tr",{staticStyle:{background:"#f0f1f5"}},[n("td",{staticClass:"col-number"},[t._v("--")]),t._v(" "),n("td",{staticClass:"col-name"},[t._v("--")]),t._v(" "),n("td",{staticClass:"col-time"},[t._v("--")]),t._v(" "),n("td",{staticClass:"col-operation-group"},[n("bk-button",{attrs:{size:"small",theme:"default"},on:{click:t.onCreateSnapshoot}},[t._v(t._s(t.$t("新建")))])],1)]),t._v(" "),t._l(t.snapshoots,(function(e,i){return n("tr",{key:e.timestamp},[n("td",{staticClass:"col-number"},[n("div",{staticClass:"content"},[t._v(t._s(t.snapshoots.length-i))])]),t._v(" "),n("td",{staticClass:"col-name",attrs:{title:e.name}},[n("div",{staticClass:"content"},[t.editingData.key===e.timestamp?n("bk-input",{directives:[{name:"focus",rawName:"v-focus"},{name:"validate",rawName:"v-validate",value:t.nameRule,expression:"nameRule"}],staticClass:"snapshoot-name-input",attrs:{"data-vv-validate-on":" ",name:"snapshootName"+e.timestamp,placeholder:t.$t("名称")},on:{blur:function(n){return t.onSaveName(e)},enter:function(n){return t.onSaveName(e)}},model:{value:t.editingData.name,callback:function(e){t.$set(t.editingData,"name",e)},expression:"editingData.name"}}):n("span",[t._v(t._s(e.name))]),t._v(" "),n("i",{staticClass:"common-icon-edit",on:{click:function(n){return n.stopPropagation(),t.onEditName(e)}}}),t._v(" "),t.veeErrors.first("snapshootName"+e.timestamp)?n("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.veeErrors.first("snapshootName"+e.timestamp),placements:["top-end"]},expression:"{\n                                    content: veeErrors.first('snapshootName' + item.timestamp),\n                                    placements: ['top-end']\n                                }"}],staticClass:"common-icon-info error-msg"}):t._e()],1)]),t._v(" "),n("td",{staticClass:"col-time"},[n("div",{staticClass:"content"},[t._v(t._s(t._f("timestampToDatetime")(e.timestamp)))])]),t._v(" "),n("td",{staticClass:"col-operation-group"},[n("span",{staticClass:"operation-item",on:{click:function(n){return t.onUseSnapshoot(e,t.snapshoots.length-i)}}},[t._v(t._s(t.$t("还原")))])])])})),t._v(" "),t.snapshoots.length?t._e():n("tr",{staticClass:"empty-snapshoot-tip"},[n("td",[n("NoData",[n("p",[t._v(t._s(t.$t("无数据，请手动添加快照或等待自动保存")))])])],1)])],2)])])])}),[],!1,null,"1a2d1da2",null).exports),mt=n(751);function vt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vt(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var bt={name:"TabPipelineTreeEdit",components:{CodeEditor:mt.a},props:["isShow"],data:function(){return{template:this.transPipelineTreeStr(),errorMessage:""}},computed:gt({},Object(v.e)({hasAdminPerm:function(t){return u()(this,void 0),t.hasAdminPerm}.bind(void 0)})),methods:gt(gt({},Object(v.c)("template/",["getLocalTemplateData"])),{},{transPipelineTreeStr:function(){var t=this.getLocalTemplateData();return JSON.stringify(t,null,4)},onDataChange:function(t){t!==this.template&&(this.template=t)},onConfirm:function(){var t={};try{t=JSON.parse(this.template),this.errorMessage=""}catch(t){this.errorMessage=t}if(!this.errorMessage){var e=k.a.isPipelineDataValid(t);if(!e.result)return void(this.errorMessage=e.message);this.$emit("modifyTemplateData",t),this.closeTab()}},closeTab:function(){this.$emit("closeTab")}})},yt=(n(1384),Object(A.a)(bt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-sideslider",{attrs:{"is-show":!0,width:800,title:t.$t("模板数据"),"quick-close":!t.hasAdminPerm,"before-close":t.closeTab}},[n("div",{staticClass:"pipeline-tree-wrap",attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"code-wrapper"},[n("code-editor",{attrs:{value:t.template,options:{readOnly:!t.hasAdminPerm,language:"json"}},on:{input:t.onDataChange}}),t._v(" "),t.errorMessage?n("div",{staticClass:"error-tips",attrs:{title:t.errorMessage}},[n("i",{staticClass:"common-icon-info"}),t._v(" "),n("div",{staticClass:"message"},[t._v(t._s(t.errorMessage))])]):t._e()],1),t._v(" "),n("div",{staticClass:"btn-wrap"},[t.hasAdminPerm?[n("bk-button",{staticClass:"save-btn",attrs:{theme:"primary"},on:{click:t.onConfirm}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.closeTab}},[t._v(t._s(t.$t("取消")))])]:n("bk-button",{attrs:{theme:"primary"},on:{click:t.closeTab}},[t._v(t._s(t.$t("关闭")))])],2)])])}),[],!1,null,"df0896f6",null).exports);function _t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ct={data:function(){return{operateFlowData:[]}},mounted:function(){this.getOperationTemplateData()},methods:wt(wt({},Object(v.b)("task/",["getOperationRecordTemplate"])),{},{getOperationTemplateData:function(){var t=this;return l()(f.a.mark((function e(){var n,i,o,s,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$route,i=n.params,o=n.query,e.prev=1,e.next=4,t.getOperationRecordTemplate({project_id:i.project_id,instance_id:o.template_id});case 4:s=e.sent,t.operateFlowData=s.data.map(function(t){return u()(this,a),t.operate_date=ut()(t.operate_date).format("YYYY-MM-DD HH:mm:ss"),t}.bind(this)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.warn(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])})))()},closeTab:function(){this.$emit("closeTab")}})},St=(n(1385),{name:"TemplateSetting",components:{TabGlobalVariables:nt,TabTemplateConfig:lt,TabTemplateSnapshoot:ft,TabPipelineTreeEdit:yt,TabOperationFlow:Object(A.a)(Ct,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-sideslider",{attrs:{"is-show":!0,width:800,"ext-cls":"operate-flow",title:t.$t("流水操作记录"),"quick-close":!0,"before-close":t.closeTab}},[n("template",{slot:"content"},[n("bk-table",{attrs:{"ext-cls":"operate-flow-table",data:t.operateFlowData}},[n("bk-table-column",{attrs:{"min-width":"130",label:t.$t("操作时间"),prop:"operate_date"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("操作名称"),prop:"operate_type_name"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("操作来源"),prop:"operate_source_name"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("操作人"),prop:"operator"}})],1)],1)],2)}),[],!1,null,"34a103b2",null).exports},props:{projectInfoLoading:Boolean,templateLabelLoading:Boolean,templateLabels:Array,activeTab:String,snapshoots:Array,common:[String,Number]},methods:{closeTab:function(){this.$emit("update:activeTab","")}}}),kt=Object(A.a)(St,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"setting-panel"},["operationFlowTab"===t.activeTab?n("TabOperationFlow",{on:{closeTab:t.closeTab}}):t._e(),t._v(" "),"globalVariableTab"===t.activeTab?n("TabGlobalVariables",{attrs:{common:t.common},on:{templateDataChanged:function(e){return t.$emit("templateDataChanged")},onCitedNodeClick:function(e){return t.$emit("onCitedNodeClick",e)},closeTab:t.closeTab}}):t._e(),t._v(" "),"templateConfigTab"===t.activeTab?n("TabTemplateConfig",{attrs:{common:t.common,"project-info-loading":t.projectInfoLoading,"template-label-loading":t.templateLabelLoading,"template-labels":t.templateLabels},on:{templateDataChanged:function(e){return t.$emit("templateDataChanged")},closeTab:t.closeTab}}):t._e(),t._v(" "),"tplSnapshootTab"===t.activeTab?n("TabTemplateSnapshoot",{attrs:{snapshoots:t.snapshoots},on:{createSnapshoot:function(e){return t.$emit("createSnapshoot")},useSnapshoot:function(e){return t.$emit("useSnapshoot",arguments)},updateSnapshoot:function(e){return t.$emit("updateSnapshoot",e)},closeTab:t.closeTab}}):t._e(),t._v(" "),"templateDataEditTab"===t.activeTab?n("TabPipelineTreeEdit",{on:{modifyTemplateData:function(e){return t.$emit("modifyTemplateData",e)},closeTab:t.closeTab}}):t._e()],1)}),[],!1,null,null,null).exports,xt=n(969).a,Pt=(n(1391),n(1392),Object(A.a)(xt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"node-config-wrapper"},[n("bk-sideslider",{ref:"nodeConfigPanel",attrs:{"ext-cls":"node-config-panel",width:800,"is-show":t.isShow,"quick-close":!0,"before-close":t.beforeClose}},[n("div",{staticClass:"config-header",attrs:{slot:"header"},slot:"header"},[t.isVariablePanelShow?[n("i",{staticClass:"bk-icon icon-arrows-left variable-back-icon",on:{click:function(e){t.isVariablePanelShow=!1}}}),t._v(" "),n("span",[t._v("\n                    "+t._s(t.variableData.key?t.$t("编辑"):t.$t("新建"))+t._s(t.$t("全局变量"))+"\n                ")])]:[n("span",{class:["go-back",{active:t.isSelectorPanelShow&&(t.basicInfo.plugin||t.basicInfo.tpl)}],on:{click:t.goBackToConfig}},[t.backToVariablePanel?n("i",{staticClass:"bk-icon icon-arrows-left variable-back-icon",on:{click:function(e){return t.onClosePanel(!0)}}}):t._e(),t._v("\n                    "+t._s(t.$t("节点配置"))+"\n                ")]),t._v(" "),t.isSelectorPanelShow&&(t.basicInfo.plugin||t.basicInfo.tpl)?n("span",{staticClass:"go-back"},[n("i",{staticClass:"common-icon-angle-right"}),t._v("\n                    "+t._s(t.selectorTitle)+"\n                ")]):t._e(),t._v(" "),n("div",{staticClass:"view-variable"},[t.isSelectorPanelShow?t._e():n("bk-popover",{attrs:{"ext-cls":"variable-popover",placement:"bottom-end","tippy-options":{hideOnClick:!1}}},[n("div",{staticStyle:{cursor:"pointer"}},[t._v(t._s(t.$t("全局变量")))]),t._v(" "),n("div",{class:["variable-list",{"list-change":t.isChange}],attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"header-area"},[n("span",[t._v(t._s(t.$t("全局变量")))]),t._v(" "),n("bk-link",{attrs:{theme:"primary",icon:"bk-icon icon-plus"},on:{click:t.openVariablePanel}},[t._v(t._s(t.$t("新建变量")))])],1),t._v(" "),n("bk-table",{attrs:{data:t.variableList,"outer-border":!1,"max-height":400}},[n("bk-table-column",{attrs:{label:t.$t("名称"),prop:"name",width:"165","show-overflow-tooltip":!0}}),t._v(" "),n("bk-table-column",{attrs:{label:"KEY","show-overflow-tooltip":!0,width:"209"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"key"},[t._v(t._s(e.row.key))]),t._v(" "),n("i",{staticClass:"copy-icon common-icon-double-paper-2",on:{click:function(n){return t.onCopyKey(e.row.key)}}})]}}],null,!1,1498962778)}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("属性"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return n("div",{staticClass:"icon-wrap"},[n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:"component_outputs"!==e.row.source_type?t.$t("输入"):t.$t("输出"),placements:["bottom"]},expression:"{\n                                                content: props.row.source_type !== 'component_outputs' ? $t('输入') : $t('输出'),\n                                                placements: ['bottom']\n                                            }"}],class:["component_outputs"!==e.row.source_type?"common-icon-show-left":"common-icon-show-right color-org"]}),t._v(" "),n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:"show"===e.row.show_type?t.$t("显示"):t.$t("隐藏"),placements:["bottom"]},expression:"{\n                                                content: props.row.show_type === 'show' ? $t('显示') : $t('隐藏'),\n                                                placements: ['bottom']\n                                            }"}],class:["show"===e.row.show_type?"common-icon-eye-show":"common-icon-eye-hide color-org"]})])}}],null,!1,3109936879)}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("操作"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("bk-link",{attrs:{theme:"system"===e.row.source_type?"default":"primary",disabled:"system"===e.row.source_type},on:{click:function(n){return t.openVariablePanel(e.row)}}},[t._v("\n                                            "+t._s(t.$t("编辑"))+"\n                                        ")])]}}],null,!1,3804504104)})],1)],1)])],1)]],2),t._v(" "),n("template",{slot:"content"},[t.isSelectorPanelShow?n("selector-panel",{attrs:{"template-labels":t.templateLabels,"is-subflow":t.isSubflow,"atom-type-list":t.atomTypeList,"basic-info":t.basicInfo,common:t.common},on:{back:function(e){t.isSelectorPanelShow=!1},viewSubflow:t.onViewSubflow,select:t.onPluginOrTplChange}}):t.isVariablePanelShow?n("div",{staticClass:"variable-edit-panel"},[n("variable-edit",{ref:"variableEdit",attrs:{"variable-data":t.variableData,common:t.common},on:{closeEditingPanel:function(e){t.isVariablePanelShow=!1},onSaveEditing:function(e){t.isVariablePanelShow=!1}}})],1):[n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isSubflow&&t.subflowListLoading,opacity:1},expression:"{ isLoading: isSubflow && subflowListLoading, opacity: 1 }"}],staticClass:"node-config"},[t.isSubflow&&t.subflowListLoading?t._e():[n("div",{staticClass:"config-form"},[n("section",{staticClass:"config-section"},[n("h3",[t._v(t._s(t.$t("基础信息")))]),t._v(" "),n("basic-info",{ref:"basicInfo",attrs:{"basic-info":t.basicInfo,"node-config":t.nodeConfig,"version-list":t.versionList,"is-subflow":t.isSubflow,"update-subflow":t.updateSubflow,"input-loading":t.inputLoading},on:{openSelectorPanel:function(e){t.isSelectorPanelShow=!0},versionChange:t.versionChange,viewSubflow:t.onViewSubflow,updateSubflowVersion:t.updateSubflowVersion,update:t.updateBasicInfo}})],1),t._v(" "),n("section",{staticClass:"config-section"},[n("h3",[t._v(t._s(t.$t("输入参数")))]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.inputLoading,zIndex:100},expression:"{ isLoading: inputLoading, zIndex: 100 }"}],staticClass:"inputs-wrapper"},[t.inputLoading?t._e():[t.inputs.length>0?n("input-params",{ref:"inputParams",attrs:{"node-id":t.nodeId,scheme:t.inputs,plugin:t.basicInfo.plugin,version:t.basicInfo.version,"subflow-forms":t.subflowForms,value:t.inputsParamValue,"is-subflow":t.isSubflow,constants:t.localConstants},on:{hookChange:t.onHookChange,update:t.updateInputsValue}}):n("no-data")]],2)]),t._v(" "),n("section",{staticClass:"config-section"},[n("h3",[t._v(t._s(t.$t("输出参数")))]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.outputLoading,zIndex:100},expression:"{ isLoading: outputLoading, zIndex: 100 }"}],staticClass:"outputs-wrapper"},[t.outputLoading?t._e():[t.outputs.length?n("output-params",{attrs:{constants:t.localConstants,params:t.outputs,version:t.basicInfo.version,"node-id":t.nodeId},on:{hookChange:t.onHookChange}}):n("no-data")]],2)])]),t._v(" "),n("div",{staticClass:"btn-footer"},[n("bk-button",{attrs:{theme:"primary",disabled:t.inputLoading||t.isSubflow&&t.subflowListLoading},on:{click:t.onSaveConfig}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.onClosePanel}},[t._v(t._s(t.$t("取消")))])],1)]],2)]],2)],2),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.isConfirmDialogShow},on:{cancel:function(e){t.isConfirmDialogShow=!1}}},[n("div",{staticClass:"node-config-confirm-dialog-content"},[n("div",{staticClass:"leave-tips"},[t._v(t._s(t.$t("保存已修改的节点信息吗？")))]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary",disabled:t.inputLoading},on:{click:t.onConfirmClick}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.onClosePanel}},[t._v(t._s(t.$t("不保存")))])],1)])])],1)}),[],!1,null,null,null).exports),Et=n(993),Dt=(n(129),{name:"SubflowUpdateTips",components:{NotifyInfo:n(996).a},props:{list:{type:Array,default:function(){return[]}},locations:{type:Array,default:function(){return[]}}},data:function(){return{showDetail:!0,curId:void 0}},computed:{sortedList:function(){var t=this;return this.list.map(function(e){var n=this;u()(this,t);var i=this.locations.find(function(t){return u()(this,n),t.id===e.subprocess_node_id}.bind(this));return Object.assign({},e,{x:i.x,y:i.y})}.bind(this)).sort(function(e,n){return u()(this,t),e.x-n.x}.bind(this))},expiredNodes:function(){var t=this;return this.list.filter(function(e){var n=this;return u()(this,t),e.expired&&this.locations.find(function(t){return u()(this,n),t.id===e.subprocess_node_id}.bind(this))}.bind(this))},tips:function(){return m.a.t("建议及时处理子流程更新，涉及")+this.expiredNodes.length+m.a.t("个子流程节点")}},methods:{onToggleDetail:function(){this.showDetail=!this.showDetail,this.showDetail||this.$emit("foldClick")},onViewClick:function(){var t,e=this,n=[];if(void 0===this.curId)n=this.sortedList;else{var i=this.sortedList.findIndex(function(t){return u()(this,e),t.subprocess_node_id===this.curId}.bind(this));n=i===this.sortedList.length-1?this.sortedList:this.sortedList.slice(i+1).concat(this.sortedList.slice(0,i))}n.some(function(n){var i=this;if(u()(this,e),n.expired&&this.locations.find(function(t){return u()(this,i),t.id===n.subprocess_node_id}.bind(this)))return t=n.subprocess_node_id,!0}.bind(this)),this.curId=t,t&&this.$emit("viewClick",t)},onBatchUpdateClick:function(){this.$emit("batchUpdate")},onFoldClick:function(){this.showDetail=!1,this.$emit("foldClick")}}}),jt=(n(1393),Object(A.a)(Dt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.expiredNodes.length>0?n("div",{staticClass:"subflow-update-tips"},[n("div",{class:["number",{active:t.showDetail}],on:{click:t.onToggleDetail}},[t._v(t._s(t.expiredNodes.length))]),t._v(" "),n("div",{staticClass:"tips-content"},[n("notify-info",{attrs:{show:t.showDetail,content:t.tips},on:{"update:show":function(e){t.showDetail=e}},scopedSlots:t._u([{key:"buttons",fn:function(){return[n("bk-button",{attrs:{text:!0,size:"small"},on:{click:t.onViewClick}},[t._v(t._s(t.$t("查看需要更新的子流程")))]),t._v(" "),n("bk-button",{attrs:{text:!0,size:"small"},on:{click:t.onBatchUpdateClick}},[t._v(t._s(t.$t("批量更新")))]),t._v(" "),n("bk-button",{attrs:{text:!0,size:"small"},on:{click:t.onFoldClick}},[t._v(t._s(t.$t("收起")))])]},proxy:!0}],null,!1,208805287)})],1)]):t._e()}),[],!1,null,"d796da92",null).exports),Ot={QUOTA_EXCEEDED_ERR_CODE:22,getSnapshootStorage:function(){var t=localStorage.getItem("snapshootStorage");return JSON.parse(t)||{}},setSnapshootStorage:function(t,e){var n=this;try{localStorage.setItem("snapshootStorage",JSON.stringify(t))}catch(o){if(o.code===this.QUOTA_EXCEEDED_ERR_CODE){var i=this.getSnapshootStorage();0===Object.keys(i).length?alert("localstorage 空间不足"):(Object.keys(t).forEach(function(i,o){var s=this;u()(this,n),i!==e.username?t.splice(o,1):Object.keys(t[i]).forEach(function(n,o){var a=this;u()(this,s),n!==e.id?t[i].splice(o,1):Object.keys(t[i][n]).forEach(function(o,s){u()(this,a),o!==e.tpl&&t[i][n].splice(s,1)}.bind(this))}.bind(this))}.bind(this)),this.setSnapshootStorage(t))}}},create:function(t,e,n,i){var o=this.getSnapshootStorage();o[t]||(o[t]={}),o[t][e]||(o[t][e]={}),o[t][e][n]||(o[t][e][n]=[]);var s=o[t][e][n].length;s>=30&&(o[t][e][n]=o[t][e][n].slice(s-29)),o[t][e][n].push(i),this.setSnapshootStorage(o,{username:t,id:e,tpl:n})},update:function(t,e,n,i){var o=this,s=this.getSnapshootStorage();if(s[t]&&s[t][e]&&s[t][e][n]){var a=s[t][e][n].findIndex(function(t){return u()(this,o),t.timestamp===i.timestamp}.bind(this));a>-1&&(s[t][e][n].splice(a,1,i),this.setSnapshootStorage(s,{username:t,id:e,tpl:n}))}else this.create(t,e,n,i)},getTplSnapshoots:function(t,e,n){var i=this.getSnapshootStorage();return i[t]&&i[t][e]&&i[t][e][n]?i[t][e][n]:[]},getSnapshoot:function(t,e,n,i){var o=this;return this.getTplSnapshoots(t,e,n).find(function(t){return u()(this,o),t.timeStamp===i}.bind(this))},deleteTplSnapshoots:function(t,e,n){var i=this.getSnapshootStorage();i[t]&&i[t][e]&&i[t][e][n]&&i[t][e][n].length>0&&(delete i[t][e][n],this.setSnapshootStorage(i,{username:t,id:e,tpl:n}))},replaceSnapshootTplKey:function(t,e,n,i){var o=this.getSnapshootStorage();o[t]&&o[t][e]&&o[t][e][n]&&o[t][e][n].length>0&&(o[t][e][i]=o[t][e][n].slice(0),delete o[t][e][n],this.setSnapshootStorage(o,{username:t,id:e,newTpl:i}))}},Tt={getStorage:function(){var t=localStorage.getItem("tplTabStorage");return JSON.parse(t)||{}},setStorage:function(t){try{localStorage.setItem("tplTabStorage",JSON.stringify(t))}catch(t){localStorage.removeItem("tplTabStorage")}},setTab:function(t,e){var n=t.user,i=t.id,o=t.tpl,s=this.getStorage();"add"===e?(n in s||(s[n]={}),i in s[n]||(s[n][i]={}),o in s[n][i]||(s[n][i][o]=0),s[n][i][o]+=1):"del"===e&&s[n]&&s[n][i]&&(s[n][i][o]>0&&(s[n][i][o]-=1),0===s[n][i][o]&&delete s[n][i][o]),this.setStorage(s)},getCount:function(t){var e=t.user,n=t.id,i=t.tpl,o=this.getStorage();return o[e]&&o[e][n]?o[e][n][i]:0}},Lt=n(789),Nt=[150,54],At=[44,44],It=[34,34],Mt=[20,150],$t=n(989),Ft=n(975).a,Rt=(n(1394),n(1395),Object(A.a)(Ft,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-dialog",{staticClass:"batch-update-dialog",attrs:{"close-icon":!1,fullscreen:!0},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[n("div",{staticClass:"header-wrapper",attrs:{slot:"header"},slot:"header"},[n("h4",[t._v("批量更新子流程"+t._s(t.$t("（")+t.expiredTplNum+t.$t("）")))]),t._v(" "),n("div",{staticClass:"legend-area"},[n("span",{staticClass:"legend-item delete"},[t._v("删除")]),t._v(" "),n("span",{staticClass:"legend-item add"},[t._v("新增")])]),t._v(" "),n("i",{staticClass:"bk-dialog-close bk-icon icon-close",on:{click:t.onCloseDialog}})]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.subflowFormsLoading,opacity:1},expression:"{ isLoading: subflowFormsLoading, opacity: 1 }"}],staticClass:"subflow-form-wrap"},t._l(t.subflowForms,(function(e){return n("section",{key:e.id,staticClass:"subflow-item"},[n("div",{staticClass:"header-area",on:{click:function(t){if(t.target!==t.currentTarget)return null;e.fold=!e.fold}}},[n("bk-checkbox",{model:{value:e.checked,callback:function(n){t.$set(e,"checked",n)},expression:"subflow.checked"}}),t._v(" "),n("h3",[t._v(t._s(e.name))]),t._v(" "),n("i",{class:["bk-icon","icon-angle-up","fold-icon",e.fold?"fold":""],on:{click:function(t){e.fold=!e.fold}}})],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!subflow.fold"}],staticClass:"form-area"},[n("div",{staticClass:"current-form"},[n("div",{staticClass:"version-tag"},[t._v(t._s(t.$t("原版本")))]),t._v(" "),n("section",{staticClass:"config-section"},[n("h4",[t._v(t._s(t.$t("输入参数")))]),t._v(" "),n("div",{staticClass:"inputs-wrapper"},[e.currentForm.inputsConfig.length>0?n("input-params",{attrs:{"is-subflow":!0,"node-id":e.id,editable:!1,scheme:e.currentForm.inputsConfig,version:e.currentForm.version,"subflow-forms":e.currentForm.form,value:e.currentForm.inputsValue,constants:t.localConstants}}):n("no-data")],1)]),t._v(" "),n("section",{staticClass:"config-section"},[n("h4",[t._v(t._s(t.$t("输出参数")))]),t._v(" "),n("div",{staticClass:"outputs-wrapper"},[e.currentForm.outputs.length>0?n("output-params",{attrs:{constants:t.localConstants,params:e.currentForm.outputs,version:e.currentForm.version,"node-id":e.id}}):n("no-data")],1)])]),t._v(" "),n("div",{staticClass:"latest-form"},[n("div",{staticClass:"version-tag lastest"},[t._v(t._s(t.$t("待更新版本")))]),t._v(" "),n("section",{staticClass:"config-section"},[n("h4",[t._v(t._s(t.$t("输入参数")))]),t._v(" "),n("div",{staticClass:"inputs-wrapper"},[e.latestForm.inputsConfig.length>0?n("input-params",{ref:"inputParams",refInFor:!0,attrs:{"is-subflow":!0,"node-id":e.id,scheme:e.latestForm.inputsConfig,version:e.latestForm.version,"subflow-forms":e.latestForm.form,value:e.latestForm.inputsValue,constants:t.localConstants},on:{hookChange:t.onHookChange,update:function(n){return t.updateInputsValue(e.id,n)}}}):n("no-data")],1)]),t._v(" "),n("section",{staticClass:"config-section"},[n("h4",[t._v(t._s(t.$t("输出参数")))]),t._v(" "),n("div",{staticClass:"outputs-wrapper"},[e.latestForm.outputs.length?n("output-params",{attrs:{constants:t.localConstants,params:e.latestForm.outputs,version:e.latestForm.version,"node-id":e.id},on:{hookChange:t.onHookChange}}):n("no-data")],1)])])])])})),0),t._v(" "),n("div",{staticClass:"footer-wrapper",attrs:{slot:"footer"},slot:"footer"},[n("bk-checkbox",{staticClass:"selecte-all",attrs:{indeterminate:t.selectedTplNum>0&&t.selectedTplNum<t.expiredTplNum,value:t.selectedTplNum>0&&t.selectedTplNum===t.expiredTplNum},on:{change:t.onSelectedAllChange}},[t._v("\n            "+t._s(t.$t("全选"))+"\n        ")]),t._v(" "),n("div",{staticClass:"action-btns"},[t.selectedTplNum>0?n("span",{staticClass:"selected-tips"},[t._v(t._s(t.$t("已选择")+t.selectedTplNum+t.$t("个")+t.$t("待更新的子流程")))]):t._e(),t._v(" "),n("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary",disabled:t.subflowFormsLoading||!t.selectedTplNum},on:{click:t.onConfirm}},[t._v("\n                "+t._s(t.$t("批量更新"))+"\n            ")]),t._v(" "),n("bk-button",{on:{click:t.onCloseDialog}},[t._v(t._s(t.$t("取消")))])],1)],1)])}),[],!1,null,"1296c747",null).exports);function Bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Vt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Bt(Object(n),!0).forEach((function(e){h()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ht={name:"TemplateEdit",components:{TemplateHeader:I,TemplateCanvas:M.a,TaskSelectNode:$t.a,NodeConfig:Pt,ConditionEdit:Et.a,TemplateSetting:kt,SubflowUpdateTips:jt,BatchUpdateDialog:Rt},mixins:[E.a],props:["template_id","type","common","entrance"],data:function(){return{isShowDialog:!1,isSaveLoading:!1,isSchemaListChange:!1,executeSchemeSaving:!1,taskSchemeList:[],isPreviewMode:!1,isExectueSchemeDialog:!1,isExecuteScheme:!1,isEditProcessPage:!0,excludeNode:[],singleAtomListLoading:!1,subAtomListLoading:!1,projectInfoLoading:!1,templateDataLoading:!1,templateSaving:!1,createTaskSaving:!1,saveAndCreate:!1,pid:void 0,isGlobalVariableUpdate:!1,isTemplateDataChanged:!1,isShowConditionEdit:!1,isNodeConfigPanelShow:!1,isFromTplListRoute:!1,isLeaveDialogShow:!1,nodeMenuOpen:!1,activeSettingTab:"",allowLeave:!1,leaveToPath:"",idOfNodeInConfigPanel:"",atomList:[],atomTypeList:{tasknode:[],subflow:[]},snapshoots:[],snapshootTimer:null,templateLabels:[],templateLabelLoading:!1,tplUUID:Object(y.b)(),tplActions:[],conditionData:{},multipleTabDialogShow:!1,tplEditingTabCount:0,isBatchUpdateDialogShow:!1,backToVariablePanel:!1,nodeGuideConfig:{el:"",width:150,placement:"bottom",once:!0,arrow:!0,img:{height:112,url:n(1396)},text:[{type:"name",val:m.a.t("双击左键")},{type:"text",val:m.a.t("可以快捷打开节点配置面板")}]},typeOfNodeNameEmpty:""}},computed:Vt(Vt(Vt({},Object(v.e)({atomConfig:function(t){return u()(this,void 0),t.atomForm.config}.bind(void 0),name:function(t){return u()(this,void 0),t.template.name}.bind(void 0),activities:function(t){return u()(this,void 0),t.template.activities}.bind(void 0),locations:function(t){return u()(this,void 0),t.template.location}.bind(void 0),lines:function(t){return u()(this,void 0),t.template.line}.bind(void 0),constants:function(t){return u()(this,void 0),t.template.constants}.bind(void 0),gateways:function(t){return u()(this,void 0),t.template.gateways}.bind(void 0),projectBaseInfo:function(t){return u()(this,void 0),t.template.projectBaseInfo}.bind(void 0),category:function(t){return u()(this,void 0),t.template.category}.bind(void 0),subprocess_info:function(t){return u()(this,void 0),t.template.subprocess_info}.bind(void 0),username:function(t){return u()(this,void 0),t.username}.bind(void 0),site_url:function(t){return u()(this,void 0),t.site_url}.bind(void 0)})),Object(v.e)("project",{timeZone:function(t){return u()(this,void 0),t.timezone}.bind(void 0),project_id:function(t){return u()(this,void 0),t.project_id}.bind(void 0)})),{},{canvasData:function(){var t=this,e={};for(var n in this.gateways){var i=this.gateways[n];i.conditions&&(e[i.id]=Object.assign({},i.conditions))}return{activities:this.activities,lines:this.lines,locations:this.locations.map(function(e){var n,i,o,s=this;u()(this,t);var a=this.atomList.find(function(t){if(u()(this,s),"tasknode"===e.type)return this.activities[e.id].component.code===t.code}.bind(this));a&&(n=a.group_icon,i=a.group_name,o=a.code);var r=Vt(Vt({},e),{},{mode:"edit",icon:n,group:i,code:o});return this.subprocess_info&&this.subprocess_info.details&&"subflow"===e.type&&this.subprocess_info.details.some(function(t){if(u()(this,s),t.subprocess_node_id===e.id&&t.expired)return r.hasUpdated=!0,!0}.bind(this)),r}.bind(this)),branchConditions:e}},subflowShouldUpdated:function(){return this.subprocess_info&&this.subprocess_info.subproc_has_update?this.subprocess_info.details:[]},tplEditDialogTip:function(){var t=this.$t("确定保存流程并去设置执行方案？");return"clone"===this.type?t=this.$t("确定保存克隆流程并去设置执行方案？"):this.isEditProcessPage||(t=this.$t("确定保存修改的内容？")),t}}),beforeRouteEnter:function(t,e,n){var i=this;n(function(t){u()(this,i),["commonProcessList","process"].includes(e.name)&&(t.isFromTplListRoute=!0)}.bind(this))},created:function(){if(this.initTemplateData(),this.getSystemVars(),this.getSingleAtomList(),this.getProjectBaseInfo(),this.common||this.getTemplateLabelList(),this.templateDataLoading=!0,this.snapshoots=this.getTplSnapshoots(),"edit"===this.type||"clone"===this.type)this.getTemplateData();else{var t="new"+b.a.tz(this.timeZone).format("YYYYMMDDHHmmss");this.setTemplateName(t),this.templateDataLoading=!1}},mounted:function(){if(this.openSnapshootTimer(),window.addEventListener("beforeunload",this.handleBeforeUnload,!1),window.addEventListener("unload",this.handleUnload.bind(this),!1),"edit"===this.type){var t=this.getTplTabData();Tt.setTab(t,"add")}},beforeDestroy:function(){if("edit"===this.type){var t=this.getTplTabData();Tt.setTab(t,"del")}window.removeEventListener("beforeunload",this.handleBeforeUnload,!1),window.removeEventListener("unload",this.handleUnload,!1),this.resetTemplateData(),this.hideGuideTips()},methods:Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt({},Object(v.b)("template/",["loadProjectBaseInfo","loadTemplateData","saveTemplateData","loadCommonTemplateData","loadCustomVarCollection","getLayoutedPipeline","loadInternalVariable"])),Object(v.b)("atomForm/",["loadSingleAtomList","loadSubflowList","loadAtomConfig","loadSubflowConfig"])),Object(v.b)("project/",["getProjectLabelsWithDefault"])),Object(v.d)("template/",["initTemplateData","resetTemplateData","setProjectBaseInfo","setTemplateName","setTemplateData","setLocation","setLocationXY","setLine","setActivities","setGateways","setStartpoint","setEndpoint","setBranchCondition","replaceTemplate","replaceLineAndLocation","setPipelineTree","setInternalVariable"])),Object(v.d)("atomForm/",["clearAtomForm"])),Object(v.c)("template/",["getLocalTemplateData","getPipelineTree"])),Object(v.b)("task/",["loadTaskScheme","saveTaskSchemList"])),{},{getSingleAtomList:function(){var t=this;return l()(f.a.mark((function e(){var n,i,o,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.singleAtomListLoading=!0,e.prev=1,n={},t.common||(n.project_id=t.project_id),e.next=6,t.loadSingleAtomList(n);case 6:i=e.sent,o=[],i.forEach(function(t){var e=this;u()(this,s);var n=o.find(function(n){return u()(this,e),n.code===t.code}.bind(this));if(n)n.list.push(t);else{var i=t.code,a=t.desc,r=t.name,l=t.group_name,c=t.group_icon,d=t.sort_key_group_en;o.push({code:i,desc:a,name:r,group_name:l,group_icon:c,type:l,list:[t],sort_key_group_en:d})}}.bind(this)),t.atomList=t.handleAtomVersionOrder(o),t.handleAtomGroup(o),t.markNodesPhase(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:return e.prev=17,t.singleAtomListLoading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[1,14,17,20]])})))()},getProjectBaseInfo:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectInfoLoading=!0,e.prev=1,e.next=4,t.loadProjectBaseInfo();case 4:n=e.sent,t.setProjectBaseInfo(n.data),t.getSubflowList(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:return e.prev=12,t.projectInfoLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})))()},getSubflowList:function(){var t=this;return l()(f.a.mark((function e(){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.subAtomListLoading=!0,e.prev=1,n={project_id:t.project_id,common:t.common,templateId:t.template_id},e.next=5,t.loadSubflowList(n);case 5:i=e.sent,t.handleSubflowList(i),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:return e.prev=12,t.subAtomListLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})))()},getTemplateData:function(){var t=this;return l()(f.a.mark((function e(){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={templateId:t.template_id,common:t.common},e.next=4,t.loadTemplateData(n);case 4:i=e.sent,t.tplActions=i.auth_actions,"clone"===t.type&&(i.name=i.name.slice(0,ot.i.TEMPLATE_NAME_MAX_LENGTH-6)+"_clone"),t.setTemplateData(i),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),404===e.t0.status&&t.$router.push({name:"notFoundPage"}),console.log(e.t0);case 14:return e.prev=14,t.templateDataLoading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})))()},getSingleAtomConfig:function(t){var e=this;return l()(f.a.mark((function n(){var i,o,s,a;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=t.atomId,o=t.version,s=e.atomConfig[i],a=e.common?void 0:e.project_id,!s||!s[o]){n.next=7;break}return e.addSingleAtomActivities(t,s[o]),n.abrupt("return");case 7:return e.atomConfigLoading=!0,n.prev=8,n.next=11,e.loadAtomConfig({atom:i,version:o,project_id:a});case 11:e.addSingleAtomActivities(t,e.atomConfig[i][o]),n.next=17;break;case 14:n.prev=14,n.t0=n.catch(8),console.log(n.t0);case 17:return n.prev=17,e.atomConfigLoading=!1,n.finish(17);case 20:case"end":return n.stop()}}),n,null,[[8,14,17,20]])})))()},getSubflowConfig:function(t){var e=this;return l()(f.a.mark((function n(){var i,o,s,a,r,l,c,u,d,h,p,m,v,g;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.loadSubflowConfig({templateId:t.atomId,version:t.atomVersion,common:e.common});case 3:i=n.sent,o=_.a.deepClone(i.data.form),s=_.a.deepClone(e.activities[t.id]),a=e.common?void 0:e.project_id,n.t0=f.a.keys(o);case 8:if((n.t1=n.t0()).done){n.next=21;break}if(r=n.t1.value,l=o[r],c=C.a.getVariableArgs(l),u=c.name,d=c.atom,h=c.tagCode,p=c.classify,m=l.version||"legacy",C.a.isConfigExists(d,m,e.atomConfig)){n.next=16;break}return n.next=16,e.loadAtomConfig({name:u,atom:d,classify:p,version:m,project_id:a});case 16:v=e.atomConfig[d][m],(g=_.a.deepClone(C.a.formFilter(h,v)))&&(l.is_meta||g.meta_transform)&&(g=g.meta_transform(l.meta||l),l.meta||(l.value=g.attrs.value)),n.next=8;break;case 21:s.constants=o||{},e.setActivities({type:"edit",location:s}),n.next=28;break;case 25:n.prev=25,n.t2=n.catch(0),console.log(n.t2);case 28:case"end":return n.stop()}}),n,null,[[0,25]])})))()},getSystemVars:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.systemVarsLoading=!0,e.next=4,t.loadInternalVariable();case 4:n=e.sent,t.setInternalVariable(n.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.systemVarsLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},getTemplateLabelList:function(){var t=this;return l()(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.templateLabelLoading=!0,e.next=4,t.getProjectLabelsWithDefault(t.project_id);case 4:n=e.sent,t.templateLabels=n.data,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return e.prev=11,t.templateLabelLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},saveTemplate:function(){var t=this;return l()(f.a.mark((function e(){var n,i,o,s,a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="edit"===t.type?t.template_id:void 0,t.saveAndCreate?t.createTaskSaving=!0:t.templateSaving=!0,e.prev=2,e.next=5,t.saveTemplateData({templateId:n,projectId:t.project_id,common:t.common});case 5:if(i=e.sent,t.tplActions=i.auth_actions,t.$bkMessage({message:m.a.t("保存成功"),theme:"success"}),t.isTemplateDataChanged=!1,"clone"!==t.type||t.common){e.next=19;break}return e.next=12,t.loadTaskScheme({project_id:t.project_id,template_id:t.template_id,isCommon:t.common});case 12:if(e.t0=e.sent,e.t0){e.next=15;break}e.t0=[];case 15:return t.taskSchemeList=e.t0,o=t.taskSchemeList.map(function(t){return u()(this,r),{data:t.data,name:t.name}}.bind(this)),e.next=19,t.saveTaskSchemList({project_id:t.project_id,template_id:i.template_id,schemes:o});case 19:"edit"!==t.type&&(t.saveTempSnapshoot(i.template_id),t.allowLeave=!0,t.isFromTplListRoute=!1,s={name:"templatePanel",params:{type:"edit"},query:{template_id:i.template_id,common:t.common}},t.common&&(s.name="commonTemplatePanel"),t.$router.push(s),a={user:t.username,id:t.common?"common":t.project_id,tpl:i.template_id},Tt.setTab(a,"add")),t.createTaskSaving&&t.goToTaskUrl(i.template_id),e.next=26;break;case 23:e.prev=23,e.t1=e.catch(2),console.log(e.t1);case 26:return e.prev=26,t.saveAndCreate=!1,t.pid=void 0,t.templateSaving=!1,t.createTaskSaving=!1,e.finish(26);case 32:case"end":return e.stop()}}),e,this,[[2,23,26,32]])})))()},addSingleAtomActivities:function(t,e){var n=this,i={},o=C.a.getFormItemDefaultValue(e);e.forEach(function(t){u()(this,n),i[t.tag_code]={hook:!1,value:o[t.tag_code]}}.bind(this));var s=_.a.deepClone(this.activities[t.id]);s.component.data=i,this.setActivities({type:"edit",location:s})},handleAtomVersionOrder:function(t){var e=this;return t.map(function(t){var n=this;u()(this,e);var i=t.list.find(function(t){return u()(this,n),"legacy"===t.version}.bind(this)),o=t.list.slice(0),s=[];return i>-1&&(s.push(o[i]),o.splice(i,1)),o.length>1&&o.sort(function(t,e){return u()(this,n),t.version.localeCompare(e.version)}.bind(this)),Vt(Vt({},t),{},{list:s.concat(o)})}.bind(this))},handleAtomGroup:function(t){var e=this,n=[];t.forEach(function(t){var i=this;u()(this,e);var o=n.find(function(e){return u()(this,i),e.type===t.type}.bind(this));if(o)o.list.push(t);else{var s=t.type,a=t.group_name,r=t.group_icon,l=t.sort_key_group_en;n.push({group_name:a,group_icon:r,type:s,sort_key_group_en:l,list:[t]})}}.bind(this)),n.sort(function(t,n){return u()(this,e),t.sort_key_group_en<n.sort_key_group_en?-1:t.sort_key_group_en>n.sort_key_group_en?1:0}.bind(this)),this.atomTypeList.tasknode=n},handleSubflowList:function(t){var e=this,n=[],i=this.common?["common_flow_view"]:["flow_view"];t.objects.forEach(function(t){u()(this,e),"clone"!==this.type&&t.id===Number(this.template_id)||(t.hasPermission=this.hasPermission(i,t.auth_actions),n.push(t))}.bind(this)),this.atomTypeList.subflow=n},showConfigPanel:function(t){this.isNodeConfigPanelShow=!0,this.idOfNodeInConfigPanel=t},closeConfigPanel:function(t){this.isNodeConfigPanelShow=!1,this.idOfNodeInConfigPanel="",this.backToVariablePanel=!1,t&&this.onChangeSettingPanel("globalVariableTab")},templateDataChanged:function(){this.isTemplateDataChanged=!0},validateAtomNode:function(){var t=this,e=!0;if(this.typeOfNodeNameEmpty="",Object.keys(this.activities).forEach(function(n){u()(this,t);var i=!0,o=this.activities[n];"ServiceActivity"===o.type?(o.name||(i=!1,this.typeOfNodeNameEmpty="serviceActivity"),o.component.code&&this.validateAtomInputForm(o.component)||(i=!1)):o.name&&void 0!==o.template_id||(i=!1,this.typeOfNodeNameEmpty="subProcess"),i||(e=!1,this.markInvalidNode(n))}.bind(this)),!e){var n=m.a.t("任务节点参数错误，请点击错误节点查看详情");this.typeOfNodeNameEmpty&&(n="serviceActivity"===this.typeOfNodeNameEmpty?m.a.t("请选择节点的插件类型"):m.a.t("请选择节点的子流程")),this.$bkMessage({message:n,theme:"error"})}return e},validateAtomInputForm:function(t){var e=this,n=t.code,i=t.data,o=t.version;if(!i)return!1;if(this.atomConfig[n]&&this.atomConfig[n][o]){var s=this.atomConfig[n][o],a={};return Object.keys(i).forEach(function(t){u()(this,e),a[t]=i[t].value}.bind(this)),this.checkAtomData(s,a)}return!0},checkAtomData:function(t,e){var n=this,i=!0,o={get_tag_value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=t[0];if(!(i in n))throw new Error("表单值中不存在 ".concat(i," 属性"));return 1===t.length?_.a.deepClone(n[i]):this.get_tag_value(t.slice(1),n[i])}};return t.forEach(function(t){var s=this;u()(this,n);var r=t.tag_code,l=t.type,c=t.attrs,d=e[r];"combine"===l?"object"!==a()(d)||this.checkAtomData(c.children,d)||(i=!1):c.validation&&c.validation.length&&c.validation.forEach(function(t){(u()(this,s),"required"===t.type&&_.a.isEmpty(d)&&(i=!1),"regex"===t.type)&&(new RegExp(t.args).test(d)||(i=!1));"custom"===t.type&&(/^\${[^${}]+}$/.test(d)||t.args.call(o,d,e).result||(i=!1))}.bind(this))}.bind(this)),i},markInvalidNode:function(t){this.onUpdateNodeInfo(t,{status:"FAILED"})},markNodesPhase:function(){var t=this;Object.keys(this.canvasData.activities).forEach(function(e){var n=this;u()(this,t);var i=this.canvasData.activities[e];if("ServiceActivity"===i.type){var o="";this.atomList.some(function(t){var e=this;if(u()(this,n),t.code===i.component.code)return t.list.some(function(t){u()(this,e),t.version===(i.component.version||"legacy")&&(o=t)}.bind(this))}.bind(this)),o&&[1,2].includes(o.phase)&&this.onUpdateNodeInfo(i.id,{phase:o.phase})}}.bind(this))},onShowNodeConfig:function(t){var e=this,n=this.locations.find(function(n){return u()(this,e),n.id===t}.bind(this));["tasknode","subflow"].includes(n.type)&&this.showConfigPanel(t)},onFormatPosition:function(){var t=this;return l()(f.a.mark((function e(){var n,i,o,s,a,r,l,c,d,h=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.reportInfo({page:"templateEdit",zone:"formatPositionIcon",event:"click"}),(n=k.a.isNodeLineNumValid(t.canvasData)).result){e.next=5;break}return Object(S.a)({message:n.message},t),e.abrupt("return");case 5:if(!t.canvasDataLoading){e.next=7;break}return e.abrupt("return");case 7:return t.canvasDataLoading=!0,e.prev=8,i=Nt,o=At,s=It,a=Mt,r=t.getPipelineTree(),l=document.getElementsByClassName("canvas-flow-wrap")[0],c=l.offsetWidth-200,e.next=15,t.getLayoutedPipeline({canvas_width:c,pipeline_tree:r,activity_size:i,event_size:o,gateway_size:s,start:a});case 15:(d=e.sent).result&&(t.onCreateSnapshoot("isFormatPosition"),t.$refs.templateCanvas.removeAllConnector(),t.setPipelineTree(d.data.pipeline_tree),t.$nextTick(function(){u()(this,h),t.$refs.templateCanvas.updateCanvas(),t.$refs.templateCanvas.onResetPosition(),t.templateDataChanged(),t.$bkMessage({message:m.a.t("排版完成，原内容在本地快照中"),theme:"success"})}.bind(this))),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),console.log(e.t0);case 22:return e.prev=22,t.canvasDataLoading=!1,e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[8,19,22,25]])})))()},onLocationChange:function(t,e){var n=this;switch(this.setLocation({type:t,location:e}),e.type){case"tasknode":case"subflow":if("add"===t&&e.atomId){if("tasknode"===e.type){var i=this.atomList.find(function(t){return u()(this,n),t.code===e.atomId}.bind(this)).list,o=i[i.length-1].version;e.version=o,this.setActivities({type:"add",location:e}),this.getSingleAtomConfig(e)}else this.setActivities({type:"add",location:e}),this.getSubflowConfig(e);return}this.setActivities({type:t,location:e});break;case"branchgateway":case"parallelgateway":case"convergegateway":case"conditionalparallelgateway":this.setGateways({type:t,location:e});break;case"startpoint":this.setStartpoint({type:t,location:e});break;case"endpoint":this.setEndpoint({type:t,location:e})}},onLineChange:function(t,e){this.setLine({type:t,line:e})},onLocationMoveDone:function(t){this.setLocationXY(t)},globalVariableUpdate:function(t){this.isGlobalVariableUpdate=t},onUpdateNodeInfo:function(t,e){var n=this,i=this.canvasData.locations.find(function(e){return u()(this,n),e.id===t}.bind(this)),o=Object.assign(i,e);this.setLocation({type:"edit",location:o}),this.$refs.templateCanvas.onUpdateNodeInfo(t,e)},onSaveExecuteSchemeClick:function(){var t=this;return l()(f.a.mark((function e(){var n,i,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.executeSchemeSaving=!0,n=t.taskSchemeList.map(function(t){return u()(this,o),{data:t.data,name:t.name}}.bind(this)),e.next=5,t.saveTaskSchemList({project_id:t.project_id,template_id:t.template_id,schemes:n});case 5:if(i=e.sent,t.isExectueSchemeDialog=!1,i.result){e.next=10;break}return t.$bkMessage({message:i.message,theme:"error"}),e.abrupt("return");case 10:t.$bkMessage({message:m.a.t("方案保存成功"),theme:"success"}),t.allowLeave=!0,t.isTemplateDataChanged=!1,t.isEditProcessPage=!0,t.isSchemaListChange=!1,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0);case 20:return e.prev=20,t.executeSchemeSaving=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[0,17,20,23]])})))()},goBackToTplEdit:function(){this.isSchemaListChange?this.isExectueSchemeDialog=!0:this.isEditProcessPage=!0},updateTaskSchemeList:function(t){this.taskSchemeList=t,this.allowLeave=!1,this.isTemplateDataChanged=!0,this.isSchemaListChange=!0},onClosePreview:function(){this.$refs.taskSelectNode.togglePreviewMode(!1)},onOpenExecuteScheme:function(t){this.isExecuteScheme=t},onChangeSettingPanel:function(t){this.activeSettingTab=t,this.isGlobalVariableUpdate&&"globalVariableTab"===t&&(this.isGlobalVariableUpdate=!1)},goToTaskUrl:function(t){this.$router.push({name:"taskCreate",params:{step:"selectnode",project_id:this.pid},query:{template_id:t,common:this.common,entrance:"templateEdit"}})},onSaveTemplate:function(t,e){this.templateSaving||this.createTaskSaving||(this.saveAndCreate=t,this.pid=e,"edit"===this.type&&Tt.getCount(this.getTplTabData())>1?this.isExecuteScheme||(this.multipleTabDialogShow=!0):this.checkNodeAndSaveTemplate())},checkNodeAndSaveTemplate:function(){var t=k.a.isNodeLineNumValid(this.canvasData);if(t.result){var e=document.querySelectorAll(".canvas-node-item .failed");if(e&&e.length){this.templateSaving=!1,this.createTaskSaving=!1;var n=m.a.t("任务节点参数错误，请点击错误节点查看详情");return this.typeOfNodeNameEmpty&&(n="serviceActivity"===this.typeOfNodeNameEmpty?m.a.t("请选择节点的插件类型"):m.a.t("请选择节点的子流程")),void Object(S.a)({message:n},this)}this.validateAtomNode()&&(this.common&&this.saveAndCreate&&void 0===this.pid?this.$refs.templateHeader.setProjectSelectDialogShow():this.isExecuteScheme?"clone"===this.type||this.isTemplateDataChanged?this.isExectueSchemeDialog=!0:this.isEditProcessPage=!1:this.saveTemplate())}else Object(S.a)({message:t.message},this)},onLeaveConfirm:function(){this.allowLeave=!0,this.$router.push({path:this.leaveToPath})},onLeaveCancel:function(){this.allowLeave=!1,this.leaveToPath="",this.isLeaveDialogShow=!1,w.a.$emit("resetProjectChange",this.project_id)},onReplaceLineAndLocation:function(t){this.replaceLineAndLocation(t)},updateAllNodeInfo:function(){var t=this,e=this.activities;Object.keys(e).forEach(function(n,i){u()(this,t),this.onUpdateNodeInfo(n,{status:"",name:e[n].name,stage_name:e[n].stage_name,optional:e[n].optional,error_ignorable:e[n].error_ignorable,retryable:e[n].can_retry||e[n].retryable,skippable:e[n].isSkipped||e[n].skippable})}.bind(this))},onOpenConditionEdit:function(t){this.isShowConditionEdit=!0,this.conditionData=Vt({},t)},onBeforeClose:function(){this.isShowDialog=!0},onConfirmClick:function(){var t=this;return l()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isSaveLoading=!0,e.prev=1,e.next=4,t.$refs.conditionEdit.confirm();case 4:t.isSaveLoading=!1,t.isShowDialog=!1,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t.isSaveLoading=!1;case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))()},onCancelClick:function(){this.isShowDialog=!1,this.isShowConditionEdit=!1},onCloseConfigPanel:function(t){this.isShowConditionEdit=!1,this.backToVariablePanel=!1,t&&this.onChangeSettingPanel("globalVariableTab")},updataCanvasCondition:function(t){this.$refs.templateCanvas.updataConditionCanvasData(t)},modifyTemplateData:function(t){var e=this;this.templateDataLoading=!0,this.setPipelineTree(t),this.$nextTick(function(){u()(this,e),this.templateDataLoading=!1}.bind(this))},handlerGuideTips:function(){if("new"===this.type){var t=this.nodeGuideConfig;this.nodeGuide=new Lt.a(t),this.nodeGuide.mount(document.querySelector(".task-node")),this.nodeGuide.instance.show(1e3)}},hideGuideTips:function(){this.nodeGuide&&this.nodeGuide.instance.hide()},canvasMounted:function(){this.handlerGuideTips()},viewUpdatedNode:function(t){this.moveNodeToView(t),this.showDotAnimation(t)},onCitedNodeClick:function(t){var e=this,n=t.group,i=t.id;if(this.backToVariablePanel=!0,"activities"===n)this.activeSettingTab="",this.showConfigPanel(i);else if("conditions"===n){var o=this.lines.find(function(t){return u()(this,e),t.id===i}.bind(this)).source.id,s=this.gateways[o].conditions[i],a=s.evaluate,r=s.name,l={id:i,name:r,nodeId:o,overlayId:"condition".concat(i),value:a};this.activeSettingTab="",this.onOpenConditionEdit(l)}},moveNodeToView:function(t){var e=this,n=this.locations.find(function(n){return u()(this,e),n.id===t}.bind(this)),i=200-n.x,o=200-n.y;this.$refs.templateCanvas.setCanvasPosition(i,o,!0);var s=document.querySelector("#".concat(t," .canvas-node-item"));s&&(s.classList.add("node-shake"),setTimeout(function(){u()(this,e),s.classList.remove("node-shake")}.bind(this),500))},showDotAnimation:function(t){var e=this;this.clearDotAnimation(),Array.isArray(t)||(t=[t]),t.forEach(function(t){u()(this,e),document.querySelector("#".concat(t," .updated-dot")).classList.add("show-animation")}.bind(this))},clearDotAnimation:function(){var t=this;document.querySelectorAll(".subflow-node .updated-dot").forEach(function(e){u()(this,t),e.classList.remove("show-animation")}.bind(this))},onCreateSnapshoot:function(t){this.snapshootTimer&&clearTimeout(this.snapshootTimer),this.setTplSnapshoot(),t||this.$bkMessage({message:m.a.t("新增流程本地快照成功"),theme:"success"}),this.snapshoots=this.getTplSnapshoots(),this.openSnapshootTimer()},onUseSnapshoot:function(t){var e=this,n=o()(t,2),i=n[0],s=n[1],a=m.a.t("最近快照已保存，并恢复至原序号为")+s+m.a.t("的快照");this.setTplSnapshoot(a),this.replaceTemplate(i),this.templateDataLoading=!0,this.$nextTick(function(){var t=this;u()(this,e),this.templateDataLoading=!1,this.snapshoots=this.getTplSnapshoots(),this.$bkMessage({message:m.a.t("替换流程成功"),theme:"success"}),this.$nextTick(function(){u()(this,t),this.updateAllNodeInfo()}.bind(this))}.bind(this))},onUpdateSnapshoot:function(t){var e=this.common?"common":this.project_id,n="edit"===this.type?this.template_id:this.tplUUID;Ot.update(this.username,e,n,t),this.snapshoots=this.getTplSnapshoots()},openSnapshootTimer:function(){var t=this;this.snapshootTimer&&clearTimeout(this.snapshootTimer),this.snapshootTimer=setTimeout(function(){u()(this,t),this.setTplSnapshoot(),this.snapshoots=this.getTplSnapshoots(),this.openSnapshootTimer()}.bind(this),3e5)},setTplSnapshoot:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.a.t("自动保存"),e=this.common?"common":this.project_id,n="edit"===this.type?this.template_id:this.tplUUID,i={name:t,timestamp:(new Date).getTime(),template:this.getLocalTemplateData()};Ot.create(this.username,e,n,i)},getTplSnapshoots:function(){var t=this.common?"common":this.project_id,e="edit"===this.type?this.template_id:this.tplUUID;return Ot.getTplSnapshoots(this.username,t,e).slice().reverse()},clearTempSnapshoot:function(){var t=this.common?"common":this.project_id;Ot.deleteTplSnapshoots(this.username,t,this.tplUUID)},saveTempSnapshoot:function(t){var e=this.common?"common":this.project_id;Ot.replaceSnapshootTplKey(this.username,e,this.tplUUID,t)},handleBeforeUnload:function(t){return t.returnValue=m.a.t("系统不会保存您所做的更改，确认离开？"),m.a.t("系统不会保存您所做的更改，确认离开？")},handleUnload:function(t,e){if("edit"===this.type){var n=this.getTplTabData();Tt.setTab(n,"del")}},onMutilpleTabConfirm:function(){this.checkNodeAndSaveTemplate(),this.multipleTabDialogShow=!1},getTplTabData:function(){return{user:this.username,id:this.common?"common":this.project_id,tpl:this.template_id}},togglePreviewMode:function(t){this.isPreviewMode=t},setExcludeNode:function(t){this.excludeNode=t},onConfirmSave:function(){var t=this;return l()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isEditProcessPage){e.next=7;break}return e.next=3,t.saveTemplate();case 3:t.isExectueSchemeDialog=!1,t.isEditProcessPage=!1,e.next=8;break;case 7:t.onSaveExecuteSchemeClick();case 8:case"end":return e.stop()}}),e)})))()},onCancelSave:function(){this.isExectueSchemeDialog=!1,this.isEditProcessPage=!0}}),beforeRouteLeave:function(t,e,n){this.allowLeave||!this.isTemplateDataChanged?(this.clearAtomForm(),this.snapshootTimer&&clearTimeout(this.snapshootTimer),"edit"!==this.type&&this.clearTempSnapshoot(),n()):(this.leaveToPath=t.fullPath,this.isLeaveDialogShow=!0)}},Gt=(n(1397),n(1398),Object(A.a)(Ht,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.templateDataLoading||t.singleAtomListLoading,zIndex:100},expression:"{ isLoading: templateDataLoading || singleAtomListLoading, zIndex: 100 }"}],staticClass:"template-page"},[t.templateDataLoading||t.singleAtomListLoading?t._e():n("div",{staticClass:"pipeline-canvas-wrapper"},[n("TemplateHeader",{ref:"templateHeader",attrs:{name:t.name,project_id:t.project_id,type:t.type,common:t.common,template_id:t.template_id,"is-global-variable-update":t.isGlobalVariableUpdate,"is-template-data-changed":t.isTemplateDataChanged,"is-from-tpl-list-route":t.isFromTplListRoute,"template-saving":t.templateSaving,"create-task-saving":t.createTaskSaving,"active-tab":t.activeSettingTab,"tpl-actions":t.tplActions,"is-edit-process-page":t.isEditProcessPage,"is-preview-mode":t.isPreviewMode,"execute-scheme-saving":t.executeSchemeSaving},on:{onSaveExecuteSchemeClick:t.onSaveExecuteSchemeClick,goBackToTplEdit:t.goBackToTplEdit,onClosePreview:t.onClosePreview,onOpenExecuteScheme:t.onOpenExecuteScheme,onChangePanel:t.onChangeSettingPanel,onSaveTemplate:t.onSaveTemplate}}),t._v(" "),t.isEditProcessPage?[t.subflowShouldUpdated.length>0?n("SubflowUpdateTips",{class:["update-tips",{"update-tips-with-menu-open":t.nodeMenuOpen}],attrs:{list:t.subflowShouldUpdated,locations:t.locations,"node-menu-open":t.nodeMenuOpen},on:{viewClick:t.viewUpdatedNode,batchUpdate:function(e){t.isBatchUpdateDialogShow=!0},foldClick:t.clearDotAnimation}}):t._e(),t._v(" "),n("TemplateCanvas",{ref:"templateCanvas",staticClass:"template-canvas",attrs:{"atom-type-list":t.atomTypeList,name:t.name,type:t.type,common:t.common,"subflow-list-loading":t.subAtomListLoading,"template-labels":t.templateLabels,"canvas-data":t.canvasData,"node-memu-open":t.nodeMenuOpen},on:{"update:nodeMemuOpen":function(e){t.nodeMenuOpen=e},"update:node-memu-open":function(e){t.nodeMenuOpen=e},"hook:mounted":t.canvasMounted,onConditionClick:t.onOpenConditionEdit,templateDataChanged:t.templateDataChanged,onLocationChange:t.onLocationChange,onLineChange:t.onLineChange,onLocationMoveDone:t.onLocationMoveDone,onFormatPosition:t.onFormatPosition,onReplaceLineAndLocation:t.onReplaceLineAndLocation,onShowNodeConfig:t.onShowNodeConfig}})]:n("TaskSelectNode",{ref:"taskSelectNode",attrs:{project_id:t.project_id,common:t.common,entrance:t.entrance,template_id:t.template_id,"exclude-node":t.excludeNode,"is-edit-process-page":t.isEditProcessPage},on:{updateTaskSchemeList:t.updateTaskSchemeList,togglePreviewMode:t.togglePreviewMode,setExcludeNode:t.setExcludeNode}}),t._v(" "),n("div",{staticClass:"side-content"},[t.isNodeConfigPanelShow?n("node-config",{ref:"nodeConfig",attrs:{"is-show":t.isNodeConfigPanelShow,"atom-list":t.atomList,"atom-type-list":t.atomTypeList,"template-labels":t.templateLabels,common:t.common,project_id:t.project_id,"node-id":t.idOfNodeInConfigPanel,"subflow-list-loading":t.subAtomListLoading,"back-to-variable-panel":t.backToVariablePanel},on:{globalVariableUpdate:t.globalVariableUpdate,updateNodeInfo:t.onUpdateNodeInfo,templateDataChanged:t.templateDataChanged,close:t.closeConfigPanel}}):t._e(),t._v(" "),n("condition-edit",{ref:"conditionEdit",attrs:{"is-show":t.isShowConditionEdit,"condition-data":t.conditionData,"back-to-variable-panel":t.backToVariablePanel},on:{onBeforeClose:t.onBeforeClose,updataCanvasCondition:t.updataCanvasCondition,close:t.onCloseConfigPanel}}),t._v(" "),n("template-setting",{attrs:{"project-info-loading":t.projectInfoLoading,"template-label-loading":t.templateLabelLoading,"template-labels":t.templateLabels,"active-tab":t.activeSettingTab,snapshoots:t.snapshoots,common:t.common},on:{"update:activeTab":function(e){t.activeSettingTab=e},"update:active-tab":function(e){t.activeSettingTab=e},templateDataChanged:t.templateDataChanged,onCitedNodeClick:t.onCitedNodeClick,modifyTemplateData:t.modifyTemplateData,createSnapshoot:t.onCreateSnapshoot,useSnapshoot:t.onUseSnapshoot,updateSnapshoot:t.onUpdateSnapshoot}})],1),t._v(" "),n("batch-update-dialog",{attrs:{show:t.isBatchUpdateDialogShow,"project-id":t.project_id,list:t.subflowShouldUpdated},on:{"update:show":function(e){t.isBatchUpdateDialogShow=e},globalVariableUpdate:t.globalVariableUpdate}}),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog",theme:"primary","mask-close":!1,"header-position":"left",title:t.$t("离开页面"),value:t.isLeaveDialogShow},on:{confirm:t.onLeaveConfirm,cancel:t.onLeaveCancel}},[n("div",{staticClass:"leave-tips"},[t._v(t._s(t.$t("系统不会保存您所做的更改，确认离开？")))])]),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"common-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.multipleTabDialogShow},on:{cancel:function(e){t.multipleTabDialogShow=!1}}},[n("div",{staticClass:"multiple-tab-dialog-content"},[n("h3",[t._v(t._s(t.$t("确定保存修改的内容？")))]),t._v(" "),n("p",[n("i",{staticClass:"bk-icon icon-exclamation-circle"},[t._v(t._s(t.$t("当前流程模板在浏览器多个标签页打开")))])]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary"},on:{click:t.onMutilpleTabConfirm}},[t._v(t._s(t.$t("确定")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:function(e){t.multipleTabDialogShow=!1}}},[t._v(t._s(t.$t("取消")))])],1)])]),t._v(" "),n("bk-dialog",{attrs:{"ext-cls":"template-edit-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.isExectueSchemeDialog},on:{cancel:function(e){t.isExectueSchemeDialog=!1}}},[n("div",{staticClass:"template-edit-dialog-content"},[n("div",{staticClass:"save-tpl-tips"},[t._v(t._s(t.tplEditDialogTip))]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary",loading:t.templateSaving||t.executeSchemeSaving},on:{click:t.onConfirmSave}},[t._v(t._s(t.$t("确定")))]),t._v(" "),n("bk-button",{attrs:{theme:"default",disabled:t.templateSaving||t.executeSchemeSaving},on:{click:t.onCancelSave}},[t._v(t._s(t.$t("取消")))])],1)])]),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"condition-edit-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.isShowDialog},on:{cancel:function(e){t.isShowDialog=!1}}},[n("div",{staticClass:"condition-edit-confirm-dialog-content"},[n("div",{staticClass:"leave-tips"},[t._v(t._s(t.$t("保存已修改的信息吗？")))]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary",loading:t.isSaveLoading},on:{click:t.onConfirmClick}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default",disabled:t.isSaveLoading},on:{click:t.onCancelClick}},[t._v(t._s(t.$t("不保存")))])],1)])])],2)])}),[],!1,null,"a9ec0658",null));e.default=Gt.exports},609:function(t,e,n){"use strict";var i,o=n(699),s=n(19),a=n(13),r=n(20),l=n(18),c=n(136),u=n(35),d=n(31),h=n(29).f,p=n(191),f=n(133),m=n(10),v=n(135),g=a.Int8Array,b=g&&g.prototype,y=a.Uint8ClampedArray,_=y&&y.prototype,w=g&&p(g),C=b&&p(b),S=Object.prototype,k=S.isPrototypeOf,x=m("toStringTag"),P=v("TYPED_ARRAY_TAG"),E=o&&!!f&&"Opera"!==c(a.opera),D=!1,j={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},O={BigInt64Array:8,BigUint64Array:8},T=function(t){if(!r(t))return!1;var e=c(t);return l(j,e)||l(O,e)};for(i in j)a[i]||(E=!1);if((!E||"function"!=typeof w||w===Function.prototype)&&(w=function(){throw TypeError("Incorrect invocation")},E))for(i in j)a[i]&&f(a[i],w);if((!E||!C||C===S)&&(C=w.prototype,E))for(i in j)a[i]&&f(a[i].prototype,C);if(E&&p(_)!==C&&f(_,C),s&&!l(C,x))for(i in D=!0,h(C,x,{get:function(){return r(this)?this[P]:void 0}}),j)a[i]&&u(a[i],P,i);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:E,TYPED_ARRAY_TAG:D&&P,aTypedArray:function(t){if(T(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(f){if(k.call(w,t))return t}else for(var e in j)if(l(j,i)){var n=a[e];if(n&&(t===n||k.call(n,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n){if(s){if(n)for(var i in j){var o=a[i];if(o&&l(o.prototype,t))try{delete o.prototype[t]}catch(t){}}C[t]&&!n||d(C,t,n?e:E&&b[t]||e)}},exportTypedArrayStaticMethod:function(t,e,n){var i,o;if(s){if(f){if(n)for(i in j)if((o=a[i])&&l(o,t))try{delete o[t]}catch(t){}if(w[t]&&!n)return;try{return d(w,t,n?e:E&&w[t]||e)}catch(t){}}for(i in j)!(o=a[i])||o[t]&&!n||d(o,t,e)}},isView:function(t){if(!r(t))return!1;var e=c(t);return"DataView"===e||l(j,e)||l(O,e)},isTypedArray:T,TypedArray:w,TypedArrayPrototype:C}},611:function(t,e,n){"use strict";var i={name:"NoData",props:{message:{type:String,default:function(){return""}}}},o=(n(634),n(9)),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"no-data-wrapper"},[n("div",{staticClass:"no-data"},[n("i",{staticClass:"common-icon-no-data"}),t._v(" "),n("p",{staticClass:"no-data-wording"},[t._t("default",(function(){return[t._v(t._s(t.message||t.$t("无数据")))]}))],2)])])}),[],!1,null,"03c0cb01",null);e.a=s.exports},625:function(t,e,n){},634:function(t,e,n){"use strict";n(625)},645:function(t,e,n){},666:function(t,e,n){"use strict";var i=n(0),o=n.n(i),s=(n(23),n(621),{name:"PageHeader",inject:["reload"],props:{selfReload:{type:Boolean,default:!1},tabList:{type:Array,default:function(){return o()(this,void 0),[]}.bind(void 0)}},methods:{tabChange:function(t){if(this.$route.name===t.routerName)return this.selfReload?this.$emit("tabChange",t):this.reload(),!1;this.$router.push({name:t.routerName,params:t.params,query:t.query})}}}),a=(n(667),n(9)),r=Object(a.a)(s,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-header"},[t._t("default",(function(){return[t.tabList.length?n("ul",{staticClass:"tab-list"},t._l(t.tabList,(function(e,i){return n("li",{key:i,class:["tab-item",{active:t.$route.name===e.routerName}],on:{click:function(n){return t.tabChange(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])})),0):t._e()]})),t._v(" "),n("div",{staticClass:"expand"},[t._t("expand")],2)],2)}),[],!1,null,"7b08c71f",null);e.a=r.exports},667:function(t,e,n){"use strict";n(645)},668:function(t,e,n){n(320)("iterator")},672:function(t,e,n){var i=n(14),o=n(321);i({target:"Array",stat:!0,forced:!n(316)((function(t){Array.from(t)}))},{from:o})},678:function(t,e,n){"use strict";var i=n(138),o=n(17),s=n(45),a=n(688),r=n(139);i("search",(function(t,e,n){return[function(e){var n=s(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,n):new RegExp(e)[t](String(n))},function(t){var i=n(e,this,t);if(i.done)return i.value;var s=o(this),l=String(t),c=s.lastIndex;a(c,0)||(s.lastIndex=0);var u=r(s,l);return a(s.lastIndex,c)||(s.lastIndex=c),null===u?-1:u.index}]}))},688:function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},689:function(t,e,n){"use strict";var i=n(13),o=n(19),s=n(699),a=n(35),r=n(192),l=n(8),c=n(132),u=n(84),d=n(30),h=n(700),p=n(797),f=n(191),m=n(133),v=n(85).f,g=n(29).f,b=n(701),y=n(72),_=n(44),w=_.get,C=_.set,S=i.ArrayBuffer,k=S,x=i.DataView,P=x&&x.prototype,E=Object.prototype,D=i.RangeError,j=p.pack,O=p.unpack,T=function(t){return[255&t]},L=function(t){return[255&t,t>>8&255]},N=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},A=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},I=function(t){return j(t,23,4)},M=function(t){return j(t,52,8)},$=function(t,e){g(t.prototype,e,{get:function(){return w(this)[e]}})},F=function(t,e,n,i){var o=h(n),s=w(t);if(o+e>s.byteLength)throw D("Wrong index");var a=w(s.buffer).bytes,r=o+s.byteOffset,l=a.slice(r,r+e);return i?l:l.reverse()},R=function(t,e,n,i,o,s){var a=h(n),r=w(t);if(a+e>r.byteLength)throw D("Wrong index");for(var l=w(r.buffer).bytes,c=a+r.byteOffset,u=i(+o),d=0;d<e;d++)l[c+d]=u[s?d:e-d-1]};if(s){if(!l((function(){S(1)}))||!l((function(){new S(-1)}))||l((function(){return new S,new S(1.5),new S(NaN),"ArrayBuffer"!=S.name}))){for(var B,V=(k=function(t){return c(this,k),new S(h(t))}).prototype=S.prototype,H=v(S),G=0;H.length>G;)(B=H[G++])in k||a(k,B,S[B]);V.constructor=k}m&&f(P)!==E&&m(P,E);var U=new x(new k(2)),Y=P.setInt8;U.setInt8(0,2147483648),U.setInt8(1,2147483649),!U.getInt8(0)&&U.getInt8(1)||r(P,{setInt8:function(t,e){Y.call(this,t,e<<24>>24)},setUint8:function(t,e){Y.call(this,t,e<<24>>24)}},{unsafe:!0})}else k=function(t){c(this,k,"ArrayBuffer");var e=h(t);C(this,{bytes:b.call(new Array(e),0),byteLength:e}),o||(this.byteLength=e)},x=function(t,e,n){c(this,x,"DataView"),c(t,k,"DataView");var i=w(t).byteLength,s=u(e);if(s<0||s>i)throw D("Wrong offset");if(s+(n=void 0===n?i-s:d(n))>i)throw D("Wrong length");C(this,{buffer:t,byteLength:n,byteOffset:s}),o||(this.buffer=t,this.byteLength=n,this.byteOffset=s)},o&&($(k,"byteLength"),$(x,"buffer"),$(x,"byteLength"),$(x,"byteOffset")),r(x.prototype,{getInt8:function(t){return F(this,1,t)[0]<<24>>24},getUint8:function(t){return F(this,1,t)[0]},getInt16:function(t){var e=F(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=F(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return A(F(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return A(F(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return O(F(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return O(F(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){R(this,1,t,T,e)},setUint8:function(t,e){R(this,1,t,T,e)},setInt16:function(t,e){R(this,2,t,L,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){R(this,2,t,L,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){R(this,4,t,N,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){R(this,4,t,N,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){R(this,4,t,I,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){R(this,8,t,M,e,arguments.length>2?arguments[2]:void 0)}});y(k,"ArrayBuffer"),y(x,"DataView"),t.exports={ArrayBuffer:k,DataView:x}},694:function(t,e,n){"use strict";var i=n(51),o=n.n(i),s=n(0),a=n.n(s),r=(n(67),n(43),n(80),n(68),n(22),n(23),n(129),n(698),n(37),n(26),n(24),n(27),n(317),n(127),n(39),n(104),n(82),n(678),n(81),n(101),n(754),n(755),n(756),n(757),n(758),n(759),n(760),n(761),n(762),n(763),n(764),n(765),n(766),n(767),n(768),n(769),n(770),n(771),n(772),n(773),n(774),n(775),n(776),n(777),n(778),n(183),n(52),n(70),n(83),n(128),n(185),function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return(i="application/font-woff",{woff:i,woff2:i,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var i},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),i=n.length,o=new Uint8Array(i),s=0;s<i;s++)o[s]=n.charCodeAt(s);e(new Blob([o],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),i=n.createElement("base");n.head.appendChild(i);var o=n.createElement("a");return n.body.appendChild(o),i.href=e,o.href=t,o.href},getAndEncode:function(t){h.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise((function(e){var n,i=new XMLHttpRequest;if(i.onreadystatechange=function(){if(4!==i.readyState)return;if(200!==i.status)return void(n?e(n):s("cannot fetch resource: "+t+", status: "+i.status));var o=new FileReader;o.onloadend=function(){var t=o.result.split(/,/)[1];e(t)},o.readAsDataURL(i.response)},i.ontimeout=function(){n?e(n):s("timeout of 30000ms occured while fetching resource: "+t)},i.responseType="blob",i.timeout=3e4,i.open("GET",t,!0),i.send(),h.impl.options.imagePlaceholder){var o=h.impl.options.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}function s(t){console.error(t),e("")}}))},uid:(t=0,function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+t++}),delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return new Promise((function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=n,i.src=t}))},width:function(t){var e=n(t,"border-left-width"),i=n(t,"border-right-width");return t.scrollWidth+e+i},height:function(t){var e=n(t,"border-top-width"),i=n(t,"border-bottom-width");return t.scrollHeight+e+i}};var t;function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function n(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}}()),l=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,o,s){return function(){return!e(t)}()?Promise.resolve(t):Promise.resolve(t).then(n).then((function(e){var n=Promise.resolve(t);return e.forEach((function(t){n=n.then((function(e){return i(e,t,o,s)}))})),n}))},shouldProcess:e,impl:{readUrls:n,inline:i}};function e(e){return-1!==e.search(t)}function n(e){for(var n,i=[];null!==(n=t.exec(e));)i.push(n[1]);return i.filter((function(t){return!r.isDataUrl(t)}))}function i(t,e,n,i){return Promise.resolve(e).then((function(t){return n?r.resolveUrl(t,n):t})).then(i||r.getAndEncode).then((function(t){return r.dataAsUrl(t,r.mimeType(e))})).then((function(n){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+r.escape(t)+")(['\"]?\\))","g")}(e),"$1"+n+"$3")}))}}(),c=function(){return{resolveAll:function(){return t(document).then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:t}};function t(){return Promise.resolve(r.asArray(document.styleSheets)).then((function(t){var e=[];return t.forEach((function(t){try{r.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return l.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return l.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),u=function(){return{inlineAll:function e(n){return n instanceof Element?function(t){var e=t.style.getPropertyValue("background");return e?l.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}(n).then((function(){return n instanceof HTMLImageElement?t(n).inline():Promise.all(r.asArray(n.childNodes).map((function(t){return e(t)})))})):Promise.resolve(n)},impl:{newImage:t}};function t(t){return{inline:function(e){return r.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||r.getAndEncode).then((function(e){return r.dataAsUrl(e,r.mimeType(t.src))})).then((function(e){return new Promise((function(n,i){t.onload=n,t.onerror=i,t.src=e}))}))}}}}(),d={imagePlaceholder:void 0,cacheBust:!1},h={toSvg:f,toPng:function(t,e){return m(t,e||{}).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return m(t,e=e||{}).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))},toBlob:function(t,e){return m(t,e||{}).then(r.canvasToBlob)},toPixelData:function(t,e){return m(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,r.width(t),r.height(t)).data}))},impl:{fontFaces:c,images:u,util:r,inliner:l,options:{}}},p=h;function f(t,e){return function(t){void 0===t.imagePlaceholder?h.impl.options.imagePlaceholder=d.imagePlaceholder:h.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?h.impl.options.cacheBust=d.cacheBust:h.impl.options.cacheBust=t.cacheBust}(e=e||{}),Promise.resolve(t).then((function(t){return function t(e,n,i){return i||!n||n(e)?Promise.resolve(e).then((function(t){return t instanceof HTMLCanvasElement?r.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(t){return o(e,t,n)})).then((function(t){return function(t,e){return e instanceof Element?Promise.resolve().then(n).then(i).then(o).then(s).then((function(){return e})):e;function n(){var n,i;n=window.getComputedStyle(t),i=e.style,n.cssText?i.cssText=n.cssText:function(t,e){r.asArray(t).forEach((function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))}))}(n,i)}function i(){[":before",":after"].forEach((function(n){!function(n){var i=window.getComputedStyle(t,n),o=i.getPropertyValue("content");if(""===o||"none"===o)return;var s=r.uid();e.className=e.className+" "+s;var a=document.createElement("style");a.appendChild(function(t,e,n){var i="."+t+":"+e,o=n.cssText?function(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}(n):function(t){return r.asArray(t).map((function(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")})).join("; ")+";"}(n);return document.createTextNode(i+"{"+o+"}")}(s,n,i)),e.appendChild(a)}(n)}))}function o(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function s(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)})))}}(e,t)})):Promise.resolve();function o(e,n,i){var o=e.childNodes;return 0===o.length?Promise.resolve(n):s(n,r.asArray(o),i).then((function(){return n}));function s(e,n,i){var o=Promise.resolve();return n.forEach((function(n){o=o.then((function(){return t(n,i)})).then((function(t){t&&e.appendChild(t)}))})),o}}}(t,e.filter,!0)})).then(v).then(g).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));e.cloneBack&&e.cloneBack.call(this,t);return t})).then((function(n){return function(t,e,n){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(r.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+n+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}(n,e.width||r.width(t),e.height||r.height(t))}))}function m(t,e){return f(t,e).then(r.makeImage).then(r.delay(100)).then((function(n){var i=function(t){var n=document.createElement("canvas");if(n.width=e.width||r.width(t),n.height=e.height||r.height(t),e.bgcolor){var i=n.getContext("2d");i.fillStyle=e.bgcolor,i.fillRect(0,0,n.width,n.height)}return n}(t);return i.getContext("2d").drawImage(n,0,0),i}))}function v(t){return c.resolveAll().then((function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t}))}function g(t){return u.inlineAll(t).then((function(){return t}))}n(38),n(49),n(668),n(187),n(734),n(184);var b=n(808);function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){y(t,e,n[e])}))}return t}var w=function(t,e,n,i,o,s,a,r,l,c){"boolean"!=typeof a&&(l=r,r=a,a=!1);var u,d="function"==typeof n?n.options:n;if(t&&t.render&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0,o&&(d.functional=!0)),i&&(d._scopeId=i),s?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},d._ssrRegister=u):e&&(u=a?function(){e.call(this,c(this.$root.$options.shadowRoot))}:function(t){e.call(this,r(t))}),u)if(d.functional){var h=d.render;d.render=function(t,e){return u.call(e),h(t,e)}}else{var p=d.beforeCreate;d.beforeCreate=p?[].concat(p,u):[u]}return n},C="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase()),S=document.head||document.getElementsByTagName("head")[0],k={},x=function(t){return function(t,e){return function(t,e){var n=C?e.media||"default":t,i=k[n]||(k[n]={ids:new Set,styles:[]});if(!i.ids.has(t)){i.ids.add(t);var o=e.source;if(e.map&&(o+="\n/*# sourceURL="+e.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",e.media&&i.element.setAttribute("media",e.media),S.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(o),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{var s=i.ids.size-1,a=document.createTextNode(o),r=i.element.childNodes;r[s]&&i.element.removeChild(r[s]),r.length?i.element.insertBefore(a,r[s]):i.element.appendChild(a)}}}(t,e)}},P=w({render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"palette-panel"},[this._t("palette",[this._m(0)])],2)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"palette-group"},[e("li",[e("div",{staticClass:"palette-default-item startpoint",attrs:{"data-type":"startpoint"}})]),e("li",[e("div",{staticClass:"palette-default-item endpoint",attrs:{"data-type":"endpoint"}})]),e("li",[e("div",{staticClass:"palette-default-item tasknode",attrs:{"data-type":"tasknode"}})]),e("li",[e("div",{staticClass:"palette-default-item gateway",attrs:{"data-type":"gateway"}})])])}]},(function(t){t&&t("data-v-09b6e314_0",{source:".palette-group{margin:0;padding:0;background:#fcfcfc;text-align:center;list-style:none}.palette-group>li{padding:14px 0}.palette-default-item{display:inline-block;width:40px;height:40px;font-size:12px;color:#888;border:1px solid #999;border-radius:2px;cursor:pointer;user-select:none}.palette-default-item:hover{box-shadow:0 0 8px rgba(50,50,50,.3)}.startpoint{border-radius:50%;border:4px solid #6a6c8a}.endpoint{border-radius:50%;background:#6a6c8a}.tasknode{height:30px;border:2px solid #33d0c6}.gateway{width:30px;height:30px;background:#7c68fc;transform:rotate(-45deg)}",map:void 0,media:void 0})}),{name:"PalettePanel",props:["selector"],data:function(){return{}}},void 0,!1,void 0,x,void 0),E=w({render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tool-panel"},t._l(t.tools,(function(e,i){return n("div",{key:i,class:["tool-item",e.cls,{actived:"frameSelect"===e.type&&t.isFrameSelecting}],on:{click:function(n){return t.onToolClick(e)}}},[t._v("\n        "+t._s(e.name)+"\n    ")])})),0)},staticRenderFns:[]},(function(t){t&&t("data-v-2c518942_0",{source:".tool-item{display:inline-block;margin-right:10px;user-select:none;cursor:pointer}.tool-item:last-child{margin-right:0}.tool-item.actived{color:#3a84ff}",map:void 0,media:void 0})}),{name:"ToolPanel",props:["tools","isFrameSelecting"],data:function(){return{}},methods:{onToolClick:function(t){this.$emit("onToolClick",t)}}},void 0,!1,void 0,x,void 0),D=w({render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bk-flow-location",on:{mousedown:this.onMouseDown,mouseup:this.onMouseUp}},["startpoint"===this.node.type?e("div",{staticClass:"circle-node startpoint"}):"endpoint"===this.node.type?e("div",{staticClass:"circle-node endpoint"}):"tasknode"===this.node.type?e("div",{staticClass:"tasknode"}):"gateway"===this.node.type?e("div",{staticClass:"gateway"}):e("div",{staticClass:"node-default"})])},staticRenderFns:[]},(function(t){t&&t("data-v-0604134d_0",{source:".bk-flow-location .circle-node{width:30px;height:30px;border-radius:50%;text-align:center}.bk-flow-location .startpoint{border:4px solid #6a6c8a}.bk-flow-location .endpoint{background:#6a6c8a}.bk-flow-location .tasknode{width:80px;height:50px;border:2px solid #33d0c6}.bk-flow-location .gateway{width:30px;height:30px;background:#7c68fc;transform:rotate(-45deg)}.bk-flow-location .node-default{width:120px;height:80px;line-height:80px;border:1px solid #ccc;border-radius:2px;text-align:center}.bk-flow-location .node-default.selected{border:1px solid #3a84ff}",map:void 0,media:void 0})}),{name:"NodeTemplate",props:{node:{type:Object,default:function(){return{}}}},data:function(){return{moveFlag:{x:0,y:0,moved:!1}}},methods:{onMouseDown:function(t){this.moveFlag={x:t.pageX,y:t.pageY,moved:!1},this.$el.addEventListener("mousemove",this.mouseMoveHandler)},onMouseUp:function(t){var e=t.pageX,n=t.pageY;this.moveFlag.x=e,this.moveFlag.y=n,this.moveFlag.moved?(console.log("drag event"),this.moveFlag.moved=!1):console.log("click event"),this.$el.removeEventListener("mousemove",this.mouseMoveHandler)},mouseMoveHandler:function(t){var e=t.pageX,n=t.pageY;(Math.abs(e-this.moveFlag.x)>2||Math.abs(n-this.moveFlag.y)>2)&&(this.moveFlag.moved=!0)}}},void 0,!1,void 0,x,void 0);function j(t){return"touches"in t?t.touches[0]:t}var O={grid:[5,5]},T={connector:["Bezier",{curviness:30}],paintStyle:{strokeWidth:2,stroke:"#567567",outlineStroke:"tranparent",outlineWidth:6},hoverPaintStyle:{fill:"transparent",stroke:"#3a84ff"}},L={endpoint:"Dot",connector:["Flowchart",{stub:[1,6],alwaysRespectStub:!0,gap:8,cornerRadius:2}],connectorOverlays:[["PlainArrow",{width:8,length:6,location:1,id:"arrow"}]],paintStyle:{fill:"#3a84ff",radius:5},anchor:["Left","Right","Top","Bottom"],isSource:!0,isTarget:!0};function N(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e="",n=0;n<7;n++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t+e}var A={showPalette:{type:Boolean,default:!0},showTool:{type:Boolean,default:!0},tools:{type:Array,default:function(){return[{type:"zoomIn",name:"放大",cls:"tool-item"},{type:"zoomOut",name:"缩小",cls:"tool-item"},{type:"resetPosition",name:"重置",cls:"tool-item"}]}},editable:{type:Boolean,default:!0},selector:{type:String,default:"palette-default-item"},data:{type:Object,default:function(){return{nodes:[],lines:[]}}},nodeOptions:{type:Object,default:function(){return _({},O)}},connectorOptions:{type:Object,default:function(){return _({},T)}},endpointOptions:{type:Object,default:function(){return _({},L)}}},I={mousedown:"ontouchstart"in document.documentElement?"touchstart":"mousedown",mousemove:"ontouchmove"in document.documentElement?"touchmove":"mousemove",mouseup:"ontouchend"in document.documentElement?"touchend":"mouseup"},M=w({render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["jsflow",{editable:t.editable}]},[n("div",{staticClass:"canvas-area"},[t.showTool?n("div",{staticClass:"tool-panel-wrap"},[t._t("toolPanel",[n("tool-panel",{attrs:{tools:t.tools,"is-frame-selecting":t.isFrameSelecting},on:{onToolClick:t.onToolClick}})])],2):t._e(),t.showPalette?n("div",{ref:"palettePanel",staticClass:"palette-panel-wrap"},[t._t("palettePanel",[n("palette-panel",{attrs:{selector:t.selector}})])],2):t._e(),n("div",{ref:"canvasFlowWrap",staticClass:"canvas-flow-wrap",style:t.canvasWrapStyle,on:t._d({},[t.mousedown,t.onCanvasMouseDown,t.mouseup,t.onCanvasMouseUp])},[n("div",{ref:"canvasFlow",staticClass:"canvas-flow",style:t.canvasStyle,attrs:{id:"canvas-flow"}},t._l(t.nodes,(function(e){return n("div",{key:e.id},[n("div",{staticClass:"jsflow-node canvas-node",attrs:{id:e.id},on:{mouseover:function(n){return t.toggleHighLight(e,!0)},mouseout:function(n){return t.toggleHighLight(e,!1)}}},[t._t("nodeTemplate",[n("node-template",{attrs:{node:e}})],{node:e})],2)])})),0),t.isFrameSelecting?n("div",{staticClass:"canvas-frame-selector",style:t.frameSelectorStyle}):t._e()]),t.showAddingNode?n("div",{staticClass:"jsflow-node adding-node",style:t.setNodeInitialPos(t.addingNodeConfig)},[t._t("nodeTemplate",[n("node-template",{attrs:{node:t.addingNodeConfig}})],{node:t.addingNodeConfig})],2):t._e()])])},staticRenderFns:[]},(function(t){t&&t("data-v-bb9dff6c_0",{source:".jsflow{height:100%;border:1px solid #ccc}.jsflow .canvas-area{position:relative;height:100%}.jsflow .tool-panel-wrap{position:absolute;top:20px;left:70px;padding:10px 20px;background:#c4c6cc;opacity:.65;border-radius:4px;z-index:4}.jsflow .palette-panel-wrap{float:left;width:60px;height:100%;border-right:1px solid #ccc}.jsflow .canvas-flow-wrap{position:relative;height:100%;overflow:hidden}.jsflow .canvas-flow{position:relative;min-width:100%;min-height:100%}.jsflow .canvas-frame-selector{position:absolute;border:1px solid #3a84ff;background:rgba(58,132,255,.15)}.jsflow .jsflow-node{position:absolute;user-select:none}.jsflow .jtk-endpoint{z-index:1;cursor:pointer}.jsflow .adding-node{opacity:.8}.jsflow .jtk-endpoint.jtk-dragging{z-index:0}.jsflow .jtk-connector{cursor:pointer}",map:void 0,media:void 0})}),{name:"JsFlow",components:{PalettePanel:P,ToolPanel:E,NodeTemplate:D},model:{prop:"data",event:"change"},props:A,data:function(){var t=this.data;return _({nodes:t.nodes,lines:t.lines,canvasGrabbing:!1,isFrameSelecting:!1,mouseDownPos:{},canvasPos:{x:0,y:0},canvasOffset:{x:0,y:0},frameSelectorPos:{x:0,y:0},frameSelectorRect:{width:0,height:0},selectedNodes:[],showAddingNode:!1,addingNodeConfig:{},addingNodeRect:{},canvasRect:{},paletteRect:{},zoom:1},I)},computed:{canvasWrapStyle:function(){return{cursor:this.isFrameSelecting?"crosshair":this.canvasGrabbing?"-webkit-grabbing":"-webkit-grab"}},canvasStyle:function(){return{left:"".concat(this.canvasOffset.x,"px"),top:"".concat(this.canvasOffset.y,"px")}},frameSelectorStyle:function(){return{left:"".concat(this.frameSelectorPos.x,"px"),top:"".concat(this.frameSelectorPos.y,"px"),width:"".concat(this.frameSelectorRect.width,"px"),height:"".concat(this.frameSelectorRect.height,"px")}}},watch:{"data.nodes":{handler:function(t){this.nodes=t},deep:!0},editable:function(t){var e=this.$el.querySelectorAll(".canvas-node");this.toggleNodeDraggable(e,t)}},mounted:function(){this.initCanvas(),this.registerEvent(),this.renderData(),this.$refs.palettePanel&&(this.paletteRect=this.$refs.palettePanel.getBoundingClientRect(),this.registerPaletteEvent())},beforeDestroy:function(){this.$refs.palettePanel&&this.$refs.palettePanel.removeEventListener(this.mousedown,this.nodeCreateHandler),this.$el.removeEventListener(this.mousemove,this.nodeMovingHandler),document.removeEventListener(this.mouseup,this.nodeMoveEndHandler)},methods:{initCanvas:function(){var t={},e=_({},this.endpointOptions,this.connectorOptions);for(var n in e){var i=n[0].toUpperCase();t["".concat(i).concat(n.slice(1))]=e[n]}this.instance=b.jsPlumb.getInstance(_({Container:"canvas-flow"},t))},registerEvent:function(){var t=this;this.instance.bind("beforeDrag",(function(e){return!!t.editable&&("function"!=typeof t.$listeners.onBeforeDrag||t.$listeners.onBeforeDrag(e))})),this.instance.bind("beforeDrop",(function(e){return!!t.editable&&("function"!=typeof t.$listeners.onBeforeDrop||t.$listeners.onBeforeDrop(e))})),this.instance.bind("connectionDrag",(function(e){"function"==typeof t.$listeners.connectionDrag&&t.$emit("connectionDrag",e)})),this.instance.bind("connection",(function(e){"function"==typeof t.$listeners.onConnection&&t.$emit("onConnection",e)})),this.instance.bind("connectionDragStop",(function(e,n){if(!e.target||!e.target.classList.contains("jsflow-node")){var i=t.getNodeWithEndpoint(n.target);if(i){var o=t.nodes.find((function(t){return i.id===t.id}));if("function"==typeof t.$listeners.onConnectionDragStop){var s={id:e.source.id,arrow:e.endpoints[0].anchor.type};t.$emit("onConnectionDragStop",s,o.id,n)}}}})),this.instance.bind("beforeDetach",(function(e){return"function"!=typeof t.$listeners.onBeforeDetach||t.$listeners.onBeforeDetach(e)})),this.instance.bind("connectionDetached",(function(e,n){var i=t.lines.filter((function(t){return t.source.id!==e.sourceId&&t.target.id!==e.targetId}));t.lines=i,"function"==typeof t.$listeners.onConnectionDetached&&t.$emit("onConnectionDetached",e)})),this.instance.bind("connectionMoved",(function(e,n){"function"==typeof t.$listeners.onConnectionMoved&&t.$emit("onConnectionMoved",lines)})),this.instance.bind("click",(function(e,n){"function"==typeof t.$listeners.onConnectionClick&&t.$emit("onConnectionClick",e,n)})),this.instance.bind("dblclick",(function(e,n){"function"==typeof t.$listeners.onConnectionDbClick&&t.$emit("onConnectionDbClick",e,n)})),this.instance.bind("endpointClick",(function(e,n){"function"==typeof t.$listeners.onEndpointClick&&t.$emit("onEndpointClick",e,n)})),this.instance.bind("endpointDblClick",(function(e,n){"function"==typeof t.$listeners.onEndpointDbClick&&t.$emit("onEndpointDbClick",e,n)}))},renderData:function(){var t=this;this.instance.batch((function(){t.nodes.forEach((function(e){t.initNode(e)})),t.lines.forEach((function(e){t.createConnector(e,t.connectorOptions)}))}))},updateCanvas:function(t){this.removeAllConnector(),this.lines=t.lines,this.nodes=t.nodes,this.renderData()},createNode:function(t){var e=this;("function"!=typeof this.$listeners.onCreateNodeBefore||this.$listeners.onCreateNodeBefore(t))&&(this.nodes.push(t),this.$nextTick((function(){e.initNode(t)})))},initNode:function(t){var e=document.getElementById(t.id);e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px"),this.setNodeDraggable(t,this.nodeOptions),this.setNodeEndPoint(t,this.endpointOptions),"function"==typeof this.$listeners.onCreateNodeAfter&&this.$emit("onCreateNodeAfter",t)},removeNode:function(t){var e=this.nodes.findIndex((function(e){return e.id===t.id}));this.nodes.splice(e,1),this.instance.remove(t.id)},setNodeEndPoint:function(t,e){var n=this;(t.endpoints||["Top","Right","Bottom","Left"]).forEach((function(i){n.instance.addEndpoint(t.id,_({anchor:i,uuid:i+t.id},e))}))},setNodeDraggable:function(t,e){if(this.editable){var n=this;this.instance.draggable(t.id,_({grid:[20,20],drag:function(e){var i=n.nodes.find((function(e){return t.id===e.id})),o=Object.assign({},i);n.$emit("onNodeMoving",o,e)},stop:function(e){var i=-1,o=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,s=t}finally{try{i||null==r.return||r.return()}finally{if(o)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(e.pos,2),s=o[0],a=o[1],r=n.nodes.find((function(e,n){if(e.id===t.id)return i=n,!0})),l=Object.assign({},r,{x:s,y:a});n.nodes.splice(i,1,l),n.$emit("onNodeMoveStop",l,e)}},e))}},setNodePosition:function(t){var e=document.getElementById(t.id);e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px"),this.instance.revalidate(e)},toggleNodeDraggable:function(t,e){this.instance.setDraggable(t,e)},setNodeInitialPos:function(t){return{left:"".concat(t.x,"px"),top:"".concat(t.y,"px"),visibility:t.visible?"initial":"hidden"}},createConnector:function(t,e){var n=t.options||{};return this.instance.connect({source:t.source.id,target:t.target.id,uuids:[t.source.arrow+t.source.id,t.target.arrow+t.target.id]},_({},e,n))},setConnector:function(t,e,n){var i=this;this.instance.getAllConnections().filter((function(n){return n.sourceId===t&&n.targetId===e})).forEach((function(t){t.setConnector(n),i.endpointOptions&&i.endpointOptions.connectorOverlays&&i.endpointOptions.connectorOverlays.forEach((function(e){t.addOverlay(e)}))}))},removeConnector:function(t){var e=this;this.instance.getConnections({source:t.source.id,target:t.target.id}).forEach((function(t){e.instance.deleteConnection(t)}))},removeAllConnector:function(){this.instance.deleteEveryConnection(),this.lines=[]},getConnectorsByNodeId:function(t){return this.instance.getAllConnections().filter((function(e){return e.sourceId===t||e.targetId===t}))},getNodeWithEndpoint:function(t){var e=t.parentNode;return!(!e||"HTML"===e.nodeName)&&(e.classList.contains("jsflow-node")?e:this.getNodeWithEndpoint(e))},addLineOverlay:function(t,e){var n=this;this.instance.getConnections({source:t.source.id,target:t.target.id}).forEach((function(t){t.addOverlay([e.type,{label:e.name,location:e.location,cssClass:e.cls,id:e.id,events:{click:function(t,e){n.$emit("onOverlayClick",t,e)}}}])}))},removeLineOverlay:function(t,e){this.instance.getConnections({source:t.source.id,target:t.target.id}).forEach((function(t){t.removeOverlay(e)}))},onCanvasMouseDown:function(t){t=j(t),this.isFrameSelecting?this.frameSelectHandler(t):(this.canvasGrabbing=!0,this.mouseDownPos={x:t.pageX,y:t.pageY},this.$refs.canvasFlowWrap.addEventListener(this.mousemove,this.canvasFlowMoveHandler,!1))},canvasFlowMoveHandler:function(t){t=j(t),this.canvasOffset={x:this.canvasPos.x+t.pageX-this.mouseDownPos.x,y:this.canvasPos.y+t.pageY-this.mouseDownPos.y}},onCanvasMouseUp:function(t){this.isFrameSelecting?this.frameSelectEndHandler(t):(this.canvasGrabbing=!1,this.$refs.canvasFlowWrap.removeEventListener(this.mousemove,this.canvasFlowMoveHandler),this.canvasPos={x:this.canvasOffset.x,y:this.canvasOffset.y})},registerPaletteEvent:function(){this.$refs.palettePanel.addEventListener(this.mousedown,this.nodeCreateHandler,!1)},nodeCreateHandler:function(t){var e=this,n=function t(e,n){return 1===e.nodeType&&e.classList.contains(n)?e:"HTML"!==e.parentNode.nodeName?t(e.parentNode,n):null}(t.target,this.selector);if(n){var i=n.dataset.type?n.dataset.type:"",o={};for(var s in n.dataset){var a=s.match(/(config)(\w*)/);if(a&&""!==a[2]){var r=a[2],l=r[0].toLowerCase()+r.slice(1);o[l]=n.dataset[s]}}this.showAddingNode=!0,this.addingNodeConfig.id=N("node"),this.addingNodeConfig.type=i,this.$nextTick((function(){var n=e.$el.querySelector(".adding-node");e.addingNodeRect=n.getBoundingClientRect();var s=e.getAddingNodePos(t);e.addingNodeConfig=_({id:N("node"),type:i,x:s.x,y:s.y,adding:!0,visible:!1},o),e.$el.addEventListener(e.mousemove,e.nodeMovingHandler,!1),document.addEventListener(e.mouseup,e.nodeMoveEndHandler,!1)}))}},nodeMovingHandler:function(t){var e=this.getAddingNodePos(t);this.$set(this.addingNodeConfig,"x",e.x),this.$set(this.addingNodeConfig,"y",e.y),this.$set(this.addingNodeConfig,"visible",!0)},nodeMoveEndHandler:function(t){if(this.$el.removeEventListener(this.mousemove,this.nodeMovingHandler),document.removeEventListener(this.mouseup,this.nodeMoveEndHandler),this.showAddingNode=!1,t.pageX>this.paletteRect.left+this.paletteRect.width){var e=this.addingNodeConfig.x-this.paletteRect.width-this.canvasOffset.x,n=this.addingNodeConfig.y-this.canvasOffset.y;this.$set(this.addingNodeConfig,"x",e),this.$set(this.addingNodeConfig,"y",n),delete this.addingNodeConfig.adding,delete this.addingNodeConfig.visible,this.createNode(this.addingNodeConfig)}this.addingNodeConfig={},this.addingNodeRect={}},getAddingNodePos:function(t){return{x:t.pageX-this.paletteRect.left-this.addingNodeRect.width/2,y:t.pageY-this.paletteRect.top-this.addingNodeRect.height/2}},toggleHighLight:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.editable){this.instance.getEndpoints(t.id);var i=document.getElementById(t.id);this.instance.selectEndpoints({source:i}).each((function(t){var i=n?e.endpointOptions.hoverPaintStyle:e.endpointOptions.paintStyle;i&&t.setStyle(i)}))}},onToolClick:function(t){"function"==typeof this[t.type]&&this[t.type](),this.$emit("onToolClick",t)},setZoom:function(t,e,n){this.instance.setContainer("canvas-flow"),this.$refs.canvasFlow.style.transform="matrix("+t+",0,0,"+t+","+e+","+n+")",this.$refs.canvasFlow.style.transformOrigin="0 0",this.$refs.canvasFlow.zoom=t,this.zoom=t,this.instance.setZoom(t)},zoomIn:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.zoom*t,o=e-e*i,s=n-n*i;i>2||this.setZoom(i,o,s)},zoomOut:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.zoom*t,o=e-e*i,s=n-n*i;i<.1||this.setZoom(i,o,s)},resetPosition:function(){this.setZoom(1,0,0),this.setCanvasPosition(0,0)},setCanvasPosition:function(t,e){this.canvasOffset={x:t,y:e},this.canvasPos={x:t,y:e}},frameSelect:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isFrameSelecting=t},onOpenFrameSelect:function(){this.frameSelect()},onCloseFrameSelect:function(){this.frameSelect(!1)},frameSelectHandler:function(t){this.canvasRect=this.$refs.canvasFlowWrap.getBoundingClientRect(),this.mouseDownPos={x:t.clientX-this.canvasRect.left,y:t.clientY-this.canvasRect.top},this.$refs.canvasFlowWrap.addEventListener(this.mousemove,this.frameSelectMovingHandler,!1)},frameSelectMovingHandler:function(t){var e=t.clientX-this.mouseDownPos.x-this.canvasRect.left,n=t.clientY-this.mouseDownPos.y-this.canvasRect.top;this.frameSelectorRect={width:Math.abs(e),height:Math.abs(n)},this.frameSelectorPos={x:e>0?this.mouseDownPos.x:this.mouseDownPos.x+e,y:n>0?this.mouseDownPos.y:this.mouseDownPos.y+n}},frameSelectEndHandler:function(t){this.$refs.canvasFlowWrap.removeEventListener(this.mousemove,this.frameSelectMovingHandler),this.$refs.canvasFlowWrap.removeEventListener(this.mouseup,this.frameSelectEndHandler),document.addEventListener(this.mousedown,this.cancelFrameSelectorHandler,{capture:!1,once:!0});var e=this.getSelectedNodes(),n=e.map((function(t){return t.id})),i=this.mouseDownPos,o=i.x,s=i.y;this.isFrameSelecting=!1,this.frameSelectorPos={x:0,y:0},this.frameSelectorRect={width:0,height:0},this.selectedNodes=e,this.clearNodesDragSelection(),this.addNodesToDragSelection(n),this.$emit("onFrameSelectEnd",e.slice(0),o,s)},getSelectedNodes:function(){var t=this,e=this.frameSelectorPos,n=e.x,i=e.y,o=this.frameSelectorRect,s=o.width,a=o.height;return this.nodes.filter((function(e){var o=document.querySelector("#".concat(e.id)).getBoundingClientRect(),r=o.left-t.canvasRect.left,l=o.top-t.canvasRect.top;if(n<r&&n+s>r&&i<l&&i+a>l)return!0}))},cancelFrameSelectorHandler:function(t){this.selectedNodes=[],this.clearNodesDragSelection(),this.$emit("onCloseFrameSelect")},addNodesToDragSelection:function(t){t.forEach((function(t){var e=document.querySelector("#".concat(t));e&&e.classList.add("selected")})),this.instance.addToDragSelection(t)},clearNodesDragSelection:function(){document.querySelectorAll(".jsflow-node.selected").forEach((function(t){t.classList.remove("selected")})),this.instance.clearDragSelection()}}},void 0,!1,void 0,x,void 0);"undefined"!=typeof window&&"Vue"in window&&window.Vue.component("js-flow",M);var $=M,F=n(46),R={name:"StartPoint",props:{node:{type:Object,default:function(){return{}}}}},B=n(9),V=Object(B.a)(R,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["circle-node","start-point",this.node.status?this.node.status.toLowerCase():""]},[e("div",{staticClass:"circle-node-text"},[this._v("\n        "+this._s(this.$t("开始"))+"\n    ")])])}),[],!1,null,null,null).exports,H={name:"EndPoint",props:{node:{type:Object,default:function(){return{}}}}},G=Object(B.a)(H,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["circle-node","end-point",this.node.status?this.node.status.toLowerCase():""]},[e("div",{staticClass:"circle-node-text"},[this._v("\n        "+this._s(this.$t("结束"))+"\n    ")])])}),[],!1,null,null,null).exports,U=n(1),Y=n(6),z={name:"TaskNode",props:{hasAdminPerm:{type:Boolean,default:!1},node:{type:Object,default:function(){return{}}}},data:function(){return{phaseStr:{1:U.a.t("当前插件即将停止维护，请更新插件版本"),2:U.a.t("当前插件已停止维护，请更新插件版本")}}},computed:{isOpenTooltip:function(){return"execute"===this.node.mode&&("RUNNING"===this.node.status?["sleep_timer","pause_node"].indexOf(this.node.code)>-1:"FAILED"===this.node.status)},isShowSkipBtn:function(){return!("FAILED"!==this.node.status||!this.node.skippable&&!this.node.errorIgnorable)},isShowRetryBtn:function(){return!("FAILED"!==this.node.status||!this.node.retryable&&!this.node.errorIgnorable)}},methods:{getIconCls:function(t){var e=this,n=t.code,i=t.group;if(Y.a[n])return Y.a[n];var o=Y.j.find(function(t){return a()(this,e),new RegExp(t).test(i)}.bind(this));return o?"common-icon-sys-".concat(o.toLowerCase()):"common-icon-sys-default"},onRetryClick:function(){this.$emit("onRetryClick",this.node.id)},onSkipClick:function(){this.$emit("onSkipClick",this.node.id)},onResumeClick:function(){this.$emit("onTaskNodeResumeClick",this.node.id)},onModifyTimeClick:function(){this.$emit("onModifyTimeClick",this.node.id)},onNodeCheckClick:function(){this.node.checkDisable||this.$emit("onNodeCheckClick",this.node.id,!this.node.checked)},mandatoryFailure:function(){this.$emit("onForceFail",this.node.id)}}},W=(n(809),Object(B.a)(z,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["execute"===t.node.mode?"default":"","task-node","process-node",t.node.status?t.node.status.toLowerCase():"",{actived:t.node.isActived}]},[n("div",{staticClass:"node-status-block"},[t.node.icon?n("img",{staticClass:"node-icon",attrs:{src:t.node.icon}}):n("i",{class:["node-icon-font",t.getIconCls(t.node)]}),t._v(" "),t.node.stage_name?n("div",{staticClass:"stage-name"},[t._v(t._s(t.node.stage_name))]):t._e()]),t._v(" "),n("div",{staticClass:"node-name"},[n("div",{staticClass:"name-text"},[t._v(t._s(t.node.name))])]),t._v(" "),n("div",{staticClass:"node-options-icon"},[t.node.optional?["edit"===t.node.mode?n("span",{staticClass:"dark-circle common-icon-dark-circle-checkbox"}):"select"===t.node.mode?n("bk-checkbox",{attrs:{value:t.node.checked,disabled:t.node.checkDisable},on:{change:t.onNodeCheckClick}}):t._e()]:t._e(),t._v(" "),t.node.error_ignorable&&"edit"===t.node.mode?n("span",{staticClass:"dark-circle common-icon-dark-circle-i"}):t._e(),t._v(" "),t.node.isSkipped||t.node.skippable?n("span",{staticClass:"dark-circle common-icon-dark-circle-s"}):t._e(),t._v(" "),t.node.can_retry||t.node.retryable?n("span",{staticClass:"dark-circle common-icon-dark-circle-r"}):t._e()],2),t._v(" "),"RUNNING"===t.node.status?n("div",{staticClass:"task-status-icon"},[n("i",{staticClass:"common-icon-loading"})]):"FINISHED"===t.node.status&&(t.node.retry>0||t.node.skip)?n("div",{staticClass:"task-status-icon"},[t.node.skip?n("i",{staticClass:"bk-icon icon-arrows-right-shape"}):t.node.retry>0?n("span",{staticClass:"retry-times"},[t._v(t._s(t.node.retry>99?"100+":t.node.retry))]):t._e()]):"FINISHED"===t.node.status&&t.node.error_ignorable?n("div",{staticClass:"task-status-icon node-subscript"},[n("i",{staticClass:"bk-icon icon-arrows-right-shape"})]):t._e(),t._v(" "),[1,2].includes(t.node.phase)?n("div",{staticClass:"node-phase-icon"},[n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.phaseStr[t.node.phase],width:210},expression:"{\n                content: phaseStr[node.phase],\n                width: 210\n            }"}],class:["bk-icon","icon-exclamation-circle",{"phase-warn":1===t.node.phase,"phase-error":2===t.node.phase}]})]):t._e(),t._v(" "),"execute"===t.node.mode?n("div",{staticClass:"state-icon"},[t.isShowRetryBtn?n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("重试")}},[n("span",{staticClass:"common-icon-retry",on:{click:function(e){return e.stopPropagation(),t.onRetryClick.apply(null,arguments)}}})]):t._e(),t._v(" "),t.isShowSkipBtn?n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("跳过")}},[n("span",{staticClass:"common-icon-skip",on:{click:function(e){return e.stopPropagation(),t.onSkipClick.apply(null,arguments)}}})]):t._e(),t._v(" "),"FAILED"!==t.node.status||t.isShowSkipBtn||t.isShowRetryBtn?t._e():n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("流程模板中该标准插件节点未配置失败处理方式，不可操作")}},[n("span",{staticClass:"common-icon-mandatory-failure"})]),t._v(" "),"RUNNING"===t.node.status?["sleep_timer"===t.node.code?n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("修改时间")}},[n("span",{staticClass:"common-icon-clock",on:{click:function(e){return e.stopPropagation(),t.onModifyTimeClick.apply(null,arguments)}}})]):t._e(),t._v(" "),"pause_node"===t.node.code?n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("继续执行")}},[n("span",{staticClass:"common-icon-play",on:{click:function(e){return e.stopPropagation(),t.onResumeClick.apply(null,arguments)}}})]):t._e(),t._v(" "),n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("强制失败")}},[n("span",{staticClass:"common-icon-mandatory-failure",on:{click:function(e){return e.stopPropagation(),t.mandatoryFailure.apply(null,arguments)}}})])]:t._e()],2):t._e()])}),[],!1,null,null,null).exports),X={name:"Subflow",props:{hasAdminPerm:{type:Boolean,default:!1},node:{type:Object,default:function(){return{}}}},computed:{isOpenTooltip:function(){return["RUNNING","SUSPENDED"].indexOf(this.node.status)>-1}},methods:{onSubflowPauseResumeClick:function(t){this.$emit("onSubflowPauseResumeClick",this.node.id,t)},onNodeCheckClick:function(){this.node.checkDisable||this.$emit("onNodeCheckClick",this.node.id,!this.node.checked)}}},q=(n(810),Object(B.a)(X,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-tooltip",{attrs:{placement:"bottom","popper-class":"task-node-tooltip",disabled:!t.isOpenTooltip}},[n("div",{class:["task-node","subflow-node",t.node.status?t.node.status.toLowerCase():"",{actived:t.node.isActived}]},[n("div",{staticClass:"node-status-block"},[n("i",{staticClass:"node-icon-font common-icon-subflow-mark"}),t._v(" "),t.node.stage_name?n("div",{staticClass:"stage-name"},[t._v(t._s(t.node.stage_name))]):t._e()]),t._v(" "),n("div",{staticClass:"node-name",attrs:{title:t.node.name}},[n("div",{staticClass:"name-text"},[t._v(t._s(t.node.name))]),t._v(" "),n("div",{staticClass:"subflow-mark"})]),t._v(" "),n("div",{staticClass:"node-options-icon"},[t.node.optional?["edit"===t.node.mode?n("span",{staticClass:"dark-circle common-icon-dark-circle-checkbox"}):"select"===t.node.mode?n("bk-checkbox",{attrs:{value:t.node.checked,disabled:t.node.checkDisable},on:{change:t.onNodeCheckClick}}):t._e()]:t._e()],2),t._v(" "),t.node.hasUpdated?n("div",{staticClass:"updated-dot"},[n("div",{staticClass:"ripple"})]):t._e(),t._v(" "),"SUSPENDED"===t.node.status||"RUNNING"===t.node.status?n("div",{staticClass:"task-status-icon subflow-status"},["SUSPENDED"===t.node.status?n("i",{staticClass:"common-icon-double-vertical-line"}):t._e(),t._v(" "),"RUNNING"===t.node.status?n("i",{staticClass:"common-icon-loading"}):t._e()]):t._e()]),t._v(" "),n("div",{staticClass:"node-tooltip-content",attrs:{slot:"content"},slot:"content"},["RUNNING"===t.node.status?[n("bk-button",{on:{click:function(e){return t.onSubflowPauseResumeClick("pause")}}},[t._v(t._s(t.$t("暂停")))]),t._v(" "),t.hasAdminPerm?n("bk-button",{on:{click:function(e){return t.$emit("onForceFail",t.node.id)}}},[t._v(t._s(t.$t("强制失败")))]):t._e()]:t._e(),t._v(" "),"SUSPENDED"===t.node.status?n("bk-button",{on:{click:function(e){return t.onSubflowPauseResumeClick("resume")}}},[t._v(t._s(t.$t("继续")))]):t._e()],2)])}),[],!1,null,"833389fe",null).exports),K={name:"BranchGateway",props:{node:{type:Object,default:function(){return{}}}},computed:{isOpenTooltip:function(){return"FAILED"===this.node.status}},methods:{onGatewaySelectionClick:function(){this.$emit("onGatewaySelectionClick",this.node.id)}}},Z=Object(B.a)(K,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["gateway-node","branch-gateway",t.node.status?t.node.status.toLowerCase():""]},[n("div",{staticClass:"node-type-icon common-icon-node-branchgateway"}),t._v(" "),t.isOpenTooltip?n("div",{staticClass:"state-icon"},[n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("跳过")}},[n("span",{staticClass:"common-icon-skip",on:{click:function(e){return e.stopPropagation(),t.onGatewaySelectionClick.apply(null,arguments)}}})])],1):t._e()])}),[],!1,null,null,null).exports,J={name:"ParallelGateway",props:{node:{type:Object,default:function(){return{}}}}},Q=Object(B.a)(J,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["gateway-node","parallel-gateway",this.node.status?this.node.status.toLowerCase():""]},[e("div",{staticClass:"node-type-icon common-icon-node-parallelgateway"})])}),[],!1,null,null,null).exports,tt={name:"ConditionalParallelGateway",props:{node:{type:Object,default:function(){return{}}}},computed:{isOpenTooltip:function(){return"FAILED"===this.node.status}},methods:{onGatewaySelectionClick:function(){this.$emit("onGatewaySelectionClick",this.node.id)}}},et=Object(B.a)(tt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["gateway-node","branch-gateway",t.node.status?t.node.status.toLowerCase():""]},[n("div",{staticClass:"node-type-icon common-icon-node-conditionalparallelgateway"}),t._v(" "),t.isOpenTooltip?n("div",{staticClass:"state-icon"},[n("el-tooltip",{attrs:{placement:"bottom",content:t.$t("跳过")}},[n("span",{staticClass:"common-icon-skip",on:{click:function(e){return e.stopPropagation(),t.onGatewaySelectionClick.apply(null,arguments)}}})])],1):t._e()])}),[],!1,null,null,null).exports,nt={name:"ConvergeGateway",props:{node:{type:Object,default:function(){return{}}}}},it=Object(B.a)(nt,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["gateway-node","converge-gateway",this.node.status?this.node.status.toLowerCase():""]},[e("div",{staticClass:"node-type-icon common-icon-node-convergegateway"})])}),[],!1,null,null,null).exports,ot=n(28),st={name:"ShortcutPanel",props:{canvasData:{type:Object,default:function(){return{}}},node:{type:Object,default:function(){return{}}},editable:{type:Boolean,default:!0},idOfNodeShortcutPanel:{type:String,default:""}},data:function(){return{nodeTypeList:[{key:"tasknode",tips:U.a.t("标准插件节点")},{key:"subflow",tips:U.a.t("子流程节点")},{key:"parallelgateway",tips:U.a.t("并行网关")},{key:"branchgateway",tips:U.a.t("分支网关")},{key:"convergegateway",tips:U.a.t("汇聚网关")}]}},computed:{currentLocation:function(){var t=this;return this.canvasData.locations.find(function(e){return a()(this,t),e.id===this.idOfNodeShortcutPanel}.bind(this))||{}},isShowConfigIcon:function(){return-1!==["tasknode","subflow"].indexOf(this.currentLocation.type)},shortcutPanelTop:function(){return this.isGatewayNode(this.node.type)?"46px":"startpoint"===this.node.type?"52px":"64px"}},methods:{onConfigBtnClick:function(){this.$emit("onConfigBtnClick",this.idOfNodeShortcutPanel)},onAppendNode:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.currentLocation,o=i.x,s=i.y,r=i.id,l=i.type,c=o+200,u="node"+Object(F.b)(),d={};n?((d=ot.a.deepClone(this.node)).oldSouceId=r,d.id=u,d.x=c):d={type:t,y:s,x:c,mode:"edit",id:u};var h={source:{arrow:"Right",id:r},target:{id:u,arrow:"Left"}},p="",f=this.canvasData.lines.some(function(t){if(a()(this,e),t.source.id===r)return p=t.target.id,!0}.bind(this)),m=this.isGatewayNode(l),v=this.isGatewayNode(t);if("startpoint"===l?d.y+=v?5:-5:(m&&!v&&(d.y-=10),!m&&v&&(d.y+=10)),f&&["tasknode","subflow","convergegateway","startpoint"].indexOf(l)>-1)this.$emit("onInsertNode",{startNodeId:r,endNodeId:p,location:d,isFillParam:n});else{if(["parallelgateway","branchgateway"].indexOf(l)>-1&&f){var g=this.getParallelNodeMinDistance(r),b=g.x,y=g.y;d.y=y+100,d.x=b}this.$emit("onAppendNode",{location:d,line:h,isFillParam:n})}},isGatewayNode:function(t){return["parallelgateway","branchgateway","convergegateway"].indexOf(t)>-1},isHaveNodeBehind:function(t){var e=this;return this.canvasData.lines.some(function(n){return a()(this,e),n.source.id===t}.bind(this))},getParallelNodeMinDistance:function(t){var e=this,n=this.canvasData,i=n.lines,o=n.locations,s=o.find(function(n){return a()(this,e),n.id===t}.bind(this)).y,r=i.filter(function(n){return a()(this,e),n.source.id===t}.bind(this)).map(function(t){return a()(this,e),t.target.id}.bind(this)),l=null,c=null;return o.forEach(function(t,n){a()(this,e),r.indexOf(t.id)>-1&&(null===l||r.indexOf(t.id)&&t.y-s>l)&&(l=t.y-s,c=t)}.bind(this)),c},onCopyBtnClick:function(){this.onAppendNode(this.node.type,!0),this.$bkMessage({message:U.a.t("复制成功"),theme:"success"})}}},at=(n(811),{name:"NodeTemplate",components:{ShortcutPanel:Object(B.a)(st,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.idOfNodeShortcutPanel===t.node.id?n("div",{ref:"shortcutWrap",staticClass:"shortcut-panel",style:{top:t.shortcutPanelTop},on:{mouseover:function(t){t.stopPropagation()}}},[n("ul",{staticClass:"nodes-wrap"},t._l(t.nodeTypeList,(function(e,i){return n("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:e.tips,delay:500},expression:"{\n                content: item.tips,\n                delay: 500\n            }"}],key:i,class:["nodes-item","common-icon-node-"+e.key+"-shortcut"],on:{click:function(n){return n.stopPropagation(),t.onAppendNode(e.key)}}})})),0),t._v(" "),t.isShowConfigIcon?n("ul",{staticClass:"operate-btns"},[n("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("节点配置"),delay:500},expression:"{\n                content: $t('节点配置'),\n                delay: 500\n            }"}],staticClass:"btn-item common-icon-bkflow-setting",on:{click:function(e){return e.stopPropagation(),t.onConfigBtnClick.apply(null,arguments)}}}),t._v(" "),n("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("复制节点"),delay:500},expression:"{\n                content: $t('复制节点'),\n                delay: 500\n            }"}],staticClass:"btn-item common-icon-bkflow-copy",on:{click:function(e){return e.stopPropagation(),t.onCopyBtnClick.apply(null,arguments)}}})]):t._e()]):t._e()}),[],!1,null,null,null).exports},props:{node:{type:Object,default:function(){return{}}},editable:{type:Boolean,default:!0},idOfNodeShortcutPanel:{type:String,default:""},hasAdminPerm:{type:Boolean,default:!1},canvasData:{type:Object,default:function(){return{}}}},data:function(){return{moveFlag:{x:0,y:0},components:{startpoint:V,endpoint:G,tasknode:W,subflow:q,branchgateway:Z,parallelgateway:Q,conditionalparallelgateway:et,convergegateway:it},clickTimer:null}},computed:{nodeTemplate:function(){return this.components[this.node.type.toLowerCase()]}},methods:{onMousedown:function(t){var e=t.pageX,n=t.pageY;this.moveFlag={x:e,y:n},this.$emit("onNodeMousedown",this.node.id)},onNodeDblclick:function(){clearTimeout(this.clickTimer),this.$emit("onNodeDblclick",this.node.id)},onNodeClick:function(t){var e=this;(t.ctrlKey||t.metaKey)&&this.editable?this.$emit("addNodesToDragSelection",this.node):(clearTimeout(this.clickTimer),this.clickTimer=setTimeout(function(){a()(this,e);var n=t.pageX,i=t.pageY;Math.abs(n-this.moveFlag.x)<2&&Math.abs(i-this.moveFlag.y)<2&&this.$emit("onNodeClick",this.node.id,this.node.type,t)}.bind(this),200))},onNodeCheckClick:function(t,e){this.$emit("onNodeCheckClick",t,e)},onNodeRemove:function(){this.$emit("onNodeRemove",this.node)},onRetryClick:function(t){this.$emit("onRetryClick",t)},onForceFail:function(t){this.$emit("onForceFail",t)},onSkipClick:function(t){this.$emit("onSkipClick",t)},onModifyTimeClick:function(t){this.$emit("onModifyTimeClick",t)},onGatewaySelectionClick:function(t){this.$emit("onGatewaySelectionClick",t)},onTaskNodeResumeClick:function(t){this.$emit("onTaskNodeResumeClick",t)},onSubflowPauseResumeClick:function(t,e){this.$emit("onSubflowPauseResumeClick",t,e)},onAppendNode:function(t){this.$emit("onAppendNode",t)},onConfigBtnClick:function(t){this.$emit("onConfigBtnClick",t)},onInsertNode:function(t){this.$emit("onInsertNode",t)}}}),rt=(n(812),n(813),Object(B.a)(at,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"canvas-node-item",on:{mousedown:t.onMousedown,click:t.onNodeClick,dblclick:t.onNodeDblclick}},[n("div",{staticClass:"canvas-node-content"},[n(t.nodeTemplate,{tag:"component",attrs:{node:t.node,"has-admin-perm":t.hasAdminPerm},on:{onNodeCheckClick:t.onNodeCheckClick,onRetryClick:t.onRetryClick,onSkipClick:t.onSkipClick,onModifyTimeClick:t.onModifyTimeClick,onGatewaySelectionClick:t.onGatewaySelectionClick,onTaskNodeResumeClick:t.onTaskNodeResumeClick,onForceFail:t.onForceFail,onSubflowPauseResumeClick:t.onSubflowPauseResumeClick}}),t._v(" "),t.editable?n("i",{staticClass:"common-icon-dark-circle-close close-icon",on:{click:function(e){return e.stopPropagation(),t.onNodeRemove.apply(null,arguments)}}}):t._e()],1),t._v(" "),n("ShortcutPanel",{attrs:{node:t.node,"id-of-node-shortcut-panel":t.idOfNodeShortcutPanel,"canvas-data":t.canvasData},on:{onAppendNode:t.onAppendNode,onInsertNode:t.onInsertNode,onConfigBtnClick:t.onConfigBtnClick}})],1)}),[],!1,null,null,null).exports),lt=(n(50),n(5)),ct=n.n(lt),ut=n(7),dt=n(611),ht={name:"NodeItem",props:{type:{type:String,default:""},node:{type:Object,default:function(){return{}}}}},pt=Object(B.a)(ht,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"entry-item",attrs:{"data-config-atom-id":"tasknode"===t.type?t.node.code:t.node.template_id,"data-config-name":t.node.name.replace(/\s/g,""),"data-config-group":t.node.group_name,"data-config-icon":t.node.group_icon,"data-type":t.type}},[n("div",{staticClass:"name-wrapper"},[t._v(t._s(t.node.name))])])}),[],!1,null,null,null).exports,ft=n(690),mt=n(102);function vt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vt(Object(n),!0).forEach((function(e){ct()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var bt={name:"NodeMenu",components:{NoData:dt.a,NodeItem:pt},mixins:[mt.a],props:{templateLabels:Array,loading:Boolean,showNodeMenu:{type:Boolean,default:!1},activeNodeListType:{type:String,default:""},isFixedNodeMenu:{type:Boolean,default:!1},nodes:{type:Array,default:function(){return[]}},common:{type:[String,Number],default:""}},data:function(){return{isPinActived:!1,selectedGroup:"subflow"===this.activeNodeListType?[]:"",searchStr:"",searchResult:[],isShowGroup:!0,defaultTypeIcon:n(814)}},computed:gt(gt({},Object(ut.e)("project",{projectId:function(t){return a()(this,void 0),t.project_id}.bind(void 0),projectName:function(t){return a()(this,void 0),t.projectName}.bind(void 0)})),{},{isSearchMode:function(){return"tasknode"===this.activeNodeListType?""!==this.searchStr||""!==this.selectedGroup:""!==this.searchStr||this.selectedGroup.length>0},listInPanel:function(){return this.isSearchMode?this.searchResult:this.nodes},groupList:function(){var t=this;return"tasknode"===this.activeNodeListType?this.nodes.map(function(e){return a()(this,t),{type:e.type,group_name:e.group_name}}.bind(this)):this.templateLabels}}),watch:{activeNodeListType:function(t){this.searchStr="",this.searchResult=[],this.selectedGroup="subflow"===t?[]:""}},created:function(){this.onSearchInput=ot.a.debounce(this.searchInputhandler,500)},methods:{getIconCls:function(t){var e=this,n=Y.j.find(function(n){return a()(this,e),new RegExp(n).test(t)}.bind(this));return"subflow"===this.activeNodeListType?"common-icon-subflow-mark":n?"common-icon-sys-".concat(n.toLowerCase()):"common-icon-sys-default"},onClickPin:function(){this.$emit("onToggleNodeMenuFixed",!this.isFixedNodeMenu)},onNameSearch:function(){this.searchResult=[],this.onSearchInput()},searchInputhandler:function(){var t=this,e=[];if(this.searchResult=[],"tasknode"===this.activeNodeListType){var n=this.nodes;if(this.selectedGroup&&(n=this.nodes.filter(function(e){return a()(this,t),e.group_name===this.selectedGroup}.bind(this))),""!==this.searchStr){var i=new RegExp(this.searchStr,"i");n.forEach(function(n){var o=this;a()(this,t),n.list.length>0&&n.list.forEach(function(t){a()(this,o),i.test(t.name)&&e.push(t)}.bind(this))}.bind(this))}else n.forEach(function(n){var i=this;a()(this,t),n.list.length>0&&e.push.apply(e,o()(n.list.map(function(t){return a()(this,i),t.list[t.list.length-1]}.bind(this))))}.bind(this))}else{var s=new RegExp(this.searchStr,"i");this.nodes.forEach(function(n){var i=this;a()(this,t);var o=!0,r=!0;this.selectedGroup.length>0&&(o=this.selectedGroup.every(function(t){var e=this;return a()(this,i),n.template_labels.find(function(n){return a()(this,e),n.label_id===Number(t)}.bind(this))}.bind(this))),""!==this.searchStr&&(r=s.test(n.name)),o&&r&&e.push(n)}.bind(this))}this.searchResult=e},handleClickOutSide:function(t){if(!this.isFixedNodeMenu){if(ft.a.parentClsContains("palette-item",t.target)||ft.a.parentClsContains("node-item-option",t.target))return;this.selectedGroup="subflow"===this.activeNodeListType?[]:"",this.$emit("onCloseNodeMenu")}},onApplyPermission:function(t){var e,n;this.common?(e="common_flow_view",n={common_flow:[{id:t.id,name:t.name}]}):(e="flow_view",n={flow:[{id:t.id,name:t.name}],project:[{id:this.projectId,name:this.projectName}]}),this.applyForPermission([e],[],n)}}},yt=(n(815),Object(B.a)(bt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"slideLeft"}},[t.showNodeMenu?n("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:t.handleClickOutSide,expression:"handleClickOutSide"}],staticClass:"node-menu"},[n("div",{class:["panel-fixed-pin",{actived:t.isFixedNodeMenu}],on:{click:function(e){return e.stopPropagation(),t.onClickPin.apply(null,arguments)}}},[n("i",{staticClass:"common-icon-pin"})]),t._v(" "),n("div",{staticClass:"search-wrap"},[n("bk-input",{staticClass:"search-input",attrs:{"right-icon":"bk-icon icon-search",placeholder:t.$t("请输入名称"),clearable:!0},on:{input:t.onNameSearch,clear:t.searchInputhandler},model:{value:t.searchStr,callback:function(e){t.searchStr="string"==typeof e?e.trim():e},expression:"searchStr"}}),t._v(" "),"tasknode"===t.activeNodeListType?n("bk-select",{attrs:{clearable:!0,searchable:!0},on:{change:t.searchInputhandler},model:{value:t.selectedGroup,callback:function(e){t.selectedGroup=e},expression:"selectedGroup"}},t._l(t.groupList,(function(t){return n("bk-option",{key:t.type,staticClass:"node-item-option",attrs:{id:t.type,name:t.group_name}})})),1):"subflow"!==t.activeNodeListType||t.common?t._e():n("bk-select",{key:"subflow-select",attrs:{"ext-popover-cls":"label-select","display-tag":!0,multiple:!0,clearable:!0,searchable:!0},on:{change:t.searchInputhandler},model:{value:t.selectedGroup,callback:function(e){t.selectedGroup=e},expression:"selectedGroup"}},t._l(t.templateLabels,(function(e,i){return n("bk-option",{key:i,staticClass:"node-item-option",attrs:{id:e.id,name:e.name}},[n("div",{staticClass:"label-select-option"},[n("span",{staticClass:"label-select-color",style:{background:e.color}}),t._v(" "),n("span",[t._v(t._s(e.name))]),t._v(" "),n("i",{staticClass:"bk-option-icon bk-icon icon-check-1"})])])})),1)],1),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,opacity:1},expression:"{ isLoading: loading, opacity: 1 }"}],staticClass:"node-list-wrap"},[t.listInPanel.length>0?[t.isSearchMode?[n("div",{staticClass:"search-result"},[t._l(t.listInPanel,(function(e,i){return["subflow"!==t.activeNodeListType||e.hasPermission?n("node-item",{key:i,staticClass:"node-item",attrs:{type:t.activeNodeListType,node:e}}):n("div",{key:i,staticClass:"node-item"},[n("div",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"name-wrapper text-permission-disable",on:{click:function(n){return t.onApplyPermission(e)}}},[t._v("\n                                    "+t._s(e.name)+"\n                                ")])])]}))],2)]:["tasknode"===t.activeNodeListType?t._l(t.listInPanel,(function(e){return n("bk-collapse",{key:e.type},[n("bk-collapse-item",{attrs:{name:e.group_name}},[n("div",{staticClass:"group-header"},[e.group_icon?n("img",{staticClass:"group-icon-img",attrs:{src:e.group_icon}}):n("i",{class:["group-icon-font",t.getIconCls(e.type)]}),t._v(" "),n("span",{staticClass:"header-title"},[t._v(t._s(e.group_name)+"\n                                        "),n("span",{staticClass:"header-atom"},[t._v("\n                                            ("+t._s(e.list.length)+")\n                                        ")])])]),t._v(" "),n("div",{staticClass:"node-item-wrap",attrs:{slot:"content"},slot:"content"},[t._l(e.list,(function(e,i){return["subflow"!==t.activeNodeListType||e.hasPermission?n("node-item",{key:i,staticClass:"node-item",attrs:{type:t.activeNodeListType,node:e}}):n("div",{key:i,staticClass:"node-item"},[n("div",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"name-wrapper text-permission-disable",on:{click:function(n){return t.onApplyPermission(e)}}},[t._v("\n                                                "+t._s(e.name)+"\n                                            ")])])]})),t._v(" "),0===e.list.length?n("div",{staticClass:"node-empty"},[n("no-data")],1):t._e()],2)])],1)})):n("div",{staticClass:"node-item-wrap"},[t._l(t.listInPanel,(function(e,i){return[e.hasPermission?n("node-item",{key:i,staticClass:"node-item",attrs:{type:t.activeNodeListType,node:e}}):n("div",{key:i,staticClass:"node-item"},[n("div",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"name-wrapper text-permission-disable",on:{click:function(n){return t.onApplyPermission(e)}}},[t._v("\n                                    "+t._s(e.name)+"\n                                ")])])]}))],2)]]:n("no-data")],2)]):t._e()])}),[],!1,null,"7b8d75f6",null).exports),_t=n(789);function wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Ct(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wt(Object(n),!0).forEach((function(e){ct()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var St={name:"PalattePanel",components:{NodeMenu:yt},props:{templateLabels:Array,subAtomListLoading:{type:Boolean,default:!0},atomTypeList:{type:Object,default:function(){return{}}},isDisableStartPoint:{type:Boolean,default:!1},isDisableEndPoint:{type:Boolean,default:!1},common:{type:[String,Number],default:!1}},data:function(){return{activeNodeListType:"",showNodeMenu:!1,isFixedNodeMenu:!1,isMenuTypeChange:!1,nodeMouse:{type:"",startX:null,startY:null},moveFlag:{x:0,y:0}}},computed:Ct(Ct({},Object(ut.e)({lang:function(t){return a()(this,void 0),t.lang}.bind(void 0)})),{},{langSuffix:function(){return"en"===this.lang?"en":"zh"},nodes:function(){return this.activeNodeListType?"tasknode"===this.activeNodeListType?this.atomTypeList.tasknode:this.atomTypeList.subflow:[]}}),watch:{showNodeMenu:function(t){this.$emit("updateNodeMenuState",t)}},mounted:function(){this.$emit("registerPaletteEvent"),this.renderGuide()},methods:{onMouseDown:function(t){this.moveFlag={x:t.pageX,y:t.pageY}},onOpenNodeMenu:function(){this.showNodeMenu=!0,this.activeNodeListType=this.nodeMouse.type},onCloseNodeMenu:function(){this.showNodeMenu=!1,this.activeNodeListType=""},onToggleNodeMenuFixed:function(t){this.isFixedNodeMenu=t},onNodeMouseDown:function(t,e){this.nodeMouse.startX=e.pageX,this.nodeMouse.startY=e.pageY,this.isMenuTypeChange=this.nodeMouse.type!==t,this.nodeMouse.type=t,document.addEventListener("mouseup",this.mouseUpHandler)},mouseUpHandler:function(t){var e=t.pageX,n=t.pageY;Math.max(e-this.nodeMouse.startX,n-this.nodeMouse.startY)<3&&(this.showNodeMenu&&!this.isMenuTypeChange?this.onCloseNodeMenu():this.onOpenNodeMenu()),document.removeEventListener("mouseup",this.mouseUpHandler)},renderGuide:function(){var t=this,e=[{el:".entry-item[data-type=tasknode]",url:n(817),text:[{type:"name",val:U.a.t("标准插件节点：")},{type:"text",val:U.a.t("已封装好的可用插件，可直接选中拖拽至画布中。")}]},{el:".entry-item[data-type=subflow]",url:n(818),text:[{type:"name",val:U.a.t("子流程：")},{type:"text",val:U.a.t("同一个项目下已新建的流程，作为子流程可以嵌套进至当前流程，并在执行任务时可以操作子流程的单个节点。")}]},{el:".entry-item[data-type=parallelgateway]",url:n(819),text:[{type:"name",val:U.a.t("并行网关：")},{type:"text",val:U.a.t("有多个流出分支，并且多个流出分支都默认执行。")}]},{el:".entry-item[data-type=branchgateway]",url:n(712),text:[{type:"name",val:U.a.t("分支网关：")},{type:"text",val:U.a.t("执行符合条件的流出分支。多个条件符合时，将只会执行第一个符合条件的分支。")}]},{el:".entry-item[data-type=convergegateway]",url:n(820),text:[{type:"name",val:U.a.t("汇聚网关：")},{type:"text",val:U.a.t("当汇聚网关用于汇聚并行网关时，所有进入顺序流的分支都到达以后，流程才会通过汇聚网关。")}]},{el:".entry-item[data-type=conditionalparallelgateway]",url:n(712),text:[{type:"name",val:U.a.t("条件并行网关：")},{type:"text",val:U.a.t("执行时满足分支条件的都会执行。")}]}],i={el:"",width:330,delay:500,arrow:!1,placement:"right",trigger:"mouseenter",img:{height:155,url:""},text:[]};e.forEach(function(e){a()(this,t),i.img.url=e.url,i.text=e.text,new _t.a(i).mount(document.querySelector(e.el))}.bind(this))}}},kt=(n(821),Object(B.a)(St,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"palette-panel"},[n("div",{staticClass:"palette-container"},[n("div",{class:["palette-item","entry-item",{disabled:t.isDisableStartPoint}],attrs:{"data-config-name":"","data-type":"startpoint"}},[n("div",{class:"node-type-icon common-icon-node-startpoint-"+t.langSuffix})]),t._v(" "),n("div",{class:["palette-item","entry-item",{disabled:t.isDisableEndPoint}],attrs:{"data-config-name":"","data-type":"endpoint"}},[n("div",{class:"node-type-icon common-icon-node-endpoint-"+t.langSuffix})]),t._v(" "),n("div",{class:["palette-item","entry-item","palette-with-menu",{actived:"tasknode"===t.activeNodeListType}],attrs:{"data-type":"tasknode"},on:{mousedown:function(e){return t.onNodeMouseDown("tasknode",e)}}},[n("div",{staticClass:"node-type-icon common-icon-node-tasknode"})]),t._v(" "),n("div",{class:["palette-item","entry-item","palette-with-menu",{actived:"subflow"===t.activeNodeListType}],attrs:{"data-type":"subflow"},on:{mousedown:function(e){return t.onNodeMouseDown("subflow",e)}}},[n("div",{staticClass:"node-type-icon common-icon-node-subflow"})]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3)]),t._v(" "),n("node-menu",{attrs:{"show-node-menu":t.showNodeMenu,"is-fixed-node-menu":t.isFixedNodeMenu,"active-node-list-type":t.activeNodeListType,"template-labels":t.templateLabels,loading:"subflow"===t.activeNodeListType&&t.subAtomListLoading,nodes:t.nodes,common:t.common},on:{onCloseNodeMenu:t.onCloseNodeMenu,onToggleNodeMenuFixed:t.onToggleNodeMenuFixed}})],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"palette-item entry-item",attrs:{"data-config-name":"","data-type":"parallelgateway"}},[e("div",{staticClass:"node-type-icon common-icon-node-parallelgateway"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"palette-item entry-item",attrs:{"data-config-name":"","data-type":"branchgateway"}},[e("div",{staticClass:"node-type-icon common-icon-node-branchgateway"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"palette-item entry-item",attrs:{"data-config-name":"","data-type":"convergegateway"}},[e("div",{staticClass:"node-type-icon common-icon-node-convergegateway"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"palette-item entry-item",attrs:{"data-config-name":"","data-type":"conditionalparallelgateway"}},[e("div",{staticClass:"node-type-icon common-icon-node-conditionalparallelgateway"})])}],!1,null,"4bddb310",null).exports),xt=/macintosh|mac os x/i.test(navigator.userAgent.toLowerCase()),Pt=[{emit:"onZoomIn",keyCodes:[107,187],ctrl:!0},{emit:"onZoomOut",keyCodes:[109,189],ctrl:!0},{emit:"onResetPosition",keyCodes:[96,48],ctrl:!0}],Et={name:"HelpInfo",props:{isShowHotKey:{type:Boolean,default:!1},editable:{type:Boolean,default:!0}},data:function(){return{isMac:xt,commonTitle:xt?"Mac":"Windows",commonCtrl:xt?"Command":"Ctrl",hotKeyTriggeringConditions:Pt}},mounted:function(){document.body.addEventListener("keydown",this.handlerKeyDown,!1)},beforeDestroy:function(){document.body.removeEventListener("keydown",this.handlerKeyDown,!1)},methods:{onCloseHotkeyInfo:function(){this.$emit("onCloseHotkeyInfo")},handlerKeyDown:function(t){var e=this,n=window.event.ctrlKey,i=this.hotKeyTriggeringConditions.find(function(i){return a()(this,e),i.keyCodes.indexOf(t.keyCode)>-1&&!!n===i.ctrl}.bind(this));i&&this.isUsable(i.emit)&&(t.preventDefault(),this.$emit(i.emit,i.params))},isUsable:function(t){return!(!this.editable&&["onZoomIn","onZoomOut","onResetPosition"].indexOf(t)<-1)}}},Dt=(n(822),Object(B.a)(Et,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"help-info-wrap"},[t.isShowHotKey?n("div",{class:["hot-key-container",{"min-top":t.editable}]},[n("transition",{attrs:{name:"wrapperLeft"}},[n("div",{class:["hot-key-panel",{"min-top":!t.editable}]},[n("p",{staticClass:"title"},[t._v(t._s(t.commonTitle+t.$t("快捷键列表")))]),t._v(" "),n("span",{staticClass:"close",on:{click:function(e){return e.stopPropagation(),t.onCloseHotkeyInfo.apply(null,arguments)}}},[n("i",{staticClass:"common-icon-dark-circle-close"})]),t._v(" "),n("table",[n("tbody",[n("tr",[n("td",[t._v(t._s(t.$t("放大"))+":")]),t._v(" "),n("td",[t._v("Ctrl + (+)")])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.$t("缩小"))+":")]),t._v(" "),n("td",[t._v("Ctrl + (-)")])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.$t("还原"))+":")]),t._v(" "),n("td",[t._v("Ctrl + 0:")])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.$t("缩放"))+":")]),t._v(" "),n("td",[t._v("Ctrl + "+t._s(t.$t("鼠标滚动")))])]),t._v(" "),t.editable?[n("tr",[n("td",[t._v(t._s(t.$t("连续选中（或取消）节点"))+":")]),t._v(" "),n("td",[t._v(t._s(t.commonCtrl)+" + "+t._s(t.$t("鼠标左键单击")))])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.$t("移动流程元素"))+":")]),t._v(" "),n("td",[t._v("["+t._s(t.$t("选中后"))+"]"+t._s(t.$t("箭头（上下左右）")))])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.$t("删除节点"))+":")]),t._v(" "),n("td",[t._v("["+t._s(t.$t("选中后"))+"] Delete")])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.$t("复制/粘贴"))+":")]),t._v(" "),n("td",[t._v("["+t._s(t.$t("选中后"))+"] Ctrl + C / Ctrl + V")])])]:t._e()],2)])])])],1):t._e()])}),[],!1,null,"1cee85a1",null).exports),jt={name:"ToolPanel",props:{editable:{type:Boolean,default:!0},isShowSelectAllTool:{type:Boolean,default:!1},isSelectAllToolDisabled:{type:Boolean,default:!1},isAllSelected:{type:Boolean,default:!1},isSelectionOpen:{type:Boolean,default:!1},showSmallMap:{type:Boolean,default:!1}},data:function(){return{isShowHotKey:!1}},computed:{selectNodeName:function(){return this.isAllSelected?U.a.t("全选"):U.a.t("反选")}},methods:{onShowMap:function(){this.$emit("onShowMap")},onZoomIn:function(){this.$emit("onZoomIn")},onZoomOut:function(){this.$emit("onZoomOut")},onResetPosition:function(){this.$emit("onResetPosition")},onFormatPosition:function(){this.$emit("onFormatPosition")},onToggleAllNode:function(){this.$emit("onToggleAllNode",!this.isAllSelected)},onOpenFrameSelect:function(){this.$emit("onOpenFrameSelect")},onToggleHotKeyInfo:function(){this.$emit("onToggleHotKeyInfo")},onDownloadCanvas:function(){this.$emit("onDownloadCanvas")}}},Ot=(n(823),Object(B.a)(jt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"wrapperLeft"}},[n("div",{staticClass:"tool-position"},[n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("缩略视图"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('缩略视图'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],class:["tool-icon",{actived:t.showSmallMap}],on:{click:t.onShowMap}},[n("i",{staticClass:"common-icon-small-map"})]),t._v(" "),n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("放大"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('放大'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onZoomIn}},[n("i",{staticClass:"common-icon-zoom-in"})]),t._v(" "),n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("缩小"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('缩小'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onZoomOut}},[n("i",{staticClass:"common-icon-zoom-out"})]),t._v(" "),n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("复位"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('复位'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onResetPosition}},[n("i",{staticClass:"common-icon-reduction"})]),t._v(" "),t.editable?n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("节点框选"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('节点框选'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],class:["tool-icon",{actived:t.isSelectionOpen}],on:{click:t.onOpenFrameSelect}},[n("i",{staticClass:"common-icon-marquee"})]):t._e(),t._v(" "),t.editable?n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("排版"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('排版'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onFormatPosition}},[n("i",{staticClass:"common-icon-four-square"})]):t._e(),t._v(" "),t.isShowSelectAllTool?n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.selectNodeName,delay:300,placements:["bottom"]},expression:"{\n                content: selectNodeName,\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onToggleAllNode}},[n("i",{class:[t.isAllSelected?"common-icon-black-hook":"common-icon-black-box",{"tool-disable":t.isSelectAllToolDisabled}]})]):t._e(),t._v(" "),n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("下载"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('下载'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onDownloadCanvas}},[n("i",{staticClass:"bk-icon icon-download"})]),t._v(" "),n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("快捷键"),delay:300,placements:["bottom"]},expression:"{\n                content: $t('快捷键'),\n                delay: 300,\n                placements: ['bottom']\n            }"}],staticClass:"tool-icon",on:{click:t.onToggleHotKeyInfo}},[n("i",{staticClass:"common-icon-flash"})])])])}),[],!1,null,"279159ca",null).exports),Tt={endpoint:"Dot",connector:["Flowchart",{stub:[20,20],alwaysRespectStub:!0,gap:0,cornerRadius:10}],connectorOverlays:[["PlainArrow",{width:8,length:6,location:1,id:"arrow"}]],paintStyle:{fill:"transparent",radius:6},hoverPaintStyle:{fill:"#3a84ff"},cssClass:"template-canvas-endpoint",hoverClass:"template-canvas-endpoint-hover",isSource:!0,isTarget:!0,maxConnections:-1},Lt={paintStyle:{fill:"transparent",strokeWidth:2,stroke:"#a9adb6",outlineStroke:"tranparent",outlineWidth:4},hoverPaintStyle:{fill:"transparent",stroke:"#3a84ff"},cssClass:"bk-sops-connector",hoverClass:"bk-sops-connector-hover",detachable:!0},Nt=n(193),At={name:"TemplateCanvas",components:{JsFlow:$,NodeTemplate:rt,PalettePanel:kt,ToolPanel:Ot,HelpInfo:Dt},props:{showPalette:{type:Boolean,default:!0},showTool:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},atomTypeList:{type:Object,default:function(){return{}}},isNodeCheckOpen:{type:Boolean,default:!1},isShowSelectAllTool:{type:Boolean,default:!1},isSelectAllToolDisabled:{type:Boolean,default:!1},isAllSelected:{type:Boolean,default:!1},hasAdminPerm:{type:Boolean,default:!1},common:{type:[String,Number],default:""},subAtomListLoading:{type:Boolean,default:!0},templateLabels:{type:Array,default:function(){return a()(this,void 0),[]}.bind(void 0)},canvasData:{type:Object,default:function(){return{lines:[],locations:[]}}},isCanvasImg:{type:Boolean,default:!1}},data:function(){var t=this.canvasData,e={lines:t.lines,nodes:t.locations},n=Tt;return this.editable||(n=Object.assign({},Tt,{isTarget:!1,isSource:!1,connectionsDetachable:!1})),{isSmallMap:!1,smallMapWidth:344,smallMapHeight:216,smallMapImg:"",showSmallMap:!1,isMouseEnterX:"",isMouseEnterY:"",windowWidth:document.documentElement.offsetWidth-60,windowHeight:document.documentElement.offsetHeight-60-50,canvasWidth:0,canvasHeight:0,canvasImgDownloading:!1,idOfNodeShortcutPanel:"",showNodeMenu:!1,isDisableStartPoint:!1,isDisableEndPoint:!1,isSelectionOpen:!1,isShowHotKey:!1,isCanCreateline:!1,selectedNodes:[],copyNodes:[],selectionOriginPos:{x:0,y:0},pasteMousePos:{x:0,y:0},referenceLine:{x:0,y:0,id:"",arrow:""},zoomOriginPosition:{x:0,y:0},endpointOptions:n,flowData:e,connectorOptions:Lt}},watch:{canvasData:function(t){var e=t.lines,n=t.locations;this.flowData={lines:e,nodes:n}}},created:function(){this.onWindowResize=ot.a.throttle(this.handlerWindowResize,300)},mounted:function(){var t=this;this.isDisableStartPoint=!!this.canvasData.locations.find(function(e){return a()(this,t),"startpoint"===e.type}.bind(this)),this.isDisableEndPoint=!!this.canvasData.locations.find(function(e){return a()(this,t),"endpoint"===e.type}.bind(this)),document.body.addEventListener("click",this.handleShortcutPanelHide,!1);var e=document.querySelector(".canvas-flow-wrap");e.addEventListener("mousewheel",this.onMouseWheel,!1),e.addEventListener("DOMMouseScroll",this.onMouseWheel,!1),e.addEventListener("mousemove",this.onCanvasMouseMove,!1),window.addEventListener("resize",this.onWindowResize,!1)},beforeDestroy:function(){this.$refs.jsFlow.$el.removeEventListener("mousemove",this.pasteMousePosHandler),document.removeEventListener("keydown",this.nodeSelectedhandler),document.removeEventListener("keydown",this.nodeLineDeletehandler),document.body.removeEventListener("click",this.handleShortcutPanelHide,!1);var t=document.querySelector(".canvas-flow-wrap");t&&(t.removeEventListener("mousewheel",this.onMouseWheel,!1),t.removeEventListener("DOMMouseScroll",this.onMouseWheel,!1),t.removeEventListener("mousemove",this.onCanvasMouseMove,!1)),window.removeEventListener("resize",this.onWindowResize,!1)},methods:{handlerWindowResize:function(){var t=this;this.windowWidth=document.documentElement.offsetWidth-60,this.windowHeight=document.documentElement.offsetHeight-60-50,this.showSmallMap&&(this.onGenerateCanvas().then(function(e){a()(this,t),this.smallMapImg=e}.bind(this)),this.getInitialValue())},onToggleMapShow:function(){var t=this;this.showSmallMap=!this.showSmallMap,this.showSmallMap&&(this.onGenerateCanvas().then(function(e){a()(this,t),this.smallMapImg=e}.bind(this)),this.$nextTick(function(){a()(this,t),this.getInitialValue()}.bind(this)))},onZoomIn:function(t){if(t){var e=t.x,n=t.y;this.$refs.jsFlow.zoomIn(1.1,e,n)}else this.$refs.jsFlow.zoomIn(1.1,0,0);this.clearReferenceLine(),this.showSmallMap=!1},onZoomOut:function(t){if(t){var e=t.x,n=t.y;this.$refs.jsFlow.zoomOut(.9,e,n)}else this.$refs.jsFlow.zoomOut(.9,0,0);this.clearReferenceLine(),this.showSmallMap=!1},onResetPosition:function(){this.$refs.jsFlow.resetPosition()},onFormatPosition:function(){this.$emit("onFormatPosition"),this.showSmallMap=!1},onOpenFrameSelect:function(){this.isSelectionOpen=!0,this.$refs.jsFlow.frameSelect(),this.showSmallMap=!1},onFrameSelectEnd:function(t){this.selectedNodes=t,this.copyNodes=ot.a.deepClone(t),this.isSelectionOpen=!1,this.selectionOriginPos=this.getNodesLocationOnLeftTop(t),this.$refs.jsFlow.$el.addEventListener("mousemove",this.pasteMousePosHandler),document.addEventListener("keydown",this.nodeSelectedhandler),document.addEventListener("keydown",this.nodeLineDeletehandler,{once:!0})},onCloseFrameSelect:function(){this.selectedNodes=[],this.copyNodes=[],this.$refs.jsFlow.$el.removeEventListener("mousemove",this.pasteMousePosHandler),document.removeEventListener("keydown",this.pasteMousePosHandler),document.removeEventListener("keydown",this.nodeSelectedhandler)},pasteMousePosHandler:function(t){this.pasteMousePos={x:t.offsetX,y:t.offsetY}},nodeSelectedhandler:function(t){if((t.ctrlKey||t.metaKey)&&86===t.keyCode)this.onCopyNodes();else if([37,38,39,40].includes(t.keyCode)){this.onMovePosition({37:"left",38:"top",39:"right",40:"bottom"}[t.keyCode])}},nodeLineDeletehandler:function(t){var e=this;46!==t.keyCode&&8!==t.keyCode||(this.selectedNodes.forEach(function(t){a()(this,e),this.onNodeRemove(t)}.bind(this)),this.onCloseFrameSelect())},onCopyNodes:function(){var t=this,e=this.createCopyOfSelectedNodes(this.copyNodes),n=e.locations,i=e.lines,o=[],s=this.selectionOriginPos,r=s.x,l=s.y,c=this.pasteMousePos,u=c.x,d=c.y;n.forEach(function(e){a()(this,t),e.x+=u-r,e.y+=d-l,o.push(e.id),this.$refs.jsFlow.createNode(e),this.$emit("onLocationChange","copy",e)}.bind(this)),i.forEach(function(e){var n=this;a()(this,t),this.$emit("onLineChange","add",e),this.$nextTick(function(){a()(this,n),this.$refs.jsFlow.createConnector(e)}.bind(this))}.bind(this)),this.$nextTick(function(){a()(this,t),this.$refs.jsFlow.clearNodesDragSelection(),this.$refs.jsFlow.addNodesToDragSelection(o),this.selectedNodes=n}.bind(this))},createCopyOfSelectedNodes:function(t){var e=this,n=[],i=[],o={},s={};return t.forEach(function(t,n){a()(this,e);var s=ot.a.deepClone(t),r=ot.a.deepClone(this.canvasData.activities[t.id]);r&&(s.atomId="ServiceActivity"===r.type?r.component.code:r.template_id),"startpoint"!==s.type&&"endpoint"!==s.type&&(i.push(s),o[t.id]=s.id="node"+Object(F.b)(),s.oldSouceId=t.id)}.bind(this)),this.canvasData.lines.forEach(function(t){if(a()(this,e),o[t.source.id]&&o[t.target.id]){var i=ot.a.deepClone(t);s[t.id]=i.id="line"+Object(F.b)(),i.source.id=o[t.source.id],i.target.id=o[t.target.id],i.oldSouceId=t.id,n.push(i)}}.bind(this)),{locations:i,lines:n}},branchConditionEditHandler:function(t,e){var n=t.target,i=n.dataset.lineid,o=n.dataset.nodeid,s=this.canvasData.branchConditions[o][i],a=s.name,r=s.evaluate;n.classList.contains("branch-condition")&&(t.stopPropagation(),this.$emit("onConditionClick",{id:i,nodeId:o,name:a,value:r,overlayId:e})),this.editable&&this.$emit("templateDataChanged")},onToggleAllNode:function(t){this.$emit("onToggleAllNode",t),this.showSmallMap=!1},updateNodeMenuState:function(t){this.showNodeMenu=t,this.$emit("update:nodeMemuOpen",t)},updateCanvas:function(){var t=this.canvasData,e=t.locations,n=t.lines;this.$refs.jsFlow.updateCanvas({nodes:e,lines:n})},removeAllConnector:function(){this.$refs.jsFlow.removeAllConnector()},onShowNodeConfig:function(t){this.$emit("onShowNodeConfig",t)},onNodeCheckClick:function(t,e){this.$emit("onNodeCheckClick",t,e)},onUpdateNodeInfo:function(t,e){var n=this,i=this.flowData.nodes.findIndex(function(e){return a()(this,n),e.id===t}.bind(this)),o=Object.assign({},this.flowData.nodes[i],e);this.$set(this.flowData.nodes,i,o)},getNodeWithEndpoint:function(t){var e=t.parentNode;return!(!e||"HTML"===e.nodeName)&&(e.classList.contains("bk-flow-location")?e:this.getNodeWithEndpoint(e))},onCreateNodeBefore:function(t){var e=document.querySelector(".node-menu");if(t.atomId&&e){var n=document.querySelector(".adding-node").offsetWidth;if(e.offsetWidth-t.x>n/2)return!1}var i=Nt.a.isLocationValid(t,this.canvasData.locations);return i.result?(this.$emit("templateDataChanged"),!0):(this.$bkMessage({message:i.message,theme:"warning"}),!1)},onCreateNodeAfter:function(t){t.oldSouceId||(this.$emit("onLocationChange","add",Object.assign({},t)),"startpoint"===t.type?this.isDisableStartPoint=!0:"endpoint"===t.type&&(this.isDisableEndPoint=!0))},onConnectionDragStop:function(t,e,n){if(t.id===e)return!1;var i=document.getElementById(e).getBoundingClientRect(),o=n.clientX-i.left,s=n.clientY-i.top,a={source:t,target:{id:e,arrow:o<i.width/2?s<i.height/2?o>s?"Top":"Left":o>i.height-s?"Bottom":"Left":s<i.height/2?i.width-o>s?"Top":"Right":i.width-o>i.height-s?"Bottom":"Right"}},r=Nt.a.isLineValid(a,this.canvasData);r.result?(this.$emit("onLineChange","add",a),this.$refs.jsFlow.createConnector(a)):this.$bkMessage({message:r.message,theme:"warning"})},onBeforeDrop:function(t){var e=t.sourceId,n=t.targetId,i=t.connection,o=t.dropEndpoint;if(e===n)return!1;var s={source:{id:e,arrow:i.endpoints[0].anchor.type},target:{id:n,arrow:o.anchor.type}},a=Nt.a.isLineValid(s,this.canvasData);if(a.result)return this.$emit("onLineChange","add",s),this.$emit("templateDataChanged"),!0;this.$bkMessage({message:a.message,theme:"warning"})},onConnection:function(t){var e=this;this.$nextTick(function(){var n=this;a()(this,e);var i=this.canvasData.lines.filter(function(e){return a()(this,n),e.source.id===t.sourceId&&e.target.id===t.targetId}.bind(this))[0],o=i.id;if(i.hasOwnProperty("midpoint")){var s=["Flowchart",{stub:[10,10],alwaysRespectStub:!0,gap:0,cornerRadius:10,midpoint:i.midpoint}];this.$refs.jsFlow.setConnector(i.source.id,i.target.id,s)}this.$refs.jsFlow.addLineOverlay(t,{type:"Label",name:'<i class="common-icon-dark-circle-close"></i>',location:.5,id:"close_".concat(o)});var r=this.canvasData.branchConditions[t.source.id];if(r&&Object.keys(r).length>0){var l=r[o].evaluate,c=r[o].name||l,u={type:"Label",name:'<div class="branch-condition"\n                                title="'.concat(ot.a.escapeStr(c),"(").concat(ot.a.escapeStr(l),')"\n                                data-lineid="').concat(o,'"\n                                data-nodeid="').concat(t.sourceId,'">').concat(c,"</div>"),location:-70,cls:"branch-condition",id:"condition".concat(o)};this.$refs.jsFlow.addLineOverlay(t,u)}}.bind(this))},onConnectionDetached:function(t){var e={source:{id:t.sourceId},target:{id:t.targetId}};this.$emit("templateDataChanged"),this.$emit("onLineChange","delete",e)},onNodeMoveStop:function(t){var e=this;if(this.$emit("templateDataChanged"),this.selectedNodes.length){var n=this.selectedNodes.find(function(n){return a()(this,e),n.id===t.id}.bind(this));if(!n)return!1;var i=n.x,o=n.y,s=t.x-i,r=t.y-o;this.selectedNodes.forEach(function(t){a()(this,e),t.x+=s,t.y+=r,this.$emit("onLocationMoveDone",t)}.bind(this))}else this.$emit("onLocationMoveDone",t)},onOverlayClick:function(t,e){var n=this,i="",o=[{type:"close",rule:/^(close_)(\w*)/},{type:"branchCondition",rule:/^(condition)(\w*)/}].find(function(e){a()(this,n);var o=t.id.match(e.rule);if(o&&""!==o[2])return i=o[2],!0}.bind(this));if(i&&"close"===o.type){var s=this.canvasData.lines.find(function(t){return a()(this,n),t.id===i}.bind(this));this.$refs.jsFlow.removeConnector(s)}i&&"branchCondition"===o.type&&this.branchConditionEditHandler(e,t.id)},onNodeRemove:function(t){this.$refs.jsFlow.removeNode(t),this.$emit("templateDataChanged"),this.$emit("onLocationChange","delete",t),"startpoint"===t.type?this.isDisableStartPoint=!1:"endpoint"===t.type&&(this.isDisableEndPoint=!1)},onBeforeDrag:function(t){this.referenceLine.id&&this.referenceLine.id===t.sourceId&&this.clearReferenceLine()},onNodeMoving:function(t){this.referenceLine.id&&this.referenceLine.id===t.id&&this.clearReferenceLine(),t.id!==this.idOfNodeShortcutPanel&&this.handleShortcutPanelHide()},createReferenceLine:function(){var t=document.querySelector(".canvas-flow-wrap"),e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("id","referenceLine"),e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("version","1.1"),e.setAttribute("style","position:absolute;left:0;top:0;width:100%;height:100%;pointer-events: none;");var n=document.createElementNS("http://www.w3.org/2000/svg","defs");n.innerHTML='\n                <marker id="arrow" markerWidth="10" markerHeight="10" refx="0" refy="2" orient="auto" markerUnits="strokeWidth">\n                    <path d="M0,0 L0,4 L6,2 z" fill="#979ba5" />\n                </marker>\n            ';var i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("id","referencePath"),i.setAttribute("marker-end","url(#arrow)"),i.setAttribute("x1","0"),i.setAttribute("y1","0"),i.setAttribute("x2","0"),i.setAttribute("y2","0"),i.setAttribute("style","stroke:#979ba5;stroke-width:2"),i.setAttribute("id","referencePath"),e.appendChild(n),e.appendChild(i),t.appendChild(e),document.body.addEventListener("mousedown",this.clearReferenceLine,{once:!0})},updataReferenceLinePositon:function(t,e){var n=document.getElementById("referencePath");n&&(n.setAttribute("x1",t.x),n.setAttribute("y1",t.y),n.setAttribute("x2",e.x),n.setAttribute("y2",e.y))},clearReferenceLine:function(){var t=document.querySelector(".canvas-flow-wrap"),e=document.getElementById("referenceLine");t&&e&&t.removeChild(e),document.getElementById("canvasContainer").removeEventListener("mousemove",this.handleReferenceLine,!1),this.referenceLine={}},onEndpointClick:function(t,e){if(!this.editable)return!1;var n=e.pageX,i=e.pageY,o=document.querySelector(".canvas-flow-wrap").getBoundingClientRect(),s=n-o.x,a=i-o.y,r=t.anchor.type;if(this.referenceLine.id&&t.elementId!==this.referenceLine.id)return this.createLine({id:this.referenceLine.id,arrow:this.referenceLine.arrow},{id:t.elementId,arrow:r}),this.clearReferenceLine(),!1;this.createReferenceLine(),this.referenceLine={x:s,y:a,id:t.elementId,arrow:r},document.getElementById("canvasContainer").addEventListener("mousemove",this.handleReferenceLine,!1)},handleReferenceLine:function(t){var e=this,n=t.pageX,i=t.pageY,o=document.querySelector(".canvas-flow-wrap").getBoundingClientRect(),s={x:n-o.x,y:i-o.y};(function(){return a()(this,e),window.requestAnimationFrame||function(t){setTimeout(t,1e3/60)}}).bind(this)(this.updataReferenceLinePositon(this.referenceLine,s))},createLine:function(t,e){if(t.id===e.id)return!1;var n={source:t,target:e},i=Nt.a.isLineValid(n,this.canvasData);i.result?(this.$emit("onLineChange","add",n),this.$refs.jsFlow.createConnector(n),this.referenceLine.id=""):this.$bkMessage({message:i.message,theme:"warning"})},onRetryClick:function(t){this.$emit("onRetryClick",t)},onSkipClick:function(t){this.$emit("onSkipClick",t)},onForceFail:function(t){this.$emit("onForceFail",t)},onModifyTimeClick:function(t){this.$emit("onModifyTimeClick",t)},onGatewaySelectionClick:function(t){this.$emit("onGatewaySelectionClick",t)},onTaskNodeResumeClick:function(t){this.$emit("onTaskNodeResumeClick",t)},onSubflowPauseResumeClick:function(t,e){this.$emit("onSubflowPauseResumeClick",t,e)},onToggleHotKeyInfo:function(t){this.showSmallMap=!1,this.isShowHotKey=!this.isShowHotKey},onCloseHotkeyInfo:function(){this.isShowHotKey=!1},addNodeToSelectedList:function(t){var e=this;document.removeEventListener("keydown",this.nodeLineDeletehandler),document.addEventListener("keydown",this.nodeLineDeletehandler);var n=this.selectedNodes.findIndex(function(n){return a()(this,e),n.id===t.id}.bind(this));if(n>-1){this.$refs.jsFlow.clearNodesDragSelection(),this.$delete(this.selectedNodes,n),this.$delete(this.copyNodes,n);var i=this.selectedNodes.map(function(t){return a()(this,e),t.id}.bind(this));this.$refs.jsFlow.addNodesToDragSelection(i)}else{this.selectedNodes.push(t),this.copyNodes.push(t);var o=this.selectedNodes.map(function(t){return a()(this,e),t.id}.bind(this));this.$refs.jsFlow.addNodesToDragSelection(o)}this.selectionOriginPos=this.getNodesLocationOnLeftTop(this.selectedNodes),document.addEventListener("keydown",this.nodeSelectedhandler),document.addEventListener("mousedown",this.handleClearDragSelection,{once:!0}),this.$refs.jsFlow.$el.addEventListener("mousemove",this.pasteMousePosHandler)},handleClearDragSelection:function(){this.selectedNodes=[],this.copyNodes=[],this.$refs.jsFlow.clearNodesDragSelection(),document.removeEventListener("mousedown",this.handleClearDragSelection,{once:!0}),document.removeEventListener("keydown",this.nodeSelectedhandler),document.removeEventListener("keydown",this.nodeLineDeletehandler),this.$refs.jsFlow.$el.removeEventListener("mousemove",this.pasteMousePosHandler)},getNodesLocationOnLeftTop:function(t){var e=this,n=0,i=0;return t.forEach(function(t,o){a()(this,e),n=0===o?t.x:Math.min(n,t.x),i=0===o?t.y:Math.min(i,t.y)}.bind(this)),{x:n,y:i}},updataConditionCanvasData:function(t){var e=this,n=t.name,i=t.overlayId,o=t.id,s=t.value,r=this.canvasData.lines.find(function(t){return a()(this,e),t.id===o}.bind(this));this.$refs.jsFlow.removeLineOverlay(r,i),this.$nextTick(function(){a()(this,e);var t={type:"Label",name:'<div class="branch-condition"\n                            title="'.concat(ot.a.escapeStr(n),"(").concat(ot.a.escapeStr(s),')"\n                            data-lineid="').concat(o,'"\n                            data-nodeid="').concat(r.source.id,'">').concat(n,"</div>"),location:-70,cls:"branch-condition",id:"condition".concat(o)};this.$refs.jsFlow.addLineOverlay(r,t)}.bind(this))},onNodeMousedown:function(t){this.$emit("onNodeMousedown",t)},onNodeClick:function(t,e,n){if(this.$emit("onNodeClick",t,e),this.editable)return this.referenceLine.id?(this.onConnectionDragStop({id:this.referenceLine.id,arrow:this.referenceLine.arrow},t,n),void this.clearReferenceLine()):void("endpoint"!==e&&this.showShortcutPane(t));this.onShowNodeConfig(t)},onNodeDblclick:function(t){this.onShowNodeConfig(t),this.handleShortcutPanelHide()},showShortcutPane:function(t){this.idOfNodeShortcutPanel&&this.onUpdateNodeInfo(this.idOfNodeShortcutPanel,{isActived:!1}),this.onUpdateNodeInfo(t,{isActived:!0}),this.updataSelctedNodeData(t)},handleShortcutPanelHide:function(t){if(t&&ft.a.parentClsContains("canvas-node",t.target))return!1;this.onUpdateNodeInfo(this.idOfNodeShortcutPanel,{isActived:!1}),this.toggleNodeLevel(this.idOfNodeShortcutPanel,!1),this.idOfNodeShortcutPanel=""},toggleNodeLevel:function(t,e){var n=document.getElementById(t);t&&n&&(e?n.classList.add("actived"):n.classList.remove("actived"))},updataSelctedNodeData:function(t){this.toggleNodeLevel(this.idOfNodeShortcutPanel,!1),this.toggleNodeLevel(t,!0),this.idOfNodeShortcutPanel=t},onAppendNode:function(t){var e=this,n=t.location,i=t.line,o=t.isFillParam?"copy":"add";this.$refs.jsFlow.createNode(n),this.$emit("onLocationChange",o,n),this.$emit("onLineChange","add",i),this.$nextTick(function(){a()(this,e),this.$refs.jsFlow.createConnector(i),this.showShortcutPane(n.id)}.bind(this))},onInsertNode:function(t){var e=this,n=t.startNodeId,i=t.endNodeId,o=t.location,s=t.isFillParam?"copy":"add",r=this.canvasData.lines.find(function(t){return a()(this,e),t.source.id===n&&t.target.id===i}.bind(this));if(!r)return!1;this.$refs.jsFlow.removeConnector(r);var l={source:{arrow:"Right",id:n},target:{id:o.id,arrow:"Left"}},c={source:{arrow:"Right",id:o.id},target:{id:i,arrow:"Left"}};this.$refs.jsFlow.createNode(o),this.$emit("onLocationChange",s,o),this.$emit("onLineChange","add",l),this.$emit("onLineChange","add",c),this.$nextTick(function(){a()(this,e),this.$refs.jsFlow.createConnector(l),this.$refs.jsFlow.createConnector(c),this.showShortcutPane(o.id)}.bind(this))},toggleSelectedNode:function(t,e){this.selecAtomtNodeId=t;var n=document.getElementById(t);e?n&&n.classList.add("selected"):n&&n.classList.remove("selected")},onMovePosition:function(t){if(!this.selectedNodes.length)return!1;this.onMoveNodesByHand(this.selectedNodes,t)},onMoveNodesByHand:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,o=this.$refs.jsFlow.instance,s=0,r=0;switch(e){case"left":s=-i;break;case"right":s=i;break;case"top":r=-i;break;case"bottom":r=i}this.$emit("templateDataChanged"),t.forEach(function(t,e){var i=this;a()(this,n);var l=document.getElementById(t.id),c=t.x+s,u=t.y+r,d={id:t.id,x:c,y:u};t.x=c,t.y=u,this.$emit("onLocationMoveDone",d),window.requestAnimationFrame(function(){a()(this,i),l.style.top=u+"px",l.style.left=c+"px",o.revalidate(l)}.bind(this))}.bind(this))},onMouseWheel:function(t){if(!t.ctrlKey)return!1;t.preventDefault();var e=t||window.event;return(e.wheelDelta?e.wheelDelta<0:e.detail>0)?this.onZoomOut(this.zoomOriginPosition):this.onZoomIn(this.zoomOriginPosition),!1},onCanvasMouseMove:function(t){var e=document.querySelector(".canvas-flow-wrap").getBoundingClientRect(),n=e.x,i=e.y;this.zoomOriginPosition.x=t.pageX-n,this.zoomOriginPosition.y=t.pageY-i},setCanvasPosition:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(i){var o=this.$refs.jsFlow.$el.querySelector("#canvas-flow");o.style.transition="left 0.4s, top 0.4s",this.$refs.jsFlow.setCanvasPosition(t,e),setTimeout(function(){a()(this,n),o.style.transition="unset"}.bind(this),600)}else this.$refs.jsFlow.setCanvasPosition(t,e)},onDownloadCanvas:function(){var t=this;this.onGenerateCanvas().then(function(e){if(a()(this,t),!this.canvasImgDownloading){this.canvasImgDownloading=!0;var n=document.createElement("a");n.download="bk_sops_template_".concat(+new Date,".png"),n.href=e,n.click(),this.canvasImgDownloading=!1}}.bind(this))},onGenerateCanvas:function(){var t=this,e=document.querySelector(".canvas-flow-wrap"),n=this.canvasData.locations.map(function(e){return a()(this,t),e.x}.bind(this)),i=this.canvasData.locations.map(function(e){return a()(this,t),e.y}.bind(this)),s=Math.min.apply(Math,o()(n)),r=Math.max.apply(Math,o()(n)),l=Math.min.apply(Math,o()(i)),c=Math.max.apply(Math,o()(i)),u=s<0?-s:0,d=l<0?-l:0,h=null;h=s<0?r>this.windowWidth?r-s:this.windowWidth-s:r>this.windowWidth?r:this.windowWidth;var f=null;return f=l<0?c>this.windowHeight?c-l:this.windowHeight-l:c>this.windowHeight?c:this.windowHeight,this.canvasHeight=f+200+30,this.canvasWidth=h+200+80,p.toJpeg(e,{bgcolor:"#ffffff",height:this.canvasHeight,width:this.canvasWidth,cloneBack:function(e){a()(this,t),e.style.width=this.canvasWidth+"px",e.style.height=this.canvasHeight+"px";var n=e.querySelector("#canvas-flow");n.style.left=u+30+"px",n.style.top=d+30+"px",n.style.right="0px",n.style.bottom="0px",n.style.transform="inherit",n.style.border=0}.bind(this)})},getInitialValue:function(){var t=this,e=document.querySelector("#canvas-flow"),n=document.querySelector(".select-box"),i=this.windowWidth/this.canvasWidth*this.smallMapWidth,s=this.windowHeight/this.canvasHeight*this.smallMapHeight,r=this.canvasData.locations.map(function(e){return a()(this,t),e.x}.bind(this)),l=this.canvasData.locations.map(function(e){return a()(this,t),e.y}.bind(this)),c=Math.min.apply(Math,o()(r)),u=Math.min.apply(Math,o()(l)),d=null,h=c<0?-c:0,p=u<0?-u:0,f=(e.offsetLeft>0?-h:h)-e.offsetLeft,m=this.smallMapWidth/this.canvasWidth*f;d=m+i>=this.smallMapWidth?i<this.smallMapWidth?this.smallMapWidth-i:m:m>0?m:0;var v=null,g=(e.offsetTop>0?-p:p)-e.offsetTop,b=this.smallMapHeight/this.canvasHeight*g;v=b+s>=this.smallMapHeight?s<this.smallMapHeight?this.smallMapHeight-s:b:b>0?b:0,this.initialLeft=h,this.initialTop=p,n.style.width=i+"px",n.style.height=s+"px",n.style.left=d+"px",n.style.top=v+"px"},onMouseDownSelect:function(t){this.isMouseEnterX=t.offsetX,this.isMouseEnterY=t.offsetY,this.$refs.selectBox.addEventListener("mousemove",this.selectBoxMoveHandler,!1),window.addEventListener("mouseup",this.onMouseUpListener,!1)},onMouseUpListener:function(){this.$refs.selectBox.removeEventListener("mousemove",this.selectBoxMoveHandler,!1),window.removeEventListener("mouseup",this.onMouseUpListener,!1)},selectBoxMoveHandler:function(t){var e=document.querySelector(".select-box"),n=this.$refs.smallMap.getBoundingClientRect().top,i=this.$refs.smallMap.getBoundingClientRect().left,o=t.clientX-this.isMouseEnterX-i,s=t.clientY-this.isMouseEnterY-n,a=this.windowWidth/this.canvasWidth*this.smallMapWidth,r=this.windowHeight/this.canvasHeight*this.smallMapHeight,l=null,c=null,u=this.smallMapWidth-a;l=o<0?0:o>u?u:o;var d=this.smallMapHeight-r;c=s<0?0:s>d?d:s,e.style.left=l+"px",e.style.top=c+"px";var h=-l*(this.canvasWidth/this.smallMapWidth)+this.initialLeft+30,p=-c*(this.canvasHeight/this.smallMapHeight)+this.initialTop+30;this.setCanvasPosition(h,p)}}},It=(n(824),Object(B.a)(At,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"canvas-container",attrs:{id:"canvasContainer"}},[n("js-flow",{ref:"jsFlow",class:["canvas-wrapper",{"tool-wrapper-telescopic":t.showNodeMenu}],attrs:{selector:"entry-item",data:t.flowData,"show-palette":t.showPalette,"show-tool":t.showTool,editable:t.editable,"endpoint-options":t.endpointOptions,"connector-options":t.connectorOptions},on:{onCreateNodeBefore:t.onCreateNodeBefore,onCreateNodeAfter:t.onCreateNodeAfter,onConnectionDragStop:t.onConnectionDragStop,onBeforeDrag:t.onBeforeDrag,onBeforeDrop:t.onBeforeDrop,onConnection:t.onConnection,onConnectionDetached:t.onConnectionDetached,onEndpointClick:t.onEndpointClick,onNodeMoving:t.onNodeMoving,onNodeMoveStop:t.onNodeMoveStop,onOverlayClick:t.onOverlayClick,onFrameSelectEnd:t.onFrameSelectEnd,onCloseFrameSelect:t.onCloseFrameSelect},scopedSlots:t._u([{key:"palettePanel",fn:function(){return[n("palette-panel",{attrs:{common:t.common,"atom-type-list":t.atomTypeList,"template-labels":t.templateLabels,"is-disable-start-point":t.isDisableStartPoint,"is-disable-end-point":t.isDisableEndPoint,"subflow-list-loading":t.subAtomListLoading},on:{updateNodeMenuState:t.updateNodeMenuState}})]},proxy:!0},{key:"toolPanel",fn:function(){return[n("tool-panel",{attrs:{"is-selection-open":t.isSelectionOpen,"is-show-select-all-tool":t.isShowSelectAllTool,"is-select-all-tool-disabled":t.isSelectAllToolDisabled,"is-all-selected":t.isAllSelected,"show-small-map":t.showSmallMap,editable:t.editable},on:{onShowMap:t.onToggleMapShow,onZoomIn:t.onZoomIn,onZoomOut:t.onZoomOut,onResetPosition:t.onResetPosition,onOpenFrameSelect:t.onOpenFrameSelect,onFormatPosition:t.onFormatPosition,onToggleAllNode:t.onToggleAllNode,onToggleHotKeyInfo:t.onToggleHotKeyInfo,onDownloadCanvas:t.onDownloadCanvas}})]},proxy:!0},{key:"nodeTemplate",fn:function(e){var i=e.node;return[n("node-template",{attrs:{node:i,"canvas-data":t.canvasData,"is-node-check-open":t.isNodeCheckOpen,editable:t.editable,"id-of-node-shortcut-panel":t.idOfNodeShortcutPanel,"has-admin-perm":t.hasAdminPerm},on:{onConfigBtnClick:t.onShowNodeConfig,onInsertNode:t.onInsertNode,onAppendNode:t.onAppendNode,onNodeDblclick:t.onNodeDblclick,onNodeClick:t.onNodeClick,onNodeMousedown:t.onNodeMousedown,onNodeCheckClick:t.onNodeCheckClick,onNodeRemove:t.onNodeRemove,onRetryClick:t.onRetryClick,onForceFail:t.onForceFail,onSkipClick:t.onSkipClick,onModifyTimeClick:t.onModifyTimeClick,onGatewaySelectionClick:t.onGatewaySelectionClick,onTaskNodeResumeClick:t.onTaskNodeResumeClick,addNodesToDragSelection:t.addNodeToSelectedList,onSubflowPauseResumeClick:t.onSubflowPauseResumeClick}})]}}])}),t._v(" "),n("help-info",{attrs:{editable:t.editable,"is-show-hot-key":t.isShowHotKey},on:{onZoomIn:t.onZoomIn,onZoomOut:t.onZoomOut,onMovePosition:t.onMovePosition,onResetPosition:t.onResetPosition,onCloseHotkeyInfo:t.onCloseHotkeyInfo}}),t._v(" "),t.showSmallMap?n("div",{ref:"smallMap",staticClass:"small-map"},[n("img",{attrs:{src:t.smallMapImg,alt:""}}),t._v(" "),n("div",{ref:"selectBox",staticClass:"select-box",on:{mousedown:function(e){return e.preventDefault(),t.onMouseDownSelect.apply(null,arguments)}}})]):t._e()],1)}),[],!1,null,null,null));e.a=It.exports},698:function(t,e,n){"use strict";var i=n(14),o=n(752);i({target:"String",proto:!0,forced:n(753)("anchor")},{anchor:function(t){return o(this,"a","name",t)}})},699:function(t,e){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},700:function(t,e,n){var i=n(84),o=n(30);t.exports=function(t){if(void 0===t)return 0;var e=i(t),n=o(e);if(e!==n)throw RangeError("Wrong length or index");return n}},701:function(t,e,n){"use strict";var i=n(34),o=n(131),s=n(30);t.exports=function(t){for(var e=i(this),n=s(e.length),a=arguments.length,r=o(a>1?arguments[1]:void 0,n),l=a>2?arguments[2]:void 0,c=void 0===l?n:o(l,n);c>r;)e[r++]=t;return e}},702:function(t,e,n){var i=n(800);t.exports=function(t,e){var n=i(t);if(n%e)throw RangeError("Wrong offset");return n}},703:function(t,e,n){var i=n(86),o=n(34),s=n(107),a=n(30),r=function(t){return function(e,n,r,l){i(n);var c=o(e),u=s(c),d=a(c.length),h=t?d-1:0,p=t?-1:1;if(r<2)for(;;){if(h in u){l=u[h],h+=p;break}if(h+=p,t?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;t?h>=0:d>h;h+=p)h in u&&(l=n(l,u[h],h,c));return l}};t.exports={left:r(!1),right:r(!0)}},704:function(t,e,n){var i=n(106),o=n(20),s=n(18),a=n(29).f,r=n(135),l=n(806),c=r("meta"),u=0,d=Object.isExtensible||function(){return!0},h=function(t){a(t,c,{value:{objectID:"O"+u++,weakData:{}}})},p=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,c)){if(!d(t))return"F";if(!e)return"E";h(t)}return t[c].objectID},getWeakData:function(t,e){if(!s(t,c)){if(!d(t))return!0;if(!e)return!1;h(t)}return t[c].weakData},onFreeze:function(t){return l&&p.REQUIRED&&d(t)&&!s(t,c)&&h(t),t}};i[c]=!0},705:function(t,e,n){},706:function(t,e,n){},707:function(t,e,n){},708:function(t,e,n){},709:function(t,e,n){},710:function(t,e,n){},711:function(t,e,n){},712:function(t,e,n){t.exports=n.p+"images/left-branchgateway-guide.27651c2720.gif"},713:function(t,e,n){},714:function(t,e,n){},715:function(t,e,n){},716:function(t,e,n){},726:function(t,e,n){},734:function(t,e,n){"use strict";var i=n(805),o=n(807);t.exports=i("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),o)},754:function(t,e,n){"use strict";var i=n(14),o=n(8),s=n(689),a=n(17),r=n(131),l=n(30),c=n(186),u=s.ArrayBuffer,d=s.DataView,h=u.prototype.slice;i({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:o((function(){return!new u(2).slice(1,void 0).byteLength}))},{slice:function(t,e){if(void 0!==h&&void 0===e)return h.call(a(this),t);for(var n=a(this).byteLength,i=r(t,n),o=r(void 0===e?n:e,n),s=new(c(this,u))(l(o-i)),p=new d(this),f=new d(s),m=0;i<o;)f.setUint8(m++,p.getUint8(i++));return s}})},755:function(t,e,n){n(798)("Uint8",(function(t){return function(e,n,i){return t(this,e,n,i)}}))},756:function(t,e,n){"use strict";var i=n(609),o=n(802),s=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(t,e){return o.call(s(this),t,e,arguments.length>2?arguments[2]:void 0)}))},757:function(t,e,n){"use strict";var i=n(609),o=n(69).every,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("every",(function(t){return o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},758:function(t,e,n){"use strict";var i=n(609),o=n(701),s=i.aTypedArray;(0,i.exportTypedArrayMethod)("fill",(function(t){return o.apply(s(this),arguments)}))},759:function(t,e,n){"use strict";var i=n(609),o=n(69).filter,s=n(803),a=i.aTypedArray;(0,i.exportTypedArrayMethod)("filter",(function(t){var e=o(a(this),t,arguments.length>1?arguments[1]:void 0);return s(this,e)}))},760:function(t,e,n){"use strict";var i=n(609),o=n(69).find,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("find",(function(t){return o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},761:function(t,e,n){"use strict";var i=n(609),o=n(69).findIndex,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("findIndex",(function(t){return o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},762:function(t,e,n){"use strict";var i=n(609),o=n(69).forEach,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("forEach",(function(t){o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},763:function(t,e,n){"use strict";var i=n(609),o=n(190).includes,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("includes",(function(t){return o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},764:function(t,e,n){"use strict";var i=n(609),o=n(190).indexOf,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("indexOf",(function(t){return o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},765:function(t,e,n){"use strict";var i=n(13),o=n(609),s=n(101),a=n(10)("iterator"),r=i.Uint8Array,l=s.values,c=s.keys,u=s.entries,d=o.aTypedArray,h=o.exportTypedArrayMethod,p=r&&r.prototype[a],f=!!p&&("values"==p.name||null==p.name),m=function(){return l.call(d(this))};h("entries",(function(){return u.call(d(this))})),h("keys",(function(){return c.call(d(this))})),h("values",m,!f),h(a,m,!f)},766:function(t,e,n){"use strict";var i=n(609),o=i.aTypedArray,s=i.exportTypedArrayMethod,a=[].join;s("join",(function(t){return a.apply(o(this),arguments)}))},767:function(t,e,n){"use strict";var i=n(609),o=n(804),s=i.aTypedArray;(0,i.exportTypedArrayMethod)("lastIndexOf",(function(t){return o.apply(s(this),arguments)}))},768:function(t,e,n){"use strict";var i=n(609),o=n(69).map,s=n(186),a=i.aTypedArray,r=i.aTypedArrayConstructor;(0,i.exportTypedArrayMethod)("map",(function(t){return o(a(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(r(s(t,t.constructor)))(e)}))}))},769:function(t,e,n){"use strict";var i=n(609),o=n(703).left,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduce",(function(t){return o(s(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}))},770:function(t,e,n){"use strict";var i=n(609),o=n(703).right,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduceRight",(function(t){return o(s(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}))},771:function(t,e,n){"use strict";var i=n(609),o=i.aTypedArray,s=i.exportTypedArrayMethod,a=Math.floor;s("reverse",(function(){for(var t,e=o(this).length,n=a(e/2),i=0;i<n;)t=this[i],this[i++]=this[--e],this[e]=t;return this}))},772:function(t,e,n){"use strict";var i=n(609),o=n(30),s=n(702),a=n(34),r=n(8),l=i.aTypedArray;(0,i.exportTypedArrayMethod)("set",(function(t){l(this);var e=s(arguments.length>1?arguments[1]:void 0,1),n=this.length,i=a(t),r=o(i.length),c=0;if(r+e>n)throw RangeError("Wrong length");for(;c<r;)this[e+c]=i[c++]}),r((function(){new Int8Array(1).set({})})))},773:function(t,e,n){"use strict";var i=n(609),o=n(186),s=n(8),a=i.aTypedArray,r=i.aTypedArrayConstructor,l=i.exportTypedArrayMethod,c=[].slice;l("slice",(function(t,e){for(var n=c.call(a(this),t,e),i=o(this,this.constructor),s=0,l=n.length,u=new(r(i))(l);l>s;)u[s]=n[s++];return u}),s((function(){new Int8Array(1).slice()})))},774:function(t,e,n){"use strict";var i=n(609),o=n(69).some,s=i.aTypedArray;(0,i.exportTypedArrayMethod)("some",(function(t){return o(s(this),t,arguments.length>1?arguments[1]:void 0)}))},775:function(t,e,n){"use strict";var i=n(609),o=n(13),s=n(8),a=n(86),r=n(30),l=n(325),c=n(326),u=n(327),d=n(89),h=n(328),p=i.aTypedArray,f=i.exportTypedArrayMethod,m=o.Uint16Array,v=m&&m.prototype.sort,g=!!v&&!s((function(){var t=new m(2);t.sort(null),t.sort({})})),b=!!v&&!s((function(){if(d)return d<74;if(c)return c<67;if(u)return!0;if(h)return h<602;var t,e,n=new m(516),i=Array(516);for(t=0;t<516;t++)e=t%4,n[t]=515-t,i[t]=t-2*e+3;for(n.sort((function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(n[t]!==i[t])return!0}));f("sort",(function(t){if(void 0!==t&&a(t),b)return v.call(this,t);p(this);var e,n=r(this.length),i=Array(n);for(e=0;e<n;e++)i[e]=this[e];for(i=l(this,function(t){return function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}}(t)),e=0;e<n;e++)this[e]=i[e];return this}),!b||g)},776:function(t,e,n){"use strict";var i=n(609),o=n(30),s=n(131),a=n(186),r=i.aTypedArray;(0,i.exportTypedArrayMethod)("subarray",(function(t,e){var n=r(this),i=n.length,l=s(t,i);return new(a(n,n.constructor))(n.buffer,n.byteOffset+l*n.BYTES_PER_ELEMENT,o((void 0===e?i:s(e,i))-l))}))},777:function(t,e,n){"use strict";var i=n(13),o=n(609),s=n(8),a=i.Int8Array,r=o.aTypedArray,l=o.exportTypedArrayMethod,c=[].toLocaleString,u=[].slice,d=!!a&&s((function(){c.call(new a(1))}));l("toLocaleString",(function(){return c.apply(d?u.call(r(this)):r(this),arguments)}),s((function(){return[1,2].toLocaleString()!=new a([1,2]).toLocaleString()}))||!s((function(){a.prototype.toLocaleString.call([1,2])})))},778:function(t,e,n){"use strict";var i=n(609).exportTypedArrayMethod,o=n(8),s=n(13).Uint8Array,a=s&&s.prototype||{},r=[].toString,l=[].join;o((function(){r.call({})}))&&(r=function(){return l.call(this)});var c=a.toString!=r;i("toString",r,c)},789:function(t,e,n){"use strict";var i=n(0),o=n.n(i),s={name:"GuidePopover",props:{config:{type:Object,default:function(){return o()(this,void 0),{}}.bind(void 0)}},data:function(){return{}}},a=(n(816),n(9)),r=Object(a.a)(s,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"guide-popover"},[n("div",{staticClass:"guide-content"},[t.config.img?n("div",{staticClass:"guide-map",style:{height:t.config.img.height+"px"}},[n("img",{staticClass:"guide-img",attrs:{src:t.config.img.url,alt:"guide-img"}})]):t._e(),t._v(" "),n("div",{staticClass:"guide-info"},t._l(t.config.text,(function(e,i){return n("span",{key:i,class:e.type},[t._v("\n                "+t._s(e.val)+"\n            ")])})),0)])])}),[],!1,null,"7c24c1cc",null).exports,l=n(3),c=n(12);e.a=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=e;var n=l.default.extend(r);this.int=new n,this.int.$props.config=e,this.int.$mount(),this.mount=function(e){var n=this;o()(this,t);var i=this.config,s=i.width,a=i.trigger,r=i.placement,l=i.delay,u=i.arrow,d=i.once;this.instance=this.instance||c.a.$bkPopover(e,{width:s,arrow:u,placement:r,delay:l||0,duration:[0,0],trigger:a||"click",allowHTML:!0,theme:"guide",animation:"shift-away",content:this.int.$el.innerHTML,zIndex:2100,onHidden:function(){o()(this,n),d&&this.instance.destroy()}.bind(this)})}.bind(this)}},792:function(t,e,n){},796:function(t,e,n){},797:function(t,e){var n=Math.abs,i=Math.pow,o=Math.floor,s=Math.log,a=Math.LN2;t.exports={pack:function(t,e,r){var l,c,u,d=new Array(r),h=8*r-e-1,p=(1<<h)-1,f=p>>1,m=23===e?i(2,-24)-i(2,-77):0,v=t<0||0===t&&1/t<0?1:0,g=0;for((t=n(t))!=t||t===1/0?(c=t!=t?1:0,l=p):(l=o(s(t)/a),t*(u=i(2,-l))<1&&(l--,u*=2),(t+=l+f>=1?m/u:m*i(2,1-f))*u>=2&&(l++,u/=2),l+f>=p?(c=0,l=p):l+f>=1?(c=(t*u-1)*i(2,e),l+=f):(c=t*i(2,f-1)*i(2,e),l=0));e>=8;d[g++]=255&c,c/=256,e-=8);for(l=l<<e|c,h+=e;h>0;d[g++]=255&l,l/=256,h-=8);return d[--g]|=128*v,d},unpack:function(t,e){var n,o=t.length,s=8*o-e-1,a=(1<<s)-1,r=a>>1,l=s-7,c=o-1,u=t[c--],d=127&u;for(u>>=7;l>0;d=256*d+t[c],c--,l-=8);for(n=d&(1<<-l)-1,d>>=-l,l+=e;l>0;n=256*n+t[c],c--,l-=8);if(0===d)d=1-r;else{if(d===a)return n?NaN:u?-1/0:1/0;n+=i(2,e),d-=r}return(u?-1:1)*n*i(2,d-e)}}},798:function(t,e,n){"use strict";var i=n(14),o=n(13),s=n(19),a=n(799),r=n(609),l=n(689),c=n(132),u=n(73),d=n(35),h=n(30),p=n(700),f=n(702),m=n(88),v=n(18),g=n(136),b=n(20),y=n(71),_=n(133),w=n(85).f,C=n(801),S=n(69).forEach,k=n(188),x=n(29),P=n(53),E=n(44),D=n(189),j=E.get,O=E.set,T=x.f,L=P.f,N=Math.round,A=o.RangeError,I=l.ArrayBuffer,M=l.DataView,$=r.NATIVE_ARRAY_BUFFER_VIEWS,F=r.TYPED_ARRAY_TAG,R=r.TypedArray,B=r.TypedArrayPrototype,V=r.aTypedArrayConstructor,H=r.isTypedArray,G=function(t,e){for(var n=0,i=e.length,o=new(V(t))(i);i>n;)o[n]=e[n++];return o},U=function(t,e){T(t,e,{get:function(){return j(this)[e]}})},Y=function(t){var e;return t instanceof I||"ArrayBuffer"==(e=g(t))||"SharedArrayBuffer"==e},z=function(t,e){return H(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},W=function(t,e){return z(t,e=m(e,!0))?u(2,t[e]):L(t,e)},X=function(t,e,n){return!(z(t,e=m(e,!0))&&b(n)&&v(n,"value"))||v(n,"get")||v(n,"set")||n.configurable||v(n,"writable")&&!n.writable||v(n,"enumerable")&&!n.enumerable?T(t,e,n):(t[e]=n.value,t)};s?($||(P.f=W,x.f=X,U(B,"buffer"),U(B,"byteOffset"),U(B,"byteLength"),U(B,"length")),i({target:"Object",stat:!0,forced:!$},{getOwnPropertyDescriptor:W,defineProperty:X}),t.exports=function(t,e,n){var s=t.match(/\d+$/)[0]/8,r=t+(n?"Clamped":"")+"Array",l="get"+t,u="set"+t,m=o[r],v=m,g=v&&v.prototype,x={},P=function(t,e){T(t,e,{get:function(){return function(t,e){var n=j(t);return n.view[l](e*s+n.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,i){var o=j(t);n&&(i=(i=N(i))<0?0:i>255?255:255&i),o.view[u](e*s+o.byteOffset,i,!0)}(this,e,t)},enumerable:!0})};$?a&&(v=e((function(t,e,n,i){return c(t,v,r),D(b(e)?Y(e)?void 0!==i?new m(e,f(n,s),i):void 0!==n?new m(e,f(n,s)):new m(e):H(e)?G(v,e):C.call(v,e):new m(p(e)),t,v)})),_&&_(v,R),S(w(m),(function(t){t in v||d(v,t,m[t])})),v.prototype=g):(v=e((function(t,e,n,i){c(t,v,r);var o,a,l,u=0,d=0;if(b(e)){if(!Y(e))return H(e)?G(v,e):C.call(v,e);o=e,d=f(n,s);var m=e.byteLength;if(void 0===i){if(m%s)throw A("Wrong length");if((a=m-d)<0)throw A("Wrong length")}else if((a=h(i)*s)+d>m)throw A("Wrong length");l=a/s}else l=p(e),o=new I(a=l*s);for(O(t,{buffer:o,byteOffset:d,byteLength:a,length:l,view:new M(o)});u<l;)P(t,u++)})),_&&_(v,R),g=v.prototype=y(B)),g.constructor!==v&&d(g,"constructor",v),F&&d(g,F,r),x[r]=v,i({global:!0,forced:v!=m,sham:!$},x),"BYTES_PER_ELEMENT"in v||d(v,"BYTES_PER_ELEMENT",s),"BYTES_PER_ELEMENT"in g||d(g,"BYTES_PER_ELEMENT",s),k(r)}):t.exports=function(){}},799:function(t,e,n){var i=n(13),o=n(8),s=n(316),a=n(609).NATIVE_ARRAY_BUFFER_VIEWS,r=i.ArrayBuffer,l=i.Int8Array;t.exports=!a||!o((function(){l(1)}))||!o((function(){new l(-1)}))||!s((function(t){new l,new l(null),new l(1.5),new l(t)}),!0)||o((function(){return 1!==new l(new r(2),1,void 0).length}))},800:function(t,e,n){var i=n(84);t.exports=function(t){var e=i(t);if(e<0)throw RangeError("The argument can't be less than 0");return e}},801:function(t,e,n){var i=n(34),o=n(30),s=n(108),a=n(195),r=n(87),l=n(609).aTypedArrayConstructor;t.exports=function(t){var e,n,c,u,d,h,p=i(t),f=arguments.length,m=f>1?arguments[1]:void 0,v=void 0!==m,g=s(p);if(null!=g&&!a(g))for(h=(d=g.call(p)).next,p=[];!(u=h.call(d)).done;)p.push(u.value);for(v&&f>2&&(m=r(m,arguments[2],2)),n=o(p.length),c=new(l(this))(n),e=0;n>e;e++)c[e]=v?m(p[e],e):p[e];return c}},802:function(t,e,n){"use strict";var i=n(34),o=n(131),s=n(30),a=Math.min;t.exports=[].copyWithin||function(t,e){var n=i(this),r=s(n.length),l=o(t,r),c=o(e,r),u=arguments.length>2?arguments[2]:void 0,d=a((void 0===u?r:o(u,r))-c,r-l),h=1;for(c<l&&l<c+d&&(h=-1,c+=d-1,l+=d-1);d-- >0;)c in n?n[l]=n[c]:delete n[l],l+=h,c+=h;return n}},803:function(t,e,n){var i=n(609).aTypedArrayConstructor,o=n(186);t.exports=function(t,e){for(var n=o(t,t.constructor),s=0,a=e.length,r=new(i(n))(a);a>s;)r[s]=e[s++];return r}},804:function(t,e,n){"use strict";var i=n(40),o=n(84),s=n(30),a=n(140),r=Math.min,l=[].lastIndexOf,c=!!l&&1/[1].lastIndexOf(1,-0)<0,u=a("lastIndexOf"),d=c||!u;t.exports=d?function(t){if(c)return l.apply(this,arguments)||0;var e=i(this),n=s(e.length),a=n-1;for(arguments.length>1&&(a=r(a,o(arguments[1]))),a<0&&(a=n+a);a>=0;a--)if(a in e&&e[a]===t)return a||0;return-1}:l},805:function(t,e,n){"use strict";var i=n(14),o=n(13),s=n(105),a=n(31),r=n(704),l=n(318),c=n(132),u=n(20),d=n(8),h=n(316),p=n(72),f=n(189);t.exports=function(t,e,n){var m=-1!==t.indexOf("Map"),v=-1!==t.indexOf("Weak"),g=m?"set":"add",b=o[t],y=b&&b.prototype,_=b,w={},C=function(t){var e=y[t];a(y,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!u(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})};if(s(t,"function"!=typeof b||!(v||y.forEach&&!d((function(){(new b).entries().next()})))))_=n.getConstructor(e,t,m,g),r.REQUIRED=!0;else if(s(t,!0)){var S=new _,k=S[g](v?{}:-0,1)!=S,x=d((function(){S.has(1)})),P=h((function(t){new b(t)})),E=!v&&d((function(){for(var t=new b,e=5;e--;)t[g](e,e);return!t.has(-0)}));P||((_=e((function(e,n){c(e,_,t);var i=f(new b,e,_);return null!=n&&l(n,i[g],{that:i,AS_ENTRIES:m}),i}))).prototype=y,y.constructor=_),(x||E)&&(C("delete"),C("has"),m&&C("get")),(E||k)&&C(g),v&&y.clear&&delete y.clear}return w[t]=_,i({global:!0,forced:_!=b},w),p(_,t),v||n.setStrong(_,t,m),_}},806:function(t,e,n){var i=n(8);t.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},807:function(t,e,n){"use strict";var i=n(29).f,o=n(71),s=n(192),a=n(87),r=n(132),l=n(318),c=n(194),u=n(188),d=n(19),h=n(704).fastKey,p=n(44),f=p.set,m=p.getterFor;t.exports={getConstructor:function(t,e,n,c){var u=t((function(t,i){r(t,u,e),f(t,{type:e,index:o(null),first:void 0,last:void 0,size:0}),d||(t.size=0),null!=i&&l(i,t[c],{that:t,AS_ENTRIES:n})})),p=m(e),v=function(t,e,n){var i,o,s=p(t),a=g(t,e);return a?a.value=n:(s.last=a={index:o=h(e,!0),key:e,value:n,previous:i=s.last,next:void 0,removed:!1},s.first||(s.first=a),i&&(i.next=a),d?s.size++:t.size++,"F"!==o&&(s.index[o]=a)),t},g=function(t,e){var n,i=p(t),o=h(e);if("F"!==o)return i.index[o];for(n=i.first;n;n=n.next)if(n.key==e)return n};return s(u.prototype,{clear:function(){for(var t=p(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,d?t.size=0:this.size=0},delete:function(t){var e=p(this),n=g(this,t);if(n){var i=n.next,o=n.previous;delete e.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),e.first==n&&(e.first=i),e.last==n&&(e.last=o),d?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=p(this),i=a(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.next:n.first;)for(i(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!g(this,t)}}),s(u.prototype,n?{get:function(t){var e=g(this,t);return e&&e.value},set:function(t,e){return v(this,0===t?0:t,e)}}:{add:function(t){return v(this,t=0===t?0:t,t)}}),d&&i(u.prototype,"size",{get:function(){return p(this).size}}),u},setStrong:function(t,e,n){var i=e+" Iterator",o=m(e),s=m(i);c(t,e,(function(t,e){f(this,{type:i,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=s(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),u(e)}}},808:function(t,e,n){(function(){void 0===Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},n=function(t,e){return t.x*e.x+t.y*e.y},i=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},o=function(t,e){return{x:t.x*e,y:t.y*e}},s=Math.pow(2,-65),a=function(e,n){for(var o=[],s=r(e,n),a=n.length-1,c=l(s,2*a-1,o,0),u=t(e,n[0]),d=i(u),p=0,f=0;f<c;f++){u=t(e,h(n,a,o[f],null,null));var m=i(u);m<d&&(d=m,p=o[f])}return u=t(e,n[a]),(m=i(u))<d&&(d=m,p=1),{location:p,distance:d}},r=function(e,i){for(var s=i.length-1,a=2*s-1,r=[],l=[],c=[],u=[],d=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],h=0;h<=s;h++)r[h]=t(i[h],e);for(h=0;h<=s-1;h++)l[h]=t(i[h+1],i[h]),l[h]=o(l[h],3);for(var p=0;p<=s-1;p++)for(var f=0;f<=s;f++)c[p]||(c[p]=[]),c[p][f]=n(l[p],r[f]);for(h=0;h<=a;h++)u[h]||(u[h]=[]),u[h].y=0,u[h].x=parseFloat(h)/a;for(var m=s,v=s-1,g=0;g<=m+v;g++){var b=Math.max(0,g-v),y=Math.min(g,m);for(h=b;h<=y;h++){var _=g-h;u[h+_].y+=c[_][h]*d[_][h]}}return u},l=function(t,e,n,i){var o,s,a=[],r=[],p=[],f=[];switch(c(t,e)){case 0:return 0;case 1:if(i>=64)return n[0]=(t[0].x+t[e].x)/2,1;if(u(t,e))return n[0]=d(t,e),1}h(t,e,.5,a,r),o=l(a,e,p,i+1),s=l(r,e,f,i+1);for(var m=0;m<o;m++)n[m]=p[m];for(m=0;m<s;m++)n[m+o]=f[m];return o+s},c=function(t,e){var n,i,o=0;n=i=Math.sgn(t[0].y);for(var s=1;s<=e;s++)(n=Math.sgn(t[s].y))!=i&&o++,i=n;return o},u=function(t,e){var n,i,o,a,r,l,c,u,d;a=t[0].y-t[e].y,r=t[e].x-t[0].x,l=t[0].x*t[e].y-t[e].x*t[0].y,u=d=0;for(var h=1;h<e;h++){var p=a*t[h].x+r*t[h].y+l;p>u?u=p:p<d&&(d=p)}return 0,1,0,n=(1*(l-u)-0*(c=r))*(1/(0*c-1*a)),i=(1*(l-d)-0*(c=r))*(1/(0*c-1*a)),o=Math.min(n,i),Math.max(n,i)-o<s?1:0},d=function(t,e){var n=t[e].x-t[0].x,i=t[e].y-t[0].y,o=t[0].x-0;return 0+1*((n*(t[0].y-0)-i*o)*(1/(0*n-1*i)))},h=function(t,e,n,i,o){for(var s=[[]],a=0;a<=e;a++)s[0][a]=t[a];for(var r=1;r<=e;r++)for(a=0;a<=e-r;a++)s[r]||(s[r]=[]),s[r][a]||(s[r][a]={}),s[r][a].x=(1-n)*s[r-1][a].x+n*s[r-1][a+1].x,s[r][a].y=(1-n)*s[r-1][a].y+n*s[r-1][a+1].y;if(null!=i)for(a=0;a<=e;a++)i[a]=s[a][0];if(null!=o)for(a=0;a<=e;a++)o[a]=s[e-a][a];return s[e][0]},p={},f=function(t,e){for(var n=function(t){var e=p[t];if(!e){var n=function(t){return function(e){return t}},i=function(){return function(t){return t}},o=function(){return function(t){return 1-t}},s=function(t){return function(e){for(var n=1,i=0;i<t.length;i++)n*=t[i](e);return n}};(e=[]).push(new function(){return function(e){return Math.pow(e,t)}});for(var a=1;a<t;a++){for(var r=[new n(t)],l=0;l<t-a;l++)r.push(new i);for(l=0;l<a;l++)r.push(new o);e.push(new s(r))}e.push(new function(){return function(e){return Math.pow(1-e,t)}}),p[t]=e}return e}(t.length-1),i=0,o=0,s=0;s<t.length;s++)i+=t[s].x*n[s](e),o+=t[s].y*n[s](e);return{x:i,y:o}},m=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},v=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},g=function(t,e,n){if(v(t))return{point:t[0],location:e};for(var i=f(t,e),o=0,s=e,a=n>0?1:-1,r=null;o<Math.abs(n);)r=f(t,s+=.005*a),o+=m(r,i),i=r;return{point:r,location:s}},b=function(t,e){var n=f(t,e),i=f(t.slice(0,t.length-1),e),o=i.y-n.y,s=i.x-n.x;return 0===o?1/0:Math.atan(o/s)},y=function(t,e,n,i,o){var s=i-e,a=t-n,r=t*(e-i)+e*(n-t),l=function(t){return[_(t,"x"),_(t,"y")]}(o),c=[s*l[0][0]+a*l[1][0],s*l[0][1]+a*l[1][1],s*l[0][2]+a*l[1][2],s*l[0][3]+a*l[1][3]+r],u=C.apply(null,c),d=[];if(null!=u)for(var h=0;h<3;h++){var p,f=u[h],m=Math.pow(f,2),v=Math.pow(f,3),g=[l[0][0]*v+l[0][1]*m+l[0][2]*f+l[0][3],l[1][0]*v+l[1][1]*m+l[1][2]*f+l[1][3]];p=n-t!=0?(g[0]-t)/(n-t):(g[1]-e)/(i-e),f>=0&&f<=1&&p>=0&&p<=1&&d.push(g)}return d};function _(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function w(t){return t<0?-1:t>0?1:0}function C(t,e,n,i){var o,s,a=e/t,r=n/t,l=i/t,c=(3*r-Math.pow(a,2))/9,u=(9*a*r-27*l-2*Math.pow(a,3))/54,d=Math.pow(c,3)+Math.pow(u,2),h=[];if(d>=0)o=w(u+Math.sqrt(d))*Math.pow(Math.abs(u+Math.sqrt(d)),1/3),s=w(u-Math.sqrt(d))*Math.pow(Math.abs(u-Math.sqrt(d)),1/3),h[0]=-a/3+(o+s),h[1]=-a/3-(o+s)/2,h[2]=-a/3-(o+s)/2,0!==Math.abs(Math.sqrt(3)*(o-s)/2)&&(h[1]=-1,h[2]=-1);else{var p=Math.acos(u/Math.sqrt(-Math.pow(c,3)));h[0]=2*Math.sqrt(-c)*Math.cos(p/3)-a/3,h[1]=2*Math.sqrt(-c)*Math.cos((p+2*Math.PI)/3)-a/3,h[2]=2*Math.sqrt(-c)*Math.cos((p+4*Math.PI)/3)-a/3}for(var f=0;f<3;f++)(h[f]<0||h[f]>1)&&(h[f]=-1);return h}var S=this.jsBezier={distanceFromCurve:a,gradientAtPoint:b,gradientAtPointAlongCurveFrom:function(t,e,n){var i=g(t,e,n);return i.location>1&&(i.location=1),i.location<0&&(i.location=0),b(t,i.location)},nearestPointOnCurve:function(t,e){var n=a(t,e);return{point:h(e,e.length-1,n.location,null,null),location:n.location}},pointOnCurve:f,pointAlongCurveFrom:function(t,e,n){return g(t,e,n).point},perpendicularToCurveAt:function(t,e,n,i){var o=g(t,e,i=null==i?0:i),s=b(t,o.location),a=Math.atan(-1/s),r=n/2*Math.sin(a),l=n/2*Math.cos(a);return[{x:o.point.x+l,y:o.point.y+r},{x:o.point.x-l,y:o.point.y-r}]},locationAlongCurveFrom:function(t,e,n){return g(t,e,n).location},getLength:function(t){var e=(new Date).getTime();if(v(t))return 0;for(var n=f(t,0),i=0,o=0,s=null;o<1;)s=f(t,o+=.005),i+=m(s,n),n=s;return console.log("length",(new Date).getTime()-e),i},lineIntersection:y,boxIntersection:function(t,e,n,i,o){var s=[];return s.push.apply(s,y(t,e,t+n,e,o)),s.push.apply(s,y(t+n,e,t+n,e+i,o)),s.push.apply(s,y(t+n,e+i,t,e+i,o)),s.push.apply(s,y(t,e+i,t,e,o)),s},boundingBoxIntersection:function(t,e){var n=[];return n.push.apply(n,y(t.x,t.y,t.x+t.w,t.y,e)),n.push.apply(n,y(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),n.push.apply(n,y(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),n.push.apply(n,y(t.x,t.y+t.h,t.x,t.y,e)),n},version:"0.9.0"};e.jsBezier=S}).call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.Biltong={version:"0.4.0"};e.Biltong=t;var n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=function(t,e,i){return i(t=n(t)?t:[t.x,t.y],e=n(e)?e:[e.x,e.y])},o=t.gradient=function(t,e){return i(t,e,(function(t,e){return e[0]==t[0]?e[1]>t[1]?1/0:-1/0:e[1]==t[1]?e[0]>t[0]?0:-0:(e[1]-t[1])/(e[0]-t[0])}))},s=(t.normal=function(t,e){return-1/o(t,e)},t.lineLength=function(t,e){return i(t,e,(function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))}))},t.quadrant=function(t,e){return i(t,e,(function(t,e){return e[0]>t[0]||e[0]==t[0]?e[1]>t[1]?2:1:e[1]>t[1]?3:4}))}),a=(t.theta=function(t,e){return i(t,e,(function(t,e){var n=o(t,e),i=Math.atan(n),a=s(t,e);return 4!=a&&3!=a||(i+=Math.PI),i<0&&(i+=2*Math.PI),i}))},t.intersects=function(t,e){var n=t.x,i=t.x+t.w,o=t.y,s=t.y+t.h,a=e.x,r=e.x+e.w,l=e.y,c=e.y+e.h;return n<=a&&a<=i&&o<=l&&l<=s||n<=r&&r<=i&&o<=l&&l<=s||n<=a&&a<=i&&o<=c&&c<=s||n<=r&&a<=i&&o<=c&&c<=s||a<=n&&n<=r&&l<=o&&o<=c||a<=i&&i<=r&&l<=o&&o<=c||a<=n&&n<=r&&l<=s&&s<=c||a<=i&&n<=r&&l<=s&&s<=c},t.encloses=function(t,e,n){var i=t.x,o=t.x+t.w,s=t.y,a=t.y+t.h,r=e.x,l=e.x+e.w,c=e.y,u=e.y+e.h,d=function(t,e,i,o){return n?t<=e&&i>=o:t<e&&i>o};return d(i,r,o,l)&&d(s,c,a,u)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),r=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,e,n){var i=o(t,e),l=s(t,e),c=n>0?a[l]:r[l],u=Math.atan(i),d=Math.abs(n*Math.sin(u))*c[1],h=Math.abs(n*Math.cos(u))*c[0];return{x:t.x+h,y:t.y+d}},t.perpendicularLineTo=function(t,e,n){var i=o(t,e),s=Math.atan(-1/i),a=n/2*Math.sin(s),r=n/2*Math.cos(s);return[{x:e.x+r,y:e.y+a},{x:e.x-r,y:e.y-a}]}}.call("undefined"!=typeof window?window:this),function(){"use strict";function t(t,e,n,i,o,s,a,r){return new Touch({target:e,identifier:O(),pageX:n,pageY:i,screenX:o,screenY:s,clientX:a||o,clientY:r||s})}function n(){var t=[];return Array.prototype.push.apply(t,arguments),t.item=function(t){return this[t]},t}var i=function(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1},o=function(t){return"string"==typeof t||t.constructor===String?document.getElementById(t):t},s=function(t){return t.srcElement||t.target},a=function(t,e,n,i){if(i){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var o={path:[],end:-1},s=function(t){o.path.push(t),t===n?o.end=o.path.length-1:null!=t.parentNode&&s(t.parentNode)};return s(e),o}return{path:[e],end:1}},r=function(t,e){for(var n=0,i=t.length;n<i&&t[n]!=e;n++);n<t.length&&t.splice(n,1)},l=1,c=function(t,e,n){var i=l++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][i]=n,n.__tauid=i,i},u=function(t,e,n,o){if(null==t)return n;var r=t.split(","),l=function(o){l.__tauid=n.__tauid;var c=s(o),u=c,d=a(o,c,e,null!=t);if(-1!=d.end)for(var h=0;h<d.end;h++){u=d.path[h];for(var p=0;p<r.length;p++)i(u,r[p],e)&&n.apply(u,arguments)}};return d(n,o,l),l},d=function(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])},h=function(t,e,n,i){if(g&&y[e]){var o=u(i,t,n,y[e]);E(t,y[e],o,n)}"focus"===e&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),E(t,e,u(i,t,n,e),n)},p={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},f=function(t,e){return function(n,o,l,c){if("contextmenu"==o&&b)h(n,o,l,c);else{if(null==n.__taTapHandler){var u=n.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},d=function(){u.down=!1},f=function(){u.taps=0};h(n,"mousedown",(function(o){for(var r=s(o),l=a(o,r,n,null!=c),h=!1,p=0;p<l.end;p++){if(h)return;r=l.path[p];for(var m=0;m<u.downSelectors.length;m++)if(null==u.downSelectors[m]||i(r,u.downSelectors[m],n)){u.down=!0,setTimeout(d,t),setTimeout(f,e),h=!0;break}}})),h(n,"mouseup",(function(t){if(u.down){var e,o,r=s(t);u.taps++;var l=P(t);for(var c in p)if(p.hasOwnProperty(c)){var d=p[c];if(d.touches===l&&(1===d.taps||d.taps===u.taps))for(var h=0;h<u[c].length;h++){o=a(t,r,n,null!=u[c][h][1]);for(var f=0;f<o.end;f++)if(e=o.path[f],null==u[c][h][1]||i(e,u[c][h][1],n)){u[c][h][0].apply(e,[t]);break}}}}}))}n.__taTapHandler.downSelectors.push(c),n.__taTapHandler[o].push([l,c]),l.__taUnstore=function(){r(n.__taTapHandler[o],l)}}}},m=function(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])},v=function(){var t=[];return function(e,n,o,a){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var r=function(n){var o=s(n);(null==a&&o==e&&!e.__tamee.over||i(o,a,e)&&(null==o.__tamee||!o.__tamee.over))&&(m("mouseenter",n,e,o),o.__tamee=o.__tamee||{},o.__tamee.over=!0,t.push(o))},l=function(n){for(var o=s(n),a=0;a<t.length;a++)o!=t[a]||i(n.relatedTarget||n.toElement,"*",o)||(o.__tamee.over=!1,t.splice(a,1),m("mouseexit",n,e,o))};E(e,"mouseover",u(a,e,r,"mouseover"),r),E(e,"mouseout",u(a,e,l,"mouseout"),l)}o.__taUnstore=function(){delete e.__tamee[n][o.__tauid]},c(e,n,o),e.__tamee[n][o.__tauid]=o}},g="ontouchstart"in document.documentElement||navigator.maxTouchPoints,b="onmousedown"in document.documentElement,y={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},_=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),w=_>-1&&_<9,C=function(t,e){if(null==t)return[0,0];var n=x(t),i=k(n,0);return[i[e+"X"],i[e+"Y"]]},S=function(t){return null==t?[0,0]:w?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:C(t,"page")},k=function(t,e){return t.item?t.item(e):t[e]},x=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},P=function(t){return x(t).length},E=function(t,e,n,i){if(c(t,e,n),i.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var o=e+n.__tauid;t["e"+o]=n,t[o]=function(){t["e"+o]&&t["e"+o](window.event)},t.attachEvent("on"+e,t[o])}},D=function(t,e,n){null!=n&&j(t,(function(){var i=o(this);if(function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)D(t,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(i,e,n),null!=n.__tauid)if(i.removeEventListener)i.removeEventListener(e,n,!1),g&&y[e]&&i.removeEventListener(y[e],n,!1);else if(this.detachEvent){var s=e+n.__tauid;i[s]&&i.detachEvent("on"+e,i[s]),i[s]=null,i["e"+s]=null}n.__taTouchProxy&&D(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}))},j=function(t,e){if(null!=t){t="undefined"!=typeof Window&&"unknown"!=typeof t.top&&t==t.top?[t]:"string"!=typeof t&&null==t.tagName&&null!=t.length?t:"string"==typeof t?document.querySelectorAll(t):[t];for(var n=0;n<t.length;n++)e.apply(t[n])}},O=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))};this.Mottle=function(e){var i=(e=e||{}).clickThreshold||250,a=e.dblClickThreshold||450,l=new v,c=new f(i,a),u=e.smartClicks,d=function(t,e,n,i){null!=n&&j(t,(function(){var t=o(this);u&&"click"===e?function(t,e,n,i){if(null==t.__taSmartClicks){h(t,"mousedown",(function(e){t.__tad=S(e)}),i),h(t,"mouseup",(function(e){t.__tau=S(e)}),i),h(t,"click",(function(e){if(t.__tad&&t.__tau&&t.__tad[0]===t.__tau[0]&&t.__tad[1]===t.__tau[1])for(var n=0;n<t.__taSmartClicks.length;n++)t.__taSmartClicks[n].apply(s(e),[e])}),i),t.__taSmartClicks=[]}t.__taSmartClicks.push(n),n.__taUnstore=function(){r(t.__taSmartClicks,n)}}(t,0,n,i):"tap"===e||"dbltap"===e||"contextmenu"===e?c(t,e,n,i):"mouseenter"===e||"mouseexit"==e?l(t,e,n,i):h(t,e,n,i)}))};this.remove=function(t){return j(t,(function(){var t=o(this);if(t.__ta)for(var e in t.__ta)if(t.__ta.hasOwnProperty(e))for(var n in t.__ta[e])t.__ta[e].hasOwnProperty(n)&&D(t,e,t.__ta[e][n]);t.parentNode&&t.parentNode.removeChild(t)})),this},this.on=function(t,e,n,i){var o=arguments[0],s=4==arguments.length?arguments[2]:null,a=arguments[1],r=arguments[arguments.length-1];return d(o,a,r,s),this},this.off=function(t,e,n){return D(t,e,n),this},this.trigger=function(e,i,s,a){var r=b&&("undefined"==typeof MouseEvent||null==s||s.constructor===MouseEvent),l=g&&!b&&y[i]?y[i]:i,c=!(g&&!b&&y[i]),u=S(s),d=C(s,"screen"),h=function(t){return C(t,"client")}(s);return j(e,(function(){var e,p=o(this);s=s||{screenX:d[0],screenY:d[1],clientX:h[0],clientY:h[1]};var f=function(t){a&&(t.payload=a)},m={TouchEvent:function(e){var i=function(e,i,o,s,a,r,l,c){return n(t.apply(null,arguments))}(window,p,0,u[0],u[1],d[0],d[1],h[0],h[1]);(e.initTouchEvent||e.initEvent)(l,!0,!0,window,null,d[0],d[1],h[0],h[1],!1,!1,!1,!1,i,i,i,1,0)},MouseEvents:function(t){t.initMouseEvent(l,!0,!0,window,0,d[0],d[1],h[0],h[1],!1,!1,!1,!1,1,p)}};if(document.createEvent){var v=!c&&!r&&g&&y[i]?"TouchEvent":"MouseEvents";e=document.createEvent(v),m[v](e),f(e),p.dispatchEvent(e)}else document.createEventObject&&((e=document.createEventObject()).eventType=e.eventName=l,e.screenX=d[0],e.screenY=d[1],e.clientX=h[0],e.clientY=h[1],f(e),p.fireEvent("on"+l,e))})),this}},this.Mottle.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.Mottle.pageLocation=S,this.Mottle.setForceTouchEvents=function(t){g=t},this.Mottle.setForceMouseEvents=function(t){b=t},this.Mottle.version="0.8.0",e.Mottle=this.Mottle}.call("undefined"==typeof window?this:window),function(){"use strict";var t=function(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)},n=function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},i=function(t,e){for(var n=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&n.push(t[i]);return n},o=function(t){return null!=t&&("string"==typeof t||t.constructor===String)},s=function(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,a=i.clientTop||n.clientTop||0,r=i.clientLeft||n.clientLeft||0,l=e.top+o-a,c=e.left+s-r;return{top:Math.round(l),left:Math.round(c)}},a=function(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1},r=function(t,e,n){if(a(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(a(i,n,t))return i;i=i.parentNode}},l=function(t,e,n){for(var i=null,o=e.getAttribute("katavorio-draggable"),s=null!=o?"[katavorio-draggable='"+o+"'] ":"",l=0;l<t.length;l++)if(null!=(i=r(e,n,s+t[l].selector))){if(t[l].filter){var c=a(n,t[l].filter,i);if(!0===t[l].filterExclude&&!c||c)return null}return[t[l],i]}return null},c=function(){var t=-1;if("Microsoft Internet Explorer"===navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),u=c>-1&&c<9,d=9===c,h=function(t){if(u)return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop];var e=f(t),n=p(e,0);return d?[n.pageX||n.clientX,n.pageY||n.clientY]:[n.pageX,n.pageY]},p=function(t,e){return t.item?t.item(e):t[e]},f=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},m={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},v=["stop","start","drag","drop","over","out","beforeStart"],g=function(){},b=function(){return!0},y=function(t,e,n){for(var i=0;i<t.length;i++)t[i]!=n&&e(t[i])},_=function(t,e,n,i){y(t,(function(t){t.setActive(e),e&&t.updatePosition(),n&&t.setHover(i,e)}))},w=function(t,e){if(null!=t){t=o(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},C=function(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):t.returnValue=!1},S=function(t,e,n){var i=t.srcElement||t.target;return!a(i,n.getInputFilterSelector(),e)},k=function(t,e,n,i){this.params=e||{},this.el=t,this.params.addClass(this.el,this._class),this.uuid=j();var o=!0;return this.setEnabled=function(t){o=t},this.isEnabled=function(){return o},this.toggleEnabled=function(){o=!o},this.setScope=function(t){this.scopes=t?t.split(/\s+/):[i]},this.addScope=function(t){var e={};for(var n in w(this.scopes,(function(t){e[t]=!0})),w(t?t.split(/\s+/):[],(function(t){e[t]=!0})),this.scopes=[],e)this.scopes.push(n)},this.removeScope=function(t){var e={};for(var n in w(this.scopes,(function(t){e[t]=!0})),w(t?t.split(/\s+/):[],(function(t){delete e[t]})),this.scopes=[],e)this.scopes.push(n)},this.toggleScope=function(t){var e={};for(var n in w(this.scopes,(function(t){e[t]=!0})),w(t?t.split(/\s+/):[],(function(t){e[t]?delete e[t]:e[t]=!0})),this.scopes=[],e)this.scopes.push(n)},this.setScope(e.scope),this.k=e.katavorio,e.katavorio},x=function(){return!0},P=function(){return!1},E=function(t,e,n,i){this._class=n.draggable;var r=k.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var c,u,d,p,f,v,g=[0,0],y=null,w=null,E=[0,0],D=!1,T=[0,0],L=!1!==this.params.consumeStartEvent,N=this.el,A=this.params.clone,I=(this.params.scroll,!1!==e.multipleDrop),M=!1,$=null,F=[],R=null,B=e.ghostProxyParent;if(c=!0===e.ghostProxy?x:e.ghostProxy&&"function"==typeof e.ghostProxy?e.ghostProxy:function(t,e){return!(!R||!R.useGhostProxy)&&R.useGhostProxy(t,e)},u=e.makeGhostProxy?e.makeGhostProxy:function(t){return R&&R.makeGhostProxy?R.makeGhostProxy(t):t.cloneNode(!0)},e.selector){var V=t.getAttribute("katavorio-draggable");null==V&&(V=""+(new Date).getTime(),t.setAttribute("katavorio-draggable",V)),F.push(e)}var H,G=e.snapThreshold,U=function(t,e,n,i,o){var s=e*Math.floor(t[0]/e),a=s+e,r=Math.abs(t[0]-s)<=i?s:Math.abs(a-t[0])<=i?a:t[0],l=n*Math.floor(t[1]/n),c=l+n;return[r,Math.abs(t[1]-l)<=o?l:Math.abs(c-t[1])<=o?c:t[1]]};this.posses=[],this.posseRoles={},this.toGrid=function(t){if(null==this.params.grid)return t;var e=this.params.grid?this.params.grid[0]/2:G||5,n=this.params.grid?this.params.grid[1]/2:G||5;return U(t,this.params.grid[0],this.params.grid[1],e,n)},this.snap=function(t,e){if(null!=N){t=t||(this.params.grid?this.params.grid[0]:10),e=e||(this.params.grid?this.params.grid[1]:10);var n=this.params.getPosition(N),i=this.params.grid?this.params.grid[0]/2:G,o=this.params.grid?this.params.grid[1]/2:G,s=U(n,t,e,i,o);return this.params.setPosition(N,s),s}},this.setUseGhostProxy=function(t){c=t?x:P};var Y=function(t){return!1===e.allowNegative?[Math.max(0,t[0]),Math.max(0,t[1])]:t},z=function(t){H="function"==typeof t?t:t?function(t,e,n,i){return Y([Math.max(0,Math.min(n.w-i[0],t[0])),Math.max(0,Math.min(n.h-i[1],t[1]))])}.bind(this):function(t){return Y(t)}}.bind(this);z("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(t){z(t)};var W,X=function(t,e,n,i){return null!=R&&R.constrain&&"function"==typeof R.constrain?R.constrain(t,e,n,i):H(t,e,n,i)};this.setRevert=function(t){W=t},this.params.revert&&(W=this.params.revert);var q=function(t){return"function"==typeof t?(t._katavorioId=j(),t._katavorioId):t},K={},Z=function(t){for(var e in K){var n=K[e],i=n[0](t);if(n[1]&&(i=!i),!i)return!1}return!0},J=this.setFilter=function(e,n){if(e){var i=q(e);K[i]=[function(n){var i,s=n.srcElement||n.target;return o(e)?i=a(s,e,t):"function"==typeof e&&(i=e(n,t)),i},!1!==n]}};this.addFilter=J,this.removeFilter=function(t){var e="function"==typeof t?t._katavorioId:t;delete K[e]};this.clearAllFilters=function(){K={}},this.canDrag=this.params.canDrag||b;var Q,tt=[],et=[];this.addSelector=function(t){t.selector&&F.push(t)},this.downListener=function(t){if(!t.defaultPrevented&&((this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this.canDrag()))if(Z(t)&&S(t,this.el,this.k)){if(R=null,$=null,F.length>0){var e=l(F,this.el,t.target||t.srcElement);if(null!=e&&(R=e[0],$=e[1]),null==$)return}else $=this.el;if(A)if(N=$.cloneNode(!0),this.params.addClass(N,m.clonedDrag),N.setAttribute("id",null),N.style.position="absolute",null!=this.params.parent){var i=this.params.getPosition(this.el);N.style.left=i[0]+"px",N.style.top=i[1]+"px",this.params.parent.appendChild(N)}else{var o=s($);N.style.left=o.left+"px",N.style.top=o.top+"px",document.body.appendChild(N)}else N=$;L&&C(t),g=h(t),N&&N.parentNode&&(T=[N.parentNode.scrollLeft,N.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),r.markSelection(this),r.markPosses(this),this.params.addClass(document.body,n.noSelect),ot("beforeStart",{el:this.el,pos:y,e:t,drag:this})}else this.params.consumeFilteredEvents&&C(t)}.bind(this),this.moveListener=function(t){if(g){if(!D)if(!1!==ot("start",{el:this.el,pos:y,e:t,drag:this})){if(!g)return;this.mark(!0),D=!0}else this.abort();if(g){et.length=0;var e=h(t),n=e[0]-g[0],i=e[1]-g[1],o=this.params.ignoreZoom?1:r.getZoom();N&&N.parentNode&&(n+=N.parentNode.scrollLeft-T[0],i+=N.parentNode.scrollTop-T[1]),n/=o,i/=o,this.moveBy(n,i,t),r.updateSelection(n,i,this),r.updatePosses(n,i,this)}}}.bind(this),this.upListener=function(t){g&&(g=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,n.noSelect),this.unmark(t),r.unmarkSelection(this,t),r.unmarkPosses(this,t),this.stop(t),r.notifyPosseDragStop(this,t),D=!1,et.length=0,A?(N&&N.parentNode&&N.parentNode.removeChild(N),N=null):W&&!0===W(N,this.params.getPosition(N))&&(this.params.setPosition(N,y),ot("revert",N)))}.bind(this),this.getFilters=function(){return K},this.abort=function(){null!=g&&this.upListener()},this.getDragElement=function(t){return t?$||this.el:N||this.el};var nt={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};e.events.start&&nt.start.push(e.events.start),e.events.beforeStart&&nt.beforeStart.push(e.events.beforeStart),e.events.stop&&nt.stop.push(e.events.stop),e.events.drag&&nt.drag.push(e.events.drag),e.events.revert&&nt.revert.push(e.events.revert),this.on=function(t,e){nt[t]&&nt[t].push(e)},this.off=function(t,e){if(nt[t]){for(var n=[],i=0;i<nt[t].length;i++)nt[t][i]!==e&&n.push(nt[t][i]);nt[t]=n}};var it,ot=function(t,e){var n=null;if(R&&R[t])n=R[t](e);else if(nt[t])for(var i=0;i<nt[t].length;i++)try{var o=nt[t][i](e);null!=o&&(n=o)}catch(t){}return n};this.notifyStart=function(t){ot("start",{el:this.el,pos:this.params.getPosition(N),e:t,drag:this})},this.stop=function(t,e){if(e||D){var n=[],i=r.getSelection(),o=this.params.getPosition(N);if(i.length>0)for(var s=0;s<i.length;s++){var a=this.params.getPosition(i[s].el);n.push([i[s].el,{left:a[0],top:a[1]},i[s]])}else n.push([N,{left:o[0],top:o[1]},this]);ot("stop",{el:N,pos:it||o,finalPos:o,e:t,drag:this,selection:n})}},this.mark=function(t){var e;y=this.params.getPosition(N),w=this.params.getPosition(N,!0),E=[w[0]-y[0],w[1]-y[1]],this.size=this.params.getSize(N),tt=r.getMatchingDroppables(this),_(tt,!0,!1,this),this.params.addClass(N,this.params.dragClass||n.drag),e=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(N):this.params.getSize(N.parentNode),Q={w:e[0],h:e[1]},f=0,v=0,t&&r.notifySelectionDragStart(this)},this.unmark=function(t,i){if(_(tt,!1,!0,this),M&&c($,N)?(it=[N.offsetLeft-f,N.offsetTop-v],N.parentNode.removeChild(N),N=$):it=null,this.params.removeClass(N,this.params.dragClass||n.drag),tt.length=0,M=!1,!i){et.length>0&&it&&e.setPosition($,it),et.sort(O);for(var o=0;o<et.length;o++){if(!0===et[o].drop(this,t))break}}},this.moveBy=function(t,n,i){et.length=0;var o=this.toGrid([y[0]+t,y[1]+n]),s=X(o,N,Q,this.size);if(c(this.el,N))if(o[0]!==s[0]||o[1]!==s[1]){if(!M){var a=u($);e.addClass(a,m.ghostProxy),B?(B.appendChild(a),d=e.getPosition($.parentNode,!0),p=e.getPosition(e.ghostProxyParent,!0),f=d[0]-p[0],v=d[1]-p[1]):$.parentNode.appendChild(a),N=a,M=!0}s=o}else M&&(N.parentNode.removeChild(N),N=$,M=!1,d=null,p=null,f=0,v=0);var r={x:s[0],y:s[1],w:this.size[0],h:this.size[1]},l={x:r.x+E[0],y:r.y+E[1],w:r.w,h:r.h},h=null;this.params.setPosition(N,[s[0]+f,s[1]+v]);for(var g=0;g<tt.length;g++){var b={x:tt[g].pagePosition[0],y:tt[g].pagePosition[1],w:tt[g].size[0],h:tt[g].size[1]};this.params.intersects(l,b)&&(I||null==h||h===tt[g].el)&&tt[g].canDrop(this)?(h||(h=tt[g].el),et.push(tt[g]),tt[g].setHover(this,!0,i)):tt[g].isHover()&&tt[g].setHover(this,!1,i)}ot("drag",{el:this.el,pos:s,e:i,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?J(this.params.handle,!1):J(this.params.filter,this.params.filterExclude)},D=function(t,e,n,i){this._class=n.droppable,this.params=e||{},this.rank=e.rank||0,this._activeClass=this.params.activeClass||n.active,this._hoverClass=this.params.hoverClass||n.hover,k.apply(this,arguments);var o=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(t){return!0},this.isHover=function(){return o},this.setHover=function(t,e,n){(e||null==this.el._katavorioDragHover||this.el._katavorioDragHover===t.el._katavorio)&&(this.params[e?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=e?t.el._katavorio:null,o!==e&&this.params.events[e?"over":"out"]({el:this.el,e:n,drag:t,drop:this}),o=e)},this.drop=function(t,e){return this.params.events.drop({drag:t,e:e,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,o=null}},j=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},O=function(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:0},T=function(t){return null==t||null==(t="string"==typeof t||t.constructor===String?document.getElementById(t):t)?null:(t._katavorio=t._katavorio||j(),t)};this.Katavorio=function(e){var s=[],a={};this._dragsByScope={},this._dropsByScope={};var r=1,l=function(t,e){w(t,(function(t){for(var n=0;n<t.scopes.length;n++)e[t.scopes[n]]=e[t.scopes[n]]||[],e[t.scopes[n]].push(t)}))},c=function(t,n){var i=0;return w(t,(function(t){for(var o=0;o<t.scopes.length;o++)if(n[t.scopes[o]]){var s=e.indexOf(n[t.scopes[o]],t);-1!==s&&(n[t.scopes[o]].splice(s,1),i++)}})),i>0},u=(this.getMatchingDroppables=function(t){for(var e=[],n={},i=0;i<t.scopes.length;i++){var o=this._dropsByScope[t.scopes[i]];if(o)for(var s=0;s<o.length;s++)!o[s].canDrop(t)||n[o[s].uuid]||!o[s].allowLoopback&&o[s].el===t.el||(n[o[s].uuid]=!0,e.push(o[s]))}return e.sort(O),e},function(t){t=t||{};var n,i={events:{}};for(n in e)i[n]=e[n];for(n in t)i[n]=t[n];for(n=0;n<v.length;n++)i.events[v[n]]=t[v[n]]||g;return i.katavorio=this,i}.bind(this)),d=function(t,e){for(var n=0;n<v.length;n++)e[v[n]]&&t.on(v[n],e[v[n]])}.bind(this),h={},p=e.css||{},f=e.scope||"katavorio-drag-scope";for(var b in m)h[b]=m[b];for(var b in p)h[b]=p[b];var _=e.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return _},this.setInputFilterSelector=function(t){return _=t,this},this.draggable=function(t,n){var i=[];return w(t,function(t){if(null!=(t=T(t)))if(null==t._katavorioDrag){var o=u(n);t._katavorioDrag=new E(t,o,h,f),l(t._katavorioDrag,this._dragsByScope),i.push(t._katavorioDrag),e.addClass(t,o.selector?h.delegatedDraggable:h.draggable)}else d(t._katavorioDrag,n)}.bind(this)),i},this.droppable=function(t,n){var i=[];return w(t,function(t){if(null!=(t=T(t))){var o=new D(t,u(n),h,f);t._katavorioDrop=t._katavorioDrop||[],t._katavorioDrop.push(o),l(o,this._dropsByScope),i.push(o),e.addClass(t,h.droppable)}}.bind(this)),i},this.select=function(t){return w(t,(function(){var t=T(this);t&&t._katavorioDrag&&(a[t._katavorio]||(s.push(t._katavorioDrag),a[t._katavorio]=[t,s.length-1],e.addClass(t,h.selected)))})),this},this.deselect=function(t){return w(t,(function(){var t=T(this);if(t&&t._katavorio&&a[t._katavorio]){for(var n=[],i=0;i<s.length;i++)s[i].el!==t&&n.push(s[i]);s=n,delete a[t._katavorio],e.removeClass(t,h.selected)}})),this},this.deselectAll=function(){for(var t in a){var n=a[t];e.removeClass(n[0],h.selected)}s.length=0,a={}},this.markSelection=function(t){y(s,(function(t){t.mark()}),t)},this.markPosses=function(t){t.posses&&w(t.posses,(function(e){t.posseRoles[e]&&P[e]&&y(P[e].members,(function(t){t.mark()}),t)}))},this.unmarkSelection=function(t,e){y(s,(function(t){t.unmark(e)}),t)},this.unmarkPosses=function(t,e){t.posses&&w(t.posses,(function(n){t.posseRoles[n]&&P[n]&&y(P[n].members,(function(t){t.unmark(e,!0)}),t)}))},this.getSelection=function(){return s.slice(0)},this.updateSelection=function(t,e,n){y(s,(function(n){n.moveBy(t,e)}),n)};var C=function(t,e){e.posses&&w(e.posses,(function(n){e.posseRoles[n]&&P[n]&&y(P[n].members,(function(e){t(e)}),e)}))};this.updatePosses=function(t,e,n){C((function(n){n.moveBy(t,e)}),n)},this.notifyPosseDragStop=function(t,e){C((function(t){t.stop(e,!0)}),t)},this.notifySelectionDragStop=function(t,e){y(s,(function(t){t.stop(e,!0)}),t)},this.notifySelectionDragStart=function(t,e){y(s,(function(t){t.notifyStart(e)}),t)},this.setZoom=function(t){r=t},this.getZoom=function(){return r};var S=function(t,e,n,i){w(t,(function(t){c(t,n),t[i](e),l(t,n)}))};w(["set","add","remove","toggle"],function(t){this[t+"Scope"]=function(e,n){S(e._katavorioDrag,n,this._dragsByScope,t+"Scope"),S(e._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this),this[t+"DragScope"]=function(e,n){S(e.constructor===E?e:e._katavorioDrag,n,this._dragsByScope,t+"Scope")}.bind(this),this[t+"DropScope"]=function(e,n){S(e.constructor===D?e:e._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this)}.bind(this)),this.snapToGrid=function(t,e){for(var n in this._dragsByScope)y(this._dragsByScope[n],(function(n){n.snap(t,e)}))},this.getDragsForScope=function(t){return this._dragsByScope[t]},this.getDropsForScope=function(t){return this._dropsByScope[t]};var k=function(t,e,n){if((t=T(t))[e]){var i=s.indexOf(t[e]);i>=0&&s.splice(i,1),c(t[e],n)&&w(t[e],(function(t){t.destroy()})),delete t[e]}},x=function(t,e,n,i){(t=T(t))[e]&&t[e].off(n,i)};this.elementRemoved=function(t){t._katavorioDrag&&this.destroyDraggable(t),t._katavorioDrop&&this.destroyDroppable(t)},this.destroyDraggable=function(t,e,n){1===arguments.length?k(t,"_katavorioDrag",this._dragsByScope):x(t,"_katavorioDrag",e,n)},this.destroyDroppable=function(t,e,n){1===arguments.length?k(t,"_katavorioDrop",this._dropsByScope):x(t,"_katavorioDrop",e,n)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},s=[],a={},P={}};var P={},j=function(e,n,i){var s,a=o(n)?n:n.id,r=!!o(n)||!1!==n.active,l=P[a]||(s={name:a,members:[]},P[a]=s,s);return w(e,(function(e){if(e._katavorioDrag){if(i&&null!=e._katavorioDrag.posseRoles[l.name])return;t(l.members,e._katavorioDrag),t(e._katavorioDrag.posses,l.name),e._katavorioDrag.posseRoles[l.name]=r}})),l};this.addToPosse=function(t,e){for(var n=[],i=1;i<arguments.length;i++)n.push(j(t,arguments[i]));return 1===n.length?n[0]:n},this.setPosse=function(t,e){for(var n=[],o=1;o<arguments.length;o++)n.push(j(t,arguments[o],!0).name);return w(t,function(t){if(t._katavorioDrag){var e=i(t._katavorioDrag.posses,n);Array.prototype.push.apply([],t._katavorioDrag.posses);for(var o=0;o<e.length;o++)this.removeFromPosse(t,e[o])}}.bind(this)),1===n.length?n[0]:n},this.removeFromPosse=function(t,e){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var i=1;i<arguments.length;i++)e=arguments[i],w(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var i=t._katavorioDrag;w(e,(function(t){n(P[t].members,i),n(i.posses,t),delete i.posseRoles[t]}))}}))},this.removeFromAllPosses=function(t){w(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;w(e.posses,(function(t){n(P[t].members,e)})),e.posses.length=0,e.posseRoles={}}}))},this.setPosseState=function(t,e,n){var i=P[e];i&&w(t,(function(t){t._katavorioDrag&&t._katavorioDrag.posses&&(t._katavorioDrag.posseRoles[i.name]=n)}))}},this.Katavorio.version="1.0.0",e.Katavorio=this.Katavorio}.call("undefined"!=typeof window?window:this),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t=this.jsPlumbUtil;function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(t){return"string"==typeof t}function o(t){return"boolean"==typeof t}function s(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function a(t){return"[object Date]"===Object.prototype.toString.call(t)}function r(t){return"[object Function]"===Object.prototype.toString.call(t)}function l(t){if(i(t))return""+t;if(o(t))return!!t;if(a(t))return new Date(t.getTime());if(r(t))return t;if(n(t)){for(var e=[],c=0;c<t.length;c++)e.push(l(t[c]));return e}if(s(t)){var u={};for(var d in t)u[d]=l(t[d]);return u}return t}function c(t,e,a,r){var c,u,d={},h={};for(a=a||[],r=r||[],u=0;u<a.length;u++)d[a[u]]=!0;for(u=0;u<r.length;u++)h[r[u]]=!0;var p=l(t);for(u in e)if(null==p[u]||h[u])p[u]=e[u];else if(i(e[u])||o(e[u]))d[u]?((c=[]).push.apply(c,n(p[u])?p[u]:[p[u]]),c.push.apply(c,o(e[u])?e[u]:[e[u]]),p[u]=c):p[u]=e[u];else if(n(e[u]))c=[],n(p[u])&&c.push.apply(c,p[u]),c.push.apply(c,e[u]),p[u]=c;else if(s(e[u]))for(var f in s(p[u])||(p[u]={}),e[u])p[u][f]=e[u][f];return p}function u(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function d(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function h(t,e,n,i){var o=t[e];return null==o&&(o=[],t[e]=o),o[i?"unshift":"push"](n),o}e.jsPlumbUtil=t,t.isArray=n,t.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},t.isString=i,t.isBoolean=o,t.isNull=function(t){return null==t},t.isObject=s,t.isDate=a,t.isFunction=r,t.isNamedFunction=function(t){return r(t)&&null!=t.name&&t.name.length>0},t.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},t.clone=l,t.merge=c,t.replace=function(t,e,n){if(null!=t){var i=t;return e.replace(/([^\.])+/g,(function(t,e,o,s){var a=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),r=function(){return i[a[1]]||(i[a[1]]=[],i[a[1]])};if(o+t.length>=s.length)a?r()[a[3]]=n:i[t]=n;else if(a){var l=r();i=l[a[3]]||(l[a[3]]={},l[a[3]])}else i=i[t]||(i[t]={},i[t]);return""})),t}},t.functionChain=function(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t},t.populate=function(t,e,o,a){var l=function(t){if(null!=t){if(i(t))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=e[n[i].substring(2,n[i].length-1)]||"";null!=o&&(t=t.replace(n[i],o))}return t}(t);if(!r(t)||a||null!=o&&0!==(t.name||"").indexOf(o)){if(n(t)){for(var c=[],u=0;u<t.length;u++)c.push(l(t[u]));return c}if(s(t)){var d={};for(var h in t)d[h]=l(t[h]);return d}return t}return t(e)}};return l(t)},t.findWithFunction=u,t.removeWithFunction=function(t,e){var n=u(t,e);return n>-1&&t.splice(n,1),-1!==n},t.remove=d,t.addWithFunction=function(t,e,n){-1===u(t,n)&&t.push(e)},t.addToList=h,t.suggest=function(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)},t.extend=function(t,e,i){var o;e=n(e)?e:[e];var s=function(e){for(var n=e.__proto__;null!=n;)if(null!=n.prototype){for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&!t.prototype.hasOwnProperty(i)&&(t.prototype[i]=n.prototype[i]);n=n.prototype.__proto__}else n=null};for(o=0;o<e.length;o++){for(var a in e[o].prototype)e[o].prototype.hasOwnProperty(a)&&!t.prototype.hasOwnProperty(a)&&(t.prototype[a]=e[o].prototype[a]);s(e[o])}var r=function(t,n){return function(){for(o=0;o<e.length;o++)e[o].prototype[t]&&e[o].prototype[t].apply(this,arguments);return n.apply(this,arguments)}},l=function(e){for(var n in e)t.prototype[n]=r(n,e[n])};if(arguments.length>2)for(o=2;o<arguments.length;o++)l(arguments[o]);return t};for(var p=[],f=0;f<256;f++)p[f]=(f<16?"0":"")+f.toString(16);function m(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return p[255&t]+p[t>>8&255]+p[t>>16&255]+p[t>>24&255]+"-"+p[255&e]+p[e>>8&255]+"-"+p[e>>16&15|64]+p[e>>24&255]+"-"+p[63&n|128]+p[n>>8&255]+"-"+p[n>>16&255]+p[n>>24&255]+p[255&i]+p[i>>8&255]+p[i>>16&255]+p[i>>24&255]}function v(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t.logEnabled&&"undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(t){}}t.uuid=m,t.fastTrim=function(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)},t.each=function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])},t.map=function(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n},t.mergeWithParents=function(t,e,n){n=n||"parent";var i=function(t){return t?e[t]:null},o=function(t){return t?i(t[n]):null},s=function(t,e){if(null==t)return e;var n=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];"override"===e.mergeStrategy&&Array.prototype.push.apply(n,["events","overlays"]);var i=c(t,e,[],n);return s(o(t),i)},a=function(t){if(null==t)return{};if("string"==typeof t)return i(t);if(t.length){for(var e=!1,n=0,o=void 0;!e&&n<t.length;)(o=a(t[n]))?e=!0:n++;return o}},r=a(t);return r?s(o(r),r):{}},t.logEnabled=!0,t.log=v,t.wrap=function(t,e,n){return function(){var i=null;try{null!=e&&(i=e.apply(this,arguments))}catch(t){v("jsPlumb function failed : "+t)}if(null!=t&&(null==n||i!==n))try{i=t.apply(this,arguments)}catch(t){v("wrapped function failed : "+t)}return i}};var g=function(){var t=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(e,n,i){var o=function(e){h(t._listeners,e,n,i),n.__jsPlumb=n.__jsPlumb||{},n.__jsPlumb[m()]=e};if("string"==typeof e)o(e);else if(null!=e.length)for(var s=0;s<e.length;s++)o(e[s]);return t},this.fire=function(t,e,n){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var i=this._listeners[t].length,o=0,s=!1,a=null;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!s&&o<i&&!1!==a;){if(this.eventsToDieOn[t])this._listeners[t][o].apply(this,[e,n]);else try{a=this._listeners[t][o].apply(this,[e,n])}catch(e){v("jsPlumb: fire failed for event "+t+" : "+e)}o++,null!=this._listeners&&null!=this._listeners[t]||(s=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var e=t.queue.pop();e&&t.fire.apply(t,e)},this.unbind=function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n=void 0;for(var i in t.__jsPlumb)n=t.__jsPlumb[i],d(this._listeners[n]||[],t)}}else 2===arguments.length&&d(this._listeners[t]||[],e);return this},this.getListener=function(e){return t._listeners[e]},this.setSuspendEvents=function(e){t.eventsSuspended=e},this.isSuspendEvents=function(){return t.eventsSuspended},this.silently=function(e){t.setSuspendEvents(!0);try{e()}catch(t){v("Cannot execute silent function "+t)}t.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var e in t._listeners)t._listeners[e]=null}};function b(t,e,n){var i=[t[0]-e[0],t[1]-e[1]],o=Math.cos(n/360*Math.PI*2),s=Math.sin(n/360*Math.PI*2);return[i[0]*o-i[1]*s+e[0],i[1]*o+i[0]*s+e[1],o,s]}t.EventGenerator=g,t.rotatePoint=b,t.rotateAnchorOrientation=function(t,e){var n=b(t,[0,0],e);return[Math.round(n[0]),Math.round(n[1])]}}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbUtil.matchesSelector=function(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1},this.jsPlumbUtil.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.jsPlumbUtil.sizeElement=function(t,e,n,i,o){t&&(t.style.height=o+"px",t.height=o,t.style.width=i+"px",t.width=i,t.style.left=e+"px",t.style.top=n+"px")}}.call("undefined"!=typeof window?window:this),function(){var t={deriveAnchor:function(t,e,n,i){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][e]}},e=function(t,e){this.count=0,this.instance=t,this.lists={},this.options=e||{},this.instance.addList=function(t,e){return this.listManager.addList(t,e)},this.instance.removeList=function(t){this.listManager.removeList(t)},this.instance.bind("manageElement",function(t){for(var e=this.instance.getSelector(t.el,"[jtk-scrollable-list]"),n=0;n<e.length;n++)this.addList(e[n])}.bind(this)),this.instance.bind("unmanageElement",(function(t){this.removeList(t.el)})),this.instance.bind("connection",function(t,e){null==e&&(this._maybeUpdateParentList(t.source),this._maybeUpdateParentList(t.target))}.bind(this))};this.jsPlumbListManager=e,e.prototype={addList:function(e,i){var o=this.instance.extend({},t);this.instance.extend(o,this.options),i=this.instance.extend(o,i||{});var s=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[s]=new n(this.instance,e,i,s)},removeList:function(t){var e=this.lists[t._jsPlumbList];e&&(e.destroy(),delete this.lists[t._jsPlumbList])},_maybeUpdateParentList:function(t){for(var e=t.parentNode,n=this.instance.getContainer();null!=e&&e!==n;){if(null!=e._jsPlumbList&&null!=this.lists[e._jsPlumbList])return void e._jsPlumbScrollHandler();e=e.parentNode}}};var n=function(t,e,n,i){function o(t,e,i,o){return n.anchor?n.anchor:n.deriveAnchor(t,e,i,o)}function s(t,e,i,o){return n.deriveEndpoint?n.deriveEndpoint(t,e,i,o):n.endpoint?n.endpoint:i.type}e._jsPlumbList=i;var a=function(n){for(var i=t.getSelector(e,".jtk-managed"),a=t.getId(e),r=0;r<i.length;r++){if(i[r].offsetTop<e.scrollTop)i[r]._jsPlumbProxies||(i[r]._jsPlumbProxies=i[r]._jsPlumbProxies||[],t.select({source:i[r]}).each((function(n){t.proxyConnection(n,0,e,a,(function(){return s("top",0,n.endpoints[0],n)}),(function(){return o("top",0,n.endpoints[0],n)})),i[r]._jsPlumbProxies.push([n,0])})),t.select({target:i[r]}).each((function(n){t.proxyConnection(n,1,e,a,(function(){return s("top",1,n.endpoints[1],n)}),(function(){return o("top",1,n.endpoints[1],n)})),i[r]._jsPlumbProxies.push([n,1])})));else if(i[r].offsetTop+i[r].offsetHeight>e.scrollTop+e.offsetHeight)i[r]._jsPlumbProxies||(i[r]._jsPlumbProxies=i[r]._jsPlumbProxies||[],t.select({source:i[r]}).each((function(n){t.proxyConnection(n,0,e,a,(function(){return s("bottom",0,n.endpoints[0],n)}),(function(){return o("bottom",0,n.endpoints[0],n)})),i[r]._jsPlumbProxies.push([n,0])})),t.select({target:i[r]}).each((function(n){t.proxyConnection(n,1,e,a,(function(){return s("bottom",1,n.endpoints[1],n)}),(function(){return o("bottom",1,n.endpoints[1],n)})),i[r]._jsPlumbProxies.push([n,1])})));else if(i[r]._jsPlumbProxies){for(var l=0;l<i[r]._jsPlumbProxies.length;l++)t.unproxyConnection(i[r]._jsPlumbProxies[l][0],i[r]._jsPlumbProxies[l][1],a);delete i[r]._jsPlumbProxies}t.revalidate(i[r])}!function(e){for(var n=e.parentNode,i=t.getContainer();null!=n&&n!==i;){if(t.hasClass(n,"jtk-managed"))return void t.recalculateOffsets(n);n=n.parentNode}}(e)};t.setAttribute(e,"jtk-scrollable-list","true"),e._jsPlumbScrollHandler=a,t.on(e,"scroll",a),a(),this.destroy=function(){t.off(e,"scroll",a),delete e._jsPlumbScrollHandler;for(var n=t.getSelector(e,".jtk-managed"),i=t.getId(e),o=0;o<n.length;o++)if(n[o]._jsPlumbProxies){for(var s=0;s<n[o]._jsPlumbProxies.length;s++)t.unproxyConnection(n[o]._jsPlumbProxies[s][0],n[o]._jsPlumbProxies[s][1],i);delete n[o]._jsPlumbProxies}}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this,n=t.jsPlumbUtil,i=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var e={};h.extend(e,t._jsPlumb.paintStyle),h.extend(e,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,e.gradient&&t._jsPlumb.paintStyle.fill&&delete e.gradient,t._jsPlumb.hoverPaintStyle=e}},o=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],s=function(t){return null==t?null:t.split(" ")},a=function(t,e,n){for(var i in e)t[i]=n},r=function(t,e,i){if(t.getDefaultType){var o=t.getTypeDescriptor(),s={},r=t.getDefaultType(),l=n.merge({},r);a(s,r,"__default");for(var c=0,u=t._jsPlumb.types.length;c<u;c++){var d=t._jsPlumb.types[c];if("__default"!==d){var h=t._jsPlumb.instance.getType(d,o);if(null!=h){var p=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"],f=[];"override"===h.mergeStrategy?Array.prototype.push.apply(p,["events","overlays","cssClass"]):f.push("cssClass"),l=n.merge(l,h,f,p),a(s,h,d)}}}e&&(l=n.populate(l,e,"_")),t.applyType(l,i,s),i||t.repaint()}},l=t.jsPlumbUIComponent=function(t){n.EventGenerator.apply(this,arguments);var e=this,i=arguments,o=e.idPrefix,s=o+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(t,e,n){this._jsPlumb.typeCache[n]=this._jsPlumb.typeCache[n]||{},this._jsPlumb.typeCache[n][t]=e},this.getCachedTypeItem=function(t,e){return this._jsPlumb.typeCache[e]?this._jsPlumb.typeCache[e][t]:null},this.getId=function(){return s};var a=t.overlays||[],r={};if(this.defaultOverlayKeys){for(var l=0;l<this.defaultOverlayKeys.length;l++)Array.prototype.push.apply(a,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[l]]||[]);for(l=0;l<a.length;l++){var c=h.convertToFullOverlaySpec(a[l]);r[c[1].id]=c}}var u={overlays:r,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return u},this.appendToDefaultType=function(t){for(var e in t)u[e]=t[e]},t.events)for(var d in t.events)e.bind(d,t.events[d]);this.clone=function(){var t=Object.create(this.constructor.prototype);return this.constructor.apply(t,i),t}.bind(this),this.isDetachAllowed=function(t){var e=!0;if(this._jsPlumb.beforeDetach)try{e=this._jsPlumb.beforeDetach(t)}catch(t){n.log("jsPlumb: beforeDetach callback failed",t)}return e},this.isDropAllowed=function(t,e,i,o,s,a,r){var l=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:e,scope:i,connection:o,dropEndpoint:s,source:a,target:r});if(this._jsPlumb.beforeDrop)try{l=this._jsPlumb.beforeDrop({sourceId:t,targetId:e,scope:i,connection:o,dropEndpoint:s,source:a,target:r})}catch(t){n.log("jsPlumb: beforeDrop callback failed",t)}return l};var p=[];this.setListenerComponent=function(t){for(var e=0;e<p.length;e++)p[e][3]=t}},c=function(t,e){var n=t._jsPlumb.types[e],i=t._jsPlumb.instance.getType(n,t.getTypeDescriptor());null!=i&&i.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,i.cssClass)};n.extend(t.jsPlumbUIComponent,n.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,e){this._jsPlumb.parameters[t]=e},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return h.getClass(this.canvas)},hasClass:function(t){return h.hasClass(this.canvas,t)},addClass:function(t){h.addClass(this.canvas,t)},removeClass:function(t){h.removeClass(this.canvas,t)},updateClasses:function(t,e){h.updateClasses(this.canvas,t,e)},setType:function(t,e,n){this.clearTypes(),this._jsPlumb.types=s(t)||[],r(this,e,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,e){r(this,t,e)},hasType:function(t){return-1!==this._jsPlumb.types.indexOf(t)},addType:function(t,e,n){var i=s(t),o=!1;if(null!=i){for(var a=0,l=i.length;a<l;a++)this.hasType(i[a])||(this._jsPlumb.types.push(i[a]),o=!0);o&&r(this,e,n)}},removeType:function(t,e,n){var i=s(t),o=!1,a=function(t){var e=this._jsPlumb.types.indexOf(t);return-1!==e&&(c(this,e),this._jsPlumb.types.splice(e,1),!0)}.bind(this);if(null!=i){for(var l=0,u=i.length;l<u;l++)o=a(i[l])||o;o&&r(this,e,n)}},clearTypes:function(t,e){for(var n=this._jsPlumb.types.length,i=0;i<n;i++)c(this,0),this._jsPlumb.types.splice(0,1);r(this,t,e)},toggleType:function(t,e,n){var i=s(t);if(null!=i){for(var o=0,a=i.length;o<a;o++){var l=this._jsPlumb.types.indexOf(i[o]);-1!==l?(c(this,l),this._jsPlumb.types.splice(l,1)):this._jsPlumb.types.push(i[o])}r(this,e,n)}},applyType:function(t,e){if(this.setPaintStyle(t.paintStyle,e),this.setHoverPaintStyle(t.hoverPaintStyle,e),t.parameters)for(var n in t.parameters)this.setParameter(n,t.parameters[n]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,e){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,i(this),e||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,e){this._jsPlumb.hoverPaintStyle=t,i(this),e||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){(t||null==this.typeId)&&(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(t,e,n){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=t;var i=t?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[i](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[i](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(n=n||jsPlumbUtil.uuid(),this.repaint({timestamp:n,recalc:!1}))),this.getAttachedElements&&!e&&function(t,e,n,i){var o=t.getAttachedElements();if(o)for(var s=0,a=o.length;s<a;s++)i&&i===o[s]||o[s].setHover(e,!0,n)}(this,t,jsPlumbUtil.uuid(),this)}}});var u=0,d=t.jsPlumbInstance=function(e){this.version="2.15.6",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},ListStyle:{},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},e&&h.extend(this.Defaults,e),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},n.EventGenerator.apply(this);var i=this,s=function(){var t=u+1;return u++,t}(),a=i.bind,r={},c=1,d=function(t){if(null==t)return null;if(3===t.nodeType||8===t.nodeType)return{el:t,text:!0};var e=i.getElement(t);return{el:e,id:n.isString(t)&&null==e?t:B(e)}};for(var p in this.getInstanceIndex=function(){return s},this.setZoom=function(t,e){return c=t,i.fire("zoom",c),e&&i.repaintEverything(),!0},this.getZoom=function(){return c},this.Defaults)r[p]=this.Defaults[p];var f,m=[];this.unbindContainer=function(){if(null!=f&&m.length>0)for(var t=0;t<m.length;t++)i.off(f,m[t][0],m[t][1])},this.setContainer=function(t){this.unbindContainer(),t=this.getElement(t),this.select().each((function(e){e.moveParent(t)})),this.selectEndpoints().each((function(e){e.moveParent(t)}));var e=f;f=t,m.length=0;for(var n={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},s=function(t,e,o){var s=e.srcElement||e.target,a=(s&&s.parentNode?s.parentNode._jsPlumb:null)||(s?s._jsPlumb:null)||(s&&s.parentNode&&s.parentNode.parentNode?s.parentNode.parentNode._jsPlumb:null);if(a){a.fire(t,a,e);var r=o&&n[o+t]||t;i.fire(r,a.component||a,e)}},a=function(t,e,n){m.push([t,n]),i.on(f,t,e,n)},r=function(t){a(t,".jtk-connector",(function(e){s(t,e)})),a(t,".jtk-endpoint",(function(e){s(t,e,"endpoint")})),a(t,".jtk-overlay",(function(e){s(t,e)}))},l=0;l<o.length;l++)r(o[l]);for(var c in w){var u=w[c].el;u.parentNode===e&&(e.removeChild(u),f.appendChild(u))}},this.getContainer=function(){return f},this.bind=function(t,e){"ready"===t&&g?e():a.apply(i,[t,e])},i.importDefaults=function(t){for(var e in t)i.Defaults[e]=t[e];return t.Container&&i.setContainer(t.Container),i},i.restoreDefaults=function(){return i.Defaults=h.extend({},r),i};var v=null,g=!1,b=[],y={},_={},w={},C={},S={},k=!1,x=[],P=!1,E=null,D=this.Defaults.Scope,j=1,O=function(){return""+j++},T=function(t,e){f?f.appendChild(t):e?this.getElement(e).appendChild(t):this.appendToRoot(t)}.bind(this),L=function(t,e,n,o){var s={c:[],e:[]};if(!P&&null!=(t=i.getElement(t))){var a=B(t),r=t.querySelectorAll(".jtk-managed");null==n&&(n=jsPlumbUtil.uuid());st({elId:a,offset:e,recalc:!1,timestamp:n});for(var l=0;l<r.length;l++)st({elId:r[l].getAttribute("id"),recalc:!0,timestamp:n});var c=i.router.redraw(a,e,n,null,o);if(Array.prototype.push.apply(s.c,c.c),Array.prototype.push.apply(s.e,c.e),r)for(var u=0;u<r.length;u++)c=i.router.redraw(r[u].getAttribute("id"),null,n,null,o,!0),Array.prototype.push.apply(s.c,c.c),Array.prototype.push.apply(s.e,c.e)}return s},N=function(t){return _[t]},A=function(t,e){var o=h.extend({},t);if(e&&h.extend(o,e),o.source&&(o.source.endpoint?o.sourceEndpoint=o.source:o.source=i.getElement(o.source)),o.target&&(o.target.endpoint?o.targetEndpoint=o.target:o.target=i.getElement(o.target)),t.uuids&&(o.sourceEndpoint=N(t.uuids[0]),o.targetEndpoint=N(t.uuids[1])),o.sourceEndpoint&&o.sourceEndpoint.isFull())n.log(i,"could not add connection; source endpoint is full");else if(o.targetEndpoint&&o.targetEndpoint.isFull())n.log(i,"could not add connection; target endpoint is full");else{if(!o.type&&o.sourceEndpoint&&(o.type=o.sourceEndpoint.connectionType),o.sourceEndpoint&&o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var s=0,a=o.sourceEndpoint.connectorOverlays.length;s<a;s++)o.overlays.push(o.sourceEndpoint.connectorOverlays[s])}o.sourceEndpoint&&o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope),!o["pointer-events"]&&o.sourceEndpoint&&o.sourceEndpoint.connectorPointerEvents&&(o["pointer-events"]=o.sourceEndpoint.connectorPointerEvents);var r=function(t,e,n){var s=function(t,e){var n=h.extend({},t);for(var i in e)e[i]&&(n[i]=e[i]);return n}(e,{anchor:o.anchors?o.anchors[n]:o.anchor,endpoint:o.endpoints?o.endpoints[n]:o.endpoint,paintStyle:o.endpointStyles?o.endpointStyles[n]:o.endpointStyle,hoverPaintStyle:o.endpointHoverStyles?o.endpointHoverStyles[n]:o.endpointHoverStyle});return i.addEndpoint(t,s)},l=function(t,e,n,i){if(o[t]&&!o[t].endpoint&&!o[t+"Endpoint"]&&!o.newConnection){var s=n[B(o[t])];if(s=s?s[i]:null){if(!s.enabled)return!1;var a=h.extend({},s.def);delete a.label;var l=null!=s.endpoint&&s.endpoint._jsPlumb?s.endpoint:r(o[t],a,e);if(l.isFull())return!1;o[t+"Endpoint"]=l,!o.scope&&a.scope&&(o.scope=a.scope),s.uniqueEndpoint?s.endpoint?l.finalEndpoint=s.endpoint:(s.endpoint=l,l.setDeleteOnEmpty(!1)):l.setDeleteOnEmpty(!0),0===e&&s.def.connectorOverlays&&(o.overlays=o.overlays||[],Array.prototype.push.apply(o.overlays,s.def.connectorOverlays))}}};if(!1!==l("source",0,this.sourceEndpointDefinitions,o.type||"default")&&!1!==l("target",1,this.targetEndpointDefinitions,o.type||"default"))return o.sourceEndpoint&&o.targetEndpoint&&(function(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var s=0;s<i.length;s++)if(i[s]===n[o])return!0;return!1}(o.sourceEndpoint,o.targetEndpoint)||(o=null)),o}}.bind(i),I=function(t){var e=i.Defaults.ConnectionType||i.getDefaultConnectionType();t._jsPlumb=i,t.newConnection=I,t.newEndpoint=$,t.endpointsByUUID=_,t.endpointsByElement=y,t.finaliseConnection=M,t.id="con_"+O();var n=new e(t);return n.isDetachable()&&(n.endpoints[0].initDraggable("_jsPlumbSource"),n.endpoints[1].initDraggable("_jsPlumbTarget")),n},M=i.finaliseConnection=function(t,e,n,o){if(e=e||{},t.suspendedEndpoint||b.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,!1!==o&&i.router.newConnection(t),L(t.source),!e.doNotFireConnectionEvent&&!1!==e.fireEvent){var s={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};i.fire("connection",s,n)}},$=function(t,e){var n=i.Defaults.EndpointType||h.Endpoint,o=h.extend({},t);o._jsPlumb=i,o.newConnection=I,o.newEndpoint=$,o.endpointsByUUID=_,o.endpointsByElement=y,o.fireDetachEvent=G,o.elementId=e||B(o.source);var s=new n(o);return s.id="ep_"+O(),ot(o.elementId,o.source),h.headless||i.getDragManager().endpointAdded(o.source,e),s},F=function(t,e,n){var i=y[t];if(i&&i.length)for(var o=0,s=i.length;o<s;o++){for(var a=0,r=i[o].connections.length;a<r;a++){if(e(i[o].connections[a]))return}n&&n(i[o])}},R=function(t,e,n){e="block"===e;var i=null;n&&(i=function(t){t.setVisible(e,!0,!0)});var o=d(t);F(o.id,(function(t){if(e&&n){var i=t.sourceId===o.id?1:0;t.endpoints[i].isVisible()&&t.setVisible(!0)}else t.setVisible(e)}),i)},B=function(t,e,o){if(n.isString(t))return t;if(null==t)return null;var a=i.getAttribute(t,"id");return a&&"undefined"!==a||(2===arguments.length&&void 0!==arguments[1]?a=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(a="jsPlumb_"+s+"_"+O()),o||i.setAttribute(t,"id",a)),a};this.setConnectionBeingDragged=function(t){k=t},this.isConnectionBeingDragged=function(){return k},this.getManagedElements=function(){return w},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(t,e,o){o=o||{};var s=h.extend({},o);h.extend(s,e),s.endpoint=s.endpoint||i.Defaults.Endpoint,s.paintStyle=s.paintStyle||i.Defaults.EndpointStyle;for(var a=[],r=n.isArray(t)||null!=t.length&&!n.isString(t)?t:[t],l=0,c=r.length;l<c;l++){s.source=i.getElement(r[l]),it(s.source);var u=B(s.source),d=$(s,u),p=ot(u,s.source,null,!P).info.o;n.addToList(y,u,d),P||d.paint({anchorLoc:d.anchor.compute({xy:[p.left,p.top],wh:x[u],element:d,timestamp:E,rotation:this.getRotation(u)}),timestamp:E}),a.push(d)}return 1===a.length?a[0]:a},this.addEndpoints=function(t,e,o){for(var s=[],a=0,r=e.length;a<r;a++){var l=i.addEndpoint(t,e[a],o);n.isArray(l)?Array.prototype.push.apply(s,l):s.push(l)}return s},this.animate=function(t,e,o){if(!this.animationSupported)return!1;o=o||{};var s=i.getElement(t),a=B(s),r=h.animEvents.step,l=h.animEvents.complete;o[r]=n.wrap(o[r],(function(){i.revalidate(a)})),o[l]=n.wrap(o[l],(function(){i.revalidate(a)})),i.doAnimate(s,e,o)},this.checkCondition=function(t,e){var o=i.getListener(t),s=!0;if(o&&o.length>0){var a=Array.prototype.slice.call(arguments,1);try{for(var r=0,l=o.length;r<l;r++)s=s&&o[r].apply(o[r],a)}catch(e){n.log(i,"cannot check condition ["+t+"]"+e)}}return s},this.connect=function(t,e){var i,o=A(t,e);if(o){if(null==o.source&&null==o.sourceEndpoint)return void n.log("Cannot establish connection - source does not exist");if(null==o.target&&null==o.targetEndpoint)return void n.log("Cannot establish connection - target does not exist");it(o.source),i=I(o),M(i,o)}return i};var V=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],H=function(t,e,n,i){var o,s,a,r=V[n],l=t[r.elId],c=(t[r.el],t.endpoints[n]),u={index:n,originalSourceId:0===n?l:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?l:t.targetId,newTargetId:t.targetId,connection:t};if(e.constructor===h.Endpoint)(o=e).addConnection(t),e=o.element;else if(s=B(e),a=this[r.epDefs][s],s===t[r.elId])o=null;else if(a)for(var d in a){if(!a[d].enabled)return;o=null!=a[d].endpoint&&a[d].endpoint._jsPlumb?a[d].endpoint:this.addEndpoint(e,a[d].def),a[d].uniqueEndpoint&&(a[d].endpoint=o),o.addConnection(t)}else o=t.makeEndpoint(0===n,e,s);return null!=o&&(c.detachFromConnection(t),t.endpoints[n]=o,t[r.el]=o.element,t[r.elId]=o.elementId,u[0===n?"newSourceId":"newTargetId"]=o.elementId,U(u),i||t.repaint()),u.element=e,u}.bind(this);this.setSource=function(t,e,n){var i=H(t,e,0,n);this.router.sourceOrTargetChanged(i.originalSourceId,i.newSourceId,t,i.el,0)},this.setTarget=function(t,e,n){var i=H(t,e,1,n);this.router.sourceOrTargetChanged(i.originalTargetId,i.newTargetId,t,i.el,1)},this.deleteEndpoint=function(t,e,n){var o="string"==typeof t?_[t]:t;return o&&i.deleteObject({endpoint:o,dontUpdateHover:e,deleteAttachedObjects:n}),i},this.deleteEveryEndpoint=function(){var t=i.setSuspendDrawing(!0);for(var e in y){var n=y[e];if(n&&n.length)for(var o=0,s=n.length;o<s;o++)i.deleteEndpoint(n[o],!0)}y={},w={},_={},C={},S={},i.router.reset();var a=i.getDragManager();return a&&a.reset(),t||i.setSuspendDrawing(!1),i};var G=function(t,e,n){var o=i.Defaults.ConnectionType||i.getDefaultConnectionType(),s=t.constructor===o?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&i.fire("connectionDetached",s,n),i.fire("internal.connectionDetached",s,n),i.router.connectionDetached(s)},U=i.fireMoveEvent=function(t,e){i.fire("connectionMoved",t,e)};this.unregisterEndpoint=function(t){for(var e in t._jsPlumb.uuid&&(_[t._jsPlumb.uuid]=null),i.router.deleteEndpoint(t),y){var n=y[e];if(n){for(var o=[],s=0,a=n.length;s<a;s++)n[s]!==t&&o.push(n[s]);y[e]=o}y[e].length<1&&delete y[e]}};this.deleteConnection=function(t,e){return!(null==t||!(e=e||{}).force&&!n.functionChain(!0,!1,[[t.endpoints[0],"isDetachAllowed",[t]],[t.endpoints[1],"isDetachAllowed",[t]],[t,"isDetachAllowed",[t]],[i,"checkCondition",["beforeDetach",t]]]))&&(t.setHover(!1),G(t,!t.pending&&!1!==e.fireEvent,e.originalEvent),t.endpoints[0].detachFromConnection(t),t.endpoints[1].detachFromConnection(t),n.removeWithFunction(b,(function(e){return t.id===e.id})),t.cleanup(),t.destroy(),!0)},this.deleteEveryConnection=function(t){t=t||{};var e=b.length,n=0;return i.batch((function(){for(var o=0;o<e;o++)n+=i.deleteConnection(b[0],t)?1:0})),n},this.deleteConnectionsForElement=function(t,e){e=e||{},t=i.getElement(t);var n=B(t),o=y[n];if(o&&o.length)for(var s=0,a=o.length;s<a;s++)o[s].deleteEveryConnection(e);return i},this.deleteObject=function(t){var e={endpoints:{},connections:{},endpointCount:0,connectionCount:0},o=!1!==t.deleteAttachedObjects,s=function(n){null!=n&&null==e.connections[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),e.connections[n.id]=n,e.connectionCount++)};for(var a in t.connection?s(t.connection):function(n){if(null!=n&&null==e.endpoints[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),e.endpoints[n.id]=n,e.endpointCount++,o))for(var i=0;i<n.connections.length;i++){var a=n.connections[i];s(a)}}(t.endpoint),e.connections){var r=e.connections[a];if(r._jsPlumb){n.removeWithFunction(b,(function(t){return r.id===t.id})),G(r,!1!==t.fireEvent&&!r.pending,t.originalEvent);var l=null==t.deleteAttachedObjects?null:!t.deleteAttachedObjects;r.endpoints[0].detachFromConnection(r,null,l),r.endpoints[1].detachFromConnection(r,null,l),r.cleanup(!0),r.destroy(!0)}}for(var c in e.endpoints){var u=e.endpoints[c];u._jsPlumb&&(i.unregisterEndpoint(u),u.cleanup(!0),u.destroy(!0))}return e};var Y=function(t,e,n,i){for(var o=0,s=t.length;o<s;o++)t[o][e].apply(t[o],n);return i(t)},z=function(t,e,n){for(var i=[],o=0,s=t.length;o<s;o++)i.push([t[o][e].apply(t[o],n),t[o]]);return i},W=function(t,e,n){return function(){return Y(t,e,arguments,n)}},X=function(t,e){return function(){return z(t,e,arguments)}},q=function(t,e){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(e)n=t;else if(t.length)for(var i=0,o=t.length;i<o;i++)n.push(d(t[i]).id);else n.push(d(t).id);return n},K=function(t,e,n){return"*"===t||(t.length>0?-1!==t.indexOf(e):!n)};this.getConnections=function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var n=t.scope||i.getDefaultScope(),o=q(n,!0),s=q(t.source),a=q(t.target),r=!e&&o.length>1?{}:[],l=function(t,n){if(!e&&o.length>1){var i=r[t];null==i&&(i=r[t]=[]),i.push(n)}else r.push(n)},c=0,u=b.length;c<u;c++){var d=b[c],h=d.proxies&&d.proxies[0]?d.proxies[0].originalEp.elementId:d.sourceId,p=d.proxies&&d.proxies[1]?d.proxies[1].originalEp.elementId:d.targetId;K(o,d.scope)&&K(s,h)&&K(a,p)&&l(d.scope,d)}return r};var Z=function(t,e){return function(n){for(var i=0,o=t.length;i<o;i++)n(t[i]);return e(t)}},J=function(t){return function(e){return t[e]}},Q=function(t,e){var n,i,o={length:t.length,each:Z(t,e),get:J(t)},s=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],a=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(n=0,i=s.length;n<i;n++)o[s[n]]=W(t,s[n],e);for(n=0,i=a.length;n<i;n++)o[a[n]]=X(t,a[n]);return o},tt=function(t){var e=Q(t,tt);return h.extend(e,{setDetachable:W(t,"setDetachable",tt),setReattach:W(t,"setReattach",tt),setConnector:W(t,"setConnector",tt),delete:function(){for(var e=0,n=t.length;e<n;e++)i.deleteConnection(t[e])},isDetachable:X(t,"isDetachable"),isReattach:X(t,"isReattach")})},et=function(t){var e=Q(t,et);return h.extend(e,{setEnabled:W(t,"setEnabled",et),setAnchor:W(t,"setAnchor",et),isEnabled:X(t,"isEnabled"),deleteEveryConnection:function(){for(var e=0,n=t.length;e<n;e++)t[e].deleteEveryConnection()},delete:function(){for(var e=0,n=t.length;e<n;e++)i.deleteEndpoint(t[e])}})};this.select=function(t){return(t=t||{}).scope=t.scope||"*",tt(t.connections||i.getConnections(t,!0))},this.selectEndpoints=function(t){(t=t||{}).scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":q(t.element),i=e?"*":q(t.source),o=e?"*":q(t.target),s=q(t.scope,!0),a=[];for(var r in y){var l=K(n,r,!0),c=K(i,r,!0),u="*"!==i,d=K(o,r,!0),h="*"!==o;if(l||c||d)t:for(var p=0,f=y[r].length;p<f;p++){var m=y[r][p];if(K(s,m.scope,!0)){var v=u&&i.length>0&&!m.isSource,g=h&&o.length>0&&!m.isTarget;if(v||g)continue t;a.push(m)}}}return et(a)},this.getAllConnections=function(){return b},this.getDefaultScope=function(){return D},this.getEndpoint=N,this.getEndpoints=function(t){return y[d(t).id]||[]},this.getDefaultEndpointType=function(){return h.Endpoint},this.getDefaultConnectionType=function(){return h.Connection},this.getId=B,this.draw=L,this.info=d,this.appendElement=T;var nt=!1;this.isHoverSuspended=function(){return nt},this.setHoverSuspended=function(t){nt=t},this.hide=function(t,e){return R(t,"none",e),i},this.idstamp=O;var it=function(t){if(!f&&t){var e=i.getElement(t);e.offsetParent&&i.setContainer(e.offsetParent)}},ot=i.manage=function(t,e,n,o){return w[t]?o&&(w[t].info=st({elId:t,timestamp:E,recalc:!0})):(w[t]={el:e,endpoints:[],connections:[],rotation:0},w[t].info=st({elId:t,timestamp:E}),i.addClass(e,"jtk-managed"),n||i.fire("manageElement",{id:t,info:w[t].info,el:e})),w[t]};this.unmanage=function(t){if(w[t]){var e=w[t].el;i.removeClass(e,"jtk-managed"),delete w[t],i.fire("unmanageElement",{id:t,el:e})}},this.rotate=function(t,e,n){return w[t]&&(w[t].rotation=e,w[t].el.style.transform="rotate("+e+"deg)",w[t].el.style.transformOrigin="center center",!0!==n)?this.revalidate(t):{c:[],e:[]}},this.getRotation=function(t){return w[t]&&w[t].rotation||0};var st=function(t){var e,n=t.timestamp,o=t.recalc,s=t.offset,a=t.elId;return P&&!n&&(n=E),!o&&n&&n===S[a]?{o:t.offset||C[a],s:x[a]}:(o||!s&&null==C[a]?null!=(e=w[a]?w[a].el:null)&&(x[a]=i.getSize(e),C[a]=i.getOffset(e),S[a]=n):(C[a]=s||C[a],null==x[a]&&null!=(e=w[a].el)&&(x[a]=i.getSize(e)),S[a]=n),C[a]&&!C[a].right&&(C[a].right=C[a].left+x[a][0],C[a].bottom=C[a].top+x[a][1],C[a].width=x[a][0],C[a].height=x[a][1],C[a].centerx=C[a].left+C[a].width/2,C[a].centery=C[a].top+C[a].height/2),{o:C[a],s:x[a]})};this.updateOffset=st,this.init=function(){g||(i.Defaults.Container&&i.setContainer(i.Defaults.Container),i.router=new t.jsPlumb.DefaultRouter(i),i.anchorManager=i.router.anchorManager,g=!0,i.fire("ready",i))}.bind(this),this.log=v,this.jsPlumbUIComponent=l,this.makeAnchor=function(){var e,o=function(e,n){if(t.jsPlumb.Anchors[e])return new t.jsPlumb.Anchors[e](n);if(!i.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+e+"'"}};if(0===arguments.length)return null;var s=arguments[0],a=arguments[1],r=null;if(s.compute&&s.getOrientation)return s;if("string"==typeof s)r=o(arguments[0],{elementId:a,jsPlumbInstance:i});else if(n.isArray(s))if(n.isArray(s[0])||n.isString(s[0]))2===s.length&&n.isObject(s[1])?n.isString(s[0])?(e=t.jsPlumb.extend({elementId:a,jsPlumbInstance:i},s[1]),r=o(s[0],e)):(e=t.jsPlumb.extend({elementId:a,jsPlumbInstance:i,anchors:s[0]},s[1]),r=new t.jsPlumb.DynamicAnchor(e)):r=new h.DynamicAnchor({anchors:s,selector:null,elementId:a,jsPlumbInstance:i});else{var l={x:s[0],y:s[1],orientation:s.length>=4?[s[2],s[3]]:[0,0],offsets:s.length>=6?[s[4],s[5]]:[0,0],elementId:a,jsPlumbInstance:i,cssClass:7===s.length?s[6]:null};(r=new t.jsPlumb.Anchor(l)).clone=function(){return new t.jsPlumb.Anchor(l)}}return r.id||(r.id="anchor_"+O()),r},this.makeAnchors=function(e,o,s){for(var a=[],r=0,l=e.length;r<l;r++)"string"==typeof e[r]?a.push(t.jsPlumb.Anchors[e[r]]({elementId:o,jsPlumbInstance:s})):n.isArray(e[r])&&a.push(i.makeAnchor(e[r],o,s));return a},this.makeDynamicAnchor=function(e,n){return new t.jsPlumb.DynamicAnchor({anchors:e,selector:n,elementId:null,jsPlumbInstance:i})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};var at=function(e,o,s,a,r){var c=new l(o),u=o._jsPlumb.EndpointDropHandler({jsPlumb:i,enabled:function(){return e.def.enabled},isFull:function(){var t=i.select({target:e.id}).length;return e.def.maxConnections>0&&t>=e.def.maxConnections},element:e.el,elementId:e.id,isSource:a,isTarget:r,addClass:function(t){i.addClass(e.el,t)},removeClass:function(t){i.removeClass(e.el,t)},onDrop:function(t){t.endpoints[0].anchor.locked=!1},isDropAllowed:function(){return c.isDropAllowed.apply(c,arguments)},isRedrop:function(t){return null!=t.suspendedElement&&null!=t.suspendedEndpoint&&t.suspendedEndpoint.element===e.el},getEndpoint:function(n){var s=e.def.endpoint;if(null==s||null==s._jsPlumb){var a=i.deriveEndpointAndAnchorSpec(n.getType().join(" "),!0),r=a.endpoints?t.jsPlumb.extend(o,{endpoint:e.def.def.endpoint||a.endpoints[1]}):o;a.anchors&&(r=t.jsPlumb.extend(r,{anchor:e.def.def.anchor||a.anchors[1]})),(s=i.addEndpoint(e.el,r))._mtNew=!0}if(o.uniqueEndpoint&&(e.def.endpoint=s),s.setDeleteOnEmpty(!0),n.isDetachable()&&s.initDraggable(),null!=s.anchor.positionFinder){var l=i.getUIPosition(arguments,i.getZoom()),c=i.getOffset(e.el),u=i.getSize(e.el),d=null==l?[0,0]:s.anchor.positionFinder(l,c,u,s.anchor.constructorParams);s.anchor.x=d[0],s.anchor.y=d[1]}return s},maybeCleanup:function(t){t._mtNew&&0===t.connections.length?i.deleteObject({endpoint:t}):delete t._mtNew}}),d=t.jsPlumb.dragEvents.drop;return s.scope=s.scope||o.scope||i.Defaults.Scope,s[d]=n.wrap(s[d],u,!0),s.rank=o.rank||0,r&&(s[t.jsPlumb.dragEvents.over]=function(){return!0}),!1===o.allowLoopback&&(s.canDrop=function(t){return t.getDragElement()._jsPlumbRelatedElement!==e.el}),i.initDroppable(e.el,s,"internal"),u};this.makeTarget=function(e,n,o){var s=t.jsPlumb.extend({_jsPlumb:this},o);t.jsPlumb.extend(s,n);for(var a=s.maxConnections||-1,r=function(e){var n=d(e),o=n.id,r=t.jsPlumb.extend({},s.dropOptions||{}),l=s.connectionType||"default";this.targetEndpointDefinitions[o]=this.targetEndpointDefinitions[o]||{},it(o),n.el._isJsPlumbGroup&&null==r.rank&&(r.rank=-1);var c={def:t.jsPlumb.extend({},s),uniqueEndpoint:s.uniqueEndpoint,maxConnections:a,enabled:!0};s.createEndpoint&&(c.uniqueEndpoint=!0,c.endpoint=i.addEndpoint(e,c.def),c.endpoint.setDeleteOnEmpty(!1)),n.def=c,this.targetEndpointDefinitions[o][l]=c,at(n,s,r,!0===s.isSource,!0),n.el._katavorioDrop[n.el._katavorioDrop.length-1].targetDef=c}.bind(this),l=e.length&&e.constructor!==String?e:[e],c=0,u=l.length;c<u;c++)r(l[c]);return this},this.unmakeTarget=function(t,e){var n=d(t);return i.destroyDroppable(n.el,"internal"),e||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(e,o,s){var a=t.jsPlumb.extend({_jsPlumb:this},s);t.jsPlumb.extend(a,o);var r=a.connectionType||"default",l=i.deriveEndpointAndAnchorSpec(r);a.endpoint=a.endpoint||l.endpoints[0],a.anchor=a.anchor||l.anchors[0];for(var u=a.maxConnections||-1,h=a.onMaxConnections,p=function(o){var s=o.id,l=this.getElement(o.el);this.sourceEndpointDefinitions[s]=this.sourceEndpointDefinitions[s]||{},it(s);var d={def:t.jsPlumb.extend({},a),uniqueEndpoint:a.uniqueEndpoint,maxConnections:u,enabled:!0};a.createEndpoint&&(d.uniqueEndpoint=!0,d.endpoint=i.addEndpoint(e,d.def),d.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[s][r]=d,o.def=d;var p=t.jsPlumb.dragEvents.stop,f=t.jsPlumb.dragEvents.drag,m=t.jsPlumb.extend({},a.dragOptions||{}),v=m.drag,g=m.stop,b=null,y=!1;m.scope=m.scope||a.scope,m[f]=n.wrap(m[f],(function(){v&&v.apply(this,arguments),y=!1})),m[p]=n.wrap(m[p],function(){if(g&&g.apply(this,arguments),this.currentlyDragging=!1,null!=b._jsPlumb){var t=a.anchor||this.Defaults.Anchor,e=b.anchor,n=b.connections[0],o=this.makeAnchor(t,s,this),r=b.element;if(null!=o.positionFinder){var l=i.getOffset(r),c=this.getSize(r),u={left:l.left+e.x*c[0],top:l.top+e.y*c[1]},d=o.positionFinder(u,l,c,o.constructorParams);o.x=d[0],o.y=d[1]}b.setAnchor(o,!0),b.repaint(),this.repaint(b.elementId),null!=n&&this.repaint(n.targetId)}}.bind(this));var _=function(e){if(3!==e.which&&2!==e.button){s=this.getId(this.getElement(o.el));var d=this.sourceEndpointDefinitions[s][r];if(d.enabled){if(a.filter)if(!1===(n.isString(a.filter)?function(t,e,n,i,o){for(var s=t.target||t.srcElement,a=!1,r=i.getSelector(e,n),l=0;l<r.length;l++)if(r[l]===s){a=!0;break}return o?!a:a}(e,o.el,a.filter,this,a.filterExclude):a.filter(e,o.el)))return;var p=this.select({source:s}).length;if(d.maxConnections>=0&&p>=d.maxConnections)return h&&h({element:o.el,maxConnections:u},e),!1;var f=t.jsPlumb.getPositionOnElement(e,l,c),v={};t.jsPlumb.extend(v,d.def),v.isTemporarySource=!0,v.anchor=[f[0],f[1],0,0],v.dragOptions=m,d.def.scope&&(v.scope=d.def.scope),b=this.addEndpoint(s,v),y=!0,b.setDeleteOnEmpty(!0),d.uniqueEndpoint&&(d.endpoint?b.finalEndpoint=d.endpoint:(d.endpoint=b,b.setDeleteOnEmpty(!1)));var g=function(){i.off(b.canvas,"mouseup",g),i.off(o.el,"mouseup",g),y&&(y=!1,i.deleteEndpoint(b))};i.on(b.canvas,"mouseup",g),i.on(o.el,"mouseup",g);var _={};if(d.def.extract)for(var w in d.def.extract){var C=(e.srcElement||e.target).getAttribute(w);C&&(_[d.def.extract[w]]=C)}i.trigger(b.canvas,"mousedown",e,_),n.consume(e)}}}.bind(this);this.on(o.el,"mousedown",_),d.trigger=_,a.filter&&(n.isString(a.filter)||n.isFunction(a.filter))&&i.setDragFilter(o.el,a.filter);var w=t.jsPlumb.extend({},a.dropOptions||{});at(o,a,w,!0,!0===a.isTarget)}.bind(this),f=e.length&&e.constructor!==String?e:[e],m=0,v=f.length;m<v;m++)p(d(f[m]));return this},this.unmakeSource=function(t,e,n){var o=d(t);i.destroyDroppable(o.el,"internal");var s=this.sourceEndpointDefinitions[o.id];if(s)for(var a in s)if(null==e||e===a){var r=s[a].trigger;r&&i.off(o.el,"mousedown",r),n||delete this.sourceEndpointDefinitions[o.id][a]}return this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)i.unmakeSource(t,null,!0);return this.sourceEndpointDefinitions={},this};var rt=function(t,e,i){e=n.isArray(e)?e:[e];var o=B(t);i=i||"default";for(var s=0;s<e.length;s++){var a=this[e[s]][o];if(a&&a[i])return a[i].def.scope||this.Defaults.Scope}}.bind(this),lt=function(t,e,i,o){i=n.isArray(i)?i:[i];var s=B(t);o=o||"default";for(var a=0;a<i.length;a++){var r=this[i[a]][s];r&&r[o]&&(r[o].def.scope=e)}}.bind(this);this.getScope=function(t,e){return rt(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(t){return rt(t,"sourceEndpointDefinitions")},this.getTargetScope=function(t){return rt(t,"targetEndpointDefinitions")},this.setScope=function(t,e,n){this.setSourceScope(t,e,n),this.setTargetScope(t,e,n)},this.setSourceScope=function(t,e,n){lt(t,e,"sourceEndpointDefinitions",n),this.setDragScope(t,e)},this.setTargetScope=function(t,e,n){lt(t,e,"targetEndpointDefinitions",n),this.setDropScope(t,e)},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)i.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var ct=function(t,e,o,s,a){var r,l,c,u="source"===t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(a=a||"default",e.length&&!n.isString(e)){r=[];for(var h=0,p=e.length;h<p;h++)u[(l=d(e[h])).id]&&u[l.id][a]&&(r[h]=u[l.id][a].enabled,c=s?!r[h]:o,u[l.id][a].enabled=c,i[c?"removeClass":"addClass"](l.el,"jtk-"+t+"-disabled"))}else{var f=(l=d(e)).id;u[f]&&u[f][a]&&(r=u[f][a].enabled,c=s?!r:o,u[f][a].enabled=c,i[c?"removeClass":"addClass"](l.el,"jtk-"+t+"-disabled"))}return r}.bind(this),ut=function(t,e){if(null!=t){if(n.isString(t)||!t.length)return e.apply(this,[t]);if(t.length)return e.apply(this,[t[0]])}}.bind(this);this.toggleSourceEnabled=function(t,e){return ct("source",t,null,!0,e),this.isSourceEnabled(t,e)},this.setSourceEnabled=function(t,e,n){return ct("source",t,e,null,n)},this.isSource=function(t,e){return e=e||"default",ut(t,function(t){var n=this.sourceEndpointDefinitions[d(t).id];return null!=n&&null!=n[e]}.bind(this))},this.isSourceEnabled=function(t,e){return e=e||"default",ut(t,function(t){var n=this.sourceEndpointDefinitions[d(t).id];return n&&n[e]&&!0===n[e].enabled}.bind(this))},this.toggleTargetEnabled=function(t,e){return ct("target",t,null,!0,e),this.isTargetEnabled(t,e)},this.isTarget=function(t,e){return e=e||"default",ut(t,function(t){var n=this.targetEndpointDefinitions[d(t).id];return null!=n&&null!=n[e]}.bind(this))},this.isTargetEnabled=function(t,e){return e=e||"default",ut(t,function(t){var n=this.targetEndpointDefinitions[d(t).id];return n&&n[e]&&!0===n[e].enabled}.bind(this))},this.setTargetEnabled=function(t,e,n){return ct("target",t,e,null,n)},this.ready=function(t){i.bind("ready",t)};this.repaint=function(t,e,n){return function(t,e){if("object"==typeof t&&t.length)for(var n=0,o=t.length;n<o;n++)e(t[n]);else e(t);return i}(t,(function(t){L(t,e,n)}))},this.revalidate=function(t,e,n){var o=n?t:i.getId(t);i.updateOffset({elId:o,recalc:!0,timestamp:e});var s=i.getDragManager();return s&&s.updateOffsets(o),L(t,null,e)},this.repaintEverything=function(){var t,e=jsPlumbUtil.uuid();for(t in y)i.updateOffset({elId:t,recalc:!0,timestamp:e});for(t in y)L(t,null,e);return this},this.removeAllEndpoints=function(t,e,n){n=n||[];var o=function(t){var s,a,r=d(t),l=y[r.id];if(l)for(n.push(r),s=0,a=l.length;s<a;s++)i.deleteEndpoint(l[s],!1);if(delete y[r.id],e&&r.el&&3!==r.el.nodeType&&8!==r.el.nodeType)for(s=0,a=r.el.childNodes.length;s<a;s++)o(r.el.childNodes[s])};return o(t),this};var dt=function(t,e){i.removeAllEndpoints(t.id,!0,e);for(var n=i.getDragManager(),o=function(t){n&&n.elementRemoved(t.id),i.router.elementRemoved(t.id),i.isSource(t.el)&&i.unmakeSource(t.el),i.isTarget(t.el)&&i.unmakeTarget(t.el),i.destroyDraggable(t.el),i.destroyDroppable(t.el),delete i.floatingConnections[t.id],delete w[t.id],delete C[t.id],t.el&&(i.removeElement(t.el),t.el._jsPlumb=null)},s=1;s<e.length;s++)o(e[s]);o(t)};this.remove=function(t,e){var n=d(t),o=[];return n.text&&n.el.parentNode?n.el.parentNode.removeChild(n.el):n.id&&i.batch((function(){dt(n,o)}),!0===e),i},this.empty=function(t,e){var n=[],o=function(t,e){var i=d(t);if(i.text)i.el.parentNode.removeChild(i.el);else if(i.el){for(;i.el.childNodes.length>0;)o(i.el.childNodes[0]);e||dt(i,n)}};return i.batch((function(){o(t,!0)}),!1===e),i},this.reset=function(t){i.silently(function(){nt=!1,i.removeAllGroups(),i.removeGroupManager(),i.deleteEveryEndpoint(),t||i.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},b.length=0,this.doReset&&this.doReset()}.bind(this))},this.destroy=function(){this.reset(),f=null,m=null};var ht=function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),t.cleanup(),t.destroy()};this.clear=function(){i.select().each(ht),i.selectEndpoints().each(ht),y={},_={}},this.setDefaultScope=function(t){return D=t,i},this.deriveEndpointAndAnchorSpec=function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),o=null,s=null,a=null,r=null,l=0;l<n.length;l++){var c=i.getType(n[l],"connection");c&&(c.endpoints&&(o=c.endpoints),c.endpoint&&(s=c.endpoint),c.anchors&&(r=c.anchors),c.anchor&&(a=c.anchor))}return{endpoints:o||[s,s],anchors:r||[a,a]}},this.setId=function(t,e,i){var o;n.isString(t)?o=t:(t=this.getElement(t),o=this.getId(t));var s=this.getConnections({source:o,scope:"*"},!0),a=this.getConnections({target:o,scope:"*"},!0);e=""+e,i?t=this.getElement(e):(t=this.getElement(o),this.setAttribute(t,"id",e)),y[e]=y[o]||[];for(var r=0,l=y[e].length;r<l;r++)y[e][r].setElementId(e),y[e][r].setReferenceElement(t);delete y[o],this.sourceEndpointDefinitions[e]=this.sourceEndpointDefinitions[o],delete this.sourceEndpointDefinitions[o],this.targetEndpointDefinitions[e]=this.targetEndpointDefinitions[o],delete this.targetEndpointDefinitions[o],this.router.changeId(o,e);var c=this.getDragManager();c&&c.changeId(o,e),w[e]=w[o],delete w[o];var u=function(n,i,o){for(var s=0,a=n.length;s<a;s++)n[s].endpoints[i].setElementId(e),n[s].endpoints[i].setReferenceElement(t),n[s][o+"Id"]=e,n[s][o]=t};u(s,0,"source"),u(a,1,"target"),this.repaint(e)},this.setDebugLog=function(t){v=t},this.setSuspendDrawing=function(t,e){var n=P;return P=t,E=t?(new Date).getTime():null,e&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return P},this.getSuspendedAt=function(){return E},this.batch=function(t,e){var i=this.isSuspendDrawing();i||this.setSuspendDrawing(!0);try{t()}catch(t){n.log("Function run while suspended failed",t)}i||this.setSuspendDrawing(!1,!e)},this.doWhileSuspended=this.batch,this.getCachedData=function(t){var e=C[t];return e?{o:e,s:x[t]}:st({elId:t})},this.show=function(t,e){return R(t,"block",e),i},this.toggleVisible=function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),F(t,(function(t){var e=t.isVisible();t.setVisible(!e)}),n)},this.addListener=this.bind;var pt=[];this.registerFloatingConnection=function(t,e,i){pt[t.id]=e,n.addToList(y,t.id,i)},this.getFloatingConnectionFor=function(t){return pt[t]},this.listManager=new t.jsPlumbListManager(this,this.Defaults.ListStyle)};n.extend(t.jsPlumbInstance,n.EventGenerator,{setAttribute:function(t,e,n){this.setAttribute(t,e,n)},getAttribute:function(e,n){return this.getAttribute(t.jsPlumb.getElement(e),n)},convertToFullOverlaySpec:function(t){return n.isString(t)&&(t=[t,{}]),t[1].id=t[1].id||n.uuid(),t},registerConnectionType:function(e,n){if(this._connectionTypes[e]=t.jsPlumb.extend({},n),n.overlays){for(var i={},o=0;o<n.overlays.length;o++){var s=this.convertToFullOverlaySpec(n.overlays[o]);i[s[1].id]=s}this._connectionTypes[e].overlays=i}},registerConnectionTypes:function(t){for(var e in t)this.registerConnectionType(e,t[e])},registerEndpointType:function(e,n){if(this._endpointTypes[e]=t.jsPlumb.extend({},n),n.overlays){for(var i={},o=0;o<n.overlays.length;o++){var s=this.convertToFullOverlaySpec(n.overlays[o]);i[s[1].id]=s}this._endpointTypes[e].overlays=i}},registerEndpointTypes:function(t){for(var e in t)this.registerEndpointType(e,t[e])},getType:function(t,e){return"connection"===e?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,e){this.setId(t,e,!0)},setParent:function(t,e){var n=this.getElement(t),i=this.getId(n),o=this.getElement(e),s=this.getId(o),a=this.getDragManager();n.parentNode.removeChild(n),o.appendChild(n),a&&a.setParent(n,i,o,s)},extend:function(t,e,n){var i;if(n)for(i=0;i<n.length;i++)t[n[i]]=e[n[i]];else for(i in e)t[i]=e[i];return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,e,n,i,o,s){var a,r=t.endpoints[e].elementId,l=t.endpoints[e];t.proxies=t.proxies||[],(a=t.proxies[e]?t.proxies[e].ep:this.addEndpoint(n,{endpoint:o(t,e),anchor:s(t,e),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),t.proxies[e]={ep:a,originalEp:l},0===e?this.router.sourceOrTargetChanged(r,i,t,n,0):this.router.sourceOrTargetChanged(r,i,t,n,1),l.detachFromConnection(t,null,!0),a.connections=[t],t.endpoints[e]=a,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)},unproxyConnection:function(t,e,n){if(null!=t._jsPlumb&&null!=t.proxies&&null!=t.proxies[e]){var i=t.proxies[e].originalEp.element,o=t.proxies[e].originalEp.elementId;t.endpoints[e]=t.proxies[e].originalEp,0===e?this.router.sourceOrTargetChanged(n,o,t,i,0):this.router.sourceOrTargetChanged(n,o,t,i,1),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),delete t.proxies[e]}}});var h=new d;t.jsPlumb=h,h.getInstance=function(t,e){var n=new d(t);if(e)for(var i in e)n[i]=e[i];return n.init(),n},h.each=function(t,e){if(null!=t)if("string"==typeof t)e(h.getElement(t));else if(null!=t.length)for(var n=0;n<t.length;n++)e(h.getElement(t[n]));else e(t)},e.jsPlumb=h}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;e.OverlayCapableJsPlumbUIComponent=function(e){t.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},e.label&&(this.getDefaultType().overlays.__label=["Label",{label:e.label,location:e.labelLocation||this.defaultLabelLocation||.5,labelStyle:e.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:"__label"}]),this.setListenerComponent=function(t){if(this._jsPlumb)for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].setListenerComponent(t)}},e.OverlayCapableJsPlumbUIComponent.applyType=function(t,e){if(e.overlays){var n,i={};for(n in e.overlays){var o=t._jsPlumb.overlays[e.overlays[n][1].id];if(o)o.updateFrom(e.overlays[n][1]),i[e.overlays[n][1].id]=!0,o.reattach(t._jsPlumb.instance,t);else{var s=t.getCachedTypeItem("overlay",e.overlays[n][1].id);null!=s?(s.reattach(t._jsPlumb.instance,t),s.setVisible(!0),s.updateFrom(e.overlays[n][1]),t._jsPlumb.overlays[s.id]=s):s=t.addOverlay(e.overlays[n],!0),i[s.id]=!0}}for(n in t._jsPlumb.overlays)null==i[t._jsPlumb.overlays[n].id]&&t.removeOverlay(t._jsPlumb.overlays[n].id,!0)}},n.extend(e.OverlayCapableJsPlumbUIComponent,t.jsPlumbUIComponent,{setHover:function(t,e){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var n in this._jsPlumb.overlays)this._jsPlumb.overlays[n][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,i){var o=function(t,i){var o=null;if(n.isArray(i)){var s=i[0],a=e.extend({component:t,_jsPlumb:t._jsPlumb.instance},i[1]);3===i.length&&e.extend(a,i[2]),o=new(e.Overlays[t._jsPlumb.instance.getRenderMode()][s])(a)}else o=i.constructor===String?new(e.Overlays[t._jsPlumb.instance.getRenderMode()][i])({component:t,_jsPlumb:t._jsPlumb.instance}):i;return o.id=o.id||n.uuid(),t.cacheTypeItem("overlay",o,o.id),t._jsPlumb.overlays[o.id]=o,o}(this,t);if(this.getData&&"Label"===o.type&&n.isArray(t)){var s=this.getData(),a=t[1];if(s){var r=a.labelLocationAttribute||"labelLocation",l=s?s[r]:null;l&&(o.loc=l)}}return i||this.repaint(),o},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var e=this.getOverlay(t);e&&e.hide()},hideOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var e=this.getOverlay(t);e&&e.show()},showOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup&&this._jsPlumb.overlays[e].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},t||this.repaint()},removeOverlay:function(t,e){var n=this._jsPlumb.overlays[t];n&&(n.setVisible(!1),!e&&n.cleanup&&n.cleanup(),delete this._jsPlumb.overlays[t],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[t])},removeOverlays:function(){for(var t=0,e=arguments.length;t<e;t++)this.removeOverlay(arguments[t])},moveParent:function(t){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var e in this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[e].isAppendedAtTopLevel){var n=this._jsPlumb.overlays[e].getElement();n.parentNode.removeChild(n),t.appendChild(n)}},getLabel:function(){var t=this.getOverlay("__label");return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay("__label")},setLabel:function(t){var n=this.getOverlay("__label");n?t.constructor===String||t.constructor===Function?n.setLabel(t):(t.label&&n.setLabel(t.label),t.location&&n.setLocation(t.location)):(n=function(t,n){var i={cssClass:n.cssClass,labelStyle:t.labelStyle,id:"__label",component:t,_jsPlumb:t._jsPlumb.instance},o=e.extend(i,n);return new(e.Overlays[t._jsPlumb.instance.getRenderMode()].Label)(o)}(this,t.constructor===String||t.constructor===Function?{label:t}:t),this._jsPlumb.overlays.__label=n);this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup(t),this._jsPlumb.overlays[e].destroy(t);t&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,e){this._jsPlumb.overlayPositions[t.id]=e},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,e,n){if(!n)for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i][t+"Class"](e)},addClass:function(t,e){this._clazzManip("add",t,e)},removeClass:function(t,e){this._clazzManip("remove",t,e)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n=function(t,e,n){var i=!1;return{drag:function(){if(i)return i=!1,!0;if(e.element){var o=n.getUIPosition(arguments,n.getZoom());null!=o&&n.setPosition(e.element,o),n.repaint(e.element,o),t.paint({anchorPoint:t.anchor.getCurrentLocation({element:t})})}},stopDrag:function(){i=!0}}},i=function(t,e,n,i){var o=e.createElement("div",{position:"absolute"});e.appendElement(o);var s=e.getId(o);e.setPosition(o,n),o.style.width=i[0]+"px",o.style.height=i[1]+"px",e.manage(s,o,!0),t.id=s,t.element=o},o=function(e,n,i,o,s,a,r,l){return r({paintStyle:e,endpoint:i,anchor:new t.FloatingAnchor({reference:n,referenceCanvas:o,jsPlumbInstance:a}),source:s,scope:l})},s=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],a=function(t,e){var n=0;if(null!=e)for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId===e||t.connections[i].targetId===e){n=i;break}return t.connections[n]};t.Endpoint=function(r){var l=r._jsPlumb,c=r.newConnection,u=r.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],t.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:r.connectionType,maxConnections:null==r.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:r.maxConnections,paintStyle:r.endpointStyle||r.paintStyle||r.style||this._jsPlumb.instance.Defaults.EndpointStyle||t.Defaults.EndpointStyle,hoverPaintStyle:r.endpointHoverStyle||r.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||t.Defaults.EndpointHoverStyle,connectorStyle:r.connectorStyle,connectorHoverStyle:r.connectorHoverStyle,connectorClass:r.connectorClass,connectorHoverClass:r.connectorHoverClass,connectorOverlays:r.connectorOverlays,connector:r.connector,connectorTooltip:r.connectorTooltip}),this._jsPlumb.enabled=!(!1===r.enabled),this._jsPlumb.visible=!0,this.element=t.getElement(r.source),this._jsPlumb.uuid=r.uuid,this._jsPlumb.floatingEndpoint=null;var d=null;this._jsPlumb.uuid&&(r.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=r.elementId,this.dragProxy=r.dragProxy,this._jsPlumb.connectionCost=r.connectionCost,this._jsPlumb.connectionsDirected=r.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var h=!0===r.deleteOnEmpty;this.setDeleteOnEmpty=function(t){h=t};var p=function(){var e=l.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var n=l.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(e),this.addClass(n),t.updateClasses(this.element,n,e)}.bind(this);this.prepareAnchor=function(t){var e=this._jsPlumb.instance.makeAnchor(t,this.elementId,l);return e.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),p()}.bind(this)),e},this.setPreparedAnchor=function(t,e){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=t,p(),e||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(t,e){var n=this.prepareAnchor(t);return this.setPreparedAnchor(n,e),this};var f=function(t){if(this.connections.length>0)for(var e=0;e<this.connections.length;e++)this.connections[e].setHover(t,!1);else this.setHover(t)}.bind(this);this.bind("mouseover",(function(){f(!0)})),this.bind("mouseout",(function(){f(!1)})),r._transient||this._jsPlumb.instance.router.addEndpoint(this,this.elementId),this.prepareEndpoint=function(n,i){var o,s=function(e,n){var i=l.getRenderMode();if(t.Endpoints[i][e])return new t.Endpoints[i][e](n);if(!l.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+e+"'"}},a={_jsPlumb:this._jsPlumb.instance,cssClass:r.cssClass,container:r.container,tooltip:r.tooltip,connectorTooltip:r.connectorTooltip,endpoint:this};return e.isString(n)?o=s(n,a):e.isArray(n)?(a=e.merge(n[1],a),o=s(n[0],a)):o=n.clone(),o.clone=function(){return e.isString(n)?s(n,a):e.isArray(n)?(a=e.merge(n[1],a),s(n[0],a)):void 0}.bind(this),o.typeId=i,o},this.setEndpoint=function(t,e){var n=this.prepareEndpoint(t);this.setPreparedEndpoint(n,!0)},this.setPreparedEndpoint=function(t,e){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=t,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},t.extend(this,r,s),this.isSource=r.isSource||!1,this.isTemporarySource=r.isTemporarySource||!1,this.isTarget=r.isTarget||!1,this.connections=r.connections||[],this.connectorPointerEvents=r["connector-pointer-events"],this.scope=r.scope||l.getDefaultScope(),this.timestamp=null,this.reattachConnections=r.reattach||l.Defaults.ReattachConnections,this.connectionsDetachable=l.Defaults.ConnectionsDetachable,!1!==r.connectionsDetachable&&!1!==r.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==r.dragAllowedWhenFull,r.onMaxConnections&&this.bind("maxConnections",r.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(this.connections.length>0?"add":"remove")+"Class"](l.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](l.endpointFullClass)},this.detachFromConnection=function(t,e,n){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this[(this.connections.length>0?"add":"remove")+"Class"](l.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](l.endpointFullClass)),!n&&h&&0===this.connections.length&&l.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==n})},this.deleteEveryConnection=function(t){for(var e=this.connections.length,n=0;n<e;n++)l.deleteConnection(this.connections[0],t)},this.detachFrom=function(t,e,n){for(var i=[],o=0;o<this.connections.length;o++)this.connections[o].endpoints[1]!==t&&this.connections[o].endpoints[0]!==t||i.push(this.connections[o]);for(var s=0,a=i.length;s<a;s++)l.deleteConnection(i[0]);return this},this.getElement=function(){return this.element},this.setElement=function(n){var i=this._jsPlumb.instance.getId(n),o=this.elementId;return e.removeWithFunction(r.endpointsByElement[this.elementId],function(t){return t.id===this.id}.bind(this)),this.element=t.getElement(n),this.elementId=l.getId(this.element),l.router.rehomeEndpoint(this,o,this.element),l.dragManager.endpointAdded(this.element),e.addToList(r.endpointsByElement,i,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),e=this.anchor.getOrientation(this),n=this.anchor.getCssClass(),i={bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return e},getCssClass:function(){return n}};return u({dropOptions:r.dropOptions,anchor:i,source:this.element,paintStyle:this.getPaintStyle(),endpoint:r.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(t){var e=(t=t||{}).timestamp,n=!(!1===t.recalc);if(!e||this.timestamp!==e){var i=l.updateOffset({elId:this.elementId,timestamp:e}),o=t.offset?t.offset.o:i.o;if(null!=o){var s=t.anchorPoint,r=t.connectorPaintStyle;if(null==s){var c=t.dimensions||i.s,u={xy:[o.left,o.top],wh:c,element:this,timestamp:e};if(n&&this.anchor.isDynamic&&this.connections.length>0){var d=a(this,t.elementWithPrecedence),h=d.endpoints[0]===this?1:0,p=0===h?d.sourceId:d.targetId,f=l.getCachedData(p),m=f.o,v=f.s;u.index=0===h?1:0,u.connection=d,u.txy=[m.left,m.top],u.twh=v,u.tElement=d.endpoints[h],u.tRotation=l.getRotation(p)}else this.connections.length>0&&(u.connection=this.connections[0]);u.rotation=l.getRotation(this.elementId),s=this.anchor.compute(u)}for(var g in this.endpoint.compute(s,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,r||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=e,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(g)){var b=this._jsPlumb.overlays[g];b.isVisible()&&(this._jsPlumb.overlayPlacements[g]=b.draw(this.endpoint,this._jsPlumb.paintStyleInUse),b.paint(this._jsPlumb.overlayPlacements[g]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var m=!1;this.initDraggable=function(){if(!m&&t.isDragSupported(this.element)){var s,a={id:null,element:null},h=null,p=!1,f=null,v=n(this,a,l),g=r.dragOptions||{},b=t.dragEvents.start,y=t.dragEvents.stop,_=t.dragEvents.drag,w=t.dragEvents.beforeStart,C=function(e){h=this.connectorSelector();var n=!0;this.isEnabled()||(n=!1),null!=h||this.isSource||this.isTemporarySource||(n=!1),!this.isSource||!this.isFull()||null!=h&&this.dragAllowedWhenFull||(n=!1),null==h||h.isDetachable(this)||(this.isFull()?n=!1:h=null);var d=l.checkCondition(null==h?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:h});if(!1===d?n=!1:"object"==typeof d?t.extend(d,s||{}):d=s||{},!1===n)return l.stopDrag&&l.stopDrag(this.canvas),v.stopDrag(),!1;for(var m=0;m<this.connections.length;m++)this.connections[m].setHover(!1);this.addClass("endpointDrag"),l.setConnectionBeingDragged(!0),h&&!this.isFull()&&this.isSource&&(h=null),l.updateOffset({elId:this.elementId});var g=this._jsPlumb.instance.getOffset(this.canvas),b=this.canvas,y=this._jsPlumb.instance.getSize(this.canvas);i(a,l,g,y),l.setAttributes(this.canvas,{dragId:a.id,elId:this.elementId});var _=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var w=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);w.endpoints[1]&&(_=w.endpoints[1])}var C=this._jsPlumb.instance.makeAnchor("Center");C.isFloating=!0,this._jsPlumb.floatingEndpoint=o(this.getPaintStyle(),C,_,this.canvas,a.element,l,u,this.scope);var S=this._jsPlumb.floatingEndpoint.anchor;if(null==h)this.setHover(!1,!1),(h=c({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:a.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:r.connectorStyle,hoverPaintStyle:r.connectorHoverStyle,connector:r.connector,overlays:r.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:r.scope,data:d})).pending=!0,h.addClass(l.draggingClass),this._jsPlumb.floatingEndpoint.addClass(l.draggingClass),this._jsPlumb.floatingEndpoint.anchor=S,l.fire("connectionDrag",h),l.router.newConnection(h);else{p=!0,h.setHover(!1);var k=h.endpoints[0].id===this.id?0:1;this.detachFromConnection(h,null,!0);var x=l.getDragScope(b);l.setAttribute(this.canvas,"originalScope",x),l.fire("connectionDrag",h),0===k?(f=[h.source,h.sourceId,b,x],l.router.sourceOrTargetChanged(h.endpoints[k].elementId,a.id,h,a.element,0)):(f=[h.target,h.targetId,b,x],l.router.sourceOrTargetChanged(h.endpoints[k].elementId,a.id,h,a.element,1)),h.suspendedEndpoint=h.endpoints[k],h.suspendedElement=h.endpoints[k].getElement(),h.suspendedElementId=h.endpoints[k].elementId,h.suspendedElementType=0===k?"source":"target",h.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=h.suspendedEndpoint,h.endpoints[k]=this._jsPlumb.floatingEndpoint,h.addClass(l.draggingClass),this._jsPlumb.floatingEndpoint.addClass(l.draggingClass)}l.registerFloatingConnection(a,h,this._jsPlumb.floatingEndpoint),l.currentlyDragging=!0}.bind(this),S=function(){if(l.setConnectionBeingDragged(!1),h&&null!=h.endpoints){var t=l.getDropEvent(arguments),e=l.getFloatingAnchorIndex(h);if(h.endpoints[0===e?1:0].anchor.locked=!1,h.removeClass(l.draggingClass),this._jsPlumb&&(h.deleteConnectionNow||h.endpoints[e]===this._jsPlumb.floatingEndpoint)&&p&&h.suspendedEndpoint){0===e?(h.floatingElement=h.source,h.floatingId=h.sourceId,h.floatingEndpoint=h.endpoints[0],h.floatingIndex=0,h.source=f[0],h.sourceId=f[1]):(h.floatingElement=h.target,h.floatingId=h.targetId,h.floatingEndpoint=h.endpoints[1],h.floatingIndex=1,h.target=f[0],h.targetId=f[1]);var n=this._jsPlumb.floatingEndpoint;l.setDragScope(f[2],f[3]),h.endpoints[e]=h.suspendedEndpoint,h.isReattach()||h._forceReattach||h._forceDetach||!l.deleteConnection(h,{originalEvent:t})?(h.setHover(!1),h._forceDetach=null,h._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(h),h.suspendedEndpoint.addConnection(h),1===e?l.router.sourceOrTargetChanged(h.floatingId,h.targetId,h,h.target,e):l.router.sourceOrTargetChanged(h.floatingId,h.sourceId,h,h.source,e),l.repaint(f[1])):l.deleteObject({endpoint:n})}this.deleteAfterDragStop?l.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),l.fire("connectionDragStop",h,t),h.pending&&l.fire("connectionAborted",h,t),l.currentlyDragging=!1,h.suspendedElement=null,h.suspendedEndpoint=null,h=null}a&&a.element&&l.remove(a.element,!1,!1),d&&l.deleteObject({endpoint:d}),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.locked=!1,this._jsPlumb.floatingEndpoint=null)}.bind(this);(g=t.extend({},g)).scope=this.scope||g.scope,g[w]=e.wrap(g[w],(function(t){s=t.e.payload||{}}),!1),g[b]=e.wrap(g[b],C,!1),g[_]=e.wrap(g[_],v.drag),g[y]=e.wrap(g[y],S),g.multipleDrop=!1,g.canDrag=function(){return this.isSource||this.isTemporarySource||this.connections.length>0&&!1!==this.connectionsDetachable}.bind(this),l.initDraggable(this.canvas,g,"internal"),this.canvas._jsPlumbRelatedElement=this.element,m=!0}};var v=r.endpoint||this._jsPlumb.instance.Defaults.Endpoint||t.Defaults.Endpoint;this.setEndpoint(v,!0);var g=r.anchor?r.anchor:r.anchors?r.anchors:l.Defaults.Anchor||"Top";this.setAnchor(g,!0);var b=["default",r.type||""].join(" ");this.addType(b,r.data,!0),this.canvas=this.endpoint.canvas,this.canvas._jsPlumb=this,this.initDraggable();var y=function(n,i,o,s){if(t.isDropSupported(this.element)){var a=r.dropOptions||l.Defaults.DropOptions||t.Defaults.DropOptions;(a=t.extend({},a)).scope=a.scope||this.scope;var c=t.dragEvents.drop,u=t.dragEvents.over,d=t.dragEvents.out,h=this,p=l.EndpointDropHandler({getEndpoint:function(){return h},jsPlumb:l,enabled:function(){return null==o||o.isEnabled()},isFull:function(){return o.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){h.addClass(t)},removeClass:function(t){h.removeClass(t)},isDropAllowed:function(){return h.isDropAllowed.apply(h,arguments)},reference:s,isRedrop:function(t,e){return t.suspendedEndpoint&&e.reference&&t.suspendedEndpoint.id===e.reference.id}});a[c]=e.wrap(a[c],p,!0),a[u]=e.wrap(a[u],function(){var e=t.getDragObject(arguments),n=l.getAttribute(t.getElement(e),"dragId"),i=l.getFloatingConnectionFor(n);if(null!=i){var o=l.getFloatingAnchorIndex(i),s=this.isTarget&&0!==o||i.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===i.suspendedEndpoint.id;if(s){var a=l.checkCondition("checkDropAllowed",{sourceEndpoint:i.endpoints[o],targetEndpoint:this,connection:i});this[(a?"add":"remove")+"Class"](l.endpointDropAllowedClass),this[(a?"remove":"add")+"Class"](l.endpointDropForbiddenClass),i.endpoints[o].anchor.over(this.anchor,this)}}}.bind(this)),a[d]=e.wrap(a[d],function(){var e=t.getDragObject(arguments),n=null==e?null:l.getAttribute(t.getElement(e),"dragId"),i=n?l.getFloatingConnectionFor(n):null;if(null!=i){var o=l.getFloatingAnchorIndex(i),s=this.isTarget&&0!==o||i.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===i.suspendedEndpoint.id;s&&(this.removeClass(l.endpointDropAllowedClass),this.removeClass(l.endpointDropForbiddenClass),i.endpoints[o].anchor.out())}}.bind(this)),l.initDroppable(n,a,"internal",i)}}.bind(this);return this.anchor.isFloating||y(this.canvas,!(r._transient||this.anchor.isFloating),this,r.reference),this},e.extend(t.Endpoint,t.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,e,n){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!e)for(var i=0;i<this.connections.length;i++)if(this.connections[i].setVisible(t),!n){var o=this===this.connections[i].endpoints[0]?1:0;1===this.connections[i].endpoints[o].connections.length&&this.connections[i].endpoints[o].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(e,n){this.setPaintStyle(e.endpointStyle||e.paintStyle,n),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle,n),null!=e.maxConnections&&(this._jsPlumb.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),t.extend(this,e,s),null!=e.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,e.cssClass),t.OverlayCapableJsPlumbUIComponent.applyType(this,e)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){var e=this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");t.removeClass(this.element,e),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(e){this.element=t.getElement(e)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(t){return function(n){var i=t.jsPlumb;t.removeClass(i.endpointDropAllowedClass),t.removeClass(i.endpointDropForbiddenClass);var o=i.getDropEvent(arguments),s=i.getDragObject(arguments),a=i.getAttribute(s,"dragId"),r=(i.getAttribute(s,"elId"),i.getAttribute(s,"originalScope")),l=i.getFloatingConnectionFor(a);if(null!=l){var c=null!=l.suspendedEndpoint;if(!c||null!=l.suspendedEndpoint._jsPlumb){var u=t.getEndpoint(l);if(null!=u){if(t.isRedrop(l,t))return l._forceReattach=!0,l.setHover(!1),void(t.maybeCleanup&&t.maybeCleanup(u));var d=i.getFloatingAnchorIndex(l);if(0===d&&!t.isSource||1===d&&!t.isTarget)t.maybeCleanup&&t.maybeCleanup(u);else{t.onDrop&&t.onDrop(l),r&&i.setDragScope(s,r);var h=t.isFull(n);if(h&&u.fire("maxConnections",{endpoint:this,connection:l,maxConnections:u._jsPlumb.maxConnections},o),!h&&t.enabled()){var p=!0;0===d?(l.floatingElement=l.source,l.floatingId=l.sourceId,l.floatingEndpoint=l.endpoints[0],l.floatingIndex=0,l.source=t.element,l.sourceId=i.getId(t.element)):(l.floatingElement=l.target,l.floatingId=l.targetId,l.floatingEndpoint=l.endpoints[1],l.floatingIndex=1,l.target=t.element,l.targetId=i.getId(t.element)),c&&l.suspendedEndpoint.id!==u.id&&(l.isDetachAllowed(l)&&l.endpoints[d].isDetachAllowed(l)&&l.suspendedEndpoint.isDetachAllowed(l)&&i.checkCondition("beforeDetach",l)||(p=!1));var f=function(n){l.endpoints[d].detachFromConnection(l),l.suspendedEndpoint&&l.suspendedEndpoint.detachFromConnection(l),l.endpoints[d]=u,u.addConnection(l);var s=u.getParameters();for(var a in s)l.setParameter(a,s[a]);if(c){var r=l.suspendedEndpoint.elementId;i.fireMoveEvent({index:d,originalSourceId:0===d?r:l.sourceId,newSourceId:0===d?u.elementId:l.sourceId,originalTargetId:1===d?r:l.targetId,newTargetId:1===d?u.elementId:l.targetId,originalSourceEndpoint:0===d?l.suspendedEndpoint:l.endpoints[0],newSourceEndpoint:0===d?u:l.endpoints[0],originalTargetEndpoint:1===d?l.suspendedEndpoint:l.endpoints[1],newTargetEndpoint:1===d?u:l.endpoints[1],connection:l},o)}else s.draggable&&i.initDraggable(this.element,t.dragOptions,"internal",i);(1===d?i.router.sourceOrTargetChanged(l.floatingId,l.targetId,l,l.target,1):i.router.sourceOrTargetChanged(l.floatingId,l.sourceId,l,l.source,0),l.endpoints[0].finalEndpoint)&&(l.endpoints[0].detachFromConnection(l),l.endpoints[0]=l.endpoints[0].finalEndpoint,l.endpoints[0].addConnection(l));e.isObject(n)&&l.mergeData(n),i.finaliseConnection(l,null,o,!1),l.setHover(!1),i.revalidate(l.endpoints[0].element)}.bind(this),m=function(){l.suspendedEndpoint&&(l.endpoints[d]=l.suspendedEndpoint,l.setHover(!1),l._forceDetach=!0,0===d?(l.source=l.suspendedEndpoint.element,l.sourceId=l.suspendedEndpoint.elementId):(l.target=l.suspendedEndpoint.element,l.targetId=l.suspendedEndpoint.elementId),l.suspendedEndpoint.addConnection(l),1===d?i.router.sourceOrTargetChanged(l.floatingId,l.targetId,l,l.target,1):i.router.sourceOrTargetChanged(l.floatingId,l.sourceId,l,l.source,0),i.repaint(l.sourceId),l._forceDetach=!1)};if(p=p&&t.isDropAllowed(l.sourceId,l.targetId,l.scope,l,u))return f(p),!0;m()}t.maybeCleanup&&t.maybeCleanup(u),i.currentlyDragging=!1}}}}}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,i=function(t,i,o,s,a){if(e.Connectors[i]=e.Connectors[i]||{},null==e.Connectors[i][o]){if(null==e.Connectors[o]){if(t.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+o+"'")}e.Connectors[i][o]=function(){e.Connectors[o].apply(this,arguments),e.ConnectorRenderers[i].apply(this,arguments)},n.extend(e.Connectors[i][o],[e.Connectors[o],e.ConnectorRenderers[i]])}return new e.Connectors[i][o](s,a)},o=function(t,e,n){return t?n.makeAnchor(t,e,n):null},s=function(t,e,i,o){null!=e&&(e._jsPlumbConnections=e._jsPlumbConnections||{},o?delete e._jsPlumbConnections[t.id]:e._jsPlumbConnections[t.id]=!0,n.isEmpty(e._jsPlumbConnections)?i.removeClass(e,i.connectedClass):i.addClass(e,i.connectedClass))};e.Connection=function(t){var i=t.newEndpoint;this.id=t.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=t.previousConnection,this.source=e.getElement(t.source),this.target=e.getElement(t.target),e.OverlayCapableJsPlumbUIComponent.apply(this,arguments),t.sourceEndpoint?(this.source=t.sourceEndpoint.getElement(),this.sourceId=t.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),t.targetEndpoint?(this.target=t.targetEndpoint.getElement(),this.targetId=t.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[];var o=this._jsPlumb.instance;o.manage(this.sourceId,this.source),o.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams,overlays:t.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(e,n,s,a,r){return s=s||this._jsPlumb.instance.getId(n),this.prepareEndpoint(o,i,this,a,e?0:1,t,n,s,r)},t.type&&(t.endpoints=t.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(t.type).endpoints);var s=this.makeEndpoint(!0,this.source,this.sourceId,t.sourceEndpoint),a=this.makeEndpoint(!1,this.target,this.targetId,t.targetEndpoint);s&&n.addToList(t.endpointsByElement,this.sourceId,s),a&&n.addToList(t.endpointsByElement,this.targetId,a),this.scope||(this.scope=this.endpoints[0].scope),null!=t.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(t.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(t.deleteEndpointsOnEmpty));var r=o.Defaults.ConnectionsDetachable;!1===t.detachable&&(r=!1),!1===this.endpoints[0].connectionsDetachable&&(r=!1),!1===this.endpoints[1].connectionsDetachable&&(r=!1);var l=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||o.Defaults.ReattachConnections;this.appendToDefaultType({detachable:r,reattach:l,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||o.Defaults.PaintStyle||e.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||o.Defaults.HoverPaintStyle||e.Defaults.HoverPaintStyle});var c=o.getSuspendedAt();if(!o.isSuspendDrawing()){var u=o.getCachedData(this.sourceId),d=u.o,h=u.s,p=o.getCachedData(this.targetId),f=p.o,m=p.s,v=c||jsPlumbUtil.uuid(),g=this.endpoints[0].anchor.compute({xy:[d.left,d.top],wh:h,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[f.left,f.top],twh:m,tElement:this.endpoints[1],timestamp:v,rotation:o.getRotation(this.endpoints[0].elementId)});this.endpoints[0].paint({anchorLoc:g,timestamp:v}),g=this.endpoints[1].anchor.compute({xy:[f.left,f.top],wh:m,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[d.left,d.top],twh:h,tElement:this.endpoints[0],timestamp:v,rotation:o.getRotation(this.endpoints[1].elementId)}),this.endpoints[1].paint({anchorLoc:g,timestamp:v})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(t){return!1!==this._jsPlumb.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this._jsPlumb.detachable)},this.setDetachable=function(t){this._jsPlumb.detachable=!0===t},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(t){this._jsPlumb.reattach=!0===t},this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=t.directed,null==t.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var b=e.extend({},this.endpoints[1].getParameters());e.extend(b,this.endpoints[0].getParameters()),e.extend(b,this.getParameters()),this.setParameters(b),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||o.Defaults.Connector||e.Defaults.Connector,!0);var y=null!=t.data&&n.isObject(t.data)?t.data:{};this.getData=function(){return y},this.setData=function(t){y=t||{}},this.mergeData=function(t){y=e.extend(y,t)};var _=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,t.type].join(" ");/[^\s]/.test(_)&&this.addType(_,t.data,!0),this.updateConnectedClass()},n.extend(e.Connection,e.OverlayCapableJsPlumbUIComponent,{applyType:function(t,n,i){var o=null;null!=t.connector&&(null==(o=this.getCachedTypeItem("connector",i.connector))&&(o=this.prepareConnector(t.connector,i.connector),this.cacheTypeItem("connector",o,i.connector)),this.setPreparedConnector(o)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var s=null;t.anchor?null==(s=this.getCachedTypeItem("anchors",i.anchor))&&(s=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",s,i.anchor)):t.anchors&&null==(s=this.getCachedTypeItem("anchors",i.anchors))&&(s=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",s,i.anchors)),null!=s&&(this.endpoints[0].anchor=s[0],this.endpoints[1].anchor=s[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),e.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,e){e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,e){e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,this.target=null,null!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(t){this._jsPlumb&&(s(this,this.source,this._jsPlumb.instance,t),s(this,this.target,this._jsPlumb.instance,t))},setHover:function(e){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(e),t.jsPlumb[e?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),t.jsPlumb[e?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,e){var o,s={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},a=this._jsPlumb.instance.getRenderMode();return n.isString(t)?o=i(this._jsPlumb.instance,a,t,s,this):n.isArray(t)&&(o=1===t.length?i(this._jsPlumb.instance,a,t[0],s,this):i(this._jsPlumb.instance,a,t[0],n.merge(t[1],s),this)),null!=e&&(o.typeId=e),o},setPreparedConnector:function(t,e,n,i){if(this.connector!==t){var o,s="";if(null!=this.connector&&(s=(o=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=t,i&&this.cacheTypeItem("connector",t,i),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.connector.reattach(this._jsPlumb.instance),this.addClass(s),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=o)for(var a=this.getOverlays(),r=0;r<a.length;r++)a[r].transfer&&a[r].transfer(this.connector);n||this.setListenerComponent(this.connector),e||this.repaint()}},setConnector:function(t,e,n,i){var o=this.prepareConnector(t,i);this.setPreparedConnector(o,e,n,i)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var e=(t=t||{}).timestamp,n=this.targetId,i=this.sourceId;if(null==e||e!==this._jsPlumb.lastPaintedAt){var o=this._jsPlumb.instance.updateOffset({elId:i}).o,s=this._jsPlumb.instance.updateOffset({elId:n}).o,a=this.endpoints[0],r=this.endpoints[1],l=a.anchor.getCurrentLocation({xy:[o.left,o.top],wh:[o.width,o.height],element:a,timestamp:e,rotation:this._jsPlumb.instance.getRotation(this.sourceId)}),c=r.anchor.getCurrentLocation({xy:[s.left,s.top],wh:[s.width,s.height],element:r,timestamp:e,rotation:this._jsPlumb.instance.getRotation(this.targetId)});this.connector.resetBounds(),this.connector.compute({sourcePos:l,targetPos:c,sourceOrientation:a.anchor.getOrientation(a),targetOrientation:r.anchor.getOrientation(r),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:o,targetInfo:s});var u={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var d in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(d)){var h=this._jsPlumb.overlays[d];h.isVisible()&&(this._jsPlumb.overlayPlacements[d]=h.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(h)),u.minX=Math.min(u.minX,this._jsPlumb.overlayPlacements[d].minX),u.maxX=Math.max(u.maxX,this._jsPlumb.overlayPlacements[d].maxX),u.minY=Math.min(u.minY,this._jsPlumb.overlayPlacements[d].minY),u.maxY=Math.max(u.maxY,this._jsPlumb.overlayPlacements[d].maxY))}var p=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,f=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),m={xmin:Math.min(this.connector.bounds.minX-(p+f),u.minX),ymin:Math.min(this.connector.bounds.minY-(p+f),u.minY),xmax:Math.max(this.connector.bounds.maxX+(p+f),u.maxX),ymax:Math.max(this.connector.bounds.maxY+(p+f),u.maxY)};for(var v in this.connector.paintExtents=m,this.connector.paint(this._jsPlumb.paintStyleInUse,null,m),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(v)){var g=this._jsPlumb.overlays[v];g.isVisible()&&g.paint(this._jsPlumb.overlayPlacements[v],m)}}this._jsPlumb.lastPaintedAt=e}},repaint:function(t){var e=jsPlumb.extend(t||{},{});e.elId=this.sourceId,this.paint(e)},prepareEndpoint:function(t,n,i,s,a,r,l,c,u){var d;if(s)i.endpoints[a]=s,s.addConnection(i);else{r.endpoints||(r.endpoints=[null,null]);var h=u||r.endpoints[a]||r.endpoint||t.Defaults.Endpoints[a]||e.Defaults.Endpoints[a]||t.Defaults.Endpoint||e.Defaults.Endpoint;r.endpointStyles||(r.endpointStyles=[null,null]),r.endpointHoverStyles||(r.endpointHoverStyles=[null,null]);var p=r.endpointStyles[a]||r.endpointStyle||t.Defaults.EndpointStyles[a]||e.Defaults.EndpointStyles[a]||t.Defaults.EndpointStyle||e.Defaults.EndpointStyle;null==p.fill&&null!=r.paintStyle&&(p.fill=r.paintStyle.stroke),null==p.outlineStroke&&null!=r.paintStyle&&(p.outlineStroke=r.paintStyle.outlineStroke),null==p.outlineWidth&&null!=r.paintStyle&&(p.outlineWidth=r.paintStyle.outlineWidth);var f=r.endpointHoverStyles[a]||r.endpointHoverStyle||t.Defaults.EndpointHoverStyles[a]||e.Defaults.EndpointHoverStyles[a]||t.Defaults.EndpointHoverStyle||e.Defaults.EndpointHoverStyle;null!=r.hoverPaintStyle&&(null==f&&(f={}),null==f.fill&&(f.fill=r.hoverPaintStyle.stroke));var m=r.anchors?r.anchors[a]:r.anchor?r.anchor:o(t.Defaults.Anchors[a],c,t)||o(e.Defaults.Anchors[a],c,t)||o(t.Defaults.Anchor,c,t)||o(e.Defaults.Anchor,c,t);d=n({paintStyle:p,hoverPaintStyle:f,endpoint:h,connections:[i],uuid:r.uuids?r.uuids[a]:null,anchor:m,source:l,scope:r.scope,reattach:r.reattach||t.Defaults.ReattachConnections,detachable:r.detachable||t.Defaults.ConnectionsDetachable}),null==s&&d.setDeleteOnEmpty(!0),i.endpoints[a]=d,!1===r.drawEndpoints&&d.setVisible(!1,!0,!0)}return d},replaceEndpoint:function(t,e){var n=this.endpoints[t],i=n.elementId,o=this._jsPlumb.instance.getEndpoints(i),s=o.indexOf(n),a=this.makeEndpoint(0===t,n.element,i,null,e);this.endpoints[t]=a,o.splice(s,1,a),this._jsPlumb.instance.deleteObject({endpoint:n,deleteAttachedObjects:!1}),this._jsPlumb.instance.fire("endpointReplaced",{previous:n,current:a}),this._jsPlumb.instance.router.sourceOrTargetChanged(this.endpoints[1].elementId,this.endpoints[1].elementId,this,this.endpoints[1].element,1)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumbUtil,e=this.jsPlumb;e.AnchorManager=function(n){var i={},o={},s={},a={},r=this,l={},c=n.jsPlumbInstance,u={},d=function(t,e){return e[0][0]-t[0][0]},h=function(t,e){return(t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0])-(e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0])},p={top:h,right:d,bottom:d,left:h},f=function(t,e){var n=c.getCachedData(t),i=n.s,a=n.o,r=function(e,n,i,a,r,l,u){if(a.length>0)for(var d=function(t,e,n,i,o,s,a,r){for(var l=[],c=e[o?0:1]/(i.length+1),u=0;u<i.length;u++){var d=(u+1)*c,h=s*e[o?1:0];a&&(d=e[o?0:1]-d);var p=o?d:h,f=n.left+p,m=p/e[0],v=o?h:d,g=n.top+v,b=v/e[1];if(0!==r){var y=jsPlumbUtil.rotatePoint([f,g],[n.centerx,n.centery],r);f=y[0],g=y[1]}l.push([f,g,m,b,i[u][1],i[u][2]])}return l}(0,n,i,(b=p[e],a.sort(b)),r,l,"right"===e||"top"===e,c.getRotation(t)),h=function(t,e){o[t.id]=[e[0],e[1],e[2],e[3]],s[t.id]=u},f=0;f<d.length;f++){var m=d[f][4],v=m.endpoints[0].elementId===t,g=m.endpoints[1].elementId===t;v&&h(m.endpoints[0],d[f]),g&&h(m.endpoints[1],d[f])}var b};r("bottom",i,a,e.bottom,!0,1,[0,1]),r("top",i,a,e.top,!0,0,[0,-1]),r("left",i,a,e.left,!1,0,[-1,0]),r("right",i,a,e.right,!1,1,[1,0])};this.reset=function(){i={},a={},l={}},this.addFloatingConnection=function(t,e){u[t]=e},this.newConnection=function(n){var i=n.sourceId,o=n.targetId,s=n.endpoints,r=!0,l=function(l,c,u,d,h){i===o&&u.isContinuous&&(n._jsPlumb.instance.removeElement(s[1].canvas),r=!1),t.addToList(a,d,[h,c,u.constructor===e.DynamicAnchor])};l(0,s[0],s[0].anchor,o,n),r&&l(0,s[1],s[1].anchor,i,n)};var m=function(e){!function(e,n){if(e){var i=function(t){return t[4]===n};t.removeWithFunction(e.top,i),t.removeWithFunction(e.left,i),t.removeWithFunction(e.bottom,i),t.removeWithFunction(e.right,i)}}(l[e.elementId],e.id)};this.connectionDetached=function(e,n){var i=e.connection||e,o=e.sourceId,s=e.targetId,l=i.endpoints,c=function(e,n,i,o,s){t.removeWithFunction(a[o],(function(t){return t[0].id===s.id}))};c(0,l[1],l[1].anchor,o,i),c(0,l[0],l[0].anchor,s,i),i.floatingId&&(c(i.floatingIndex,i.floatingEndpoint,i.floatingEndpoint.anchor,i.floatingId,i),m(i.floatingEndpoint)),m(i.endpoints[0]),m(i.endpoints[1]),n||(r.redraw(i.sourceId),i.targetId!==i.sourceId&&r.redraw(i.targetId))},this.addEndpoint=function(e,n){t.addToList(i,n,e)},this.changeId=function(t,e){a[e]=a[t],i[e]=i[t],delete a[t],delete i[t]},this.getConnectionsFor=function(t){return a[t]||[]},this.getEndpointsFor=function(t){return i[t]||[]},this.deleteEndpoint=function(e){t.removeWithFunction(i[e.elementId],(function(t){return t.id===e.id})),m(e)},this.elementRemoved=function(t){delete u[t],delete i[t],i[t]=[]};var v=function(e,i,o,s,a,r,l,c,u,d,h,p){var f,m,v=-1,g=s.endpoints[l],b=g.id,y=[1,0][l],_=[[i,o],s,a,r,b],w=e[u],C=g._continuousAnchorEdge?e[g._continuousAnchorEdge]:null;if(C){var S=t.findWithFunction(C,(function(t){return t[4]===b}));if(-1!==S)for(C.splice(S,1),f=0;f<C.length;f++)m=C[f][1],t.addWithFunction(h,m,(function(t){return t.id===m.id})),t.addWithFunction(p,C[f][1].endpoints[l],(function(t){return t.id===m.endpoints[l].id})),t.addWithFunction(p,C[f][1].endpoints[y],(function(t){return t.id===m.endpoints[y].id}))}for(f=0;f<w.length;f++)m=w[f][1],1===n.idx&&w[f][3]===r&&-1===v&&(v=f),t.addWithFunction(h,m,(function(t){return t.id===m.id})),t.addWithFunction(p,w[f][1].endpoints[l],(function(t){return t.id===m.endpoints[l].id})),t.addWithFunction(p,w[f][1].endpoints[y],(function(t){return t.id===m.endpoints[y].id}));var k=c?-1!==v?v:0:w.length;w.splice(k,0,_),g._continuousAnchorEdge=u};this.sourceOrTargetChanged=function(n,i,o,s,r){if(0===r){if(n!==i){o.sourceId=i,o.source=s,t.removeWithFunction(a[n],(function(t){return t[0].id===o.id}));var l=t.findWithFunction(a[o.targetId],(function(t){return t[0].id===o.id}));l>-1&&(a[o.targetId][l][0]=o,a[o.targetId][l][1]=o.endpoints[0],a[o.targetId][l][2]=o.endpoints[0].anchor.constructor===e.DynamicAnchor),t.addToList(a,i,[o,o.endpoints[1],o.endpoints[1].anchor.constructor===e.DynamicAnchor]),o.endpoints[1].anchor.isContinuous&&(o.source===o.target?o._jsPlumb.instance.removeElement(o.endpoints[1].canvas):null==o.endpoints[1].canvas.parentNode&&o._jsPlumb.instance.appendElement(o.endpoints[1].canvas)),o.updateConnectedClass()}}else if(1===r){var c=o.endpoints[0].elementId;o.target=s,o.targetId=i;var u=t.findWithFunction(a[c],(function(t){return t[0].id===o.id})),d=t.findWithFunction(a[n],(function(t){return t[0].id===o.id}));-1!==u&&(a[c][u][0]=o,a[c][u][1]=o.endpoints[1],a[c][u][2]=o.endpoints[1].anchor.constructor===e.DynamicAnchor),d>-1&&(a[n].splice(d,1),t.addToList(a,i,[o,o.endpoints[0],o.endpoints[0].anchor.constructor===e.DynamicAnchor])),o.updateConnectedClass()}},this.rehomeEndpoint=function(t,e,n){var o=i[e]||[],s=c.getId(n);if(s!==e){var a=o.indexOf(t);if(a>-1){var l=o.splice(a,1)[0];r.add(l,s)}}for(var u=0;u<t.connections.length;u++)t.connections[u].sourceId===e?r.sourceOrTargetChanged(e,t.elementId,t.connections[u],t.element,0):t.connections[u].targetId===e&&r.sourceOrTargetChanged(e,t.elementId,t.connections[u],t.element,1)},this.redraw=function(n,o,s,r,d,h){var p=[],m=[],g=[];if(!c.isSuspendDrawing()){var b=i[n]||[],y=a[n]||[];s=s||jsPlumbUtil.uuid(),r=r||{left:0,top:0},o&&(o={left:o.left+r.left,top:o.top+r.top});for(var _=c.updateOffset({elId:n,offset:o,recalc:!1,timestamp:s}),w={},C=0;C<y.length;C++){var S=y[C][0],k=S.sourceId,x=S.targetId,P=S.endpoints[0].anchor.isContinuous,E=S.endpoints[1].anchor.isContinuous;if(P||E){var D=k+"_"+x,j=w[D],O=S.sourceId===n?1:0,T=c.getRotation(x),L=c.getRotation(k);P&&!l[k]&&(l[k]={top:[],right:[],bottom:[],left:[]}),E&&!l[x]&&(l[x]={top:[],right:[],bottom:[],left:[]}),n!==x&&c.updateOffset({elId:x,timestamp:s}),n!==k&&c.updateOffset({elId:k,timestamp:s});var N=c.getCachedData(x),A=c.getCachedData(k);x===k&&(P||E)?(v(l[k],-Math.PI/2,0,S,!1,x,0,!1,"top",0,p,m),v(l[x],-Math.PI/2,0,S,!1,k,1,!1,"top",0,p,m)):(j||(j=this.calculateOrientation(k,x,A.o,N.o,S.endpoints[0].anchor,S.endpoints[1].anchor,S,L,T),w[D]=j),P&&v(l[k],j.theta,0,S,!1,x,0,!1,j.a[0],0,p,m),E&&v(l[x],j.theta2,-1,S,!0,k,1,!0,j.a[1],0,p,m)),P&&t.addWithFunction(g,k,(function(t){return t===k})),E&&t.addWithFunction(g,x,(function(t){return t===x})),t.addWithFunction(p,S,(function(t){return t.id===S.id})),(P&&0===O||E&&1===O)&&t.addWithFunction(m,S.endpoints[O],(function(t){return t.id===S.endpoints[O].id}))}}for(C=0;C<b.length;C++)0===b[C].connections.length&&b[C].anchor.isContinuous&&(l[n]||(l[n]={top:[],right:[],bottom:[],left:[]}),v(l[n],-Math.PI/2,0,{endpoints:[b[C],b[C]],paint:function(){}},!1,n,0,!1,b[C].anchor.getDefaultFace(),0,p,m),t.addWithFunction(g,n,(function(t){return t===n})));for(C=0;C<g.length;C++)f(g[C],l[g[C]]);for(C=0;C<b.length;C++)b[C].paint({timestamp:s,offset:_,dimensions:_.s,recalc:!0!==h});for(C=0;C<m.length;C++){var I=c.getCachedData(m[C].elementId);m[C].paint({timestamp:null,offset:I,dimensions:I.s})}for(C=0;C<y.length;C++){var M=y[C][1];if(M.anchor.constructor===e.DynamicAnchor){M.paint({elementWithPrecedence:n,timestamp:s}),t.addWithFunction(p,y[C][0],(function(t){return t.id===y[C][0].id}));for(var $=0;$<M.connections.length;$++)M.connections[$]!==y[C][0]&&t.addWithFunction(p,M.connections[$],(function(t){return t.id===M.connections[$].id}))}else t.addWithFunction(p,y[C][0],(function(t){return t.id===y[C][0].id}))}var F=u[n];for(F&&F.paint({timestamp:s,recalc:!1,elId:n}),C=0;C<p.length;C++)p[C].paint({elId:n,timestamp:null,recalc:!1,clearEdits:d})}return{c:p,e:m}};var g=function(e){t.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var n=e.faces||["top","right","bottom","left"],i=!(!1===e.clockwise),a={},r={top:"bottom",right:"left",left:"right",bottom:"top"},l={top:"right",right:"bottom",left:"top",bottom:"left"},c={top:"left",right:"top",left:"bottom",bottom:"right"},u=i?l:c,d=i?c:l,h=e.cssClass||"",p=null,f=null,m=["left","right"],v=["top","bottom"],g=null,b=0;b<n.length;b++)a[n[b]]=!0;this.getDefaultFace=function(){return 0===n.length?"top":n[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(t){return a[t]?t:a[r[t]]?r[t]:a[u[t]]?u[t]:a[d[t]]?d[t]:t},this.isEdgeSupported=function(t){return null==g?null==f?!0===a[t]:f===t:-1!==g.indexOf(t)},this.setCurrentFace=function(t,e){p=t,e&&null!=f&&(f=p)},this.getCurrentFace=function(){return p},this.getSupportedFaces=function(){var t=[];for(var e in a)a[e]&&t.push(e);return t},this.lock=function(){f=p},this.unlock=function(){f=null},this.isLocked=function(){return null!=f},this.lockCurrentAxis=function(){null!=p&&(g="left"===p||"right"===p?m:v)},this.unlockCurrentAxis=function(){g=null},this.compute=function(t){return o[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return o[t.element.id]||[0,0]},this.getOrientation=function(t){return s[t.id]||[0,0]},this.getCssClass=function(){return h}};c.continuousAnchorFactory={get:function(t){return new g(t)},clear:function(t){delete o[t]}}},e.AnchorManager.prototype.calculateOrientation=function(t,e,n,i,o,s,a,r,l){var c=["left","top","right","bottom"];if(t===e)return{orientation:"identity",a:["top","top"]};var u=Math.atan2(i.centery-n.centery,i.centerx-n.centerx),d=Math.atan2(n.centery-i.centery,n.centerx-i.centerx),h=[],p={};!function(t,e){for(var n=0;n<t.length;n++)if(p[t[n]]={left:[e[n][0].left,e[n][0].centery],right:[e[n][0].right,e[n][0].centery],top:[e[n][0].centerx,e[n][0].top],bottom:[e[n][0].centerx,e[n][0].bottom]},0!==e[n][1])for(var i in p[t[n]])p[t[n]][i]=jsPlumbUtil.rotatePoint(p[t[n]][i],[e[n][0].centerx,e[n][0].centery],e[n][1])}(["source","target"],[[n,r],[i,l]]);for(var f=0;f<c.length;f++)for(var m=0;m<c.length;m++)h.push({source:c[f],target:c[m],dist:Biltong.lineLength(p.source[c[f]],p.target[c[m]])});h.sort((function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0}));for(var v=h[0].source,g=h[0].target,b=0;b<h.length&&(v=o.isContinuous&&o.locked?o.getCurrentFace():!o.isContinuous||o.isEdgeSupported(h[b].source)?h[b].source:null,g=s.isContinuous&&s.locked?s.getCurrentFace():!s.isContinuous||s.isEdgeSupported(h[b].target)?h[b].target:null,null==v||null==g);b++);return o.isContinuous&&o.setCurrentFace(v),s.isContinuous&&s.setCurrentFace(g),{a:[v,g],theta:u,theta2:d}},e.Anchor=function(e){this.x=e.x||0,this.y=e.y||0,this.elementId=e.elementId,this.cssClass=e.cssClass||"",this.orientation=e.orientation||[0,0],this.lastReturnValue=null,this.offsets=e.offsets||[0,0],this.timestamp=null,this._unrotatedOrientation=[this.orientation[0],this.orientation[1]],this.relocatable=!1!==e.relocatable,this.snapOnRelocate=!1!==e.snapOnRelocate,this.locked=!1,t.EventGenerator.apply(this),this.compute=function(t){var e=t.xy,n=t.wh,i=t.timestamp;if(i&&i===this.timestamp)return this.lastReturnValue;var o=[e[0]+this.x*n[0]+this.offsets[0],e[1]+this.y*n[1]+this.offsets[1],this.x,this.y],s=t.rotation;if(null!=s&&0!==s){var a=jsPlumbUtil.rotatePoint(o,[e[0]+n[0]/2,e[1]+n[1]/2],s);this.orientation[0]=Math.round(this._unrotatedOrientation[0]*a[2]-this._unrotatedOrientation[1]*a[3]),this.orientation[1]=Math.round(this._unrotatedOrientation[1]*a[2]+this._unrotatedOrientation[0]*a[3]),this.lastReturnValue=[a[0],a[1],this.x,this.y]}else this.orientation[0]=this._unrotatedOrientation[0],this.orientation[1]=this._unrotatedOrientation[1],this.lastReturnValue=o;return this.timestamp=i,this.lastReturnValue},this.getCurrentLocation=function(t){return t=t||{},null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue},this.setPosition=function(t,e,n,i,o){this.locked&&!o||(this.x=t,this.y=e,this.orientation=[n,i],this.lastReturnValue=null)}},t.extend(e.Anchor,t.EventGenerator,{equals:function(t){if(!t)return!1;var e=t.getOrientation(),n=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&n[0]===e[0]&&n[1]===e[1]},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),e.FloatingAnchor=function(t){e.Anchor.apply(this,arguments);var n=t.reference,i=t.referenceCanvas,o=e.getSize(i),s=0,a=0,r=null,l=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var e=t.xy,n=[e[0]+o[0]/2,e[1]+o[1]/2];return l=n,n},this.getOrientation=function(t){if(r)return r;var e=n.getOrientation(t);return[Math.abs(e[0])*s*-1,Math.abs(e[1])*a*-1]},this.over=function(t,e){r=t.getOrientation(e)},this.out=function(){r=null},this.getCurrentLocation=function(t){return null==l?this.compute(t):l}},t.extend(e.FloatingAnchor,e.Anchor);var n=function(t,n,i){return t.constructor===e.Anchor?t:n.makeAnchor(t,i,n)};e.DynamicAnchor=function(t){e.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=t.elementId,this.jsPlumbInstance=t.jsPlumbInstance;for(var i=0;i<t.anchors.length;i++)this.anchors[i]=n(t.anchors[i],this.jsPlumbInstance,this.elementId);this.getAnchors=function(){return this.anchors};var o=this.anchors.length>0?this.anchors[0]:null,s=o,a=function(t,e,n,i,o,s,a){var r=i[0]+t.x*o[0],l=i[1]+t.y*o[1],c=i[0]+o[0]/2,u=i[1]+o[1]/2;if(null!=s&&0!==s){var d=jsPlumbUtil.rotatePoint([r,l],[c,u],s);r=d[0],l=d[1]}return Math.sqrt(Math.pow(e-r,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(c-r,2)+Math.pow(u-l,2))},r=t.selector||function(t,e,n,i,o,s,r){for(var l=n[0]+i[0]/2,c=n[1]+i[1]/2,u=-1,d=1/0,h=0;h<r.length;h++){var p=a(r[h],l,c,t,e,o,s);p<d&&(u=h+0,d=p)}return r[u]};this.compute=function(t){var e=t.xy,n=t.wh,i=t.txy,a=t.twh,l=t.rotation,c=t.tRotation;return this.timestamp=t.timestamp,this.locked||null==i||null==a?(this.lastReturnValue=o.compute(t),this.lastReturnValue):(t.timestamp=null,o=r(e,n,i,a,l,c,this.anchors),this.x=o.x,this.y=o.y,o!==s&&this.fire("anchorChanged",o),s=o,this.lastReturnValue=o.compute(t),this.lastReturnValue)},this.getCurrentLocation=function(t){return null!=o?o.getCurrentLocation(t):null},this.getOrientation=function(t){return null!=o?o.getOrientation(t):[0,0]},this.over=function(t,e){null!=o&&o.over(t,e)},this.out=function(){null!=o&&o.out()},this.setAnchor=function(t){o=t},this.getCssClass=function(){return o&&o.getCssClass()||""},this.setAnchorCoordinates=function(t){var e=jsPlumbUtil.findWithFunction(this.anchors,(function(e){return e.x===t[0]&&e.y===t[1]}));return-1!==e&&(this.setAnchor(this.anchors[e]),!0)}},t.extend(e.DynamicAnchor,e.Anchor);var i=function(t,n,i,o,s,a){e.Anchors[s]=function(e){var r=e.jsPlumbInstance.makeAnchor([t,n,i,o,0,0],e.elementId,e.jsPlumbInstance);return r.type=s,a&&a(r,e),r}};i(.5,0,0,-1,"TopCenter"),i(.5,1,0,1,"BottomCenter"),i(0,.5,-1,0,"LeftMiddle"),i(1,.5,1,0,"RightMiddle"),i(.5,0,0,-1,"Top"),i(.5,1,0,1,"Bottom"),i(0,.5,-1,0,"Left"),i(1,.5,1,0,"Right"),i(.5,.5,0,0,"Center"),i(1,0,0,-1,"TopRight"),i(1,1,0,1,"BottomRight"),i(0,0,0,-1,"TopLeft"),i(0,1,0,1,"BottomLeft"),e.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},e.Anchors.AutoDefault=function(t){var n=t.jsPlumbInstance.makeDynamicAnchor(e.Defaults.DynamicAnchors(t));return n.type="AutoDefault",n};var o=function(t,n){e.Anchors[t]=function(e){var i=e.jsPlumbInstance.makeAnchor(["Continuous",{faces:n}],e.elementId,e.jsPlumbInstance);return i.type=t,i}};e.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},o("ContinuousLeft",["left"]),o("ContinuousTop",["top"]),o("ContinuousBottom",["bottom"]),o("ContinuousRight",["right"]),i(0,0,0,0,"Assign",(function(t,e){var n=e.position||"Fixed";t.positionFinder=n.constructor===String?e.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=e})),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,e,n){return[(t.left-e.left)/n[0],(t.top-e.top)/n[1]]},Grid:function(t,e,n,i){var o=t.left-e.left,s=t.top-e.top,a=n[0]/i.grid[0],r=n[1]/i.grid[1],l=Math.floor(o/a),c=Math.floor(s/r);return[(l*a+a/2)/n[0],(c*r+r/2)/n[1]]}},e.Anchors.Perimeter=function(t){var e=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");var i=function(){for(var t=.5,n=2*Math.PI/e,i=0,o=[],s=0;s<e;s++){var a=t+t*Math.sin(i),r=t+t*Math.cos(i);o.push([a,r,0,0]),i+=n}return o},o=function(t){for(var n=e/t.length,i=[],o=function(t,o,s,a,r,l,c){for(var u=(s-t)/(n=e*r),d=(a-o)/n,h=0;h<n;h++)i.push([t+u*h,o+d*h,null==l?0:l,null==c?0:c])},s=0;s<t.length;s++)o.apply(null,t[s]);return i},s=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length,t[n][4],t[n][5]]);return o(e)},a=function(){return s([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])},r={Circle:i,Ellipse:i,Diamond:function(){return s([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:a,Square:a,Triangle:function(){return s([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var e=t.points,n=[],i=0,s=0;s<e.length-1;s++){var a=Math.sqrt(Math.pow(e[s][2]-e[s][0])+Math.pow(e[s][3]-e[s][1]));i+=a,n.push([e[s][0],e[s][1],e[s+1][0],e[s+1][1],a])}for(var r=0;r<n.length;r++)n[r][4]=n[r][4]/i;return o(n)}};if(!r[n])throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var l=r[n](t);t.rotation&&(l=function(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var s=t[o][0]-.5,a=t[o][1]-.5;n.push([s*Math.cos(i)-a*Math.sin(i)+.5,s*Math.sin(i)+a*Math.cos(i)+.5,t[o][2],t[o][3]])}return n}(l,t.rotation));var c=t.jsPlumbInstance.makeDynamicAnchor(l);return c.type="Perimeter",c}}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbUtil;var t=this.jsPlumb;t.DefaultRouter=function(e){this.jsPlumbInstance=e,this.anchorManager=new t.AnchorManager({jsPlumbInstance:e}),this.sourceOrTargetChanged=function(t,e,n,i,o){this.anchorManager.sourceOrTargetChanged(t,e,n,i,o)},this.reset=function(){this.anchorManager.reset()},this.changeId=function(t,e){this.anchorManager.changeId(t,e)},this.elementRemoved=function(t){this.anchorManager.elementRemoved(t)},this.newConnection=function(t){this.anchorManager.newConnection(t)},this.connectionDetached=function(t,e){this.anchorManager.connectionDetached(t,e)},this.redraw=function(t,e,n,i,o,s){return this.anchorManager.redraw(t,e,n,i,o,s)},this.deleteEndpoint=function(t){this.anchorManager.deleteEndpoint(t)},this.rehomeEndpoint=function(t,e,n){this.anchorManager.rehomeEndpoint(t,e,n)},this.addEndpoint=function(t,e){this.anchorManager.addEndpoint(t,e)}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,i=t.Biltong;e.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(t,e){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}},this.lineIntersection=function(t,e,n,i){return[]},this.boxIntersection=function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){e.Segments.AbstractSegment.apply(this,arguments);var n,o,s,a,r,l,c,u=function(){n=Math.sqrt(Math.pow(r-a,2)+Math.pow(c-l,2)),o=i.gradient({x:a,y:l},{x:r,y:c}),s=-1/o};this.type="Straight",this.getLength=function(){return n},this.getGradient=function(){return o},this.getCoordinates=function(){return{x1:a,y1:l,x2:r,y2:c}},this.setCoordinates=function(t){a=t.x1,l=t.y1,r=t.x2,c=t.y2,u()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(a,r),minY:Math.min(l,c),maxX:Math.max(a,r),maxY:Math.max(l,c)}},this.pointOnPath=function(t,e){if(0!==t||e){if(1!==t||e){var o=e?t>0?t:n+t:t*n;return i.pointOnLine({x:a,y:l},{x:r,y:c},o)}return{x:r,y:c}}return{x:a,y:l}},this.gradientAtPoint=function(t){return o},this.pointAlongPathFrom=function(t,e,n){var o=this.pointOnPath(t,n),s=e<=0?{x:a,y:l}:{x:r,y:c};return e<=0&&Math.abs(e)>1&&(e*=-1),i.pointOnLine(o,s,e)};var d=function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)},h=function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e};this.findClosestPointOnPath=function(t,e){var u={d:1/0,x:null,y:null,l:null,x1:a,x2:r,y1:l,y2:c};if(0===o)u.y=l,u.x=d(a,r,t)?t:h(a,r,t);else if(o===1/0||o===-1/0)u.x=a,u.y=d(l,c,e)?e:h(l,c,e);else{var p=l-o*a,f=(e-s*t-p)/(o-s),m=o*f+p;u.x=d(a,r,f)?f:h(a,r,f),u.y=d(l,c,m)?m:h(l,c,m)}var v=i.lineLength([u.x,u.y],[a,l]);return u.d=i.lineLength([t,e],[u.x,u.y]),u.l=v/n,u};var p=function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n},f=p;this.lineIntersection=function(t,e,n,s){var u=Math.abs(i.gradient({x:t,y:e},{x:n,y:s})),d=Math.abs(o),h=d===1/0?a:l-d*a,p=[],m=u===1/0?t:e-u*t;if(u!==d)if(u===1/0&&0===d)f(t,a,r)&&f(l,e,s)&&(p=[t,l]);else if(0===u&&d===1/0)f(e,l,c)&&f(a,t,n)&&(p=[a,e]);else{var v,g;u===1/0?f(v=t,a,r)&&f(g=d*t+h,e,s)&&(p=[v,g]):0===u?f(g=e,l,c)&&f(v=(e-h)/d,t,n)&&(p=[v,g]):(g=d*(v=(m-h)/(d-u))+h,f(v,a,r)&&f(g,l,c)&&(p=[v,g]))}return p},this.boxIntersection=function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(t){e.Segments.AbstractSegment.apply(this,arguments);var n=function(e,n){return i.theta([t.cx,t.cy],[e,n])},o=function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+s:t.startAngle;return n-Math.abs(n-t.endAngle)*e}var i=t.endAngle<t.startAngle?t.endAngle+s:t.endAngle,o=Math.abs(i-t.startAngle);return t.startAngle+o*e},s=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+this.radius*Math.cos(t.startAngle),this.y1=t.cy+this.radius*Math.sin(t.startAngle),this.x2=t.cx+this.radius*Math.cos(t.endAngle),this.y2=t.cy+this.radius*Math.sin(t.endAngle)):(this.startAngle=n(t.x1,t.y1),this.endAngle=n(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),this.endAngle<0&&(this.endAngle+=s),this.startAngle<0&&(this.startAngle+=s);var a=this.endAngle<this.startAngle?this.endAngle+s:this.endAngle;this.sweep=Math.abs(a-this.startAngle),this.anticlockwise&&(this.sweep=s-this.sweep);var r=2*Math.PI*this.radius,l=this.sweep/s,c=r*l;this.getLength=function(){return c},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var u=1e-10,d=function(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<u?e:n-t<u?n:t};this.pointOnPath=function(e,n){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};n&&(e/=c);var i=o(this,e),s=t.cx+t.r*Math.cos(i),a=t.cy+t.r*Math.sin(i);return{x:d(s),y:d(a),theta:i}},this.gradientAtPoint=function(e,n){var o=this.pointOnPath(e,n),s=i.normal([t.cx,t.cy],[o.x,o.y]);return this.anticlockwise||s!==1/0&&s!==-1/0||(s*=-1),s},this.pointAlongPathFrom=function(e,n,i){var o=this.pointOnPath(e,i),s=n/r*2*Math.PI,a=this.anticlockwise?-1:1,l=o.theta+a*s;return{x:t.cx+this.radius*Math.cos(l),y:t.cy+this.radius*Math.sin(l)}}},Bezier:function(n){this.curve=[{x:n.x1,y:n.y1},{x:n.cp1x,y:n.cp1y},{x:n.cp2x,y:n.cp2y},{x:n.x2,y:n.y2}];var i=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},o=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},s=function(t){var e={x:0,y:0};if(0===t)return this.curve[0];var n=this.curve.length-1;if(1===t)return this.curve[n];var i=this.curve,o=1-t;if(0===n)return this.curve[0];if(1===n)return{x:o*i[0].x+t*i[1].x,y:o*i[0].y+t*i[1].y};if(n<4){var s,a,r,l=o*o,c=t*t,u=0;return 2===n?(i=[i[0],i[1],i[2],e],s=l,a=o*t*2,r=c):3===n&&(s=l*o,a=l*t*3,r=o*c*3,u=t*c),{x:s*i[0].x+a*i[1].x+r*i[2].x+u*i[3].x,y:s*i[0].y+a*i[1].y+r*i[2].y+u*i[3].y}}return e}.bind(this),a=function(t){var e=[];t--;for(var n=0;n<=t;n++)e.push(s(n/t));return e},r=function(){i(this.curve)&&(this.length=0);var t=a(16);this.length=0;for(var e=0;e<15;e++){var n=t[e],s=t[e+1];this.length+=o(n,s)}}.bind(this);e.Segments.AbstractSegment.apply(this,arguments);this.bounds={minX:Math.min(n.x1,n.x2,n.cp1x,n.cp2x),minY:Math.min(n.y1,n.y2,n.cp1y,n.cp2y),maxX:Math.max(n.x1,n.x2,n.cp1x,n.cp2x),maxY:Math.max(n.y1,n.y2,n.cp1y,n.cp2y)},this.type="Bezier",r();var l=function(e,n,i){return i&&(n=t.jsBezier.locationAlongCurveFrom(e,n>0?0:1,n)),n};this.pointOnPath=function(e,n){return e=l(this.curve,e,n),t.jsBezier.pointOnCurve(this.curve,e)},this.gradientAtPoint=function(e,n){return e=l(this.curve,e,n),t.jsBezier.gradientAtPoint(this.curve,e)},this.pointAlongPathFrom=function(e,n,i){return e=l(this.curve,e,i),t.jsBezier.pointAlongCurveFrom(this.curve,e,n)},this.getLength=function(){return this.length},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(e,n){var i=t.jsBezier.nearestPointOnCurve({x:e,y:n},this.curve);return{d:Math.sqrt(Math.pow(i.point.x-e,2)+Math.pow(i.point.y-n,2)),x:i.point.x,y:i.point.y,l:1-i.location,s:this}},this.lineIntersection=function(e,n,i,o){return t.jsBezier.lineIntersection(e,n,i,o,this.curve)}}},e.SegmentRenderer={getPath:function(t,e){return{Straight:function(e){var n=t.getCoordinates();return(e?"M "+n.x1+" "+n.y1+" ":"")+"L "+n.x2+" "+n.y2},Bezier:function(e){var n=t.params;return(e?"M "+n.x2+" "+n.y2+" ":"")+"C "+n.cp2x+" "+n.cp2y+" "+n.cp1x+" "+n.cp1y+" "+n.x1+" "+n.y1},Arc:function(e){var n=t.params,i=t.sweep>Math.PI?1:0,o=t.anticlockwise?0:1;return(e?"M"+t.x1+" "+t.y1+" ":"")+"A "+t.radius+" "+n.r+" 0 "+i+","+o+" "+t.x2+" "+t.y2}}[t.type](e)}};var o=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};e.Connectors.AbstractConnector=function(t){o.apply(this,arguments);var s=[],a=0,r=[],l=[],c=t.stub||0,u=n.isArray(c)?c[0]:c,d=n.isArray(c)?c[1]:c,h=t.gap||0,p=n.isArray(h)?h[0]:h,f=n.isArray(h)?h[1]:h,m=null,v=null;this.getPathData=function(){for(var t="",n=0;n<s.length;n++)t+=e.SegmentRenderer.getPath(s[n],0===n),t+=" ";return t},this.findSegmentForPoint=function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null},i=0;i<s.length;i++){var o=s[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=s[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=r[i][0]+o.l*(r[i][1]-r[i][0]))}return n},this.lineIntersection=function(t,e,n,i){for(var o=[],a=0;a<s.length;a++)o.push.apply(o,s[a].lineIntersection(t,e,n,i));return o},this.boxIntersection=function(t,e,n,i){for(var o=[],a=0;a<s.length;a++)o.push.apply(o,s[a].boxIntersection(t,e,n,i));return o},this.boundingBoxIntersection=function(t){for(var e=[],n=0;n<s.length;n++)e.push.apply(e,s[n].boundingBoxIntersection(t));return e};var g=function(){for(var t=0,e=0;e<s.length;e++){var n=s[e].getLength();l[e]=n/a,r[e]=[t,t+=n/a]}},b=function(t,e){var n,i,o;if(e&&(t=t>0?t/a:(a+t)/a),1===t)n=s.length-1,o=1;else if(0===t)o=0,n=0;else if(t>=.5){for(n=0,o=0,i=r.length-1;i>-1;i--)if(r[i][1]>=t&&r[i][0]<=t){n=i,o=(t-r[i][0])/l[i];break}}else for(n=r.length-1,o=1,i=0;i<r.length;i++)if(r[i][1]>=t){n=i,o=(t-r[i][0])/l[i];break}return{segment:s[n],proportion:o,index:n}},y=function(t,n,i){if(i.x1!==i.x2||i.y1!==i.y2){var o=new e.Segments[n](i);s.push(o),a+=o.getLength(),t.updateBounds(o)}},_=function(){a=s.length=r.length=l.length=0};this.setSegments=function(t){m=[],a=0;for(var e=0;e<t.length;e++)m.push(t[e]),a+=t[e].getLength()},this.getLength=function(){return a};var w=function(t){this.strokeWidth=t.strokeWidth;var e=i.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],o=t.targetPos[1]<t.sourcePos[1],s=t.strokeWidth||1,a=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),r=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),l=n?t.targetPos[0]:t.sourcePos[0],c=o?t.targetPos[1]:t.sourcePos[1],h=Math.abs(t.targetPos[0]-t.sourcePos[0]),m=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===a[0]&&0===a[1]||0===r[0]&&0===r[1]){var v=h>m?0:1,g=[1,0][v];r=[],(a=[])[v]=t.sourcePos[v]>t.targetPos[v]?-1:1,r[v]=t.sourcePos[v]>t.targetPos[v]?1:-1,a[g]=0,r[g]=0}var b=n?h+p*a[0]:p*a[0],y=o?m+p*a[1]:p*a[1],_=n?f*r[0]:h+f*r[0],w=o?f*r[1]:m+f*r[1],C=a[0]*r[0]+a[1]*r[1],S={sx:b,sy:y,tx:_,ty:w,lw:s,xSpan:Math.abs(_-b),ySpan:Math.abs(w-y),mx:(b+_)/2,my:(y+w)/2,so:a,to:r,x:l,y:c,w:h,h:m,segment:e,startStubX:b+a[0]*u,startStubY:y+a[1]*u,endStubX:_+r[0]*d,endStubY:w+r[1]*d,isXGreaterThanStubTimes2:Math.abs(b-_)>u+d,isYGreaterThanStubTimes2:Math.abs(y-w)>u+d,opposite:-1===C,perpendicular:0===C,orthogonal:1===C,sourceAxis:0===a[0]?"y":"x",points:[l,c,h,m,b,y,_,w],stubs:[u,d]};return S.anchorOrientation=S.opposite?"opposite":S.orthogonal?"orthogonal":"perpendicular",S};this.getSegments=function(){return s},this.updateBounds=function(t){var e=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,e.minX),this.bounds.maxX=Math.max(this.bounds.maxX,e.maxX),this.bounds.minY=Math.min(this.bounds.minY,e.minY),this.bounds.maxY=Math.max(this.bounds.maxY,e.maxY)};return this.pointOnPath=function(t,e){var n=b(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,e){var n=b(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0},this.pointAlongPathFrom=function(t,e,n){var i=b(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||[0,0]},this.compute=function(t){v=w.call(this,t),_(),this._compute(v,t),this.x=v.points[0],this.y=v.points[1],this.w=v.points[2],this.h=v.points[3],this.segment=v.segment,g()},{addSegment:y,prepareCompute:w,sourceStub:u,targetStub:d,maxStub:Math.max(u,d),sourceGap:p,targetGap:f,maxGap:Math.max(p,f)}},n.extend(e.Connectors.AbstractConnector,o),e.Endpoints.AbstractEndpoint=function(t){o.apply(this,arguments);var e=this.compute=function(t,e,n,i){var o=this._compute.apply(this,arguments);return this.x=o[0],this.y=o[1],this.w=o[2],this.h=o[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,o};return{compute:e,cssClass:t.cssClass}},n.extend(e.Endpoints.AbstractEndpoint,o),e.Endpoints.Dot=function(t){this.type="Dot";e.Endpoints.AbstractEndpoint.apply(this,arguments);t=t||{},this.radius=t.radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,e,n,i){this.radius=n.radius||this.radius;var o=t[0]-this.radius,s=t[1]-this.radius,a=2*this.radius,r=2*this.radius;if(n.stroke){var l=n.strokeWidth||1;o-=l,s-=l,a+=2*l,r+=2*l}return[o,s,a,r,this.radius]}},n.extend(e.Endpoints.Dot,e.Endpoints.AbstractEndpoint),e.Endpoints.Rectangle=function(t){this.type="Rectangle";e.Endpoints.AbstractEndpoint.apply(this,arguments);t=t||{},this.width=t.width||20,this.height=t.height||20,this._compute=function(t,e,n,i){var o=n.width||this.width,s=n.height||this.height;return[t[0]-o/2,t[1]-s/2,o,s]}},n.extend(e.Endpoints.Rectangle,e.Endpoints.AbstractEndpoint);var s=function(t){e.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};n.extend(s,e.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),e.Endpoints.Image=function(i){this.type="Image",s.apply(this,arguments),e.Endpoints.AbstractEndpoint.apply(this,arguments);var o=i.onload,a=i.src||i.url,r=i.cssClass?" "+i.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=i.width,this._jsPlumb.heightToUse=i.height,this._jsPlumb.endpoint=i.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,o&&o(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(t,e){var n=t.constructor===String?t:t.src;o=e,this._jsPlumb.img.src=n,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(a,o),this._compute=function(t,e,n,i){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=e.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+r),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(t,e,i){if(!this._jsPlumb.deleted){this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0);var o=this.anchorPoint[0]-this._jsPlumb.widthToUse/2,s=this.anchorPoint[1]-this._jsPlumb.heightToUse/2;n.sizeElement(this.canvas,o,s,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse)}},this.paint=function(e,n){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(e,n):t.setTimeout(function(){this.paint(e,n)}.bind(this),200))}},n.extend(e.Endpoints.Image,[s,e.Endpoints.AbstractEndpoint],{cleanup:function(t){t&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),e.Endpoints.Blank=function(t){e.Endpoints.AbstractEndpoint.apply(this,arguments);this.type="Blank",s.apply(this,arguments),this._compute=function(t,e,n,i){return[t[0],t[1],10,0]};var i=t.cssClass?" "+t.cssClass:"";this.canvas=e.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+i),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(t,e){n.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},n.extend(e.Endpoints.Blank,[e.Endpoints.AbstractEndpoint,s],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),e.Endpoints.Triangle=function(t){this.type="Triangle",e.Endpoints.AbstractEndpoint.apply(this,arguments);var n=this;(t=t||{}).width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,e,i,o){var s=i.width||n.width,a=i.height||n.height;return[t[0]-s/2,t[1]-a/2,s,a]}};var a=e.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.visible=!1!==t.visible};a.prototype={cleanup:function(t){t&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(t,e){},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},e.Overlays.Arrow=function(t){this.type="Arrow",a.apply(this,arguments),this.isAppendedAtTopLevel=!1,t=t||{};var o=this;this.length=t.length||20,this.width=t.width||20,this.id=t.id,this.direction=(t.direction||1)<0?-1:1;var s=t.paintStyle||{"stroke-width":1},r=t.foldback||.623;this.computeMaxSize=function(){return 1.5*o.width},this.elementCreated=function(n,i){if(this.path=n,t.events)for(var o in t.events)e.on(n,o,t.events[o])},this.draw=function(t,e){var o,a,l,c;if(t.pointAlongPathFrom){if(n.isString(this.loc)||this.loc>1||this.loc<0){var u=parseInt(this.loc,10),d=this.loc<0?1:0;o=t.pointAlongPathFrom(d,u,!1),a=t.pointAlongPathFrom(d,u-this.direction*this.length/2,!1),l=i.pointOnLine(o,a,this.length)}else if(1===this.loc){if(o=t.pointOnPath(this.loc),a=t.pointAlongPathFrom(this.loc,-this.length),l=i.pointOnLine(o,a,this.length),-1===this.direction){var h=l;l=o,o=h}}else if(0===this.loc){if(l=t.pointOnPath(this.loc),a=t.pointAlongPathFrom(this.loc,this.length),o=i.pointOnLine(l,a,this.length),-1===this.direction){var p=l;l=o,o=p}}else o=t.pointAlongPathFrom(this.loc,this.direction*this.length/2),a=t.pointOnPath(this.loc),l=i.pointOnLine(o,a,this.length);var f={hxy:o,tail:c=i.perpendicularLineTo(o,l,this.width),cxy:i.pointOnLine(o,l,r*this.length)},m=s.stroke||e.stroke,v=s.fill||e.stroke;return{component:t,d:f,"stroke-width":s.strokeWidth||e.strokeWidth,stroke:m,fill:v,minX:Math.min(o.x,c[0].x,c[1].x),maxX:Math.max(o.x,c[0].x,c[1].x),minY:Math.min(o.y,c[0].y,c[1].y),maxY:Math.max(o.y,c[0].y,c[1].y)}}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},n.extend(e.Overlays.Arrow,a,{updateFrom:function(t){this.length=t.length||this.length,this.width=t.width||this.width,this.direction=null!=t.direction?t.direction:this.direction,this.foldback=t.foldback||this.foldback},cleanup:function(){this.path&&this.path.parentNode&&this.path.parentNode.removeChild(this.path)}}),e.Overlays.PlainArrow=function(t){t=t||{};var n=e.extend(t,{foldback:1});e.Overlays.Arrow.call(this,n),this.type="PlainArrow"},n.extend(e.Overlays.PlainArrow,e.Overlays.Arrow),e.Overlays.Diamond=function(t){var n=(t=t||{}).length||40,i=e.extend(t,{length:n/2,foldback:2});e.Overlays.Arrow.call(this,i),this.type="Diamond"},n.extend(e.Overlays.Diamond,e.Overlays.Arrow);var r=function(t,e){return(null==t._jsPlumb.cachedDimensions||e)&&(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions},l=function(t){e.jsPlumbUIComponent.apply(this,arguments),a.apply(this,arguments);var i=this.fire;this.fire=function(){i.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=t.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=t.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=t.create,this._jsPlumb.initiallyInvisible=!1===t.visible,this.getElement=function(){if(null==this._jsPlumb.div){var n=this._jsPlumb.div=e.getElement(this._jsPlumb.create(this._jsPlumb.component));n.style.position="absolute",jsPlumb.addClass(n,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:"")),this._jsPlumb.instance.appendElement(n),this._jsPlumb.instance.getId(n),this.canvas=n;var i="translate(-50%, -50%)";n.style.webkitTransform=i,n.style.mozTransform=i,n.style.msTransform=i,n.style.oTransform=i,n.style.transform=i,n._jsPlumb=this,!1===t.visible&&(n.style.display="none")}return this._jsPlumb.div},this.draw=function(t,e,i){var o=r(this);if(null!=o&&2===o.length){var s={x:0,y:0};if(i)s={x:i[0],y:i[1]};else if(t.pointOnPath){var a=this.loc,l=!1;(n.isString(this.loc)||this.loc<0||this.loc>1)&&(a=parseInt(this.loc,10),l=!0),s=t.pointOnPath(a,l)}else{var c=this.loc.constructor===Array?this.loc:this.endpointLoc;s={x:c[0]*t.w,y:c[1]*t.h}}var u=s.x-o[0]/2,d=s.y-o[1]/2;return{component:t,d:{minx:u,miny:d,td:o,cxy:s},minX:u,maxX:u+o[0],minY:d,maxY:d+o[1]}}return{minX:0,maxX:0,minY:0,maxY:0}}};n.extend(l,[e.jsPlumbUIComponent,a],{getDimensions:function(){return[1,1]},setVisible:function(t){this._jsPlumb.div&&(this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(r(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){t?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(t,e){null!=this._jsPlumb.div&&t.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var t=r(this);return Math.max(t[0],t[1])},paint:function(t,e){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),e.Overlays.Custom=function(t){this.type="Custom",l.apply(this,arguments)},n.extend(e.Overlays.Custom,l),e.Overlays.GuideLines=function(){var t=this;t.length=50,t.strokeWidth=5,this.type="GuideLines",a.apply(this,arguments),e.jsPlumbUIComponent.apply(this,arguments),this.draw=function(e,n){var o=e.pointAlongPathFrom(t.loc,t.length/2),s=e.pointOnPath(t.loc),a=i.pointOnLine(o,s,t.length),r=i.perpendicularLineTo(o,a,40),l=i.perpendicularLineTo(a,o,20);return{connector:e,head:o,tail:a,headLine:l,tailLine:r,minX:Math.min(o.x,a.x,l[0].x,l[1].x),minY:Math.min(o.y,a.y,l[0].y,l[1].y),maxX:Math.max(o.x,a.x,l[0].x,l[1].x),maxY:Math.max(o.y,a.y,l[0].y,l[1].y)}}},e.Overlays.Label=function(t){this.labelStyle=t.labelStyle;this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var n=e.extend({create:function(){return e.createElement("div")}},t);if(e.Overlays.Custom.call(this,n),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var i=this.getElement();if(this.labelStyle.font=this.labelStyle.font||"12px sans-serif",i.style.font=this.labelStyle.font,i.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(i.style.background=this.labelStyle.fill),this.labelStyle.borderWidth>0){var o=this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black";i.style.border=this.labelStyle.borderWidth+"px solid "+o}this.labelStyle.padding&&(i.style.padding=this.labelStyle.padding)}},n.extend(e.Overlays.Label,e.Overlays.Custom,{cleanup:function(t){t&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),l.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(t){null!=t.label&&this.setLabel(t.label)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this,e=t.jsPlumbUtil,n=t.jsPlumbInstance,i="_jsPlumbGroup",o=function(t){var n={},o={},s={},a=this;function r(e,n){for(var i=t.getContainer();;){if(null==e||e===i)return!1;if(e===n)return!0;e=e.parentNode}}function l(e,n){for(var i=e.getEl().querySelectorAll(".jtk-managed"),o=0;o<i.length;o++)t[n?"show":"hide"](i[o],!0)}t.bind("connection",(function(n){var i=t.getGroupFor(n.source),a=t.getGroupFor(n.target);null!=i&&null!=a&&i===a?(o[n.connection.id]=i,s[n.connection.id]=i):(null!=i&&(e.suggest(i.connections.source,n.connection),o[n.connection.id]=i),null!=a&&(e.suggest(a.connections.target,n.connection),s[n.connection.id]=a))})),t.bind("internal.connectionDetached",(function(t){!function(t){delete t.proxies;var n,i=o[t.id];null!=i&&(n=function(e){return e.id===t.id},e.removeWithFunction(i.connections.source,n),e.removeWithFunction(i.connections.target,n),delete o[t.id]),null!=(i=s[t.id])&&(n=function(e){return e.id===t.id},e.removeWithFunction(i.connections.source,n),e.removeWithFunction(i.connections.target,n),delete s[t.id])}(t.connection)})),t.bind("connectionMoved",(function(t){var e=(0===t.index?o:s)[t.connection.id];if(e){var n=e.connections[0===t.index?"source":"target"],i=n.indexOf(t.connection);-1!==i&&n.splice(i,1)}})),this.addGroup=function(e){t.addClass(e.getEl(),"jtk-group-expanded"),n[e.id]=e,e.manager=this,d(e),t.fire("group:add",{group:e})},this.addToGroup=function(e,n,i){if(e=this.getGroup(e)){var o=e.getEl();if(n._isJsPlumbGroup)return;var s=n._jsPlumbGroup;if(s!==e){t.removeFromDragSelection(n);var r=t.getOffset(n,!0),l=e.collapsed?t.getOffset(o,!0):t.getOffset(e.getDragArea(),!0);null!=s&&(s.remove(n,!1,i,!1,e),a.updateConnectionsForGroup(s)),e.add(n,i);var d=function(t,n){var i=0===n?1:0;t.each((function(t){t.setVisible(!1),t.endpoints[i].element._jsPlumbGroup===e?(t.endpoints[i].setVisible(!1),u(t,i,e)):(t.endpoints[n].setVisible(!1),c(t,n,e))}))};e.collapsed&&(d(t.select({source:n}),0),d(t.select({target:n}),1));var h=t.getId(n);t.dragManager.setParent(n,h,o,t.getId(o),r);var p={left:r.left-l.left,top:r.top-l.top};if(t.setPosition(n,p),t.dragManager.revalidateParent(n,h,r),a.updateConnectionsForGroup(e),t.revalidate(h),!i){var f={group:e,el:n,pos:p};s&&(f.sourceGroup=s),t.fire("group:addMember",f)}}}},this.removeFromGroup=function(t,e,n){if(t=this.getGroup(t)){if(t.collapsed){var i=function(n,i){for(var o=0;o<n.length;o++){var s=n[o];if(s.proxies)for(var a=0;a<s.proxies.length;a++)if(null!=s.proxies[a]){var l=s.proxies[a].originalEp.element;(l===e||r(l,e))&&u(s,i,t)}}};i(t.connections.source.slice(),0),i(t.connections.target.slice(),1)}t.remove(e,null,n)}},this.getGroup=function(t){var i=t;if(e.isString(t)&&null==(i=n[t]))throw new TypeError("No such group ["+t+"]");return i},this.getGroups=function(){var t=[];for(var e in n)t.push(n[e]);return t},this.removeGroup=function(e,i,o,s){e=this.getGroup(e),this.expandGroup(e,!0);var a=e[i?"removeAll":"orphanAll"](o,s);return t.remove(e.getEl()),delete n[e.id],delete t._groups[e.id],t.fire("group:remove",{group:e}),a},this.removeAllGroups=function(t,e,i){for(var o in n)this.removeGroup(n[o],t,e,i)};var c=function(e,n,o){var s=e.endpoints[0===n?1:0].element;if(!s[i]||s[i].shouldProxy()||!s[i].collapsed){var a=o.getEl(),r=t.getId(a);t.proxyConnection(e,n,a,r,(function(t,e){return o.getEndpoint(t,e)}),(function(t,e){return o.getAnchor(t,e)}))}};this.collapseGroup=function(e){if(null!=(e=this.getGroup(e))&&!e.collapsed){var n=e.getEl();if(l(e,!1),e.shouldProxy()){var i=function(t,n){for(var i=0;i<t.length;i++){var o=t[i];c(o,n,e)}};i(e.connections.source,0),i(e.connections.target,1)}e.collapsed=!0,t.removeClass(n,"jtk-group-expanded"),t.addClass(n,"jtk-group-collapsed"),t.revalidate(n),t.fire("group:collapse",{group:e})}};var u=function(e,n,i){t.unproxyConnection(e,n,t.getId(i.getEl()))};function d(e){for(var n=e.getMembers().slice(),i=[],a=0;a<n.length;a++)Array.prototype.push.apply(i,n[a].querySelectorAll(".jtk-managed"));Array.prototype.push.apply(n,i);var r=t.getConnections({source:n,scope:"*"},!0),l=t.getConnections({target:n,scope:"*"},!0),c={};e.connections.source.length=0,e.connections.target.length=0;var u=function(n){for(var i=0;i<n.length;i++)if(!c[n[i].id]){c[n[i].id]=!0;var a=t.getGroupFor(n[i].source),r=t.getGroupFor(n[i].target);a===e?(r!==e&&e.connections.source.push(n[i]),o[n[i].id]=e):r===e&&(e.connections.target.push(n[i]),s[n[i].id]=e)}};u(r),u(l)}this.expandGroup=function(e,n){if(null!=(e=this.getGroup(e))&&e.collapsed){var i=e.getEl();if(l(e,!0),e.shouldProxy()){var o=function(t,n){for(var i=0;i<t.length;i++){var o=t[i];u(o,n,e)}};o(e.connections.source,0),o(e.connections.target,1)}e.collapsed=!1,t.addClass(i,"jtk-group-expanded"),t.removeClass(i,"jtk-group-collapsed"),t.revalidate(i),this.repaintGroup(e),n||t.fire("group:expand",{group:e})}},this.repaintGroup=function(e){for(var n=(e=this.getGroup(e)).getMembers(),i=0;i<n.length;i++)t.revalidate(n[i])},this.updateConnectionsForGroup=d,this.refreshAllGroups=function(){for(var e in n)d(n[e]),t.dragManager.updateOffsets(t.getId(n[e].getEl()))}},s=function(n,o){var s=this,a=o.el;this.getEl=function(){return a},this.id=o.id||e.uuid(),a._isJsPlumbGroup=!0;var r=this.getDragArea=function(){var t=n.getSelector(a,"[jtk-group-content]");return t&&t.length>0?t[0]:a},l=!0===o.ghost,c=l||!0===o.constrain,u=!1!==o.revert,d=!0===o.orphan,h=!0===o.prune,p=!0===o.dropOverride,f=!1!==o.proxied,m=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(t,e){return o.anchor||"Continuous"},this.getEndpoint=function(t,e){return o.endpoint||["Dot",{radius:10}]},this.collapsed=!1,!1!==o.draggable){var v={drag:function(){for(var t=0;t<m.length;t++)n.draw(m[t])},stop:function(t){n.fire("groupDragStop",jsPlumb.extend(t,{group:s}))},scope:"_jsPlumbGroupDrag"};o.dragOptions&&t.jsPlumb.extend(v,o.dragOptions),n.draggable(o.el,v)}!1!==o.droppable&&n.droppable(o.el,{drop:function(t){var e=t.drag.el;if(!e._isJsPlumbGroup){var i=e._jsPlumbGroup;if(i!==s){if(null!=i&&i.overrideDrop(e,s))return;n.getGroupManager().addToGroup(s,e,!1)}}}});var g=function(t,e){for(var n=null==t.nodeType?t:[t],i=0;i<n.length;i++)e(n[i])};function b(t,e){var i=function(t){return t.offsetParent}(t),o=n.getSize(i),s=n.getSize(t),a=e[0],r=a+s[0],l=e[1],c=l+s[1];return r>0&&a<o[0]&&c>0&&l<o[1]}function y(t){var e=n.getId(t),i=n.getOffset(t);return t.parentNode.removeChild(t),n.getContainer().appendChild(t),n.setPosition(t,i),C(t),n.dragManager.clearParent(t,e),[e,i]}function _(t){var e=[];function i(t,e,i){var o=null;if(!b(t,[e,i])){var s=t._jsPlumbGroup;h?n.remove(t):o=y(t),s.remove(t)}return o}for(var o=0;o<t.selection.length;o++)e.push(i(t.selection[o][0],t.selection[o][1].left,t.selection[o][1].top));return 1===e.length?e[0]:e}function w(t){var e=n.getId(t);n.revalidate(t),n.dragManager.revalidateParent(t,e)}function C(t){t._katavorioDrag&&((h||d)&&t._katavorioDrag.off("stop",_),h||d||!u||(t._katavorioDrag.off("revert",w),t._katavorioDrag.setRevert(null)))}function S(t){t._katavorioDrag&&((h||d)&&t._katavorioDrag.on("stop",_),c&&t._katavorioDrag.setConstrain(!0),l&&t._katavorioDrag.setUseGhostProxy(!0),h||d||!u||(t._katavorioDrag.on("revert",w),t._katavorioDrag.setRevert((function(t,e){return!b(t,e)}))))}this.overrideDrop=function(t,e){return p&&(u||h||d)},this.add=function(t,e){var i=r();g(t,(function(t){if(null!=t._jsPlumbGroup){if(t._jsPlumbGroup===s)return;t._jsPlumbGroup.remove(t,!0,e,!1)}t._jsPlumbGroup=s,m.push(t),n.isAlreadyDraggable(t)&&S(t),t.parentNode!==i&&i.appendChild(t)})),n.getGroupManager().updateConnectionsForGroup(s)},this.remove=function(t,i,o,a,r){g(t,(function(t){if(t._jsPlumbGroup===s){if(delete t._jsPlumbGroup,e.removeWithFunction(m,(function(e){return e===t})),i)try{s.getDragArea().removeChild(t)}catch(t){jsPlumbUtil.log("Could not remove element from Group "+t)}if(C(t),!o){var a={group:s,el:t};r&&(a.targetGroup=r),n.fire("group:removeMember",a)}}})),a||n.getGroupManager().updateConnectionsForGroup(s)},this.removeAll=function(t,e){for(var i=0,o=m.length;i<o;i++){var a=m[0];s.remove(a,t,e,!0),n.remove(a,!0)}m.length=0,n.getGroupManager().updateConnectionsForGroup(s)},this.orphanAll=function(){for(var t={},e=0;e<m.length;e++){var n=y(m[e]);t[n[0]]=n[1]}return m.length=0,t},this.getMembers=function(){return m},a[i]=this,n.bind("elementDraggable",function(t){t.el._jsPlumbGroup===this&&S(t.el)}.bind(this)),this.shouldProxy=function(){return f},n.getGroupManager().addGroup(this)};n.prototype.addGroup=function(t){var e=this;if(e._groups=e._groups||{},null!=e._groups[t.id])throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=t.el[i])throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new s(e,t);return e._groups[n.id]=n,t.collapsed&&this.collapseGroup(n),n},n.prototype.addToGroup=function(t,e,n){var i=function(e){var i=this.getId(e);this.manage(i,e),this.getGroupManager().addToGroup(t,e,n)}.bind(this);if(Array.isArray(e))for(var o=0;o<e.length;o++)i(e[o]);else i(e)},n.prototype.removeFromGroup=function(t,e,n){this.getGroupManager().removeFromGroup(t,e,n),this.getContainer().appendChild(e)},n.prototype.removeGroup=function(t,e,n,i){return this.getGroupManager().removeGroup(t,e,n,i)},n.prototype.removeAllGroups=function(t,e,n){this.getGroupManager().removeAllGroups(t,e,n)},n.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)},n.prototype.getGroups=function(){return this.getGroupManager().getGroups()},n.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)},n.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)},n.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)},n.prototype.toggleGroup=function(t){null!=(t=this.getGroupManager().getGroup(t))&&this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)},n.prototype.getGroupManager=function(){var t=this._groupManager;return null==t&&(t=this._groupManager=new o(this)),t},n.prototype.removeGroupManager=function(){delete this._groupManager},n.prototype.getGroupFor=function(t){if(t=this.getElement(t)){for(var e=this.getContainer(),n=!1,o=null;!n;)null==t||t===e?n=!0:t[i]?(o=t[i],t,n=!0):t=t.parentNode;return o}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil;t.Connectors.Flowchart=function(e){this.type="Flowchart",(e=e||{}).stub=null==e.stub?30:e.stub;var n,i=t.Connectors.AbstractConnector.apply(this,arguments),o=null==e.midpoint||isNaN(e.midpoint)?.5:e.midpoint,s=!0===e.alwaysRespectStubs,a=null,r=null,l=null!=e.cornerRadius?e.cornerRadius:0,c=(e.loopbackRadius,function(t){return t<0?-1:0===t?0:1}),u=function(t){return[c(t[2]-t[0]),c(t[3]-t[1])]},d=function(t,e,n,i){if(a!==e||r!==n){var o=null==a?i.sx:a,s=null==r?i.sy:r,l=o===e?"v":"h";a=e,r=n,t.push([o,s,e,n,l])}},h=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},p=function(t){var e=[];return e.push.apply(e,t),e},f=function(t,e,n){for(var o,s,a,r=null,c=0;c<e.length-1;c++){if(r=r||p(e[c]),o=p(e[c+1]),s=u(r),a=u(o),l>0&&r[4]!==o[4]){var d=Math.min(h(r),h(o)),f=Math.min(l,d/2);r[2]-=s[0]*f,r[3]-=s[1]*f,o[0]+=a[0]*f,o[1]+=a[1]*f;var m=s[1]===a[0]&&1===a[0]||s[1]===a[0]&&0===a[0]&&s[0]!==a[1]||s[1]===a[0]&&-1===a[0],v=(o[1]>r[3]?1:-1)===(o[0]>r[2]?1:-1),g=v&&m||!v&&!m?o[0]:r[2],b=v&&m||!v&&!m?r[3]:o[1];i.addSegment(t,"Straight",{x1:r[0],y1:r[1],x2:r[2],y2:r[3]}),i.addSegment(t,"Arc",{r:f,x1:r[2],y1:r[3],x2:o[0],y2:o[1],cx:g,cy:b,ac:m})}else{var y=r[2]===r[0]?0:r[2]>r[0]?n.lw/2:-n.lw/2,_=r[3]===r[1]?0:r[3]>r[1]?n.lw/2:-n.lw/2;i.addSegment(t,"Straight",{x1:r[0]-y,y1:r[1]-_,x2:r[2]+y,y2:r[3]+_})}r=o}null!=o&&i.addSegment(t,"Straight",{x1:o[0],y1:o[1],x2:o[2],y2:o[3]})};this.midpoint=o,this._compute=function(t,e){n=[],a=null,r=null,null;var l=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},c={perpendicular:l,orthogonal:l,opposite:function(e){var n=t,i="x"===e?0:1;return!s&&{x:function(){return 1===n.so[i]&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||-1===n.so[i]&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return 1===n.so[i]&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||-1===n.so[i]&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}}[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}}[t.anchorOrientation](t.sourceAxis),u="x"===t.sourceAxis?0:1,h="x"===t.sourceAxis?1:0,p=c[u],m=c[h],v=c[u+2],g=c[h+2];d(n,c[0],c[1],t);var b=t.startStubX+(t.endStubX-t.startStubX)*o,y=t.startStubY+(t.endStubY-t.startStubY)*o,_={x:[0,1],y:[1,0]},w={perpendicular:function(e){var n=t,i={x:[[n.startStubX,n.endStubX],null,[n.endStubX,n.startStubX]],y:[[n.startStubY,n.endStubY],null,[n.endStubY,n.startStubY]]},o={x:[[b,n.startStubY],[b,n.endStubY]],y:[[n.startStubX,y],[n.endStubX,y]]},s={x:[[n.endStubX,n.startStubY]],y:[[n.startStubX,n.endStubY]]},a={x:[[n.startStubX,n.endStubY],[n.endStubX,n.endStubY]],y:[[n.endStubX,n.startStubY],[n.endStubX,n.endStubY]]},r={x:[[n.startStubX,y],[n.endStubX,y],[n.endStubX,n.endStubY]],y:[[b,n.startStubY],[b,n.endStubY],[n.endStubX,n.endStubY]]},l={x:[n.startStubY,n.endStubY],y:[n.startStubX,n.endStubX]},c=_[e][0],u=_[e][1],d=n.so[c]+1,h=n.to[u]+1,p=-1===n.to[u]&&l[e][1]<l[e][0]||1===n.to[u]&&l[e][1]>l[e][0],f=i[e][d][0],m=i[e][d][1],v={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][d][h];return n.segment===v[3]||n.segment===v[2]&&p?o[e]:n.segment===v[2]&&m<f?s[e]:n.segment===v[2]&&m>=f||n.segment===v[1]&&!p?r[e]:n.segment===v[0]||n.segment===v[1]&&p?a[e]:void 0},orthogonal:function(e,n,i,o,s){var a=t,r={x:-1===a.so[0]?Math.min(n,o):Math.max(n,o),y:-1===a.so[1]?Math.min(n,o):Math.max(n,o)}[e];return{x:[[r,i],[r,s],[o,s]],y:[[i,r],[s,r],[s,o]]}[e]},opposite:function(n,o,s,a){var r=t,l={x:"y",y:"x"}[n],c={x:"height",y:"width"}[n],d=r["is"+n.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var h=s+(1-e.sourceEndpoint.anchor[l])*e.sourceInfo[c]+i.maxStub;return{x:[[o,h],[a,h]],y:[[h,o],[h,a]]}[n]}return!d||1===r.so[u]&&o>a||-1===r.so[u]&&o<a?{x:[[o,y],[a,y]],y:[[b,o],[b,a]]}[n]:1===r.so[u]&&o<a||-1===r.so[u]&&o>a?{x:[[b,r.sy],[b,r.ty]],y:[[r.sx,y],[r.tx,y]]}[n]:void 0}}[t.anchorOrientation](t.sourceAxis,p,m,v,g);if(w)for(var C=0;C<w.length;C++)d(n,w[C][0],w[C][1],t);d(n,c[2],c[3],t),d(n,t.tx,t.ty,t),f(this,n,t)}},e.extend(t.Connectors.Flowchart,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil;t.Connectors.AbstractBezierConnector=function(e){var n,i=!1!==(e=e||{}).showLoopback,o=(e.curviness,e.margin||5),s=(e.proximityLimit,e.orientation&&"clockwise"===e.orientation),a=e.loopbackRadius||25;return this._compute=function(t,e){var r=e.sourcePos,l=e.targetPos,c=Math.abs(r[0]-l[0]),u=Math.abs(r[1]-l[1]);if(i&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){!0;var d=e.sourcePos[0],h=e.sourcePos[1]-o,p=d,f=h-a,m=p-a,v=f-a;c=2*a,u=2*a,t.points[0]=m,t.points[1]=v,t.points[2]=c,t.points[3]=u,n.addSegment(this,"Arc",{loopback:!0,x1:d-m+4,y1:h-v,startAngle:0,endAngle:2*Math.PI,r:a,ac:!s,x2:d-m-4,y2:h-v,cx:p-m,cy:f-v})}else!1,this._computeBezier(t,e,r,l,c,u)},n=t.Connectors.AbstractConnector.apply(this,arguments)},e.extend(t.Connectors.AbstractBezierConnector,t.Connectors.AbstractConnector);var n=function(e){e=e||{},this.type="Bezier";var n=t.Connectors.AbstractBezierConnector.apply(this,arguments),i=e.curviness||150,o=10;this.getCurviness=function(){return i},this._findControlPoint=function(t,e,n,s,a,r,l){var c=[];return r[0]!==l[0]||r[1]===l[1]?(0===l[0]?c.push(n[0]<e[0]?t[0]+o:t[0]-o):c.push(t[0]+i*l[0]),0===l[1]?c.push(n[1]<e[1]?t[1]+o:t[1]-o):c.push(t[1]+i*r[1])):(0===r[0]?c.push(e[0]<n[0]?t[0]+o:t[0]-o):c.push(t[0]-i*r[0]),0===r[1]?c.push(e[1]<n[1]?t[1]+o:t[1]-o):c.push(t[1]+i*l[1])),c},this._computeBezier=function(t,e,i,o,s,a){var r,l,c=i[0]<o[0]?s:0,u=i[1]<o[1]?a:0,d=i[0]<o[0]?0:s,h=i[1]<o[1]?0:a;r=this._findControlPoint([c,u],i,o,e.sourceEndpoint,e.targetEndpoint,t.so,t.to),l=this._findControlPoint([d,h],o,i,e.targetEndpoint,e.sourceEndpoint,t.to,t.so),n.addSegment(this,"Bezier",{x1:c,y1:u,x2:d,y2:h,cp1x:r[0],cp1y:r[1],cp2x:l[0],cp2y:l[1]})}};t.Connectors.Bezier=n,e.extend(n,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n=function(t,e,n,i){return t<=n&&i<=e?1:t<=n&&e<=i?2:n<=t&&i>=e?3:4},i=function(t,e,n,i,o,s,a,r,l){return r<=l?[t,e]:1===n?i[3]<=0&&o[3]>=1?[t+(i[2]<.5?-1*s:s),e]:i[2]>=1&&o[2]<=0?[t,e+(i[3]<.5?-1*a:a)]:[t+-1*s,e+-1*a]:2===n?i[3]>=1&&o[3]<=0?[t+(i[2]<.5?-1*s:s),e]:i[2]>=1&&o[2]<=0?[t,e+(i[3]<.5?-1*a:a)]:[t+s,e+-1*a]:3===n?i[3]>=1&&o[3]<=0?[t+(i[2]<.5?-1*s:s),e]:i[2]<=0&&o[2]>=1?[t,e+(i[3]<.5?-1*a:a)]:[t+-1*s,e+-1*a]:4===n?i[3]<=0&&o[3]>=1?[t+(i[2]<.5?-1*s:s),e]:i[2]<=0&&o[2]>=1?[t,e+(i[3]<.5?-1*a:a)]:[t+s,e+-1*a]:void 0},o=function(e){e=e||{},this.type="StateMachine";var o,s=t.Connectors.AbstractBezierConnector.apply(this,arguments),a=e.curviness||10,r=e.margin||5,l=e.proximityLimit||80;e.orientation&&e.orientation;this._computeBezier=function(t,e,c,u,d,h){var p=e.sourcePos[0]<e.targetPos[0]?0:d,f=e.sourcePos[1]<e.targetPos[1]?0:h,m=e.sourcePos[0]<e.targetPos[0]?d:0,v=e.sourcePos[1]<e.targetPos[1]?h:0;0===e.sourcePos[2]&&(p-=r),1===e.sourcePos[2]&&(p+=r),0===e.sourcePos[3]&&(f-=r),1===e.sourcePos[3]&&(f+=r),0===e.targetPos[2]&&(m-=r),1===e.targetPos[2]&&(m+=r),0===e.targetPos[3]&&(v-=r),1===e.targetPos[3]&&(v+=r);var g,b,y,_,w=(p+m)/2,C=(f+v)/2,S=n(p,f,m,v),k=Math.sqrt(Math.pow(m-p,2)+Math.pow(v-f,2));g=(o=i(w,C,S,e.sourcePos,e.targetPos,a,a,k,l))[0],b=o[0],y=o[1],_=o[1],s.addSegment(this,"Bezier",{x1:m,y1:v,x2:p,y2:f,cp1x:g,cp1y:y,cp2x:b,cp2y:_})}};t.Connectors.StateMachine=o,e.extend(o,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n=function(e){this.type="Straight";var n=t.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t,e){n.addSegment(this,"Straight",{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),n.addSegment(this,"Straight",{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),n.addSegment(this,"Straight",{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}};t.Connectors.Straight=n,e.extend(n,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},i="http://www.w3.org/2000/svg",o=function(t,e){for(var n in e)t.setAttribute(n,""+e[n])},s=function(e,n){return(n=n||{}).version="1.1",n.xmlns=i,t.createElementNS(i,e,null,null,n)},a=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},r=function(t){for(var e=t.querySelectorAll(" defs,linearGradient,radialGradient"),n=0;n<e.length;n++)e[n].parentNode.removeChild(e[n])},l=function(t,e,i,o,a){if(e.setAttribute("fill",i.fill?i.fill:"none"),e.setAttribute("stroke",i.stroke?i.stroke:"none"),i.gradient?function(t,e,n,i,o){var a,l="jsplumb_gradient_"+o._jsPlumb.instance.idstamp();r(t),a=n.gradient.offset?s("radialGradient",{id:l}):s("linearGradient",{id:l,gradientUnits:"userSpaceOnUse"});var c=s("defs");t.appendChild(c),c.appendChild(a);for(var u=0;u<n.gradient.stops.length;u++){var d=1===o.segment||2===o.segment?u:n.gradient.stops.length-1-u,h=n.gradient.stops[d][1],p=s("stop",{offset:Math.floor(100*n.gradient.stops[u][0])+"%","stop-color":h});a.appendChild(p)}var f=n.stroke?"stroke":"fill";e.setAttribute(f,"url(#"+l+")")}(t,e,i,0,a):(r(t),e.setAttribute("style","")),i.strokeWidth&&e.setAttribute("stroke-width",i.strokeWidth),i.dashstyle&&i.strokeWidth&&!i["stroke-dasharray"]){var l=-1===i.dashstyle.indexOf(",")?" ":",",c=i.dashstyle.split(l),u="";c.forEach((function(t){u+=Math.floor(t*i.strokeWidth)+l})),e.setAttribute("stroke-dasharray",u)}else i["stroke-dasharray"]&&e.setAttribute("stroke-dasharray",i["stroke-dasharray"]);for(var d in n)i[d]&&e.setAttribute(n[d],i[d])},c=function(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)};e.svg={node:s,attr:o,pos:a};var u=function(n){var i=n.pointerEventsSpec||"all",r={};t.jsPlumbUIComponent.apply(this,n.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var l=n.cssClass+" "+(n.originalArgs[0].cssClass||""),c={style:"",width:0,height:0,"pointer-events":i,position:"absolute"};this.svg=s("svg",c),n.useDivWrapper?(this.canvas=t.createElement("div",{position:"absolute"}),e.sizeElement(this.canvas,0,0,1,1),this.canvas.className=l):(o(this.svg,{class:l}),this.canvas=this.svg),n._jsPlumb.appendElement(this.canvas,n.originalArgs[0].parent),n.useDivWrapper&&this.canvas.appendChild(this.svg);var u=[this.canvas];return this.getDisplayElements=function(){return u},this.appendDisplayElement=function(t){u.push(t)},this.paint=function(t,i,s){if(null!=t){var l,c=[this.x,this.y],u=[this.w,this.h];null!=s&&(s.xmin<0&&(c[0]+=s.xmin),s.ymin<0&&(c[1]+=s.ymin),u[0]=s.xmax+(s.xmin<0?-s.xmin:0),u[1]=s.ymax+(s.ymin<0?-s.ymin:0)),n.useDivWrapper?(e.sizeElement(this.canvas,c[0],c[1],u[0]>0?u[0]:1,u[1]>0?u[1]:1),c[0]=0,c[1]=0,l=a([0,0])):l=a([c[0],c[1]]),r.paint.apply(this,arguments),o(this.svg,{style:l,width:u[0]||1,height:u[1]||1})}},{renderer:r}};e.extend(u,t.jsPlumbUIComponent,{cleanup:function(t){t||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null,this._jsPlumb=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(t){var e=t.getContainer();this.canvas&&null==this.canvas.parentNode&&e.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&e.appendChild(this.bgCanvas)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none")}}),t.ConnectorRenderers.svg=function(e){var n=this,i=u.apply(this,[{cssClass:e._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:e._jsPlumb}]);i.renderer.paint=function(i,a,r){var u=n.getSegments(),d=[0,0];if(r.xmin<0&&(d[0]=-r.xmin),r.ymin<0&&(d[1]=-r.ymin),u.length>0){var h={d:n.getPathData(),transform:"translate("+d[0]+","+d[1]+")","pointer-events":e["pointer-events"]||"visibleStroke"},p=null;n.x,n.y,n.w,n.h;if(i.outlineStroke){var f=i.outlineWidth||1,m=i.strokeWidth+2*f;delete(p=t.extend({},i)).gradient,p.stroke=i.outlineStroke,p.strokeWidth=m,null==n.bgPath?(n.bgPath=s("path",h),t.addClass(n.bgPath,t.connectorOutlineClass),c(n.svg,n.bgPath,0)):o(n.bgPath,h),l(n.svg,n.bgPath,p,0,n)}null==n.path?(n.path=s("path",h),c(n.svg,n.path,i.outlineStroke?1:0)):o(n.path,h),l(n.svg,n.path,i,0,n)}}},e.extend(t.ConnectorRenderers.svg,u);var d=t.SvgEndpoint=function(e){var n=u.apply(this,[{cssClass:e._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:e._jsPlumb}]);n.renderer.paint=function(e){var n=t.extend({},e);n.outlineStroke&&(n.stroke=n.outlineStroke),null==this.node?(this.node=this.makeNode(n),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),l(this.svg,this.node,n,(this.x,this.y,this.w,this.h),this),a(this.node,(this.x,this.y))}.bind(this)};e.extend(d,u),t.Endpoints.svg.Dot=function(){t.Endpoints.Dot.apply(this,arguments),d.apply(this,arguments),this.makeNode=function(t){return s("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){o(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},e.extend(t.Endpoints.svg.Dot,[t.Endpoints.Dot,d]),t.Endpoints.svg.Rectangle=function(){t.Endpoints.Rectangle.apply(this,arguments),d.apply(this,arguments),this.makeNode=function(t){return s("rect",{width:this.w,height:this.h})},this.updateNode=function(t){o(t,{width:this.w,height:this.h})}},e.extend(t.Endpoints.svg.Rectangle,[t.Endpoints.Rectangle,d]),t.Endpoints.svg.Image=t.Endpoints.Image,t.Endpoints.svg.Blank=t.Endpoints.Blank,t.Overlays.svg.Label=t.Overlays.Label,t.Overlays.svg.Custom=t.Overlays.Custom;var h=function(e,n){e.apply(this,n),t.jsPlumbUIComponent.apply(this,n),this.isAppendedAtTopLevel=!1;this.path=null,this.paint=function(t,e){if(t.component.svg&&e){null==this.path&&(this.path=s("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,t.component),this.canvas=t.component.svg);var a=n&&1===n.length&&n[0].cssClass||"",r=[0,0];e.xmin<0&&(r[0]=-e.xmin),e.ymin<0&&(r[1]=-e.ymin),o(this.path,{d:i(t.d),class:a,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+r[0]+","+r[1]+")"})}};var i=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){t.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),t.canvas.appendChild(this.path))}},p={cleanup:function(t){null!=this.path&&(t?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(t,e){this.path&&e.canvas&&e.canvas.appendChild(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}};e.extend(h,[t.jsPlumbUIComponent,t.Overlays.AbstractOverlay]),t.Overlays.svg.Arrow=function(){h.apply(this,[t.Overlays.Arrow,arguments])},e.extend(t.Overlays.svg.Arrow,[t.Overlays.Arrow,h],p),t.Overlays.svg.PlainArrow=function(){h.apply(this,[t.Overlays.PlainArrow,arguments])},e.extend(t.Overlays.svg.PlainArrow,[t.Overlays.PlainArrow,h],p),t.Overlays.svg.Diamond=function(){h.apply(this,[t.Overlays.Diamond,arguments])},e.extend(t.Overlays.svg.Diamond,[t.Overlays.Diamond,h],p),t.Overlays.svg.GuideLines=function(){var e,n,i=null,a=this;t.Overlays.GuideLines.apply(this,arguments),this.paint=function(t,l){null==i&&(i=s("path"),t.connector.svg.appendChild(i),a.attachListeners(i,t.connector),a.attachListeners(i,a),e=s("path"),t.connector.svg.appendChild(e),a.attachListeners(e,t.connector),a.attachListeners(e,a),n=s("path"),t.connector.svg.appendChild(n),a.attachListeners(n,t.connector),a.attachListeners(n,a));var c=[0,0];l.xmin<0&&(c[0]=-l.xmin),l.ymin<0&&(c[1]=-l.ymin),o(i,{d:r(t.head,t.tail),stroke:"red",fill:null,transform:"translate("+c[0]+","+c[1]+")"}),o(e,{d:r(t.tailLine[0],t.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+c[0]+","+c[1]+")"}),o(n,{d:r(t.headLine[0],t.headLine[1]),stroke:"green",fill:null,transform:"translate("+c[0]+","+c[1]+")"})};var r=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}},e.extend(t.Overlays.svg.GuideLines,t.Overlays.GuideLines)}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,i=t.Katavorio,o=t.Biltong,s=function(t,n){var s="_katavorio_"+(n=n||"main"),a=t[s],r=t.getEventManager();return a||((a=new i({bind:r.on,unbind:r.off,getSize:e.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(e,n){var i=t.getOffset(e,n,e._katavorioDrag?e.offsetParent:null);return[i.left,i.top]},setPosition:function(t,e){t.style.left=e[0]+"px",t.style.top=e[1]+"px"},addClass:e.addClass,removeClass:e.removeClass,intersects:o.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:t.getDefaultScope(),css:{noSelect:t.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(t.getZoom()),t[s]=a,t.bind("zoom",a.setZoom)),a},a=function(t){var e=t.el._jsPlumbDragOptions,n=!0;return e.canDrag&&(n=e.canDrag()),n&&(this.setHoverSuspended(!0),this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.setConnectionBeingDragged(!0)),n},r=function(t){var e=this.getUIPosition(arguments,this.getZoom());if(null!=e){var n=t.el._jsPlumbDragOptions;this.draw(t.el,e,null,!0),n._dragging&&this.addClass(t.el,"jtk-dragged"),n._dragging=!0}},l=function(t){for(var e,n=t.selection,i=function(n){var i;null!=n[1]&&(e=this.getUIPosition([{el:n[2].el,pos:[n[1].left,n[1].top]}]),i=this.draw(n[2].el,e)),null!=n[0]._jsPlumbDragOptions&&delete n[0]._jsPlumbDragOptions._dragging,this.removeClass(n[0],"jtk-dragged"),this.select({source:n[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:n[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),t.e._drawResult=t.e._drawResult||{c:[],e:[],a:[]},Array.prototype.push.apply(t.e._drawResult.c,i.c),Array.prototype.push.apply(t.e._drawResult.e,i.e),Array.prototype.push.apply(t.e._drawResult.a,i.a),this.getDragManager().dragEnded(n[2].el)}.bind(this),o=0;o<n.length;o++)i(n[o]);this.setHoverSuspended(!1),this.setConnectionBeingDragged(!1)},c=function(t,e){if(null==e)return[0,0];var n=f(e),i=p(n,0);return[i[t+"X"],i[t+"Y"]]},u=c.bind(this,"page"),d=c.bind(this,"screen"),h=c.bind(this,"client"),p=function(t,e){return t.item?t.item(e):t[e]},f=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},m=function(t){var e={},n=[],i={},o={},s={};this.register=function(a){var r,l=t.getId(a);e[l]||(e[l]=a,n.push(a),i[l]={});var c=function(e){if(e)for(var n=0;n<e.childNodes.length;n++)if(3!==e.childNodes[n].nodeType&&8!==e.childNodes[n].nodeType){var u=jsPlumb.getElement(e.childNodes[n]),d=t.getId(e.childNodes[n],null,!0);if(d&&o[d]&&o[d]>0){r||(r=t.getOffset(a));var h=t.getOffset(u);i[l][d]={id:d,offset:{left:h.left-r.left,top:h.top-r.top}},s[d]=l}c(e.childNodes[n])}};c(a)},this.updateOffsets=function(e,n){if(null!=e){n=n||{};var o,a=jsPlumb.getElement(e),r=t.getId(a),l=i[r];if(l)for(var c in l)if(l.hasOwnProperty(c)){var u=jsPlumb.getElement(c),d=n[c]||t.getOffset(u);if(null==u.offsetParent&&null!=i[r][c])continue;o||(o=t.getOffset(a)),i[r][c]={id:c,offset:{left:d.left-o.left,top:d.top-o.top}},s[c]=r}}},this.endpointAdded=function(n,a){a=a||t.getId(n);var r=document.body,l=n.parentNode;for(o[a]=o[a]?o[a]+1:1;null!=l&&l!==r;){var c=t.getId(l,null,!0);if(c&&e[c]){var u=t.getOffset(l);if(null==i[c][a]){var d=t.getOffset(n);i[c][a]={id:a,offset:{left:d.left-u.left,top:d.top-u.top}},s[a]=c}break}l=l.parentNode}},this.endpointDeleted=function(t){if(o[t.elementId]&&(o[t.elementId]--,o[t.elementId]<=0))for(var e in i)i.hasOwnProperty(e)&&i[e]&&(delete i[e][t.elementId],delete s[t.elementId])},this.changeId=function(t,e){i[e]=i[t],i[t]={},s[e]=s[t],s[t]=null},this.getElementsForDraggable=function(t){return i[t]},this.elementRemoved=function(t){var e=s[t];e&&(i[e]&&delete i[e][t],delete s[t])},this.reset=function(){e={},n=[],i={},o={}},this.dragEnded=function(e){if(null!=e.offsetParent){var n=t.getId(e),i=s[n];i&&this.updateOffsets(i)}},this.setParent=function(e,n,o,a,r){var l=s[n];i[a]||(i[a]={});var c=t.getOffset(o),u=r||t.getOffset(e);l&&i[l]&&delete i[l][n],i[a][n]={id:n,offset:{left:u.left-c.left,top:u.top-c.top}},s[n]=a},this.clearParent=function(t,e){var n=s[e];n&&(delete i[n][e],delete s[e])},this.revalidateParent=function(e,n,i){var o=s[n];if(o){var a={};a[n]=i,this.updateOffsets(o,a),t.revalidate(o)}},this.getDragAncestor=function(e){var n=jsPlumb.getElement(e),i=t.getId(n),o=s[i];return o?jsPlumb.getElement(o):null}},v=function(t,e,i){e=n.fastTrim(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var o=t.classList;if(null!=o){for(;o.length>0;)o.remove(o.item(0));for(var s=0;s<i.length;s++)i[s]&&o.add(i[s])}}catch(t){n.log("JSPLUMB: cannot set class list",t)}},g=function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal},b=function(t,e,i){e=null==e?[]:n.isArray(e)?e:e.split(/\s+/),i=null==i?[]:n.isArray(i)?i:i.split(/\s+/);var o=g(t).split(/\s+/),s=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===o.indexOf(e[n])&&o.push(e[n]);else{var i=o.indexOf(e[n]);-1!==i&&o.splice(i,1)}};s(!0,e),s(!1,i),v(t,o.join(" "),o)};t.jsPlumb.extend(t.jsPlumbInstance.prototype,{headless:!1,pageLocation:u,screenLocation:d,clientLocation:h,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new m(this)),this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,e,n,i){return this.createElementNS(null,t,e,n,i)},createElementNS:function(t,e,n,i,o){var s,a=null==t?document.createElement(e):document.createElementNS(t,e);for(s in n=n||{})a.style[s]=n[s];for(s in i&&(a.className=i),o=o||{})a.setAttribute(s,""+o[s]);return a},getAttribute:function(t,e){return null!=t.getAttribute?t.getAttribute(e):null},setAttribute:function(t,e,n){null!=t.setAttribute&&t.setAttribute(e,n)},setAttributes:function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:g,addClass:function(t,e){jsPlumb.each(t,(function(t){b(t,e)}))},hasClass:function(t,e){return(t=jsPlumb.getElement(t)).classList?t.classList.contains(e):-1!==g(t).indexOf(e)},removeClass:function(t,e){jsPlumb.each(t,(function(t){b(t,null,e)}))},toggleClass:function(t,e){jsPlumb.hasClass(t,e)?jsPlumb.removeClass(t,e):jsPlumb.addClass(t,e)},updateClasses:function(t,e,n){jsPlumb.each(t,(function(t){b(t,e,n)}))},setClass:function(t,e){null!=e&&jsPlumb.each(t,(function(t){v(t,e,e.split(/\s+/))}))},setPosition:function(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px"},getPosition:function(t){var e=function(e){var n=t.style[e];return n?n.substring(0,n.length-2):0};return{left:e("left"),top:e("top")}},getStyle:function(t,e){return void 0!==window.getComputedStyle?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]},getSelector:function(t,e){return 1===arguments.length?null!=t.nodeType?t:document.querySelectorAll(t):t.querySelectorAll(e)},getOffset:function(t,e,n){t=jsPlumb.getElement(t),n=n||this.getContainer();for(var i={left:t.offsetLeft,top:t.offsetTop},o=e||null!=n&&t!==n&&t.offsetParent!==n?t.offsetParent:null,s=function(t){null!=t&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(i.left-=t.scrollLeft,i.top-=t.scrollTop)}.bind(this);null!=o;)i.left+=o.offsetLeft,i.top+=o.offsetTop,s(o),o=e?o.offsetParent:o.offsetParent===n?null:o.offsetParent;if(null!=n&&!e&&(n.scrollTop>0||n.scrollLeft>0)){var a=null!=t.offsetParent?this.getStyle(t.offsetParent,"position"):"static",r=this.getStyle(t,"position");"absolute"!==r&&"fixed"!==r&&"absolute"!==a&&"fixed"!==a&&(i.left-=n.scrollLeft,i.top-=n.scrollTop)}return i},getPositionOnElement:function(t,e,n){var i=void 0!==e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},o=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||o.scrollTop,r=window.pageXOffset||s.scrollLeft||o.scrollLeft,l=s.clientTop||o.clientTop||0,c=s.clientLeft||o.clientLeft||0,u=i.top+a-l+0*n,d=i.left+r-c+0*n,h=jsPlumb.pageLocation(t),p=i.width||e.offsetWidth*n,f=i.height||e.offsetHeight*n;return[(h[0]-d)/p,(h[1]-u)/f]},getAbsolutePosition:function(t){var e=function(e){var n=t.style[e];if(n)return parseFloat(n.substring(0,n.length-2))};return[e("left"),e("top")]},setAbsolutePosition:function(t,e,n,i){n?this.animate(t,{left:"+="+(e[0]-n[0]),top:"+="+(e[1]-n[1])},i):(t.style.left=e[0]+"px",t.style.top=e[1]+"px")},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,e){var i;return t=n.isArray(t)||null!=t.length&&!n.isString(t)?t:[t],Array.prototype.slice.call(t).forEach(function(t){(i=this.info(t)).el&&this._initDraggableIfNecessary(i.el,!0,e,i.id,!0)}.bind(this)),this},snapToGrid:function(t,e,n){var i=[],o=function(t){var o=this.info(t);if(null!=o.el&&o.el._katavorioDrag){var s=o.el._katavorioDrag.snap(e,n);this.revalidate(o.el),i.push([o.el,s])}}.bind(this);if(1===arguments.length||3===arguments.length)o(t,e,n);else{var s=this.getManagedElements();for(var a in s)o(a,arguments[0],arguments[1])}return i},initDraggable:function(t,e,n){s(this,n).draggable(t,e),t._jsPlumbDragOptions=e},destroyDraggable:function(t,e){s(this,e).destroyDraggable(t),t._jsPlumbDragOptions=null,t._jsPlumbRelatedElement=null},unbindDraggable:function(t,e,n,i){s(this,i).destroyDraggable(t,e,n)},setDraggable:function(t,e){return jsPlumb.each(t,function(t){this.isDragSupported(t)&&(this._draggableStates[this.getAttribute(t,"id")]=e,this.setElementDraggable(t,e))}.bind(this))},_draggableStates:{},toggleDraggable:function(t){var e;return jsPlumb.each(t,function(t){var n=this.getAttribute(t,"id");return e=!(e=null!=this._draggableStates[n]&&this._draggableStates[n]),this._draggableStates[n]=e,this.setDraggable(t,e),e}.bind(this)),e},_initDraggableIfNecessary:function(t,e,i,o,s){if(!jsPlumb.headless&&(null!=e&&e&&jsPlumb.isDragSupported(t,this))){var c=i||this.Defaults.DragOptions;if(c=jsPlumb.extend({},c),jsPlumb.isAlreadyDraggable(t,this))i.force&&this.initDraggable(t,c);else{var u=jsPlumb.dragEvents.drag,d=jsPlumb.dragEvents.stop,h=jsPlumb.dragEvents.start;this.manage(o,t),c[h]=n.wrap(c[h],a.bind(this)),c[u]=n.wrap(c[u],r.bind(this)),c[d]=n.wrap(c[d],l.bind(this));var p=this.getId(t);this._draggableStates[p]=!0;var f=this._draggableStates[p];c.disabled=null!=f&&!f,this.initDraggable(t,c),this.getDragManager().register(t),s&&this.fire("elementDraggable",{el:t,options:c})}}},animationSupported:!0,getElement:function(t){return null==t?null:"string"==typeof(t="string"==typeof t?t:null==t.tagName&&null!=t.length&&null==t.enctype?t[0]:t)?document.getElementById(t):t},removeElement:function(t){s(this).elementRemoved(t),this.getEventManager().remove(t)},doAnimate:function(t,i,o){o=o||{};var s=this.getOffset(t),a=function(t,e){var i=function(i){if(null!=e[i]){if(n.isString(e[i])){var o=e[i].match(/-=/)?-1:1,s=e[i].substring(2);return t[i]+o*s}return e[i]}return t[i]};return[i("left"),i("top")]}(s,i),r=a[0]-s.left,l=a[1]-s.top,c=o.duration||250,u=c/15,d=15/c*r,h=15/c*l,p=0,f=setInterval((function(){e.setPosition(t,{left:s.left+d*(p+1),top:s.top+h*(p+1)}),null!=o.step&&o.step(p,Math.ceil(u)),++p>=u&&(window.clearInterval(f),null!=o.complete&&o.complete())}),15)},destroyDroppable:function(t,e){s(this,e).destroyDroppable(t)},unbindDroppable:function(t,e,n,i){s(this,i).destroyDroppable(t,e,n)},droppable:function(t,e){var i;return t=n.isArray(t)||null!=t.length&&!n.isString(t)?t:[t],(e=e||{}).allowLoopback=!1,Array.prototype.slice.call(t).forEach(function(t){(i=this.info(t)).el&&this.initDroppable(i.el,e)}.bind(this)),this},initDroppable:function(t,e,n){s(this,n).droppable(t,e)},isAlreadyDraggable:function(t){return null!=t._katavorioDrag},isDragSupported:function(t,e){return!0},isDropSupported:function(t,e){return!0},isElementDraggable:function(t){return(t=e.getElement(t))._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t,e){var n=t[0].el;if(null==n.offsetParent)return null;var i=t[0].finalPos||t[0].pos,o={left:i[0],top:i[1]};if(n._katavorioDrag&&n.offsetParent!==this.getContainer()){var s=this.getOffset(n.offsetParent);o.left+=s.left,o.top+=s.top}return o},setDragFilter:function(t,e,n){t._katavorioDrag&&t._katavorioDrag.setFilter(e,n)},setElementDraggable:function(t,n){(t=e.getElement(t))._katavorioDrag&&t._katavorioDrag.setEnabled(n)},setDragScope:function(t,e){t._katavorioDrag&&t._katavorioDrag.k.setDragScope(t,e)},setDropScope:function(t,e){t._katavorioDrop&&t._katavorioDrop.length>0&&t._katavorioDrop[0].k.setDropScope(t,e)},addToPosse:function(t,n){var i=Array.prototype.slice.call(arguments,1),o=s(this);e.each(t,(function(t){(t=[e.getElement(t)]).push.apply(t,i),o.addToPosse.apply(o,t)}))},setPosse:function(t,n){var i=Array.prototype.slice.call(arguments,1),o=s(this);e.each(t,(function(t){(t=[e.getElement(t)]).push.apply(t,i),o.setPosse.apply(o,t)}))},removeFromPosse:function(t,n){var i=Array.prototype.slice.call(arguments,1),o=s(this);e.each(t,(function(t){(t=[e.getElement(t)]).push.apply(t,i),o.removeFromPosse.apply(o,t)}))},removeFromAllPosses:function(t){var n=s(this);e.each(t,(function(t){n.removeFromAllPosses(e.getElement(t))}))},setPosseState:function(t,n,i){var o=s(this);e.each(t,(function(t){o.setPosseState(e.getElement(t),n,i)}))},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){t._katavorioDrag&&t._katavorioDrag.abort()},addToDragSelection:function(t){var e=this.getElement(t);null==e||!e._isJsPlumbGroup&&null!=e._jsPlumbGroup||s(this).select(t)},removeFromDragSelection:function(t){s(this).deselect(t)},getDragSelection:function(){return s(this).getSelection()},clearDragSelection:function(){s(this).deselectAll()},trigger:function(t,e,n,i){this.getEventManager().trigger(t,e,n,i)},doReset:function(){for(var t in this)0===t.indexOf("_katavorio_")&&this[t].reset()},getEventManager:function(){return(n=(e=this)._mottle)||(n=e._mottle=new t.Mottle),n;var e,n},on:function(t,e,n){return this.getEventManager().on.apply(this,arguments),this},off:function(t,e,n){return this.getEventManager().off.apply(this,arguments),this}});var y,_;y=e.init,(_=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?y():setTimeout(_,9)})()}.call("undefined"!=typeof window?window:this)},809:function(t,e,n){"use strict";n(705)},810:function(t,e,n){"use strict";n(706)},811:function(t,e,n){"use strict";n(707)},812:function(t,e,n){"use strict";n(708)},813:function(t,e,n){"use strict";n(709)},814:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgODk1IDg5NSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgODk1IDg5NTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiM2NjY2NjY7fQo8L3N0eWxlPgo8Zz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01NTUuMywzMDUuMjRjLTEzLjY0LTEyLjg5LTMwLjk1LTIxLjYtNTEuOTItMjYuMTVjLTE1LjY3LTMuNTQtNDYuMzctNS4zMS05Mi4wOS01LjMxaC01MC40MXYzNjhoODMuNzYKCQljMzEuMzMsMCw1My45NC0xLjc3LDY3Ljg0LTUuMzFjMTguMTktNC41NSwzMy4yOS0xMi4yNSw0NS4yOS0yMy4xMmMxMi0xMC44NiwyMS43OS0yOC43NCwyOS4zNy01My42MwoJCWM3LjU4LTI0Ljg4LDExLjM3LTU4LjgsMTEuMzctMTAxLjc2YzAtNDIuOTUtMy43OS03NS45Mi0xMS4zNy05OC45MkM1NzkuNTUsMzM2LjA3LDU2OC45NCwzMTguMTIsNTU1LjMsMzA1LjI0eiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTQ0Ny41LDcuOTNDMjA0LjczLDcuOTMsNy45MywyMDQuNzMsNy45Myw0NDcuNXMxOTYuOCw0MzkuNTcsNDM5LjU3LDQzOS41N3M0MzkuNTctMTk2LjgsNDM5LjU3LTQzOS41NwoJCVM2OTAuMjcsNy45Myw0NDcuNSw3LjkzeiBNNjk3LjQyLDU4MS4xNGMtMTMuOSw0MC40My0zMy43Myw3My4xNS01OS41LDk4LjE2Yy0xOS40NiwxOC45NS00NS43MywzMy43My03OC44Myw0NC4zNAoJCWMtMjQuNzYsNy44My01Ny44NiwxMS43NS05OS4zLDExLjc1aC0yMTEuMXYtNTU1LjZoMjA1LjAzYzQ2LjI0LDAsODEuNDgsMy41NCwxMDUuNzQsMTAuNjFjMzIuNTksOS42MSw2MC41MSwyNi42Niw4My43Niw1MS4xNgoJCWMyMy4yNCwyNC41MSw0MC45Myw1NC41Miw1My4wNiw5MC4wMWMxMi4xMywzNS41LDE4LjE5LDc5LjI3LDE4LjE5LDEzMS4zMkM3MTQuNDcsNTA4LjYzLDcwOC43OSw1NDguMDUsNjk3LjQyLDU4MS4xNHoiLz4KPC9nPgo8L3N2Zz4K"},815:function(t,e,n){"use strict";n(710)},816:function(t,e,n){"use strict";n(711)},817:function(t,e,n){t.exports=n.p+"images/left-tasknode-guide.6e0f4019a0.gif"},818:function(t,e,n){t.exports=n.p+"images/left-subflow-guide.35e915237d.gif"},819:function(t,e,n){t.exports=n.p+"images/left-parallelgateway-guide.0e29ea648a.gif"},820:function(t,e,n){t.exports=n.p+"images/left-convergegateway-guide.f6a076bd9e.gif"},821:function(t,e,n){"use strict";n(713)},822:function(t,e,n){"use strict";n(714)},823:function(t,e,n){"use strict";n(715)},824:function(t,e,n){"use strict";n(716)},825:function(t,e,n){var i;"undefined"!=typeof self&&self,i=function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="fb15")}({"01f9":function(t,e,n){"use strict";var i=n("2d00"),o=n("5ca1"),s=n("2aba"),a=n("32e9"),r=n("84f2"),l=n("41a0"),c=n("7f20"),u=n("38fd"),d=n("2b4c")("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,n,f,m,v,g){l(n,e,f);var b,y,_,w=function(t){if(!h&&t in x)return x[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},C=e+" Iterator",S="values"==m,k=!1,x=t.prototype,P=x[d]||x["@@iterator"]||m&&x[m],E=P||w(m),D=m?S?w("entries"):E:void 0,j="Array"==e&&x.entries||P;if(j&&(_=u(j.call(new t)))!==Object.prototype&&_.next&&(c(_,C,!0),i||"function"==typeof _[d]||a(_,d,p)),S&&P&&"values"!==P.name&&(k=!0,E=function(){return P.call(this)}),i&&!g||!h&&!k&&x[d]||a(x,d,E),r[e]=E,r[C]=p,m)if(b={values:S?E:w("values"),keys:v?E:w("keys"),entries:D},g)for(y in b)y in x||s(x,y,b[y]);else o(o.P+o.F*(h||k),e,b);return b}},"02f4":function(t,e,n){var i=n("4588"),o=n("be13");t.exports=function(t){return function(e,n){var s,a,r=String(o(e)),l=i(n),c=r.length;return l<0||l>=c?t?"":void 0:(s=r.charCodeAt(l))<55296||s>56319||l+1===c||(a=r.charCodeAt(l+1))<56320||a>57343?t?r.charAt(l):s:t?r.slice(l,l+2):a-56320+(s-55296<<10)+65536}}},"0390":function(t,e,n){"use strict";var i=n("02f4")(!0);t.exports=function(t,e,n){return e+(n?i(t,e).length:1)}},"0bfb":function(t,e,n){"use strict";var i=n("cb7c");t.exports=function(){var t=i(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},"0d58":function(t,e,n){var i=n("ce10"),o=n("e11e");t.exports=Object.keys||function(t){return i(t,o)}},1495:function(t,e,n){var i=n("86cc"),o=n("cb7c"),s=n("0d58");t.exports=n("9e1e")?Object.defineProperties:function(t,e){o(t);for(var n,a=s(e),r=a.length,l=0;r>l;)i.f(t,n=a[l++],e[n]);return t}},"214f":function(t,e,n){"use strict";n("b0c5");var i=n("2aba"),o=n("32e9"),s=n("79e5"),a=n("be13"),r=n("2b4c"),l=n("520a"),c=r("species"),u=!s((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),d=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();t.exports=function(t,e,n){var h=r(t),p=!s((function(){var e={};return e[h]=function(){return 7},7!=""[t](e)})),f=p?!s((function(){var e=!1,n=/a/;return n.exec=function(){return e=!0,null},"split"===t&&(n.constructor={},n.constructor[c]=function(){return n}),n[h](""),!e})):void 0;if(!p||!f||"replace"===t&&!u||"split"===t&&!d){var m=/./[h],v=n(a,h,""[t],(function(t,e,n,i,o){return e.exec===l?p&&!o?{done:!0,value:m.call(e,n,i)}:{done:!0,value:t.call(n,e,i)}:{done:!1}})),g=v[0],b=v[1];i(String.prototype,t,g),o(RegExp.prototype,h,2==e?function(t,e){return b.call(t,this,e)}:function(t){return b.call(t,this)})}}},"230e":function(t,e,n){var i=n("d3f4"),o=n("7726").document,s=i(o)&&i(o.createElement);t.exports=function(t){return s?o.createElement(t):{}}},"23c6":function(t,e,n){var i=n("2d95"),o=n("2b4c")("toStringTag"),s="Arguments"==i(function(){return arguments}());t.exports=function(t){var e,n,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?n:s?i(e):"Object"==(a=i(e))&&"function"==typeof e.callee?"Arguments":a}},2621:function(t,e){e.f=Object.getOwnPropertySymbols},"2aba":function(t,e,n){var i=n("7726"),o=n("32e9"),s=n("69a8"),a=n("ca5a")("src"),r=n("fa5b"),l=(""+r).split("toString");n("8378").inspectSource=function(t){return r.call(t)},(t.exports=function(t,e,n,r){var c="function"==typeof n;c&&(s(n,"name")||o(n,"name",e)),t[e]!==n&&(c&&(s(n,a)||o(n,a,t[e]?""+t[e]:l.join(String(e)))),t===i?t[e]=n:r?t[e]?t[e]=n:o(t,e,n):(delete t[e],o(t,e,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[a]||r.call(this)}))},"2aeb":function(t,e,n){var i=n("cb7c"),o=n("1495"),s=n("e11e"),a=n("613b")("IE_PROTO"),r=function(){},l=function(){var t,e=n("230e")("iframe"),i=s.length;for(e.style.display="none",n("fab2").appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;i--;)delete l.prototype[s[i]];return l()};t.exports=Object.create||function(t,e){var n;return null!==t?(r.prototype=i(t),n=new r,r.prototype=null,n[a]=t):n=l(),void 0===e?n:o(n,e)}},"2b4c":function(t,e,n){var i=n("5537")("wks"),o=n("ca5a"),s=n("7726").Symbol,a="function"==typeof s;(t.exports=function(t){return i[t]||(i[t]=a&&s[t]||(a?s:o)("Symbol."+t))}).store=i},"2d00":function(t,e){t.exports=!1},"2d95":function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},"2fdb":function(t,e,n){"use strict";var i=n("5ca1"),o=n("d2c8");i(i.P+i.F*n("5147")("includes"),"String",{includes:function(t){return!!~o(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"32e9":function(t,e,n){var i=n("86cc"),o=n("4630");t.exports=n("9e1e")?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},"38fd":function(t,e,n){var i=n("69a8"),o=n("4bf8"),s=n("613b")("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),i(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},"41a0":function(t,e,n){"use strict";var i=n("2aeb"),o=n("4630"),s=n("7f20"),a={};n("32e9")(a,n("2b4c")("iterator"),(function(){return this})),t.exports=function(t,e,n){t.prototype=i(a,{next:o(1,n)}),s(t,e+" Iterator")}},"456d":function(t,e,n){var i=n("4bf8"),o=n("0d58");n("5eda")("keys",(function(){return function(t){return o(i(t))}}))},4588:function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},4630:function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"4bf8":function(t,e,n){var i=n("be13");t.exports=function(t){return Object(i(t))}},5147:function(t,e,n){var i=n("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[i]=!1,!"/./"[t](e)}catch(t){}}return!0}},"520a":function(t,e,n){"use strict";var i,o,s=n("0bfb"),a=RegExp.prototype.exec,r=String.prototype.replace,l=a,c=(i=/a/,o=/b*/g,a.call(i,"a"),a.call(o,"a"),0!==i.lastIndex||0!==o.lastIndex),u=void 0!==/()??/.exec("")[1];(c||u)&&(l=function(t){var e,n,i,o,l=this;return u&&(n=new RegExp("^"+l.source+"$(?!\\s)",s.call(l))),c&&(e=l.lastIndex),i=a.call(l,t),c&&i&&(l.lastIndex=l.global?i.index+i[0].length:e),u&&i&&i.length>1&&r.call(i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i}),t.exports=l},"52a7":function(t,e){e.f={}.propertyIsEnumerable},5537:function(t,e,n){var i=n("8378"),o=n("7726"),s=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:n("2d00")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},"5ca1":function(t,e,n){var i=n("7726"),o=n("8378"),s=n("32e9"),a=n("2aba"),r=n("9b43"),l=function(t,e,n){var c,u,d,h,p=t&l.F,f=t&l.G,m=t&l.S,v=t&l.P,g=t&l.B,b=f?i:m?i[e]||(i[e]={}):(i[e]||{}).prototype,y=f?o:o[e]||(o[e]={}),_=y.prototype||(y.prototype={});for(c in f&&(n=e),n)d=((u=!p&&b&&void 0!==b[c])?b:n)[c],h=g&&u?r(d,i):v&&"function"==typeof d?r(Function.call,d):d,b&&a(b,c,d,t&l.U),y[c]!=d&&s(y,c,h),v&&_[c]!=d&&(_[c]=d)};i.core=o,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},"5eda":function(t,e,n){var i=n("5ca1"),o=n("8378"),s=n("79e5");t.exports=function(t,e){var n=(o.Object||{})[t]||Object[t],a={};a[t]=e(n),i(i.S+i.F*s((function(){n(1)})),"Object",a)}},"5f1b":function(t,e,n){"use strict";var i=n("23c6"),o=RegExp.prototype.exec;t.exports=function(t,e){var n=t.exec;if("function"==typeof n){var s=n.call(t,e);if("object"!=typeof s)throw new TypeError("RegExp exec method returned something other than an Object or null");return s}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,e)}},"613b":function(t,e,n){var i=n("5537")("keys"),o=n("ca5a");t.exports=function(t){return i[t]||(i[t]=o(t))}},"626a":function(t,e,n){var i=n("2d95");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},6762:function(t,e,n){"use strict";var i=n("5ca1"),o=n("c366")(!0);i(i.P,"Array",{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},6821:function(t,e,n){var i=n("626a"),o=n("be13");t.exports=function(t){return i(o(t))}},"69a8":function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},"6a99":function(t,e,n){var i=n("d3f4");t.exports=function(t,e){if(!i(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!i(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},7333:function(t,e,n){"use strict";var i=n("0d58"),o=n("2621"),s=n("52a7"),a=n("4bf8"),r=n("626a"),l=Object.assign;t.exports=!l||n("79e5")((function(){var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach((function(t){e[t]=t})),7!=l({},t)[n]||Object.keys(l({},e)).join("")!=i}))?function(t,e){for(var n=a(t),l=arguments.length,c=1,u=o.f,d=s.f;l>c;)for(var h,p=r(arguments[c++]),f=u?i(p).concat(u(p)):i(p),m=f.length,v=0;m>v;)d.call(p,h=f[v++])&&(n[h]=p[h]);return n}:l},7726:function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},"77f1":function(t,e,n){var i=n("4588"),o=Math.max,s=Math.min;t.exports=function(t,e){return(t=i(t))<0?o(t+e,0):s(t,e)}},"79e5":function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},"7f20":function(t,e,n){var i=n("86cc").f,o=n("69a8"),s=n("2b4c")("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,s)&&i(t,s,{configurable:!0,value:e})}},8378:function(t,e){var n=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},"84f2":function(t,e){t.exports={}},"86cc":function(t,e,n){var i=n("cb7c"),o=n("c69a"),s=n("6a99"),a=Object.defineProperty;e.f=n("9e1e")?Object.defineProperty:function(t,e,n){if(i(t),e=s(e,!0),i(n),o)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},"9b43":function(t,e,n){var i=n("d8e8");t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)}}return function(){return t.apply(e,arguments)}}},"9c6c":function(t,e,n){var i=n("2b4c")("unscopables"),o=Array.prototype;null==o[i]&&n("32e9")(o,i,{}),t.exports=function(t){o[i][t]=!0}},"9def":function(t,e,n){var i=n("4588"),o=Math.min;t.exports=function(t){return t>0?o(i(t),9007199254740991):0}},"9e1e":function(t,e,n){t.exports=!n("79e5")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},a352:function(e,n){e.exports=t},a481:function(t,e,n){"use strict";var i=n("cb7c"),o=n("4bf8"),s=n("9def"),a=n("4588"),r=n("0390"),l=n("5f1b"),c=Math.max,u=Math.min,d=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;n("214f")("replace",2,(function(t,e,n,f){return[function(i,o){var s=t(this),a=null==i?void 0:i[e];return void 0!==a?a.call(i,s,o):n.call(String(s),i,o)},function(t,e){var o=f(n,t,this,e);if(o.done)return o.value;var d=i(t),h=String(this),p="function"==typeof e;p||(e=String(e));var v=d.global;if(v){var g=d.unicode;d.lastIndex=0}for(var b=[];;){var y=l(d,h);if(null===y)break;if(b.push(y),!v)break;""===String(y[0])&&(d.lastIndex=r(h,s(d.lastIndex),g))}for(var _,w="",C=0,S=0;S<b.length;S++){y=b[S];for(var k=String(y[0]),x=c(u(a(y.index),h.length),0),P=[],E=1;E<y.length;E++)P.push(void 0===(_=y[E])?_:String(_));var D=y.groups;if(p){var j=[k].concat(P,x,h);void 0!==D&&j.push(D);var O=String(e.apply(void 0,j))}else O=m(k,h,x,P,D,e);x>=C&&(w+=h.slice(C,x)+O,C=x+k.length)}return w+h.slice(C)}];function m(t,e,i,s,a,r){var l=i+t.length,c=s.length,u=p;return void 0!==a&&(a=o(a),u=h),n.call(r,u,(function(n,o){var r;switch(o.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,i);case"'":return e.slice(l);case"<":r=a[o.slice(1,-1)];break;default:var u=+o;if(0===u)return n;if(u>c){var h=d(u/10);return 0===h?n:h<=c?void 0===s[h-1]?o.charAt(1):s[h-1]+o.charAt(1):n}r=s[u-1]}return void 0===r?"":r}))}}))},aae3:function(t,e,n){var i=n("d3f4"),o=n("2d95"),s=n("2b4c")("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==o(t))}},ac6a:function(t,e,n){for(var i=n("cadf"),o=n("0d58"),s=n("2aba"),a=n("7726"),r=n("32e9"),l=n("84f2"),c=n("2b4c"),u=c("iterator"),d=c("toStringTag"),h=l.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=o(p),m=0;m<f.length;m++){var v,g=f[m],b=p[g],y=a[g],_=y&&y.prototype;if(_&&(_[u]||r(_,u,h),_[d]||r(_,d,g),l[g]=h,b))for(v in i)_[v]||s(_,v,i[v],!0)}},b0c5:function(t,e,n){"use strict";var i=n("520a");n("5ca1")({target:"RegExp",proto:!0,forced:i!==/./.exec},{exec:i})},be13:function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},c366:function(t,e,n){var i=n("6821"),o=n("9def"),s=n("77f1");t.exports=function(t){return function(e,n,a){var r,l=i(e),c=o(l.length),u=s(a,c);if(t&&n!=n){for(;c>u;)if((r=l[u++])!=r)return!0}else for(;c>u;u++)if((t||u in l)&&l[u]===n)return t||u||0;return!t&&-1}}},c649:function(t,e,n){"use strict";(function(t){n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return l})),n("a481");var i,o,s="undefined"!=typeof window?window.console:t.console,a=/-(\w)/g,r=(i=function(t){return t.replace(a,(function(t,e){return e?e.toUpperCase():""}))},o=Object.create(null),function(t){return o[t]||(o[t]=i(t))});function l(t){null!==t.parentElement&&t.parentElement.removeChild(t)}function c(t,e,n){var i=0===n?t.children[0]:t.children[n-1].nextSibling;t.insertBefore(e,i)}}).call(this,n("c8ba"))},c69a:function(t,e,n){t.exports=!n("9e1e")&&!n("79e5")((function(){return 7!=Object.defineProperty(n("230e")("div"),"a",{get:function(){return 7}}).a}))},c8ba:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},ca5a:function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},cadf:function(t,e,n){"use strict";var i=n("9c6c"),o=n("d53b"),s=n("84f2"),a=n("6821");t.exports=n("01f9")(Array,"Array",(function(t,e){this._t=a(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):o(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])}),"values"),s.Arguments=s.Array,i("keys"),i("values"),i("entries")},cb7c:function(t,e,n){var i=n("d3f4");t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},ce10:function(t,e,n){var i=n("69a8"),o=n("6821"),s=n("c366")(!1),a=n("613b")("IE_PROTO");t.exports=function(t,e){var n,r=o(t),l=0,c=[];for(n in r)n!=a&&i(r,n)&&c.push(n);for(;e.length>l;)i(r,n=e[l++])&&(~s(c,n)||c.push(n));return c}},d2c8:function(t,e,n){var i=n("aae3"),o=n("be13");t.exports=function(t,e,n){if(i(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(o(t))}},d3f4:function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},d53b:function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},d8e8:function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},e11e:function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},f559:function(t,e,n){"use strict";var i=n("5ca1"),o=n("9def"),s=n("d2c8"),a="".startsWith;i(i.P+i.F*n("5147")("startsWith"),"String",{startsWith:function(t){var e=s(this,t,"startsWith"),n=o(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return a?a.call(e,i,n):e.slice(n,n+i.length)===i}})},f6fd:function(t,e){!function(t){var e=t.getElementsByTagName("script");"currentScript"in t||Object.defineProperty(t,"currentScript",{get:function(){try{throw new Error}catch(i){var t,n=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(i.stack)||[!1])[1];for(t in e)if(e[t].src==n||"interactive"==e[t].readyState)return e[t];return null}}})}(document)},f751:function(t,e,n){var i=n("5ca1");i(i.S+i.F,"Object",{assign:n("7333")})},fa5b:function(t,e,n){t.exports=n("5537")("native-function-to-string",Function.toString)},fab2:function(t,e,n){var i=n("7726").document;t.exports=i&&i.documentElement},fb15:function(t,e,n){"use strict";var i;function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,s=t}finally{try{i||null==r.return||r.return()}finally{if(o)throw s}}return n}}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.r(e),"undefined"!=typeof window&&(n("f6fd"),(i=window.document.currentScript)&&(i=i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(n.p=i[1])),n("f751"),n("f559"),n("ac6a"),n("cadf"),n("456d"),n("6762"),n("2fdb");var l=n("a352"),c=n.n(l),u=n("c649");function d(t,e){var n=this;this.$nextTick((function(){return n.$emit(t.toLowerCase(),e)}))}function h(t){var e=this;return function(n){null!==e.realList&&e["onDrag"+t](n),d.call(e,t,n)}}function p(t){return["transition-group","TransitionGroup"].includes(t)}function f(t,e,n){return t[n]||(e[n]?e[n]():void 0)}var m=["Start","Add","Remove","Update","End"],v=["Choose","Unchoose","Sort","Filter","Clone"],g=["Move"].concat(m,v).map((function(t){return"on"+t})),b=null,y={name:"draggable",inheritAttrs:!1,props:{options:Object,list:{type:Array,required:!1,default:null},value:{type:Array,required:!1,default:null},noTransitionOnDrag:{type:Boolean,default:!1},clone:{type:Function,default:function(t){return t}},element:{type:String,default:"div"},tag:{type:String,default:null},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},data:function(){return{transitionMode:!1,noneFunctionalComponentMode:!1}},render:function(t){var e=this.$slots.default;this.transitionMode=function(t){if(!t||1!==t.length)return!1;var e=a(t,1)[0].componentOptions;return!!e&&p(e.tag)}(e);var n=function(t,e,n){var i=0,o=0,s=f(e,n,"header");s&&(i=s.length,t=t?[].concat(r(s),r(t)):r(s));var a=f(e,n,"footer");return a&&(o=a.length,t=t?[].concat(r(t),r(a)):r(a)),{children:t,headerOffset:i,footerOffset:o}}(e,this.$slots,this.$scopedSlots),i=n.children,o=n.headerOffset,s=n.footerOffset;this.headerOffset=o,this.footerOffset=s;var l=function(t,e){var n=null,i=function(t,e){n=function(t,e,n){return void 0===n||((t=t||{})[e]=n),t}(n,t,e)};if(i("attrs",Object.keys(t).filter((function(t){return"id"===t||t.startsWith("data-")})).reduce((function(e,n){return e[n]=t[n],e}),{})),!e)return n;var o=e.on,s=e.props,a=e.attrs;return i("on",o),i("props",s),Object.assign(n.attrs,a),n}(this.$attrs,this.componentData);return t(this.getTag(),l,i)},created:function(){null!==this.list&&null!==this.value&&u.b.error("Value and list props are mutually exclusive! Please set one or another."),"div"!==this.element&&u.b.warn("Element props is deprecated please use tag props instead. See https://github.com/SortableJS/Vue.Draggable/blob/master/documentation/migrate.md#element-props"),void 0!==this.options&&u.b.warn("Options props is deprecated, add sortable options directly as vue.draggable item, or use v-bind. See https://github.com/SortableJS/Vue.Draggable/blob/master/documentation/migrate.md#options-props")},mounted:function(){var t=this;if(this.noneFunctionalComponentMode=this.getTag().toLowerCase()!==this.$el.nodeName.toLowerCase()&&!this.getIsFunctional(),this.noneFunctionalComponentMode&&this.transitionMode)throw new Error("Transition-group inside component is not supported. Please alter tag value or remove transition-group. Current tag value: ".concat(this.getTag()));var e={};m.forEach((function(n){e["on"+n]=h.call(t,n)})),v.forEach((function(n){e["on"+n]=d.bind(t,n)}));var n=Object.keys(this.$attrs).reduce((function(e,n){return e[Object(u.a)(n)]=t.$attrs[n],e}),{}),i=Object.assign({},this.options,n,e,{onMove:function(e,n){return t.onDragMove(e,n)}});!("draggable"in i)&&(i.draggable=">*"),this._sortable=new c.a(this.rootContainer,i),this.computeIndexes()},beforeDestroy:function(){void 0!==this._sortable&&this._sortable.destroy()},computed:{rootContainer:function(){return this.transitionMode?this.$el.children[0]:this.$el},realList:function(){return this.list?this.list:this.value}},watch:{options:{handler:function(t){this.updateOptions(t)},deep:!0},$attrs:{handler:function(t){this.updateOptions(t)},deep:!0},realList:function(){this.computeIndexes()}},methods:{getIsFunctional:function(){var t=this._vnode.fnOptions;return t&&t.functional},getTag:function(){return this.tag||this.element},updateOptions:function(t){for(var e in t){var n=Object(u.a)(e);-1===g.indexOf(n)&&this._sortable.option(n,t[e])}},getChildrenNodes:function(){if(this.noneFunctionalComponentMode)return this.$children[0].$slots.default;var t=this.$slots.default;return this.transitionMode?t[0].child.$slots.default:t},computeIndexes:function(){var t=this;this.$nextTick((function(){t.visibleIndexes=function(t,e,n,i){if(!t)return[];var o=t.map((function(t){return t.elm})),s=e.length-i,a=r(e).map((function(t,e){return e>=s?o.length:o.indexOf(t)}));return n?a.filter((function(t){return-1!==t})):a}(t.getChildrenNodes(),t.rootContainer.children,t.transitionMode,t.footerOffset)}))},getUnderlyingVm:function(t){var e=function(t,e){return t.map((function(t){return t.elm})).indexOf(e)}(this.getChildrenNodes()||[],t);return-1===e?null:{index:e,element:this.realList[e]}},getUnderlyingPotencialDraggableComponent:function(t){var e=t.__vue__;return e&&e.$options&&p(e.$options._componentTag)?e.$parent:!("realList"in e)&&1===e.$children.length&&"realList"in e.$children[0]?e.$children[0]:e},emitChanges:function(t){var e=this;this.$nextTick((function(){e.$emit("change",t)}))},alterList:function(t){if(this.list)t(this.list);else{var e=r(this.value);t(e),this.$emit("input",e)}},spliceList:function(){var t=arguments,e=function(e){return e.splice.apply(e,r(t))};this.alterList(e)},updatePosition:function(t,e){var n=function(n){return n.splice(e,0,n.splice(t,1)[0])};this.alterList(n)},getRelatedContextFromMoveEvent:function(t){var e=t.to,n=t.related,i=this.getUnderlyingPotencialDraggableComponent(e);if(!i)return{component:i};var o=i.realList,s={list:o,component:i};if(e!==n&&o&&i.getUnderlyingVm){var a=i.getUnderlyingVm(n);if(a)return Object.assign(a,s)}return s},getVmIndex:function(t){var e=this.visibleIndexes,n=e.length;return t>n-1?n:e[t]},getComponent:function(){return this.$slots.default[0].componentInstance},resetTransitionData:function(t){if(this.noTransitionOnDrag&&this.transitionMode){this.getChildrenNodes()[t].data=null;var e=this.getComponent();e.children=[],e.kept=void 0}},onDragStart:function(t){this.context=this.getUnderlyingVm(t.item),t.item._underlying_vm_=this.clone(this.context.element),b=t.item},onDragAdd:function(t){var e=t.item._underlying_vm_;if(void 0!==e){Object(u.d)(t.item);var n=this.getVmIndex(t.newIndex);this.spliceList(n,0,e),this.computeIndexes();var i={element:e,newIndex:n};this.emitChanges({added:i})}},onDragRemove:function(t){if(Object(u.c)(this.rootContainer,t.item,t.oldIndex),"clone"!==t.pullMode){var e=this.context.index;this.spliceList(e,1);var n={element:this.context.element,oldIndex:e};this.resetTransitionData(e),this.emitChanges({removed:n})}else Object(u.d)(t.clone)},onDragUpdate:function(t){Object(u.d)(t.item),Object(u.c)(t.from,t.item,t.oldIndex);var e=this.context.index,n=this.getVmIndex(t.newIndex);this.updatePosition(e,n);var i={element:this.context.element,oldIndex:e,newIndex:n};this.emitChanges({moved:i})},updateProperty:function(t,e){t.hasOwnProperty(e)&&(t[e]+=this.headerOffset)},computeFutureIndex:function(t,e){if(!t.element)return 0;var n=r(e.to.children).filter((function(t){return"none"!==t.style.display})),i=n.indexOf(e.related),o=t.component.getVmIndex(i);return-1===n.indexOf(b)&&e.willInsertAfter?o+1:o},onDragMove:function(t,e){var n=this.move;if(!n||!this.realList)return!0;var i=this.getRelatedContextFromMoveEvent(t),o=this.context,s=this.computeFutureIndex(i,t);return Object.assign(o,{futureIndex:s}),n(Object.assign({},t,{relatedContext:i,draggedContext:o}),e)},onDragEnd:function(){this.computeIndexes(),b=null}}};"undefined"!=typeof window&&"Vue"in window&&window.Vue.component("draggable",y);var _=y;e.default=_}}).default},t.exports=i(n(912))},842:function(t,e,n){},843:function(t,e,n){},844:function(t,e,n){},845:function(t,e,n){},846:function(t,e,n){"use strict";n(726)},847:function(t,e,n){},859:function(t,e,n){"use strict";var i={name:"NodePreview",components:{TemplateCanvas:n(694).a},props:{canvasData:Object,previewBread:Array,previewDataLoading:Boolean,isAllSelected:Boolean,isSelectAllToolDisabled:Boolean,isShowSelectAllTool:Boolean},data:function(){return{ellipsis:"...",showBreakList:[0,1,2],isOmit:!0}},watch:{previewBread:function(t){t.length>3?this.showBreakList=[0,t.length-1,t.length-2]:this.showBreakList=[0,1,2]}},methods:{onNodeClick:function(t){this.previewDataLoading||this.$emit("onNodeClick",t)},onSelectSubflow:function(t,e,n){this.previewDataLoading||this.previewBread.length-1!==n&&this.$emit("onSelectSubflow",t,e,n)}}},o=(n(846),n(9)),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"node-preview-wrapper"},[n("div",{staticClass:"operation-header clearfix"},[n("div",{staticClass:"bread-crumbs-wrapper"},t._l(t.previewBread,(function(e,i){return n("div",{key:i,class:["path-item",{"name-ellipsis":t.previewBread.length>1}],attrs:{title:t.showBreakList.includes(i)?e.name:""}},[i&&t.showBreakList.includes(i)||1===i?n("span",[t._v("\n                    >\n                ")]):t._e(),t._v(" "),t.showBreakList.includes(i)?n("span",{staticClass:"node-name",attrs:{title:e.name},on:{click:function(n){return t.onSelectSubflow(e.id,e.version,i)}}},[t._v("\n                    "+t._s(e.name)+"\n                ")]):1===i?n("span",{staticClass:"node-ellipsis"},[t._v("\n                    "+t._s(t.ellipsis)+"\n                ")]):t._e()])})),0)]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.previewDataLoading,opacity:1,zIndex:100},expression:"{ isLoading: previewDataLoading, opacity: 1, zIndex: 100 }"}],staticClass:"preview-canvas-wrapper"},[t.previewDataLoading?t._e():n("TemplateCanvas",{ref:"TemplateCanvas",attrs:{"show-palette":!1,editable:!1,"is-all-selected":t.isAllSelected,"is-show-select-all-tool":t.isShowSelectAllTool,"is-select-all-tool-disabled":t.isSelectAllToolDisabled,"canvas-data":t.canvasData},on:{onNodeClick:t.onNodeClick}})],1)])}),[],!1,null,"4dc06bf6",null);e.a=s.exports},910:function(t,e,n){"use strict";n(792)},911:function(t,e,n){"use strict";n(796)},912:function(t,e,n){"use strict";n.r(e),function(t){
/**!
 * Sortable 1.10.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */
function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){o(t,e,n[e])}))}return t}function r(t,e){if(null==t)return{};var n,i,o=function(t,e){if(null==t)return{};var n,i,o={},s=Object.keys(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(e,"MultiDrag",(function(){return ye})),n.d(e,"Sortable",(function(){return Bt})),n.d(e,"Swap",(function(){return le}));function c(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var u=c(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),d=c(/Edge/i),h=c(/firefox/i),p=c(/safari/i)&&!c(/chrome/i)&&!c(/android/i),f=c(/iP(ad|od|hone)/i),m=c(/chrome/i)&&c(/android/i),v={capture:!1,passive:!1};function g(t,e,n){t.addEventListener(e,n,!u&&v)}function b(t,e,n){t.removeEventListener(e,n,!u&&v)}function y(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function _(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function w(t,e,n,i){if(t){n=n||document;do{if(null!=e&&(">"===e[0]?t.parentNode===n&&y(t,e):y(t,e))||i&&t===n)return t;if(t===n)break}while(t=_(t))}return null}var C,S=/\s+/g;function k(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(S," ").replace(" "+e+" "," ");t.className=(i+(n?" "+e:"")).replace(S," ")}}function x(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in i||-1!==e.indexOf("webkit")||(e="-webkit-"+e),i[e]=n+("string"==typeof n?"":"px")}}function P(t,e){var n="";if("string"==typeof t)n=t;else do{var i=x(t,"transform");i&&"none"!==i&&(n=i+" "+n)}while(!e&&(t=t.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(n)}function E(t,e,n){if(t){var i=t.getElementsByTagName(e),o=0,s=i.length;if(n)for(;o<s;o++)n(i[o],o);return i}return[]}function D(){var t=document.scrollingElement;return t||document.documentElement}function j(t,e,n,i,o){if(t.getBoundingClientRect||t===window){var s,a,r,l,c,d,h;if(t!==window&&t!==D()?(a=(s=t.getBoundingClientRect()).top,r=s.left,l=s.bottom,c=s.right,d=s.height,h=s.width):(a=0,r=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,h=window.innerWidth),(e||n)&&t!==window&&(o=o||t.parentNode,!u))do{if(o&&o.getBoundingClientRect&&("none"!==x(o,"transform")||n&&"static"!==x(o,"position"))){var p=o.getBoundingClientRect();a-=p.top+parseInt(x(o,"border-top-width")),r-=p.left+parseInt(x(o,"border-left-width")),l=a+s.height,c=r+s.width;break}}while(o=o.parentNode);if(i&&t!==window){var f=P(o||t),m=f&&f.a,v=f&&f.d;f&&(l=(a/=v)+(d/=v),c=(r/=m)+(h/=m))}return{top:a,left:r,bottom:l,right:c,width:h,height:d}}}function O(t,e,n){for(var i=I(t,!0),o=j(t)[e];i;){var s=j(i)[n];if(!("top"===n||"left"===n?o>=s:o<=s))return i;if(i===D())break;i=I(i,!1)}return!1}function T(t,e,n){for(var i=0,o=0,s=t.children;o<s.length;){if("none"!==s[o].style.display&&s[o]!==Bt.ghost&&s[o]!==Bt.dragged&&w(s[o],n.draggable,t,!1)){if(i===e)return s[o];i++}o++}return null}function L(t,e){for(var n=t.lastElementChild;n&&(n===Bt.ghost||"none"===x(n,"display")||e&&!y(n,e));)n=n.previousElementSibling;return n||null}function N(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Bt.clone||e&&!y(t,e)||n++;return n}function A(t){var e=0,n=0,i=D();if(t)do{var o=P(t),s=o.a,a=o.d;e+=t.scrollLeft*s,n+=t.scrollTop*a}while(t!==i&&(t=t.parentNode));return[e,n]}function I(t,e){if(!t||!t.getBoundingClientRect)return D();var n=t,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var o=x(n);if(n.clientWidth<n.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!n.getBoundingClientRect||n===document.body)return D();if(i||e)return n;i=!0}}}while(n=n.parentNode);return D()}function M(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function $(t,e){return function(){if(!C){var n=arguments,i=this;1===n.length?t.call(i,n[0]):t.apply(i,n),C=setTimeout((function(){C=void 0}),e)}}}function F(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function R(e){var n=window.Polymer,i=t||window.Zepto;return n&&n.dom?n.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}function B(t,e){x(t,"position","absolute"),x(t,"top",e.top),x(t,"left",e.left),x(t,"width",e.width),x(t,"height",e.height)}function V(t){x(t,"position",""),x(t,"top",""),x(t,"left",""),x(t,"width",""),x(t,"height","")}var H="Sortable"+(new Date).getTime();function G(){var t,e=[];return{captureAnimationState:function(){(e=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(t){if("none"!==x(t,"display")&&t!==Bt.ghost){e.push({target:t,rect:j(t)});var n=a({},e[e.length-1].rect);if(t.thisAnimationDuration){var i=P(t,!0);i&&(n.top-=i.f,n.left-=i.e)}t.fromRect=n}}))},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(function(t,e){for(var n in t)if(t.hasOwnProperty(n))for(var i in e)if(e.hasOwnProperty(i)&&e[i]===t[n][i])return Number(n);return-1}(e,{target:t}),1)},animateAll:function(n){var i=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof n&&n());var o=!1,s=0;e.forEach((function(t){var e=0,n=t.target,a=n.fromRect,r=j(n),l=n.prevFromRect,c=n.prevToRect,u=t.rect,d=P(n,!0);d&&(r.top-=d.f,r.left-=d.e),n.toRect=r,n.thisAnimationDuration&&M(l,r)&&!M(a,r)&&(u.top-r.top)/(u.left-r.left)==(a.top-r.top)/(a.left-r.left)&&(e=function(t,e,n,i){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*i.animation}(u,l,c,i.options)),M(r,a)||(n.prevFromRect=a,n.prevToRect=r,e||(e=i.options.animation),i.animate(n,u,r,e)),e&&(o=!0,s=Math.max(s,e),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout((function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null}),e),n.thisAnimationDuration=e)})),clearTimeout(t),o?t=setTimeout((function(){"function"==typeof n&&n()}),s):"function"==typeof n&&n(),e=[]},animate:function(t,e,n,i){if(i){x(t,"transition",""),x(t,"transform","");var o=P(this.el),s=o&&o.a,a=o&&o.d,r=(e.left-n.left)/(s||1),l=(e.top-n.top)/(a||1);t.animatingX=!!r,t.animatingY=!!l,x(t,"transform","translate3d("+r+"px,"+l+"px,0)"),function(t){t.offsetWidth}(t),x(t,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),x(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout((function(){x(t,"transition",""),x(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1}),i)}}}}var U=[],Y={initializeByDefault:!0},z={mount:function(t){for(var e in Y)Y.hasOwnProperty(e)&&!(e in t)&&(t[e]=Y[e]);U.push(t)},pluginEvent:function(t,e,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var o=t+"Global";U.forEach((function(i){e[i.pluginName]&&(e[i.pluginName][o]&&e[i.pluginName][o](a({sortable:e},n)),e.options[i.pluginName]&&e[i.pluginName][t]&&e[i.pluginName][t](a({sortable:e},n)))}))},initializePlugins:function(t,e,n,i){for(var o in U.forEach((function(i){var o=i.pluginName;if(t.options[o]||i.initializeByDefault){var a=new i(t,e,t.options);a.sortable=t,a.options=t.options,t[o]=a,s(n,a.defaults)}})),t.options)if(t.options.hasOwnProperty(o)){var a=this.modifyOption(t,o,t.options[o]);void 0!==a&&(t.options[o]=a)}},getEventProperties:function(t,e){var n={};return U.forEach((function(i){"function"==typeof i.eventProperties&&s(n,i.eventProperties.call(e[i.pluginName],t))})),n},modifyOption:function(t,e,n){var i;return U.forEach((function(o){t[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[e]&&(i=o.optionListeners[e].call(t[o.pluginName],n))})),i}};function W(t){var e=t.sortable,n=t.rootEl,i=t.name,o=t.targetEl,s=t.cloneEl,r=t.toEl,l=t.fromEl,c=t.oldIndex,h=t.newIndex,p=t.oldDraggableIndex,f=t.newDraggableIndex,m=t.originalEvent,v=t.putSortable,g=t.extraEventProperties;if(e=e||n&&n[H]){var b,y=e.options,_="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||u||d?(b=document.createEvent("Event")).initEvent(i,!0,!0):b=new CustomEvent(i,{bubbles:!0,cancelable:!0}),b.to=r||n,b.from=l||n,b.item=o||n,b.clone=s,b.oldIndex=c,b.newIndex=h,b.oldDraggableIndex=p,b.newDraggableIndex=f,b.originalEvent=m,b.pullMode=v?v.lastPutMode:void 0;var w=a({},g,z.getEventProperties(i,e));for(var C in w)b[C]=w[C];n&&n.dispatchEvent(b),y[_]&&y[_].call(e,b)}}var X=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.evt,o=r(n,["evt"]);z.pluginEvent.bind(Bt)(t,e,a({dragEl:K,parentEl:Z,ghostEl:J,rootEl:Q,nextEl:tt,lastDownEl:et,cloneEl:nt,cloneHidden:it,dragStarted:vt,putSortable:ct,activeSortable:Bt.active,originalEvent:i,oldIndex:ot,oldDraggableIndex:at,newIndex:st,newDraggableIndex:rt,hideGhostForTarget:Mt,unhideGhostForTarget:$t,cloneNowHidden:function(){it=!0},cloneNowShown:function(){it=!1},dispatchSortableEvent:function(t){q({sortable:e,name:t,originalEvent:i})}},o))};function q(t){W(a({putSortable:ct,cloneEl:nt,targetEl:K,rootEl:Q,oldIndex:ot,oldDraggableIndex:at,newIndex:st,newDraggableIndex:rt},t))}var K,Z,J,Q,tt,et,nt,it,ot,st,at,rt,lt,ct,ut,dt,ht,pt,ft,mt,vt,gt,bt,yt,_t,wt=!1,Ct=!1,St=[],kt=!1,xt=!1,Pt=[],Et=!1,Dt=[],jt="undefined"!=typeof document,Ot=f,Tt=d||u?"cssFloat":"float",Lt=jt&&!m&&!f&&"draggable"in document.createElement("div"),Nt=function(){if(jt){if(u)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),At=function(t,e){var n=x(t),i=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),o=T(t,0,e),s=T(t,1,e),a=o&&x(o),r=s&&x(s),l=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+j(o).width,c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+j(s).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&"none"!==a.float){var u="left"===a.float?"left":"right";return!s||"both"!==r.clear&&r.clear!==u?"horizontal":"vertical"}return o&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||l>=i&&"none"===n[Tt]||s&&"none"===n[Tt]&&l+c>i)?"vertical":"horizontal"},It=function(t){function e(t,n){return function(i,o,s,a){var r=i.options.group.name&&o.options.group.name&&i.options.group.name===o.options.group.name;if(null==t&&(n||r))return!0;if(null==t||!1===t)return!1;if(n&&"clone"===t)return t;if("function"==typeof t)return e(t(i,o,s,a),n)(i,o,s,a);var l=(n?i:o).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var n={},o=t.group;o&&"object"==i(o)||(o={name:o}),n.name=o.name,n.checkPull=e(o.pull,!0),n.checkPut=e(o.put),n.revertClone=o.revertClone,t.group=n},Mt=function(){!Nt&&J&&x(J,"display","none")},$t=function(){!Nt&&J&&x(J,"display","")};jt&&document.addEventListener("click",(function(t){if(Ct)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Ct=!1,!1}),!0);var Ft=function(t){if(K){t=t.touches?t.touches[0]:t;var e=(o=t.clientX,s=t.clientY,St.some((function(t){if(!L(t)){var e=j(t),n=t[H].options.emptyInsertThreshold,i=o>=e.left-n&&o<=e.right+n,r=s>=e.top-n&&s<=e.bottom+n;return n&&i&&r?a=t:void 0}})),a);if(e){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.target=n.rootEl=e,n.preventDefault=void 0,n.stopPropagation=void 0,e[H]._onDragOver(n)}}var o,s,a},Rt=function(t){K&&K.parentNode[H]._isOutsideThisEl(t.target)};function Bt(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=s({},e),t[H]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return At(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Bt.supportPointer&&"PointerEvent"in window,emptyInsertThreshold:5};for(var i in z.initializePlugins(this,t,n),n)!(i in e)&&(e[i]=n[i]);for(var o in It(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&Lt,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?g(t,"pointerdown",this._onTapStart):(g(t,"mousedown",this._onTapStart),g(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(g(t,"dragover",this),g(t,"dragenter",this)),St.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),s(this,G())}function Vt(t,e,n,i,o,s,a,r){var l,c,h=t[H],p=h.options.onMove;return!window.CustomEvent||u||d?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=n,l.draggedRect=i,l.related=o||e,l.relatedRect=s||j(e),l.willInsertAfter=r,l.originalEvent=a,t.dispatchEvent(l),p&&(c=p.call(h,l,a)),c}function Ht(t){t.draggable=!1}function Gt(){Et=!1}function Ut(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,i=0;n--;)i+=e.charCodeAt(n);return i.toString(36)}function Yt(t){return setTimeout(t,0)}function zt(t){return clearTimeout(t)}Bt.prototype={constructor:Bt,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(gt=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,K):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,n=this.el,i=this.options,o=i.preventOnFilter,s=t.type,a=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,r=(a||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||r,c=i.filter;if(function(t){Dt.length=0;var e=t.getElementsByTagName("input"),n=e.length;for(;n--;){var i=e[n];i.checked&&Dt.push(i)}}(n),!K&&!(/mousedown|pointerdown/.test(s)&&0!==t.button||i.disabled||l.isContentEditable||(r=w(r,i.draggable,n,!1))&&r.animated||et===r)){if(ot=N(r),at=N(r,i.draggable),"function"==typeof c){if(c.call(this,t,r,this))return q({sortable:e,rootEl:l,name:"filter",targetEl:r,toEl:n,fromEl:n}),X("filter",e,{evt:t}),void(o&&t.cancelable&&t.preventDefault())}else if(c&&(c=c.split(",").some((function(i){if(i=w(l,i.trim(),n,!1))return q({sortable:e,rootEl:i,name:"filter",targetEl:r,fromEl:n,toEl:n}),X("filter",e,{evt:t}),!0}))))return void(o&&t.cancelable&&t.preventDefault());i.handle&&!w(l,i.handle,n,!1)||this._prepareDragStart(t,a,r)}}},_prepareDragStart:function(t,e,n){var i,o=this,s=o.el,a=o.options,r=s.ownerDocument;if(n&&!K&&n.parentNode===s){var l=j(n);if(Q=s,Z=(K=n).parentNode,tt=K.nextSibling,et=n,lt=a.group,Bt.dragged=K,ut={target:K,clientX:(e||t).clientX,clientY:(e||t).clientY},ft=ut.clientX-l.left,mt=ut.clientY-l.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,K.style["will-change"]="all",i=function(){X("delayEnded",o,{evt:t}),Bt.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!h&&o.nativeDraggable&&(K.draggable=!0),o._triggerDragStart(t,e),q({sortable:o,name:"choose",originalEvent:t}),k(K,a.chosenClass,!0))},a.ignore.split(",").forEach((function(t){E(K,t.trim(),Ht)})),g(r,"dragover",Ft),g(r,"mousemove",Ft),g(r,"touchmove",Ft),g(r,"mouseup",o._onDrop),g(r,"touchend",o._onDrop),g(r,"touchcancel",o._onDrop),h&&this.nativeDraggable&&(this.options.touchStartThreshold=4,K.draggable=!0),X("delayStart",this,{evt:t}),!a.delay||a.delayOnTouchOnly&&!e||this.nativeDraggable&&(d||u))i();else{if(Bt.eventCanceled)return void this._onDrop();g(r,"mouseup",o._disableDelayedDrag),g(r,"touchend",o._disableDelayedDrag),g(r,"touchcancel",o._disableDelayedDrag),g(r,"mousemove",o._delayedDragTouchMoveHandler),g(r,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&g(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(i,a.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){K&&Ht(K),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;b(t,"mouseup",this._disableDelayedDrag),b(t,"touchend",this._disableDelayedDrag),b(t,"touchcancel",this._disableDelayedDrag),b(t,"mousemove",this._delayedDragTouchMoveHandler),b(t,"touchmove",this._delayedDragTouchMoveHandler),b(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?g(document,"pointermove",this._onTouchMove):g(document,e?"touchmove":"mousemove",this._onTouchMove):(g(K,"dragend",this),g(Q,"dragstart",this._onDragStart));try{document.selection?Yt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(wt=!1,Q&&K){X("dragStarted",this,{evt:e}),this.nativeDraggable&&g(document,"dragover",Rt);var n=this.options;!t&&k(K,n.dragClass,!1),k(K,n.ghostClass,!0),Bt.active=this,t&&this._appendGhost(),q({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(dt){this._lastX=dt.clientX,this._lastY=dt.clientY,Mt();for(var t=document.elementFromPoint(dt.clientX,dt.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(dt.clientX,dt.clientY))!==e;)e=t;if(K.parentNode[H]._isOutsideThisEl(t),e)do{if(e[H]){if(e[H]._onDragOver({clientX:dt.clientX,clientY:dt.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);$t()}},_onTouchMove:function(t){if(ut){var e=this.options,n=e.fallbackTolerance,i=e.fallbackOffset,o=t.touches?t.touches[0]:t,s=J&&P(J,!0),a=J&&s&&s.a,r=J&&s&&s.d,l=Ot&&_t&&A(_t),c=(o.clientX-ut.clientX+i.x)/(a||1)+(l?l[0]-Pt[0]:0)/(a||1),u=(o.clientY-ut.clientY+i.y)/(r||1)+(l?l[1]-Pt[1]:0)/(r||1);if(!Bt.active&&!wt){if(n&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<n)return;this._onDragStart(t,!0)}if(J){s?(s.e+=c-(ht||0),s.f+=u-(pt||0)):s={a:1,b:0,c:0,d:1,e:c,f:u};var d="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");x(J,"webkitTransform",d),x(J,"mozTransform",d),x(J,"msTransform",d),x(J,"transform",d),ht=c,pt=u,dt=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!J){var t=this.options.fallbackOnBody?document.body:Q,e=j(K,!0,Ot,!0,t),n=this.options;if(Ot){for(_t=t;"static"===x(_t,"position")&&"none"===x(_t,"transform")&&_t!==document;)_t=_t.parentNode;_t!==document.body&&_t!==document.documentElement?(_t===document&&(_t=D()),e.top+=_t.scrollTop,e.left+=_t.scrollLeft):_t=D(),Pt=A(_t)}k(J=K.cloneNode(!0),n.ghostClass,!1),k(J,n.fallbackClass,!0),k(J,n.dragClass,!0),x(J,"transition",""),x(J,"transform",""),x(J,"box-sizing","border-box"),x(J,"margin",0),x(J,"top",e.top),x(J,"left",e.left),x(J,"width",e.width),x(J,"height",e.height),x(J,"opacity","0.8"),x(J,"position",Ot?"absolute":"fixed"),x(J,"zIndex","100000"),x(J,"pointerEvents","none"),Bt.ghost=J,t.appendChild(J),x(J,"transform-origin",ft/parseInt(J.style.width)*100+"% "+mt/parseInt(J.style.height)*100+"%")}},_onDragStart:function(t,e){var n=this,i=t.dataTransfer,o=n.options;X("dragStart",this,{evt:t}),Bt.eventCanceled?this._onDrop():(X("setupClone",this),Bt.eventCanceled||((nt=R(K)).draggable=!1,nt.style["will-change"]="",this._hideClone(),k(nt,this.options.chosenClass,!1),Bt.clone=nt),n.cloneId=Yt((function(){X("clone",n),Bt.eventCanceled||(n.options.removeCloneOnHide||Q.insertBefore(nt,K),n._hideClone(),q({sortable:n,name:"clone"}))})),!e&&k(K,o.dragClass,!0),e?(Ct=!0,n._loopId=setInterval(n._emulateDragOver,50)):(b(document,"mouseup",n._onDrop),b(document,"touchend",n._onDrop),b(document,"touchcancel",n._onDrop),i&&(i.effectAllowed="move",o.setData&&o.setData.call(n,i,K)),g(document,"drop",n),x(K,"transform","translateZ(0)")),wt=!0,n._dragStartId=Yt(n._dragStarted.bind(n,e,t)),g(document,"selectstart",n),vt=!0,p&&x(document.body,"user-select","none"))},_onDragOver:function(t){var e,n,i,o,s=this.el,r=t.target,l=this.options,c=l.group,u=Bt.active,d=lt===c,h=l.sort,p=ct||u,f=this,m=!1;if(!Et){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),r=w(r,l.draggable,s,!0),M("dragOver"),Bt.eventCanceled)return m;if(K.contains(t.target)||r.animated&&r.animatingX&&r.animatingY||f._ignoreWhileAnimating===r)return R(!1);if(Ct=!1,u&&!l.disabled&&(d?h||(i=!Q.contains(K)):ct===this||(this.lastPutMode=lt.checkPull(this,u,K,t))&&c.checkPut(this,u,K,t))){if(o="vertical"===this._getDirection(t,r),e=j(K),M("dragOverValid"),Bt.eventCanceled)return m;if(i)return Z=Q,$(),this._hideClone(),M("revert"),Bt.eventCanceled||(tt?Q.insertBefore(K,tt):Q.appendChild(K)),R(!0);var v=L(s,l.draggable);if(!v||function(t,e,n){var i=j(L(n.el,n.options.draggable));return e?t.clientX>i.right+10||t.clientX<=i.right&&t.clientY>i.bottom&&t.clientX>=i.left:t.clientX>i.right&&t.clientY>i.top||t.clientX<=i.right&&t.clientY>i.bottom+10}(t,o,this)&&!v.animated){if(v===K)return R(!1);if(v&&s===t.target&&(r=v),r&&(n=j(r)),!1!==Vt(Q,s,K,e,r,n,t,!!r))return $(),s.appendChild(K),Z=s,B(),R(!0)}else if(r.parentNode===s){n=j(r);var g,b,y,_=K.parentNode!==s,C=!function(t,e,n){var i=n?t.left:t.top,o=n?t.right:t.bottom,s=n?t.width:t.height,a=n?e.left:e.top,r=n?e.right:e.bottom,l=n?e.width:e.height;return i===a||o===r||i+s/2===a+l/2}(K.animated&&K.toRect||e,r.animated&&r.toRect||n,o),S=o?"top":"left",P=O(r,"top","top")||O(K,"top","top"),E=P?P.scrollTop:void 0;if(gt!==r&&(b=n[S],kt=!1,xt=!C&&l.invertSwap||_),0!==(g=function(t,e,n,i,o,s,a,r){var l=i?t.clientY:t.clientX,c=i?n.height:n.width,u=i?n.top:n.left,d=i?n.bottom:n.right,h=!1;if(!a)if(r&&yt<c*o){if(!kt&&(1===bt?l>u+c*s/2:l<d-c*s/2)&&(kt=!0),kt)h=!0;else if(1===bt?l<u+yt:l>d-yt)return-bt}else if(l>u+c*(1-o)/2&&l<d-c*(1-o)/2)return function(t){return N(K)<N(t)?1:-1}(e);if((h=h||a)&&(l<u+c*s/2||l>d-c*s/2))return l>u+c/2?1:-1;return 0}(t,r,n,o,C?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,xt,gt===r))){var D=N(K);do{D-=g,y=Z.children[D]}while(y&&("none"===x(y,"display")||y===J))}if(0===g||y===r)return R(!1);gt=r,bt=g;var T=r.nextElementSibling,A=!1,I=Vt(Q,s,K,e,r,n,t,A=1===g);if(!1!==I)return 1!==I&&-1!==I||(A=1===I),Et=!0,setTimeout(Gt,30),$(),A&&!T?s.appendChild(K):r.parentNode.insertBefore(K,A?T:r),P&&F(P,0,E-P.scrollTop),Z=K.parentNode,void 0===b||xt||(yt=Math.abs(b-j(r)[S])),B(),R(!0)}if(s.contains(K))return R(!1)}return!1}function M(l,c){X(l,f,a({evt:t,isOwner:d,axis:o?"vertical":"horizontal",revert:i,dragRect:e,targetRect:n,canSort:h,fromSortable:p,target:r,completed:R,onMove:function(n,i){return Vt(Q,s,K,e,n,j(n),t,i)},changed:B},c))}function $(){M("dragOverAnimationCapture"),f.captureAnimationState(),f!==p&&p.captureAnimationState()}function R(e){return M("dragOverCompleted",{insertion:e}),e&&(d?u._hideClone():u._showClone(f),f!==p&&(k(K,ct?ct.options.ghostClass:u.options.ghostClass,!1),k(K,l.ghostClass,!0)),ct!==f&&f!==Bt.active?ct=f:f===Bt.active&&ct&&(ct=null),p===f&&(f._ignoreWhileAnimating=r),f.animateAll((function(){M("dragOverAnimationComplete"),f._ignoreWhileAnimating=null})),f!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(r===K&&!K.animated||r===s&&!r.animated)&&(gt=null),l.dragoverBubble||t.rootEl||r===document||(K.parentNode[H]._isOutsideThisEl(t.target),!e&&Ft(t)),!l.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),m=!0}function B(){st=N(K),rt=N(K,l.draggable),q({sortable:f,name:"change",toEl:s,newIndex:st,newDraggableIndex:rt,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){b(document,"mousemove",this._onTouchMove),b(document,"touchmove",this._onTouchMove),b(document,"pointermove",this._onTouchMove),b(document,"dragover",Ft),b(document,"mousemove",Ft),b(document,"touchmove",Ft)},_offUpEvents:function(){var t=this.el.ownerDocument;b(t,"mouseup",this._onDrop),b(t,"touchend",this._onDrop),b(t,"pointerup",this._onDrop),b(t,"touchcancel",this._onDrop),b(document,"selectstart",this)},_onDrop:function(t){var e=this.el,n=this.options;st=N(K),rt=N(K,n.draggable),X("drop",this,{evt:t}),Z=K&&K.parentNode,st=N(K),rt=N(K,n.draggable),Bt.eventCanceled||(wt=!1,xt=!1,kt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),zt(this.cloneId),zt(this._dragStartId),this.nativeDraggable&&(b(document,"drop",this),b(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),p&&x(document.body,"user-select",""),x(K,"transform",""),t&&(vt&&(t.cancelable&&t.preventDefault(),!n.dropBubble&&t.stopPropagation()),J&&J.parentNode&&J.parentNode.removeChild(J),(Q===Z||ct&&"clone"!==ct.lastPutMode)&&nt&&nt.parentNode&&nt.parentNode.removeChild(nt),K&&(this.nativeDraggable&&b(K,"dragend",this),Ht(K),K.style["will-change"]="",vt&&!wt&&k(K,ct?ct.options.ghostClass:this.options.ghostClass,!1),k(K,this.options.chosenClass,!1),q({sortable:this,name:"unchoose",toEl:Z,newIndex:null,newDraggableIndex:null,originalEvent:t}),Q!==Z?(st>=0&&(q({rootEl:Z,name:"add",toEl:Z,fromEl:Q,originalEvent:t}),q({sortable:this,name:"remove",toEl:Z,originalEvent:t}),q({rootEl:Z,name:"sort",toEl:Z,fromEl:Q,originalEvent:t}),q({sortable:this,name:"sort",toEl:Z,originalEvent:t})),ct&&ct.save()):st!==ot&&st>=0&&(q({sortable:this,name:"update",toEl:Z,originalEvent:t}),q({sortable:this,name:"sort",toEl:Z,originalEvent:t})),Bt.active&&(null!=st&&-1!==st||(st=ot,rt=at),q({sortable:this,name:"end",toEl:Z,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){X("nulling",this),Q=K=Z=J=tt=nt=et=it=ut=dt=vt=st=rt=ot=at=gt=bt=ct=lt=Bt.dragged=Bt.ghost=Bt.clone=Bt.active=null,Dt.forEach((function(t){t.checked=!0})),Dt.length=ht=pt=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":K&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],n=this.el.children,i=0,o=n.length,s=this.options;i<o;i++)w(t=n[i],s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Ut(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach((function(t,i){var o=n.children[i];w(o,this.options.draggable,n,!1)&&(e[t]=o)}),this),t.forEach((function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))}))},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return w(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];var i=z.modifyOption(this,t,e);n[t]=void 0!==i?i:e,"group"===t&&It(n)},destroy:function(){X("destroy",this);var t=this.el;t[H]=null,b(t,"mousedown",this._onTapStart),b(t,"touchstart",this._onTapStart),b(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(b(t,"dragover",this),b(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),St.splice(St.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!it){if(X("hideClone",this),Bt.eventCanceled)return;x(nt,"display","none"),this.options.removeCloneOnHide&&nt.parentNode&&nt.parentNode.removeChild(nt),it=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(it){if(X("showClone",this),Bt.eventCanceled)return;Q.contains(K)&&!this.options.group.revertClone?Q.insertBefore(nt,K):tt?Q.insertBefore(nt,tt):Q.appendChild(nt),this.options.group.revertClone&&this.animate(K,nt),x(nt,"display",""),it=!1}}else this._hideClone()}},jt&&g(document,"touchmove",(function(t){(Bt.active||wt)&&t.cancelable&&t.preventDefault()})),Bt.utils={on:g,off:b,css:x,find:E,is:function(t,e){return!!w(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},throttle:$,closest:w,toggleClass:k,clone:R,index:N,nextTick:Yt,cancelNextTick:zt,detectDirection:At,getChild:T},Bt.get=function(t){return t[H]},Bt.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach((function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Bt.utils=a({},Bt.utils,t.utils)),z.mount(t)}))},Bt.create=function(t,e){return new Bt(t,e)},Bt.version="1.10.2";var Wt,Xt,qt,Kt,Zt,Jt,Qt=[],te=!1;function ee(){Qt.forEach((function(t){clearInterval(t.pid)})),Qt=[]}function ne(){clearInterval(Jt)}var ie,oe=$((function(t,e,n,i){if(e.scroll){var o,s=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=e.scrollSensitivity,l=e.scrollSpeed,c=D(),u=!1;Xt!==n&&(Xt=n,ee(),Wt=e.scroll,o=e.scrollFn,!0===Wt&&(Wt=I(n,!0)));var d=0,h=Wt;do{var p=h,f=j(p),m=f.top,v=f.bottom,g=f.left,b=f.right,y=f.width,_=f.height,w=void 0,C=void 0,S=p.scrollWidth,k=p.scrollHeight,P=x(p),E=p.scrollLeft,O=p.scrollTop;p===c?(w=y<S&&("auto"===P.overflowX||"scroll"===P.overflowX||"visible"===P.overflowX),C=_<k&&("auto"===P.overflowY||"scroll"===P.overflowY||"visible"===P.overflowY)):(w=y<S&&("auto"===P.overflowX||"scroll"===P.overflowX),C=_<k&&("auto"===P.overflowY||"scroll"===P.overflowY));var T=w&&(Math.abs(b-s)<=r&&E+y<S)-(Math.abs(g-s)<=r&&!!E),L=C&&(Math.abs(v-a)<=r&&O+_<k)-(Math.abs(m-a)<=r&&!!O);if(!Qt[d])for(var N=0;N<=d;N++)Qt[N]||(Qt[N]={});Qt[d].vx==T&&Qt[d].vy==L&&Qt[d].el===p||(Qt[d].el=p,Qt[d].vx=T,Qt[d].vy=L,clearInterval(Qt[d].pid),0==T&&0==L||(u=!0,Qt[d].pid=setInterval(function(){i&&0===this.layer&&Bt.active._onTouchMove(Zt);var e=Qt[this.layer].vy?Qt[this.layer].vy*l:0,n=Qt[this.layer].vx?Qt[this.layer].vx*l:0;"function"==typeof o&&"continue"!==o.call(Bt.dragged.parentNode[H],n,e,t,Zt,Qt[this.layer].el)||F(Qt[this.layer].el,n,e)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&h!==c&&(h=I(h,!1)));te=u}}),30),se=function(t){var e=t.originalEvent,n=t.putSortable,i=t.dragEl,o=t.activeSortable,s=t.dispatchSortableEvent,a=t.hideGhostForTarget,r=t.unhideGhostForTarget;if(e){var l=n||o;a();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(c.clientX,c.clientY);r(),l&&!l.el.contains(u)&&(s("spill"),this.onSpill({dragEl:i,putSortable:n}))}};function ae(){}function re(){}function le(){function t(){this.defaults={swapClass:"sortable-swap-highlight"}}return t.prototype={dragStart:function(t){var e=t.dragEl;ie=e},dragOverValid:function(t){var e=t.completed,n=t.target,i=t.onMove,o=t.activeSortable,s=t.changed,a=t.cancel;if(o.options.swap){var r=this.sortable.el,l=this.options;if(n&&n!==r){var c=ie;!1!==i(n)?(k(n,l.swapClass,!0),ie=n):ie=null,c&&c!==ie&&k(c,l.swapClass,!1)}s(),e(!0),a()}},drop:function(t){var e=t.activeSortable,n=t.putSortable,i=t.dragEl,o=n||this.sortable,s=this.options;ie&&k(ie,s.swapClass,!1),ie&&(s.swap||n&&n.options.swap)&&i!==ie&&(o.captureAnimationState(),o!==e&&e.captureAnimationState(),function(t,e){var n,i,o=t.parentNode,s=e.parentNode;if(!o||!s||o.isEqualNode(e)||s.isEqualNode(t))return;n=N(t),i=N(e),o.isEqualNode(s)&&n<i&&i++;o.insertBefore(e,o.children[n]),s.insertBefore(t,s.children[i])}(i,ie),o.animateAll(),o!==e&&e.animateAll())},nulling:function(){ie=null}},s(t,{pluginName:"swap",eventProperties:function(){return{swapItem:ie}}})}ae.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,n=t.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var i=T(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(e,i):this.sortable.el.appendChild(e),this.sortable.animateAll(),n&&n.animateAll()},drop:se},s(ae,{pluginName:"revertOnSpill"}),re.prototype={onSpill:function(t){var e=t.dragEl,n=t.putSortable||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:se},s(re,{pluginName:"removeOnSpill"});var ce,ue,de,he,pe,fe=[],me=[],ve=!1,ge=!1,be=!1;function ye(){function t(t){for(var e in this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this));t.options.supportPointer?g(document,"pointerup",this._deselectMultiDrag):(g(document,"mouseup",this._deselectMultiDrag),g(document,"touchend",this._deselectMultiDrag)),g(document,"keydown",this._checkKeyDown),g(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(e,n){var i="";fe.length&&ue===t?fe.forEach((function(t,e){i+=(e?", ":"")+t.textContent})):i=n.textContent,e.setData("Text",i)}}}return t.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(t){var e=t.dragEl;de=e},delayEnded:function(){this.isMultiDrag=~fe.indexOf(de)},setupClone:function(t){var e=t.sortable,n=t.cancel;if(this.isMultiDrag){for(var i=0;i<fe.length;i++)me.push(R(fe[i])),me[i].sortableIndex=fe[i].sortableIndex,me[i].draggable=!1,me[i].style["will-change"]="",k(me[i],this.options.selectedClass,!1),fe[i]===de&&k(me[i],this.options.chosenClass,!1);e._hideClone(),n()}},clone:function(t){var e=t.sortable,n=t.rootEl,i=t.dispatchSortableEvent,o=t.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||fe.length&&ue===e&&(_e(!0,n),i("clone"),o()))},showClone:function(t){var e=t.cloneNowShown,n=t.rootEl,i=t.cancel;this.isMultiDrag&&(_e(!1,n),me.forEach((function(t){x(t,"display","")})),e(),pe=!1,i())},hideClone:function(t){var e=this,n=(t.sortable,t.cloneNowHidden),i=t.cancel;this.isMultiDrag&&(me.forEach((function(t){x(t,"display","none"),e.options.removeCloneOnHide&&t.parentNode&&t.parentNode.removeChild(t)})),n(),pe=!0,i())},dragStartGlobal:function(t){t.sortable;!this.isMultiDrag&&ue&&ue.multiDrag._deselectMultiDrag(),fe.forEach((function(t){t.sortableIndex=N(t)})),fe=fe.sort((function(t,e){return t.sortableIndex-e.sortableIndex})),be=!0},dragStarted:function(t){var e=this,n=t.sortable;if(this.isMultiDrag){if(this.options.sort&&(n.captureAnimationState(),this.options.animation)){fe.forEach((function(t){t!==de&&x(t,"position","absolute")}));var i=j(de,!1,!0,!0);fe.forEach((function(t){t!==de&&B(t,i)})),ge=!0,ve=!0}n.animateAll((function(){ge=!1,ve=!1,e.options.animation&&fe.forEach((function(t){V(t)})),e.options.sort&&we()}))}},dragOver:function(t){var e=t.target,n=t.completed,i=t.cancel;ge&&~fe.indexOf(e)&&(n(!1),i())},revert:function(t){var e=t.fromSortable,n=t.rootEl,i=t.sortable,o=t.dragRect;fe.length>1&&(fe.forEach((function(t){i.addAnimationState({target:t,rect:ge?j(t):o}),V(t),t.fromRect=o,e.removeAnimationState(t)})),ge=!1,function(t,e){fe.forEach((function(n,i){var o=e.children[n.sortableIndex+(t?Number(i):0)];o?e.insertBefore(n,o):e.appendChild(n)}))}(!this.options.removeCloneOnHide,n))},dragOverCompleted:function(t){var e=t.sortable,n=t.isOwner,i=t.insertion,o=t.activeSortable,s=t.parentEl,a=t.putSortable,r=this.options;if(i){if(n&&o._hideClone(),ve=!1,r.animation&&fe.length>1&&(ge||!n&&!o.options.sort&&!a)){var l=j(de,!1,!0,!0);fe.forEach((function(t){t!==de&&(B(t,l),s.appendChild(t))})),ge=!0}if(!n)if(ge||we(),fe.length>1){var c=pe;o._showClone(e),o.options.animation&&!pe&&c&&me.forEach((function(t){o.addAnimationState({target:t,rect:he}),t.fromRect=he,t.thisAnimationDuration=null}))}else o._showClone(e)}},dragOverAnimationCapture:function(t){var e=t.dragRect,n=t.isOwner,i=t.activeSortable;if(fe.forEach((function(t){t.thisAnimationDuration=null})),i.options.animation&&!n&&i.multiDrag.isMultiDrag){he=s({},e);var o=P(de,!0);he.top-=o.f,he.left-=o.e}},dragOverAnimationComplete:function(){ge&&(ge=!1,we())},drop:function(t){var e=t.originalEvent,n=t.rootEl,i=t.parentEl,o=t.sortable,s=t.dispatchSortableEvent,a=t.oldIndex,r=t.putSortable,l=r||this.sortable;if(e){var c=this.options,u=i.children;if(!be)if(c.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),k(de,c.selectedClass,!~fe.indexOf(de)),~fe.indexOf(de))fe.splice(fe.indexOf(de),1),ce=null,W({sortable:o,rootEl:n,name:"deselect",targetEl:de,originalEvt:e});else{if(fe.push(de),W({sortable:o,rootEl:n,name:"select",targetEl:de,originalEvt:e}),e.shiftKey&&ce&&o.el.contains(ce)){var d,h,p=N(ce),f=N(de);if(~p&&~f&&p!==f)for(f>p?(h=p,d=f):(h=f,d=p+1);h<d;h++)~fe.indexOf(u[h])||(k(u[h],c.selectedClass,!0),fe.push(u[h]),W({sortable:o,rootEl:n,name:"select",targetEl:u[h],originalEvt:e}))}else ce=de;ue=l}if(be&&this.isMultiDrag){if((i[H].options.sort||i!==n)&&fe.length>1){var m=j(de),v=N(de,":not(."+this.options.selectedClass+")");if(!ve&&c.animation&&(de.thisAnimationDuration=null),l.captureAnimationState(),!ve&&(c.animation&&(de.fromRect=m,fe.forEach((function(t){if(t.thisAnimationDuration=null,t!==de){var e=ge?j(t):m;t.fromRect=e,l.addAnimationState({target:t,rect:e})}}))),we(),fe.forEach((function(t){u[v]?i.insertBefore(t,u[v]):i.appendChild(t),v++})),a===N(de))){var g=!1;fe.forEach((function(t){t.sortableIndex===N(t)||(g=!0)})),g&&s("update")}fe.forEach((function(t){V(t)})),l.animateAll()}ue=l}(n===i||r&&"clone"!==r.lastPutMode)&&me.forEach((function(t){t.parentNode&&t.parentNode.removeChild(t)}))}},nullingGlobal:function(){this.isMultiDrag=be=!1,me.length=0},destroyGlobal:function(){this._deselectMultiDrag(),b(document,"pointerup",this._deselectMultiDrag),b(document,"mouseup",this._deselectMultiDrag),b(document,"touchend",this._deselectMultiDrag),b(document,"keydown",this._checkKeyDown),b(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(t){if(!(void 0!==be&&be||ue!==this.sortable||t&&w(t.target,this.options.draggable,this.sortable.el,!1)||t&&0!==t.button))for(;fe.length;){var e=fe[0];k(e,this.options.selectedClass,!1),fe.shift(),W({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:e,originalEvt:t})}},_checkKeyDown:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},s(t,{pluginName:"multiDrag",utils:{select:function(t){var e=t.parentNode[H];e&&e.options.multiDrag&&!~fe.indexOf(t)&&(ue&&ue!==e&&(ue.multiDrag._deselectMultiDrag(),ue=e),k(t,e.options.selectedClass,!0),fe.push(t))},deselect:function(t){var e=t.parentNode[H],n=fe.indexOf(t);e&&e.options.multiDrag&&~n&&(k(t,e.options.selectedClass,!1),fe.splice(n,1))}},eventProperties:function(){var t=this,e=[],n=[];return fe.forEach((function(i){var o;e.push({multiDragElement:i,index:i.sortableIndex}),o=ge&&i!==de?-1:ge?N(i,":not(."+t.options.selectedClass+")"):N(i),n.push({multiDragElement:i,index:o})})),{items:l(fe),clones:[].concat(me),oldIndicies:e,newIndicies:n}},optionListeners:{multiDragKey:function(t){return"ctrl"===(t=t.toLowerCase())?t="Control":t.length>1&&(t=t.charAt(0).toUpperCase()+t.substr(1)),t}}})}function _e(t,e){me.forEach((function(n,i){var o=e.children[n.sortableIndex+(t?Number(i):0)];o?e.insertBefore(n,o):e.appendChild(n)}))}function we(){fe.forEach((function(t){t!==de&&t.parentNode&&t.parentNode.removeChild(t)}))}Bt.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?g(document,"dragover",this._handleAutoScroll):this.options.supportPointer?g(document,"pointermove",this._handleFallbackAutoScroll):e.touches?g(document,"touchmove",this._handleFallbackAutoScroll):g(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?b(document,"dragover",this._handleAutoScroll):(b(document,"pointermove",this._handleFallbackAutoScroll),b(document,"touchmove",this._handleFallbackAutoScroll),b(document,"mousemove",this._handleFallbackAutoScroll)),ne(),ee(),clearTimeout(C),C=void 0},nulling:function(){Zt=Xt=Wt=te=Jt=qt=Kt=null,Qt.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var n=this,i=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,s=document.elementFromPoint(i,o);if(Zt=t,e||d||u||p){oe(t,this.options,s,e);var a=I(s,!0);!te||Jt&&i===qt&&o===Kt||(Jt&&ne(),Jt=setInterval((function(){var s=I(document.elementFromPoint(i,o),!0);s!==a&&(a=s,ee()),oe(t,n.options,s,e)}),10),qt=i,Kt=o)}else{if(!this.options.bubbleScroll||I(s,!0)===D())return void ee();oe(t,this.options,I(s,!1),!1)}}},s(t,{pluginName:"scroll",initializeByDefault:!0})}),Bt.mount(re,ae),e.default=Bt}.call(this,n(130))},969:function(t,e,n){"use strict";(function(t){n(38),n(49),n(50);var i=n(16),o=n.n(i),s=n(51),a=n.n(s),r=n(0),l=n.n(r),c=n(5),u=n.n(c),d=n(4),h=n.n(d),p=(n(67),n(127),n(26),n(24),n(80),n(22),n(23),n(68),n(103),n(315),n(37),n(101),n(39),n(104),n(128),n(185),n(27),n(81),n(82),n(43),n(184),n(1)),f=n(7),m=n(655),v=n(28),g=n(1503),b=n(1215),y=n(1221),_=n(1504),w=n(1219),C=n(611),S=n(12);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a={name:"NodeConfig",components:{BasicInfo:g.a,InputParams:b.a,OutputParams:y.a,SelectorPanel:_.a,VariableEdit:w.a,NoData:C.a},props:{project_id:[String,Number],nodeId:String,isShow:Boolean,atomList:Array,subflowList:Array,atomTypeList:Object,templateLabels:Array,common:[String,Number],subflowListLoading:Boolean,backToVariablePanel:Boolean},data:function(){var t=this.$store.state.template.activities[this.nodeId],e=this.getNodeBasic(t);return{updateSubflow:!1,pluginLoading:!1,subflowLoading:!1,constantsLoading:!1,subflowVersionUpdating:!1,isConfirmDialogShow:!1,nodeConfig:t,basicInfo:e,versionList:"ServiceActivity"===t.type?this.getAtomVersions(t.component.code):[],inputs:[],inputsParamValue:{},outputs:[],subflowForms:{},isSelectorPanelShow:"ServiceActivity"===t.type?!e.plugin:!e.tpl,isVariablePanelShow:!1,variableData:{},localConstants:{},isChange:!1}},computed:x(x({},Object(f.e)({activities:function(t){return l()(this,void 0),t.template.activities}.bind(void 0),constants:function(t){return l()(this,void 0),t.template.constants}.bind(void 0),systemConstants:function(t){return l()(this,void 0),t.template.systemConstants}.bind(void 0),locations:function(t){return l()(this,void 0),t.template.location}.bind(void 0),pluginConfigs:function(t){return l()(this,void 0),t.atomForm.config}.bind(void 0),pluginOutput:function(t){return l()(this,void 0),t.atomForm.output}.bind(void 0)})),{},{variableList:function(){var t=this,e=Object.keys(this.systemConstants).map(function(e){return l()(this,t),this.systemConstants[e]}.bind(this)),n=Object.keys(this.localConstants).map(function(e){return l()(this,t),this.localConstants[e]}.bind(this));return[].concat(a()(e),a()(n))},isSubflow:function(){return"ServiceActivity"!==this.nodeConfig.type},atomGroup:function(){var t=this;return this.atomList.find(function(e){return l()(this,t),e.code===this.basicInfo.plugin}.bind(this))},inputLoading:function(){return this.pluginLoading||this.subflowLoading||this.constantsLoading||this.subflowVersionUpdating},outputLoading:function(){return this.pluginLoading||this.subflowLoading},selectorTitle:function(){return this.isSubflow?p.a.t("选择子流程"):p.a.t("选择标准插件")}}),watch:{constants:function(t){this.localConstants=v.a.deepClone(t)},subflowListLoading:function(t){t||(this.basicInfo=this.getNodeBasic(this.nodeConfig))}},created:function(){var t=this;S.a.$on("jobExecuteTaskOutputs",function(e){var n=this;l()(this,t);var i=this.basicInfo,o=i.plugin,s=i.version;if(!this.isSubflow&&"job_execute_task"===o){var r=e.val,c=e.oldVal,u=a()(this.pluginOutput[o][s]);r&&r.length>0&&r.forEach(function(t){l()(this,n),1===t.category&&u.push({name:t.name,key:t.name,version:s})}.bind(this)),c&&c.length>0&&c.forEach(function(t){var e=this;if(l()(this,n),1===t.category){if(r.find(function(n){return l()(this,e),n.id===t.id}.bind(this)))return;Object.keys(this.localConstants).some(function(n){l()(this,e);var i=this.localConstants[n].source_info[this.nodeId];if(i&&i.includes(t.name))return this.deleteVariable(n),!0}.bind(this))}}.bind(this)),this.outputs=u}}.bind(this)),this.localConstants=v.a.deepClone(this.constants)},mounted:function(){this.initData()},methods:x(x(x({},Object(f.b)("atomForm/",["loadAtomConfig","loadSubflowConfig"])),Object(f.d)("template/",["setVariableSourceInfo","setSubprocessUpdated","setActivities","addVariable","setConstants","setOutputs"])),{},{initData:function(){var t=this;return o()(h.a.mark((function e(){var n,i,o,s,a,r,c=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.basicInfo.plugin||t.basicInfo.tpl){e.next=2;break}return e.abrupt("return");case 2:if(t.isSubflow){e.next=10;break}return n={},Object.keys(t.nodeConfig.component.data||{}).forEach(function(e){l()(this,c);var i=v.a.deepClone(t.nodeConfig.component.data[e].value);n[e]=i}.bind(this)),t.inputsParamValue=n,e.next=8,t.getPluginDetail();case 8:e.next=19;break;case 10:return i=t.basicInfo,o=i.tpl,s=i.version,a={},Object.keys(t.nodeConfig.constants).forEach(function(e){l()(this,c);var n=t.nodeConfig.constants[e];"show"===n.show_type&&(a[e]=n)}.bind(this)),e.next=15,t.getSubflowDetail(o,s);case 15:return e.next=17,t.getSubflowInputsConfig();case 17:t.inputs=e.sent,t.inputsParamValue=t.getSubflowInputsValue(a);case 19:(r=t.locations.find(function(e){return l()(this,c),e.id===t.nodeConfig.id}.bind(this)))&&"FAILED"===r.status&&t.validate();case 21:case"end":return e.stop()}}),e,this)})))()},getPluginDetail:function(){var t=this;return o()(h.a.mark((function e(){var n,i,o,s=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.basicInfo,i=n.plugin,o=n.version,t.pluginLoading=!0,e.prev=2,e.next=5,t.getAtomConfig(i,o);case 5:t.inputs=e.sent,t.outputs=t.atomGroup.list.find(function(t){return l()(this,s),t.version===o}.bind(this)).output,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0);case 12:return e.prev=12,t.pluginLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[2,9,12,15]])})))()},getAtomConfig:function(e,n,i,s){var a=this;return o()(h.a.mark((function o(){var r,l,c;return h.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(r=a.common?void 0:a.project_id,!(l=a.pluginConfigs[e])||!l[n]){o.next=4;break}return o.abrupt("return",l[n]);case 4:return o.prev=4,o.next=7,a.loadAtomConfig({atom:e,version:n,classify:i,name:s,project_id:r});case 7:return c=t.atoms[e],o.abrupt("return",c);case 11:o.prev=11,o.t0=o.catch(4),console.log(o.t0);case 14:case"end":return o.stop()}}),o,null,[[4,11]])})))()},getSubflowDetail:function(t,e){var n=this;return o()(h.a.mark((function i(){var o,s,a,r=this;return h.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.subflowLoading=!0,i.prev=1,o={templateId:t,common:n.common},e&&(o.version=e),i.next=6,n.loadSubflowConfig(x({},o));case 6:return s=i.sent,a=s.data,n.subflowForms=a.form,n.updateBasicInfo({version:a.version}),n.outputs=Object.keys(a.outputs).map(function(t){l()(this,r);var e=a.outputs[t];return{name:e.name,key:e.key,version:e.hasOwnProperty("version")?e.version:"legacy"}}.bind(this)),i.abrupt("return",a);case 14:i.prev=14,i.t0=i.catch(1),console.log(i.t0);case 17:return i.prev=17,n.subflowLoading=!1,i.finish(17);case 20:case"end":return i.stop()}}),i,this,[[1,14,17,20]])})))()},getSubflowInputsConfig:function(){var t=this;return o()(h.a.mark((function e(){var n,i,s=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.constantsLoading=!0,n=[],i=Object.keys(t.subflowForms).map(function(e){return l()(this,s),t.subflowForms[e]}.bind(this)).filter(function(t){return l()(this,s),"show"===t.show_type}.bind(this)).sort(function(t,e){return l()(this,s),t.index-e.index}.bind(this)),e.next=5,Promise.all(i.map(function(){var e=o()(h.a.mark((function e(i){var o,s,a,r,l,c,u,d,f;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.key,s=m.a.getVariableArgs(i),a=s.name,r=s.atom,l=s.tagCode,c=s.classify,u=i.version||"legacy",e.next=5,t.getAtomConfig(r,u,c,a);case 5:d=e.sent,f=v.a.deepClone(m.a.formFilter(l,d)),(i.is_meta||f.meta_transform)&&(f=f.meta_transform(i.meta||i),i.meta||(i.meta=v.a.deepClone(i),i.value=f.attrs.value)),f.tag_code=o,f.attrs.name=i.name,["input","textarea"].includes(i.custom_type)&&""!==i.validation&&f.attrs.validation.push({type:"regex",args:i.validation,error_message:p.a.t("默认值不符合正则规则：")+i.validation}),n.push(f);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return t.constantsLoading=!1,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})))()},getNodeBasic:function(t){var e=this;if("ServiceActivity"===t.type){var n=t.component,i=t.name,o=t.stage_name,s=t.labels,a=t.error_ignorable,r=t.can_retry,c=t.retryable,u=t.isSkipped,d=t.skippable,h=t.optional,f=p.a.t("请选择插件"),m="",v="";if(n.code){var g=this.atomList.find(function(t){return l()(this,e),t.code===n.code}.bind(this));f="".concat(g.group_name,"-").concat(g.name),v=n.hasOwnProperty("version")?n.version:"legacy";var b=g.list.find(function(t){return l()(this,e),t.version===v}.bind(this)).desc;if(b&&b.includes("\n"))m=b.split("\n").join("<br>");else m=b}return{plugin:n.code||"",name:f,nodeName:i,stageName:o,nodeLabel:s||[],version:v,desc:m,ignorable:a,skippable:void 0===u?d:u,retryable:void 0===r?c:r,selectable:h}}var y=t.template_id,_=t.name,w=t.stage_name,C=t.labels,S=t.optional,k=p.a.t("请选择子流程");return y&&this.atomTypeList.subflow.some(function(t){if(l()(this,e),t.template_id===Number(y))return k=t.name,!0}.bind(this)),{tpl:y||"",name:k,nodeName:_,stageName:w,nodeLabel:C||[],selectable:S,version:t.hasOwnProperty("version")?t.version:""}},getAtomVersions:function(t){var e=this;return t?this.atomList.find(function(n){return l()(this,e),n.code===t}.bind(this)).list.map(function(t){return l()(this,e),{version:t.version}}.bind(this)).reverse():[]},getSubflowInputsValue:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(t).reduce(function(i,o){l()(this,e);var s=t[o];if("show"===s.show_type){var a=!1,r=n[o],c=this.isInputParamsInConstants(s);r&&!c&&(a=s.custom_type||r.custom_type?s.custom_type===r.custom_type:s.source_tag===r.source_tag);var u=a?this.inputsParamValue[o]:s.value;i[s.key]=v.a.deepClone(u)}return i}.bind(this),{})},isInputParamsInConstants:function(t){var e=this;return Object.keys(this.localConstants).some(function(n){l()(this,e);var i=this.localConstants[n].source_info[this.nodeId];return i&&i.includes(t.tag_code)}.bind(this))},onCopyKey:function(t){this.copyText=t,document.addEventListener("copy",this.copyHandler),document.execCommand("copy"),document.removeEventListener("copy",this.copyHandler),this.copyText=""},copyHandler:function(t){t.preventDefault(),t.clipboardData.setData("text/html",this.copyText),t.clipboardData.setData("text/plain",this.copyText),this.$bkMessage({message:p.a.t("已复制"),theme:"success"})},goBackToConfig:function(){this.isSelectorPanelShow&&(this.basicInfo.plugin||this.basicInfo.tpl)&&(this.isSelectorPanelShow=!1)},onPluginOrTplChange:function(t){this.isSelectorPanelShow=!1,this.clearParamsSourceInfo(),this.isSubflow?this.tplChange(t):this.pluginChange(t)},pluginChange:function(t){var e=this;return o()(h.a.mark((function n(){var i,o,s,a,r,c,u,d,p,f=this;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t.code,o=t.group_name,s=t.name,a=t.list,e.versionList=e.getAtomVersions(i),r=e.atomList.find(function(t){return l()(this,f),t.code===i}.bind(this)),c=r.list.find(function(t){return l()(this,f),t.version===a[a.length-1].version}.bind(this)),(u=c.desc)&&u.includes("\n")&&(d=u.split("\n"),u=d.join("<br>")),p={plugin:i,version:a[a.length-1].version,name:"".concat(o,"-").concat(s),nodeName:s,stageName:"",nodeLabel:[],desc:u,ignorable:!1,skippable:!0,retryable:!0,selectable:!0},e.updateBasicInfo(p),e.inputsParamValue={},n.next=10,e.getPluginDetail();case 10:e.$refs.basicInfo&&e.$refs.basicInfo.validate();case 11:case"end":return n.stop()}}),n,this)})))()},versionChange:function(t){var e=this,n=this.atomList.find(function(t){return l()(this,e),t.code===this.basicInfo.plugin}.bind(this)).list.find(function(n){return l()(this,e),n.version===t}.bind(this)).desc;if(n&&n.includes("\n")){var i=n.split("\n");n=i.join("<br>")}this.updateBasicInfo({version:t,desc:n}),this.clearParamsSourceInfo(),this.inputsParamValue={},this.getPluginDetail()},tplChange:function(t){var e=this;return o()(h.a.mark((function n(){var i,o,s,a;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t.id,o=t.name,s=t.version,a={name:o,version:s,tpl:i,nodeName:o},e.updateBasicInfo(a),n.next=5,e.getSubflowDetail(i,s);case 5:return n.next=7,e.getSubflowInputsConfig();case 7:e.inputs=n.sent,e.inputsParamValue=e.getSubflowInputsValue(e.subflowForms),e.setSubprocessUpdated({subprocess_node_id:e.nodeConfig.id}),e.$refs.basicInfo&&e.$refs.basicInfo.validate();case 11:case"end":return n.stop()}}),n)})))()},updateBasicInfo:function(t){this.basicInfo=Object.assign({},this.basicInfo,t)},updateInputsValue:function(t){this.inputsParamValue=t},updateSubflowVersion:function(){var t=this;return o()(h.a.mark((function e(){var n,i=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.subflowVersionUpdating=!0,n=Object.assign({},t.subflowForms),e.next=4,t.getSubflowDetail(t.basicInfo.tpl);case 4:return t.subflowUpdateParamsChange(),e.next=7,t.getSubflowInputsConfig();case 7:t.inputs=e.sent,t.subflowVersionUpdating=!1,t.$nextTick(function(){l()(this,i),t.inputsParamValue=t.getSubflowInputsValue(t.subflowForms,n),t.updateSubflow=!0}.bind(this));case 10:case"end":return e.stop()}}),e,this)})))()},subflowUpdateParamsChange:function(){var t=this,e=this.nodeConfig.id,n=function(n){var i=this,o=t.localConstants[n],s=o.source_type,a=o.source_info[t.nodeId];a&&("component_inputs"===s&&a.forEach(function(s){l()(this,i);var a=t.subflowForms[s];a&&a.source_tag===o.source_tag||t.setVariableSourceInfo({key:n,id:e,type:"delete",tagCode:s})}.bind(this)),"component_outputs"===s&&a.forEach(function(o){var s=this;l()(this,i),t.outputs.find(function(t){return l()(this,s),t.key===o}.bind(this))||t.setVariableSourceInfo({key:n,id:e,type:"delete",tagCode:o})}.bind(this)))};for(var i in this.localConstants)n(i)},clearParamsSourceInfo:function(){var t=this,e=this.nodeConfig.id,n=function(n){var i=this,o=t.localConstants[n],s=o.source_type,a=o.source_info[t.nodeId];a&&("component_inputs"===s&&t.inputs.forEach(function(o){l()(this,i),a.includes(o.tag_code)&&t.setVariableSourceInfo({key:n,id:e,type:"delete",tagCode:o.tag_code})}.bind(this)),"component_outputs"===s&&t.outputs.forEach(function(o){l()(this,i),a.includes(o.key)&&t.setVariableSourceInfo({key:n,id:e,type:"delete",tagCode:o.key})}.bind(this)))};for(var i in this.localConstants)n(i)},onViewSubflow:function(t){var e={};e=this.common?{name:"commonTemplatePanel",params:{type:"edit"},query:{template_id:t,common:"1"}}:{name:"templatePanel",params:{type:"edit",project_id:this.project_id},query:{template_id:t}};var n=this.$router.resolve(e).href;window.open(n,"_blank")},onHookChange:function(t,e){"create"===t?(this.isChange=!0,this.$set(this.localConstants,e.key,e)):this.setVariableSourceInfo(e)},setVariableSourceInfo:function(t){var e=this,n=t.type,i=t.id,o=t.key,s=t.tagCode,a=this.localConstants[o];if(a){var r=a.source_info;if("add"===n)r[i]?r[i].push(s):this.$set(r,i,[s]);else if("delete"===n){var c;if(r[i].length<=1)this.$delete(r,i);else r[i].some(function(t,n){if(l()(this,e),t===s)return c=n,!0}.bind(this)),r[i].splice(c,1);Object.keys(r).length||this.deleteVariable(o)}}},deleteVariable:function(t){var e=this.localConstants[t];for(var n in this.localConstants){var i=this.localConstants[n];i.index>e.index&&(i.index=i.index-1)}this.$delete(this.localConstants,t)},validate:function(){var t=this;return this.$refs.basicInfo.validate().then(function(e){return l()(this,t),!this.$refs.inputParams||this.$refs.inputParams.validate()}.bind(this))},getNodeFullConfig:function(){var t,e=this;if(this.isSubflow){var n=this.basicInfo,i=n.nodeName,o=n.stageName,s=n.nodeLabel,a=n.selectable,r=n.version,c=n.tpl,u={};Object.keys(this.subflowForms).forEach(function(t){l()(this,e);var n=this.subflowForms[t];"show"===n.show_type&&(n.value=v.a.deepClone(this.inputsParamValue[t])),u[t]=n}.bind(this)),t=Object.assign({},this.nodeConfig,{constants:u,version:r,name:i,stage_name:o,labels:s,template_id:c,optional:a})}else{var d=this.basicInfo,h=d.ignorable,p=d.nodeName,f=d.stageName,m=d.nodeLabel,g=d.plugin,b=d.retryable,y=d.skippable,_=d.selectable,w=d.version,C={};Object.keys(this.inputsParamValue).forEach(function(t){l()(this,e);var n=this.inputsParamValue[t],i=!1;this.$refs.inputParams&&this.$refs.inputParams.hooked&&(i=this.$refs.inputParams.hooked[t]||!1),C[t]={hook:i,value:v.a.deepClone(n)}}.bind(this));var S={code:g,data:C,version:w};delete(t=Object.assign({},this.nodeConfig,{component:S,retryable:b,skippable:y,name:p,stage_name:f,labels:m,error_ignorable:h,optional:_})).can_retry,delete t.isSkipped}return t},syncActivity:function(){var t=this.getNodeFullConfig();this.nodeConfig=t,this.setActivities({type:"edit",location:t})},handleVariableChange:function(){var t=this;this.outputs.forEach(function(e){l()(this,t),e in this.localConstants||this.setOutputs({changeType:"delete",key:e})}.bind(this));var e=Object.keys(this.localConstants);Object.keys(this.constants).length!==e.length?this.$emit("globalVariableUpdate",!0):e.some(function(e){if(l()(this,t),!(e in this.constants))return this.$emit("globalVariableUpdate",!0),!0}.bind(this)),this.setConstants(this.localConstants)},getAtomPhase:function(){var t=this,e="";return this.atomList.some(function(n){var i=this;if(l()(this,t),n.code===this.basicInfo.plugin)return n.list.some(function(t){l()(this,i),t.version===(this.basicInfo.version||"legacy")&&(e=t.phase)}.bind(this))}.bind(this)),e},isOutputsChanged:function(){var t=this,e=[],n=[];return Object.keys(this.localConstants).forEach(function(n){l()(this,t);var i=this.localConstants[n];"component_outputs"===i.source_type&&e.push(i)}.bind(this)),Object.keys(this.constants).forEach(function(e){l()(this,t);var i=this.constants[e];"component_outputs"===i.source_type&&n.push(i)}.bind(this)),!v.a.isDataEqual(e,n)},openVariablePanel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.key?this.variableData=t:this.variableData={custom_type:"input",desc:"",form_schema:{},index:Object.keys(this.constants).length+1,key:"",name:"",show_type:"show",source_info:{},source_tag:"input.input",source_type:"custom",validation:"^.+$",value:"",version:"legacy"},this.isVariablePanelShow=!0},beforeClose:function(){if(this.isSelectorPanelShow&&!(this.isSubflow?this.basicInfo.tpl:this.basicInfo.plugin))return this.onClosePanel(),!0;if(this.isVariablePanelShow)return this.$refs.variableEdit.handleMaskClick(),!1;var t=this.getNodeFullConfig();return v.a.isDataEqual(t,this.nodeConfig)&&!this.isOutputsChanged()?(this.onClosePanel(),!0):(this.isConfirmDialogShow=!0,this.isSelectorPanelShow=!1,!1)},onSaveConfig:function(){var t=this;this.validate().then(function(e){if(l()(this,t),e){var n=this.basicInfo,i={status:"",skippable:n.skippable,retryable:n.retryable,optional:n.selectable};if(!this.isSubflow){var o=this.getAtomPhase();i.phase=o}this.updateSubflow&&this.setSubprocessUpdated({subprocess_node_id:this.nodeConfig.id}),this.syncActivity(),this.handleVariableChange(),this.$emit("updateNodeInfo",this.nodeId,i),this.$emit("templateDataChanged"),this.$emit("close")}}.bind(this))},onConfirmClick:function(){this.isConfirmDialogShow=!1,this.onSaveConfig()},onClosePanel:function(t){this.$emit("close",t)}})}}).call(this,n(130))},970:function(t,e,n){"use strict";n(842)},971:function(t,e,n){"use strict";n(843)},972:function(t,e,n){"use strict";n(844)},973:function(t,e,n){"use strict";n(845)},974:function(t,e,n){"use strict";n(847)},975:function(t,e,n){"use strict";(function(t){n(38),n(49),n(50);var i=n(51),o=n.n(i),s=n(16),a=n.n(s),r=n(0),l=n.n(r),c=n(5),u=n.n(c),d=n(4),h=n.n(d),p=(n(67),n(37),n(127),n(23),n(22),n(26),n(315),n(24),n(27),n(81),n(101),n(39),n(104),n(128),n(185),n(68),n(184),n(80),n(7)),f=n(655),m=n(28),v=n(1),g=n(1215),b=n(1221),y=n(611);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a={name:"BatchUpdateDialog",components:{InputParams:g.a,OutputParams:b.a,NoData:y.a},props:{show:{type:Boolean,default:!1},projectId:Number,list:{type:Array,default:function(){return[]}}},data:function(){return{isShow:this.show,subflowFormsLoading:!1,subflowForms:[],localConstants:{}}},computed:w(w({},Object(p.e)({activities:function(t){return l()(this,void 0),t.template.activities}.bind(void 0),constants:function(t){return l()(this,void 0),t.template.constants}.bind(void 0),systemConstants:function(t){return l()(this,void 0),t.template.systemConstants.variables}.bind(void 0),pluginConfigs:function(t){return l()(this,void 0),t.atomForm.config}.bind(void 0)})),{},{expiredTplNum:function(){var t=this;return this.list.filter(function(e){return l()(this,t),e.expired}.bind(this)).length},selectedTplNum:function(){var t=this;return this.subflowForms.filter(function(e){return l()(this,t),e.checked}.bind(this)).length}}),watch:{show:function(t){this.isShow=t,this.loadSubflowForms()}},methods:w(w(w(w({},Object(p.d)("template/",["setActivities","setConstants","setOutputs"])),Object(p.b)("template",["getBatchForms"])),Object(p.b)("atomForm/",["loadAtomConfig"])),{},{loadSubflowForms:function(){var t=this;return a()(h.a.mark((function e(){var n,i,o,s=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.subflowFormsLoading=!0,n=[],t.list.map(function(t){l()(this,s),t.expired&&n.push({id:t.template_id,nodeId:t.subprocess_node_id,version:t.version})}.bind(this)),e.next=6,t.getBatchForms({tpls:n,projectId:t.projectId});case 6:i=e.sent,o=[],n.forEach(function(e){var n=this;l()(this,s);var a=t.activities[e.nodeId],r=a.name,c=a.id,u=a.template_id,d=a.constants,h={},p={};for(var f in i.data[e.id].forEach(function(t){var e=this;l()(this,n);var i=t.form,o=t.outputs,s=t.version,a={};for(var r in i){var c=i[r];"show"===c.show_type&&(a[r]=c)}var u={form:a,outputs:Object.keys(o).map(function(t){l()(this,e);var n=o[t];return{name:n.name,key:n.key,version:n.hasOwnProperty("version")?n.version:"legacy"}}.bind(this)),inputsConfig:[],inputsValue:{},version:s};t.is_current?h=u:p=u}.bind(this)),h.form){var v=h.form[f];p.form.hasOwnProperty(f)||(v.status="added")}for(var g in p.form){var b=p.form[g];h.form.hasOwnProperty(g)||(b.status="deleted"),d[b.key]&&(p.inputsValue[b.key]=m.a.deepClone(d[b.key].val))}o.push({name:r,id:c,template_id:u,latestForm:h,currentForm:p,loading:!1,checked:!1,fold:!1})}.bind(this)),t.subflowForms=o,t.getTplsFormConfig(o),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0);case 16:return e.prev=16,t.subflowFormsLoading=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[0,13,16,19]])})))()},getTplsFormConfig:function(t){var e=this;return a()(h.a.mark((function n(){var i,s,r,c,u=this;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={},s=[],r={},c=[],t.forEach(function(t){var e=this;l()(this,u);var n=Object.keys(t.latestForm.form).map(function(n){return l()(this,e),t.latestForm.form[n]}.bind(this)).sort(function(t,n){return l()(this,e),t.index-n.index}.bind(this)),i=Object.keys(t.currentForm.form).map(function(n){return l()(this,e),t.currentForm.form[n]}.bind(this)).sort(function(t,n){return l()(this,e),t.index-n.index}.bind(this));c.push({latestFormArr:n,currentFormArr:i})}.bind(this)),c.forEach(function(t){var e=this;l()(this,u),[].concat(o()(t.latestFormArr),o()(t.currentFormArr)).forEach(function(t){l()(this,e);var n=t.custom_type||t.source_tag.split(".")[0];i["".concat(n,"_").concat(t.version)]||(i["".concat(n,"_").concat(t.version)]=!0,s.push(t))}.bind(this))}.bind(this)),n.next=8,Promise.all(s.map(function(){var t=a()(h.a.mark((function t(n){var i,o,s,a,l,c,u,d,p;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.custom_type||n.source_tag.split(".")[0],o=f.a.getVariableArgs(n),s=o.name,a=o.atom,l=o.tagCode,c=o.classify,u=n.version||"legacy",t.next=5,e.getAtomConfig(a,u,c,s);case 5:d=t.sent,p=m.a.deepClone(f.a.formFilter(l,d)),(n.is_meta||p.meta_transform)&&(p=p.meta_transform(n.meta||n),n.meta||(n.value=p.attrs.value)),p.attrs.name=n.name,["input","textarea"].includes(n.custom_type)&&""!==n.validation&&p.attrs.validation.push({type:"regex",args:n.validation,error_message:v.a.t("默认值不符合正则规则：")+n.validation}),r["".concat(i,"_").concat(n.version)]=p;case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:c.forEach(function(t,n){var i=this;l()(this,u),t.latestFormArr.forEach(function(t){l()(this,i);var o=t.custom_type||t.source_tag.split(".")[0],s=m.a.deepClone(r["".concat(o,"_").concat(t.version)]);s.tag_code=t.key,s.status=t.status,e.subflowForms[n].latestForm.inputsConfig.push(s),e.subflowForms[n].latestForm.inputsValue[t.key]=m.a.deepClone(t.value)}.bind(this)),t.currentFormArr.forEach(function(t){l()(this,i);var o=t.custom_type||t.source_tag.split(".")[0],s=m.a.deepClone(r["".concat(o,"_").concat(t.version)]);s.tag_code=t.key,s.status=t.status,e.subflowForms[n].currentForm.inputsConfig.push(s)}.bind(this))}.bind(this));case 9:case"end":return n.stop()}}),n,this)})))()},getAtomConfig:function(e,n,i,o){var s=this;return a()(h.a.mark((function a(){var r,l,c;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r=s.common?void 0:s.project_id,!(l=s.pluginConfigs[e])||!l[n]){a.next=4;break}return a.abrupt("return",l[n]);case 4:return a.prev=4,a.next=7,s.loadAtomConfig({atom:e,version:n,classify:i,name:o,project_id:r});case 7:return c=t.atoms[e],a.abrupt("return",c);case 11:a.prev=11,a.t0=a.catch(4),console.log(a.t0);case 14:case"end":return a.stop()}}),a,null,[[4,11]])})))()},onSelectedAllChange:function(t){var e=this;this.subflowForms.forEach(function(n){l()(this,e),n.checked=t}.bind(this))},onHookChange:function(t,e){"create"===t?this.$set(this.localConstants,e.key,e):this.setVariableSourceInfo(e)},setVariableSourceInfo:function(t){var e=this,n=t.type,i=t.id,o=t.key,s=t.tagCode,a=this.localConstants[o];if(a){var r=a.source_info;if("add"===n)r[i]?r[i].push(s):this.$set(r,i,[s]);else if("delete"===n){var c;if(r[i].length<=1)this.$delete(r,i);else r[i].some(function(t,n){if(l()(this,e),t===s)return c=n,!0}.bind(this)),r[i].splice(c,1);Object.keys(r).length||this.deleteVariable(o)}}},deleteVariable:function(t){var e=this.localConstants[t];for(var n in this.localConstants){var i=this.localConstants[n];i.index>e.index&&(i.index=i.index-1)}this.$delete(this.localConstants,t)},updateInputsValue:function(t,e){var n=this;this.subflowForms.find(function(e){return l()(this,n),e.id===t}.bind(this)).latestForm.inputsValue=e},handleVariableChange:function(){var t=this;this.subflowForms.forEach(function(e){var n=this;l()(this,t),e.latestForm.outputs.forEach(function(t){l()(this,n),t in this.localConstants||this.setOutputs({changeType:"delete",key:t})}.bind(this))}.bind(this));var e=Object.keys(this.localConstants);Object.keys(this.constants).length!==e.length?this.$emit("globalVariableUpdate",!0):e.some(function(e){if(l()(this,t),!(e in this.constants))return this.$emit("globalVariableUpdate",!0),!0}.bind(this)),this.setConstants(this.localConstants)},onConfirm:function(){var t=this;if(this.$refs.inputParams.filter(function(e,n){return l()(this,t),this.subflowForms[n].checked}.bind(this)).every(function(e){return l()(this,t),e.validate()}.bind(this)))this.subflowForms.filter(function(e){return l()(this,t),e.checked}.bind(this)).forEach(function(e){var n=this;l()(this,t);var i=m.a.deepClone(this.activities[e.id]);Object.keys(i.constants).forEach(function(t){l()(this,n),i.constants[t].value=e.latestForm.inputsValue[t]}.bind(this)),this.setActivities({type:"edit",location:i})}.bind(this)),this.handleVariableChange(),this.onCloseDialog();else{var e=document.querySelector(".subflow-form-wrap .common-error-tip");e&&e.scrollIntoView()}},onCloseDialog:function(){this.$emit("update:show",!1)}})}}).call(this,n(130))},989:function(t,e,n){"use strict";n(38),n(49),n(50);var i=n(51),o=n.n(i),s=n(16),a=n.n(s),r=n(0),l=n.n(r),c=n(5),u=n.n(c),d=n(4),h=n.n(d),p=(n(67),n(23),n(37),n(22),n(43),n(127),n(315),n(68),n(103),n(80),n(184),n(129),n(26),n(672),n(128),n(101),n(39),n(734),n(185),n(183),n(24),n(7)),f=n(897),m=n.n(f),v=(n(314),n(1)),g=n(46),b=n(6),y=n(102),_=(n(27),n(81),n(82),{name:"EditScheme",props:{orderedNodeData:Array},data:function(){var t=this.transformToText(this.orderedNodeData);return{excludeNodes:[],schemeText:t,initSchemeText:t,errorMsg:""}},methods:{transformToText:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i="";return t.forEach(function(t){l()(this,e);var o=t.stage_name,s=t.name,a=t.optional?n.includes(t.id)?0:1:2;i+="".concat(""===o?"":o+"：").concat(s," ").concat(a,"\n")}.bind(this)),i},judgeDataEqual:function(){return this.initSchemeText.trim()===this.schemeText.trim()},updateSelected:function(){var t=this;this.errorMsg="";var e=this.schemeText.trim(),n=[],i=[],o=e.split("\n").filter(function(e){return l()(this,t),""!==e.trim()}.bind(this));o.length!==this.orderedNodeData.length?this.errorMsg=v.a.t("方案节点个数（")+o.length+v.a.t("）与实际节点个数（")+this.orderedNodeData.length+v.a.t("）不一致，请确认导出方案后模板是否有过修改"):(o.some(function(e){var o=this;if(l()(this,t),""!==e.trim()){var s="",a="",r=e.split("：").filter(function(t){return l()(this,o),""!==t.trim()}.bind(this)),c="";if(r.length>1?(s=r[0],r.splice(0,1),c=r.join("：").split(" ").filter(function(t){return l()(this,o),""!==t.trim()}.bind(this))):(s="",c=r[0].split(" ").filter(function(t){return l()(this,o),""!==t.trim()}.bind(this))),!(c.length>1)){var u=this.orderedNodeData.find(function(t){return l()(this,o),t.stage_name===s&&t.name===c[0]}.bind(this));return this.errorMsg=u?v.a.t("方案中的（")+c[0]+v.a.t("）节点选择标记与模板中不一致，请确认导出方案后模板中节点可选配置是否有过修改"):v.a.t("方案中的（")+c[0]+v.a.t("）节点在模板中未找到，请确认导出方案后模板是否有过修改"),!0}var d=c.length-1,h=Number(c[d]);c.pop(d),a=c.join(" ");var p=this.orderedNodeData.find(function(t){return l()(this,o),t.stage_name===s&&t.name===a&&!i.includes(t.id)}.bind(this));return p?(i.push(p.id),(p.optional?[0,1].includes(h):2===h)?void(p.optional&&0===h&&n.push(p.id)):(this.errorMsg=v.a.t("方案中的（")+a+v.a.t("）节点选择标记与模板中不一致，请确认导出方案后模板中节点可选配置是否有过修改"),!0)):(this.errorMsg=v.a.t("方案中的（")+a+v.a.t("）节点在模板中未找到，请确认导出方案后模板是否有过修改"),!0)}}.bind(this)),""===this.errorMsg&&(this.excludeNodes=n))},onSaveScheme:function(){var t=this;if(this.updateSelected(),!this.errorMsg){var e=this.orderedNodeData.filter(function(e){return l()(this,t),!this.excludeNodes.includes(e.id)}.bind(this)).map(function(e){return l()(this,t),e.id}.bind(this));this.$emit("importTextScheme",e),this.$emit("update:isShow",!1)}}}}),w=(n(971),n(9)),C=Object(w.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"edit-scheme-wrap"},[n("transition",{attrs:{name:"vertical-move"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.errorMsg,expression:"errorMsg"}],staticClass:"error-tips"},[t._v(t._s(t.errorMsg))])]),t._v(" "),n("div",{staticClass:"form-content"},[n("bk-form",{attrs:{"form-type":"vertical"}},[n("bk-form-item",{attrs:{label:t.$t("方案内容"),required:!0}},[n("bk-input",{attrs:{type:"textarea",rows:16},on:{blur:t.updateSelected},model:{value:t.schemeText,callback:function(e){t.schemeText=e},expression:"schemeText"}}),t._v(" "),n("div",{staticClass:"content-tips"},[t._v(t._s(t.$t("参考格式：步骤：节点名 标识位(0：不选择；1：选择；2：非可选节点)，并以换行符分隔。")))])],1),t._v(" "),n("bk-form-item",{attrs:{label:t.$t("变更节点对比")}},[n("bk-table",{attrs:{data:t.orderedNodeData}},[n("bk-table-column",{attrs:{label:t.$t("步骤名称")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(e.row.stage_name||"--")+"\n                        ")]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("节点名称"),prop:"name"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("选中状态")},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.optional&&t.excludeNodes.includes(e.row.id)?n("span",{staticClass:"unselect"},[t._v(t._s(t.$t("否")))]):n("span",[t._v(t._s(t.$t("是")))])]}}])})],1)],1)],1)],1),t._v(" "),n("div",{staticClass:"btn-wrap"},[n("bk-button",{attrs:{theme:"primary"},on:{click:t.onSaveScheme}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{on:{click:function(e){return t.$emit("update:isShow",!1)}}},[t._v(t._s(t.$t("取消")))])],1)],1)}),[],!1,null,"6174f566",null).exports;function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var x={name:"TaskSchema",components:{EditScheme:C},mixins:[y.a],props:{template_id:{type:[String,Number],default:""},project_id:{type:[String,Number],default:""},templateName:{type:String,default:""},isCommonProcess:{type:Boolean,default:!1},isSchemeShow:{type:Boolean,default:!1},isSchemeEditable:{type:Boolean,default:!1},isPreviewMode:{type:Boolean,default:!1},isEditProcessPage:{type:Boolean,default:!0},selectedNodes:{type:Array,default:function(){return[]}},orderedNodeData:{type:Array,default:function(){return[]}},tplActions:{type:Array,default:function(){return[]}}},data:function(){return{isSaveLoading:!1,isShowDialog:!1,showPanel:!0,nameEditing:!1,schemaName:"",schemaNameRule:{required:!0,max:b.i.SCHEME_NAME_MAX_LENGTH,regex:b.e},schemaList:[],deleting:!1,isEditSchemeShow:!1,isPreview:!1}},computed:k({haveCreateSchemeTpl:function(){var t=this.isCommonProcess?"common_flow_edit":"flow_edit";return this.hasPermission([t],this.tplActions)}},Object(p.e)("project",{projectId:function(t){return l()(this,void 0),t.project_id}.bind(void 0),projectName:function(t){return l()(this,void 0),t.projectName}.bind(void 0)})),watch:{isPreviewMode:function(t){this.isPreview=t}},created:function(){this.loadSchemeList()},methods:k(k({},Object(p.b)("task/",["loadTaskScheme","createTaskScheme","deleteTaskScheme"])),{},{onCheckChange:function(t,e){this.$emit("selectScheme",e,t)},loadSchemeList:function(){var t=this;return a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.loadTaskScheme({project_id:t.project_id,template_id:t.template_id,isCommon:t.isCommonProcess});case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:t.schemaList=e.t0,t.$emit("updateTaskSchemeList",t.schemaList),e.next=13;break;case 10:e.prev=10,e.t1=e.catch(0),console.log(e.t1);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},toggleSchemePanel:function(){this.showPanel=!this.showPanel},onImportTemporaryPlan:function(){var t=!0;if(!this.haveCreateSchemeTpl){var e=this.isCommonProcess?"common_flow_edit":"flow_edit";t=this.checkSchemeRelativePermission([e])}t&&(this.isEditSchemeShow=!0)},onCreateScheme:function(){var t=this,e=!0;if(!this.haveCreateSchemeTpl){var n=this.isCommonProcess?"common_flow_edit":"flow_edit";e=this.checkSchemeRelativePermission([n])}e&&!this.isPreviewMode&&(this.nameEditing=!0,this.$nextTick(function(){l()(this,t),this.$refs.nameInput.focus()}.bind(this)))},handlerBlur:function(){this.nameEditing=""!==this.schemaName.trim()},onAddScheme:function(){var t=this;""!==this.schemaName?this.schemaList.some(function(e){return l()(this,t),e.name===this.schemaName}.bind(this))?this.$bkMessage({message:v.a.t("方案名称已存在"),theme:"error"}):this.$validator.validateAll().then(function(){var e=a()(h.a.mark((function e(n){var i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}return t.schemaName="",t.nameEditing=!1,e.abrupt("return");case 4:if(t.schemaName=t.schemaName.trim(),i=t.selectedNodes.slice(),t.isEditProcessPage){e.next=13;break}return t.schemaList.push({data:JSON.stringify(i),name:t.schemaName,id:Object(g.b)()}),t.$bkMessage({message:v.a.t("方案添加成功"),theme:"success"}),t.$emit("updateTaskSchemeList",t.schemaList),t.schemaName="",t.nameEditing=!1,e.abrupt("return");case 13:return o={project_id:t.project_id,template_id:t.template_id,name:t.schemaName,data:JSON.stringify(i),isCommon:t.isCommonProcess},e.prev=14,e.next=17,t.createTaskScheme(o);case 17:t.loadSchemeList(),t.$bkMessage({message:v.a.t("方案添加成功"),theme:"success"}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),console.log(e.t0);case 24:return e.prev=24,t.schemaName="",t.nameEditing=!1,e.finish(24);case 28:case"end":return e.stop()}}),e,null,[[14,21,24,28]])})));return function(t){return e.apply(this,arguments)}}()):this.nameEditing=!1},onDeleteScheme:function(t){var e=this;return a()(h.a.mark((function n(){var i,o,s=this;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.checkSchemeRelativePermission(["flow_edit"]),!e.deleting&&i){n.next=3;break}return n.abrupt("return");case 3:if(e.isEditProcessPage){n.next=9;break}return o=e.schemaList.findIndex(function(e){return l()(this,s),e.id===t.id}.bind(this)),e.schemaList.splice(o,1),e.$bkMessage({message:v.a.t("方案删除成功"),theme:"success"}),e.$emit("updateTaskSchemeList",e.schemaList),n.abrupt("return");case 9:return e.deleting=!0,n.prev=10,n.next=13,e.deleteTaskScheme({id:t.id,isCommon:e.isCommonProcess});case 13:e.loadSchemeList(),e.$bkMessage({message:v.a.t("方案删除成功"),theme:"success"}),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(10),console.log(n.t0);case 20:return n.prev=20,e.deleting=!1,n.finish(20);case 23:case"end":return n.stop()}}),n,this,[[10,17,20,23]])})))()},checkSchemeRelativePermission:function(t){if(!this.hasPermission(t,this.tplActions)){var e={flow:[{id:this.template_id,name:this.templateName}],project:[{id:this.projectId,name:this.projectName}]};return this.applyForPermission(t,this.tplActions,e),!1}return!0},onCancel:function(){this.schemeName="",this.nameEditing=!1},onChangePreviewNode:function(){this.isPreview=!this.isPreview,this.$emit("togglePreviewMode",this.isPreview)},onCloseEditScheme:function(){this.$refs.editScheme.judgeDataEqual()?this.isEditSchemeShow=!1:this.isShowDialog=!0},onConfirmClick:function(){this.isSaveLoading=!0;try{var t=this.$refs.editScheme;t.onSaveScheme(),this.isSaveLoading=!1,this.isShowDialog=!1,t.errorMsg||(this.isEditSchemeShow=!1)}catch(t){console.warn(t),this.isSaveLoading=!1}},onCancelClick:function(){this.isShowDialog=!1,this.isEditSchemeShow=!1}})},P=(n(972),n(973),Object(w.a)(x,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isSchemeShow?n("div",{staticClass:"task-scheme"},[n("div",{staticClass:"schema-nav"},[n("div",{staticClass:"scheme-combine-shape",on:{click:t.toggleSchemePanel}},[n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("执行方案"),placements:["top"]},expression:"{\n                    content: $t('执行方案'),\n                    placements: ['top']\n                }"}],staticClass:"common-icon-paper"})])]),t._v(" "),t.showPanel&&!t.isEditSchemeShow?n("div",{staticClass:"schema-list-panel"},[n("div",{staticClass:"scheme-title"},[n("span",[t._v(" "+t._s(t.$t("执行方案")))]),t._v(" "),n("div",[n("bk-button",{attrs:{size:"small",theme:"primary"},on:{click:t.onChangePreviewNode}},[t._v(t._s(t.isPreview?t.$t("关闭预览"):t.$t("节点预览")))]),t._v(" "),n("bk-button",{attrs:{size:"small",disabled:t.isCommonProcess},on:{click:t.onImportTemporaryPlan}},[t._v("导入临时方案")])],1)]),t._v(" "),n("div",{staticClass:"scheme-header"},[t.nameEditing?n("div",{staticClass:"scheme-form"},[n("bk-input",{directives:[{name:"validate",rawName:"v-validate.persist",value:t.schemaNameRule,expression:"schemaNameRule",modifiers:{persist:!0}}],ref:"nameInput",staticClass:"bk-input-inline",attrs:{name:"schemaName",clearable:!0,placeholder:t.$t("方案名称")},on:{blur:t.handlerBlur},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onAddScheme.apply(null,arguments)}},model:{value:t.schemaName,callback:function(e){t.schemaName=e},expression:"schemaName"}}),t._v(" "),t.veeErrors.has("schemaName")?n("span",{staticClass:"common-error-tip error-msg"},[t._v(t._s(t.veeErrors.first("schemaName")))]):t._e()],1):n("div",{staticClass:"add-plan",on:{click:t.onCreateScheme}},[n("span",{staticClass:"common-icon-add"}),t._v("\n                "+t._s(t.$t("新增方案"))+"\n            ")])]),t._v(" "),n("div",{class:["scheme-content",{"is-diasbled":t.isCommonProcess}]},[n("ul",{staticClass:"schemeList"},t._l(t.schemaList,(function(e){return n("li",{key:e.id,staticClass:"scheme-item"},[n("bk-checkbox",{on:{change:function(n){return t.onCheckChange(n,e)}}}),t._v(" "),n("span",{staticClass:"scheme-name",attrs:{title:e.name}},[t._v(t._s(e.name))]),t._v(" "),t.isSchemeEditable?n("i",{staticClass:"bk-icon icon-close-circle-shape",on:{click:function(n){return n.stopPropagation(),t.onDeleteScheme(e)}}}):t._e()],1)})),0)])]):t._e(),t._v(" "),n("bk-sideslider",{attrs:{"is-show":t.showPanel&&t.isEditSchemeShow,width:800,"quick-close":!0,"before-close":t.onCloseEditScheme}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"title-back",on:{click:t.onCloseEditScheme}},[t._v(t._s(t.$t("执行方案")))]),t._v("\n            >\n            "),n("span",[t._v(t._s(t.$t("导入临时方案")))])]),t._v(" "),n("edit-scheme",{ref:"editScheme",attrs:{slot:"content","is-show":t.isEditSchemeShow,"ordered-node-data":t.orderedNodeData},on:{"update:isShow":function(e){t.isEditSchemeShow=e},"update:is-show":function(e){t.isEditSchemeShow=e},importTextScheme:function(e){return t.$emit("importTextScheme",e)}},slot:"content"})],1),t._v(" "),n("bk-dialog",{attrs:{width:"400","ext-cls":"task-scheme-dialog",theme:"primary","mask-close":!1,"show-footer":!1,value:t.isShowDialog},on:{cancel:function(e){t.isShowDialog=!1}}},[n("div",{staticClass:"task-scheme-confirm-dialog-content"},[n("div",{staticClass:"leave-tips"},[t._v(t._s(t.$t("保存已修改的信息吗？")))]),t._v(" "),n("div",{staticClass:"action-wrapper"},[n("bk-button",{attrs:{theme:"primary",loading:t.isSaveLoading},on:{click:t.onConfirmClick}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default",disabled:t.isSaveLoading},on:{click:t.onCancelClick}},[t._v(t._s(t.$t("不保存")))])],1)])])],1):t._e()}),[],!1,null,"0189ecbe",null).exports),E=n(694),D=n(859);function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T={components:{TaskScheme:P,TemplateCanvas:E.a,NodePreview:D.a},props:{project_id:[String,Number],template_id:[String,Number],common:String,excludeNode:Array,entrance:String,isEditProcessPage:{type:Boolean,default:!0}},data:function(){return{selectedNodes:[],allSelectableNodes:[],isAllSelected:!0,isPreviewMode:!1,isAppmakerHasScheme:!0,version:"",previewBread:[],previewData:{location:[],line:[],gateways:{},constants:[]},orderedNodeData:[],templateName:"",templateLoading:!0,previewDataLoading:!0,tplActions:[],planDataObj:{}}},computed:O(O({},Object(p.e)({activities:function(t){return l()(this,void 0),t.template.activities}.bind(void 0),location:function(t){return l()(this,void 0),t.template.location}.bind(void 0),line:function(t){return l()(this,void 0),t.template.line}.bind(void 0),constants:function(t){return l()(this,void 0),t.template.constants}.bind(void 0),gateways:function(t){return l()(this,void 0),t.template.gateways}.bind(void 0),taskScheme:function(t){return l()(this,void 0),t.task.taskScheme}.bind(void 0),app_id:function(t){return l()(this,void 0),t.app_id}.bind(void 0),viewMode:function(t){return l()(this,void 0),t.view_mode}.bind(void 0)})),{},{canvasData:function(){return this.formatCanvasData("select",this)},isSelectAllShow:function(){var t=this;return"app"===this.viewMode&&this.location.some(function(e){return l()(this,t),e.optional}.bind(this))},isSchemeShow:function(){var t=this;return!!this.location.some(function(e){return l()(this,t),e.optional}.bind(this))&&("appmaker"!==this.viewMode||!this.isAppmakerHasScheme)},isCommonProcess:function(){return 1===Number(this.$route.query.common)},loading:function(){return this.isPreviewMode&&this.previewDataLoading||this.templateLoading}}),created:function(){"appmaker"===this.viewMode&&(this.isPreviewMode=!0),this.getTemplateData()},methods:O(O(O(O(O({},Object(p.b)("template/",["loadTemplateData"])),Object(p.b)("task/",["getSchemeDetail","loadPreviewNodeData"])),Object(p.b)("appmaker/",["loadAppmakerDetail"])),Object(p.d)("template/",["setTemplateData"])),{},{getTemplateData:function(){var t=this;return a()(h.a.mark((function e(){var n,i,o,s,a,r=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.templateLoading=!0,e.prev=1,n={templateId:t.template_id,common:t.common},i=[],e.next=6,t.loadTemplateData(n);case 6:if(o=e.sent,t.tplActions=o.auth_actions,t.version=o.version,t.templateName=o.name,t.orderedNodeData=t.getOrderedNodeData(o),"appmaker"!==t.viewMode){e.next=24;break}return e.next=14,t.loadAppmakerDetail(t.app_id);case 14:if(s=e.sent,a=s.template_scheme_id,t.previewBread=[{id:t.template_id,name:t.templateName,version:t.version}],""!==a){e.next=23;break}return t.isAppmakerHasScheme=!1,e.next=21,t.getPreviewNodeData(t.template_id,t.version);case 21:e.next=24;break;case 23:t.selectScheme({id:a});case 24:t.setTemplateData(o),t.allSelectableNodes=t.location.filter(function(t){return l()(this,r),t.optional}.bind(this)),t.allSelectableNodes.forEach(function(e){l()(this,r),-1===t.excludeNode.indexOf(e.id)&&i.push(e.id)}.bind(this)),t.selectedNodes=i,t.canvasData.locations.forEach(function(e){l()(this,r),t.selectedNodes.indexOf(e.id)>-1&&t.$set(e,"checked",!0)}.bind(this)),e.next=35;break;case 31:e.prev=31,e.t0=e.catch(1),404===e.t0.status&&t.$router.push({name:"notFoundPage"}),console.log(e.t0);case 35:return e.prev=35,t.templateLoading=!1,e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[1,31,35,38]])})))()},getPreviewNodeData:function(t,e){var n=this;return a()(h.a.mark((function i(){var o,s,a;return h.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.previewDataLoading=!0,o=n.getExcludeNode(),s={templateId:Number(t),excludeTaskNodesId:o,common:n.common,version:e},i.prev=3,i.next=6,n.loadPreviewNodeData(s);case 6:(a=i.sent).result&&(n.previewData=a.data.pipeline_tree),i.next=13;break;case 10:i.prev=10,i.t0=i.catch(3),console.log(i.t0);case 13:return i.prev=13,n.previewDataLoading=!1,i.finish(13);case 16:case"end":return i.stop()}}),i,null,[[3,10,13,16]])})))()},onGotoParamFill:function(){var t=this;return a()(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={name:"taskCreate",params:{project_id:t.project_id,step:"paramfill"},query:{template_id:t.template_id,common:t.common,entrance:t.entrance}},"function"===t.entrance&&(n.name="functionTemplateStep"),"appmaker"===t.viewMode&&(n.name="appmakerTaskCreate"),t.$router.push(n);case 4:case"end":return e.stop()}}),e)})))()},formatCanvasData:function(t,e){var n=this,i=e.line,o=e.location,s=e.gateways,a=e.activities,r={};for(var c in s){var u=s[c];u.conditions&&(r[u.id]=Object.assign({},u.conditions))}return{lines:i,locations:o.map(function(e){l()(this,n);var i="tasknode"===e.type?a[e.id].component.code:"";return O(O({},e),{},{mode:t,code:i})}.bind(this)),branchConditions:r}},getOrderedNodeData:function(t){var e=this,n=JSON.parse(t.pipeline_tree),i=n.start_event.outgoing,o=[];return this.retrieveLines(n,i,o,[]),o.sort(function(t,n){return l()(this,e),t.level-n.level}.bind(this)),o},retrieveLines:function(t,e,n,i){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=t.activities,r=t.gateways,c=t.flows,u=c[e].target,d=a[u],h=r[u],p=d||h;if(p&&!i.includes(p.id)){if(i.push(p.id),d){var f=n.find(function(t){return l()(this,o),t.id===d.id}.bind(this));f||(d.level=s,n.push(d))}var m=Array.isArray(p.outgoing)?p.outgoing:[p.outgoing];h&&(s+=1),m.forEach(function(e,a,r){l()(this,o),this.retrieveLines(t,e,n,i,s)}.bind(this))}},onToggleAllNode:function(t){var e=this;this.isAllSelected=t,this.canvasData.locations.forEach(function(n){l()(this,e),this.isSelectableNode(n.id)&&this.$set(n,"checked",t)}.bind(this));var n=this.allSelectableNodes.map(function(t){return l()(this,e),t.id}.bind(this));this.selectedNodes=t?n:[],this.updateExcludeNodes()},onNodeClick:function(t){var e=this.previewData.activities[t];if("appmaker"!==this.viewMode&&e&&"SubProcess"===e.type){var n=e.template_id,i=e.name,o=e.version;this.previewBread.push({id:n,name:i,version:o}),this.getPreviewNodeData(n,e.version)}},onNodeCheckClick:function(t,e){var n=this;this.canvasData.locations.some(function(i){if(l()(this,n),i.id===t)return this.$set(i,"checked",e),!0}.bind(this)),e?(this.selectedNodes.length===this.allSelectableNodes.length-1&&(this.isAllSelected=!0),this.selectedNodes.push(t)):(this.isAllSelected=!1,this.selectedNodes=this.selectedNodes.filter(function(e){return l()(this,n),e!==t}.bind(this))),this.updateExcludeNodes()},onSelectSubflow:function(t,e,n){this.getPreviewNodeData(t,e),this.previewBread.splice(n+1,this.previewBread.length)},getExcludeNode:function(){var t=this,e=[];return this.allSelectableNodes.filter(function(n){l()(this,t),-1===this.selectedNodes.indexOf(n.id)&&e.push(n.id)}.bind(this)),e},isSelectableNode:function(t){var e=this;return this.allSelectableNodes.findIndex(function(n){return l()(this,e),n.id===t}.bind(this))>-1},selectScheme:function(t,e){var n=this;return a()(h.a.mark((function i(){var s,a,r,c,u,d,p,f,m,v,g=this;return h.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=[],a=[],!1!==e){i.next=8;break}if(a=[],n.$delete(n.planDataObj,t.id),Object.keys(n.planDataObj).length)for(r in n.planDataObj)s=n.planDataObj[r],(c=a).push.apply(c,o()(s)),u=Array.from(new Set(a)),n.selectedNodes=u;else n.selectedNodes=[];i.next=25;break;case 8:if(i.prev=8,!n.isEditProcessPage){i.next=15;break}return i.next=12,n.getSchemeDetail({id:t.id,isCommon:n.isCommonProcess});case 12:i.t0=i.sent,i.next=16;break;case 15:i.t0=t;case 16:for(p in d=i.t0,s=n.isCommonProcess?JSON.parse(d):JSON.parse(d.data),n.planDataObj[t.id]=s,n.planDataObj)m=n.planDataObj[p],(f=a).push.apply(f,o()(m)),v=Array.from(new Set(a)),n.selectedNodes=v;i.next=25;break;case 22:i.prev=22,i.t1=i.catch(8),console.log(i.t1);case 25:n.updateExcludeNodes(),n.canvasData.locations.forEach(function(t){if(l()(this,g),n.isSelectableNode(t.id)){var e=n.selectedNodes.indexOf(t.id)>-1;n.$set(t,"checked",e)}}.bind(this)),n.isPreviewMode&&n.getPreviewNodeData(n.template_id,n.version);case 28:case"end":return i.stop()}}),i,this,[[8,22]])})))()},importTextScheme:function(t){var e=this;this.selectedNodes=t.slice(0),this.updateExcludeNodes(),this.canvasData.locations.forEach(function(t){if(l()(this,e),this.isSelectableNode(t.id)){var n=this.selectedNodes.indexOf(t.id)>-1;this.$set(t,"checked",n)}}.bind(this)),this.isPreviewMode&&this.getPreviewNodeData(this.template_id,this.version)},updateTaskSchemeList:function(t){this.$emit("updateTaskSchemeList",t)},onExportScheme:function(){var t=this,e=[];this.orderedNodeData.forEach(function(n){l()(this,t);var i=n.stage_name,o=n.name,s=n.optional?this.excludeNode.includes(n.id)?0:1:2;e.push(["".concat(""===i?"":i+"：").concat(o," ").concat(s)])}.bind(this));var n=m.a.utils.book_new(),i=m.a.utils.aoa_to_sheet(e);m.a.utils.book_append_sheet(n,i,"task_scheme"),m.a.writeFile(n,"bk_sops_tpl_task_scheme_".concat(+new Date,".xlsx"))},togglePreviewMode:function(t){this.isPreviewMode=t,t?(this.previewBread.push({id:this.template_id,name:this.templateName,version:this.version}),this.getPreviewNodeData(this.template_id,this.version)):this.previewBread=[],this.$emit("togglePreviewMode",t)},updateExcludeNodes:function(){var t=this.getExcludeNode();this.$emit("setExcludeNode",t)}})},L=(n(974),Object(w.a)(T,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.templateLoading,opacity:1,zIndex:100},expression:"{ isLoading: templateLoading, opacity: 1, zIndex: 100 }"}],staticClass:"select-node-wrapper",class:{"task-create-page":!t.isEditProcessPage}},[n("div",{staticClass:"canvas-content"},[t.isPreviewMode||t.templateLoading?t.isPreviewMode?n("NodePreview",{ref:"nodePreview",attrs:{"preview-data-loading":t.previewDataLoading,"canvas-data":t.formatCanvasData("perview",t.previewData),"preview-bread":t.previewBread},on:{onNodeClick:t.onNodeClick,onSelectSubflow:t.onSelectSubflow}}):t._e():n("TemplateCanvas",{ref:"templateCanvas",attrs:{"preview-data-loading":t.previewDataLoading,"show-palette":!1,editable:!1,"is-node-check-open":t.isSchemeShow,"is-all-selected":t.isAllSelected,"is-show-select-all-tool":t.isSelectAllShow,"canvas-data":t.canvasData},on:{onNodeCheckClick:t.onNodeCheckClick,onToggleAllNode:t.onToggleAllNode}}),t._v(" "),n("task-scheme",{directives:[{name:"show",rawName:"v-show",value:t.isEditProcessPage||!t.isPreviewMode,expression:"isEditProcessPage || !isPreviewMode"}],attrs:{project_id:t.project_id,template_id:t.template_id,"template-name":t.templateName,"is-scheme-show":t.isSchemeShow,"is-scheme-editable":"appmaker"!==t.viewMode,"is-preview-mode":t.isPreviewMode,"is-common-process":t.isCommonProcess,"selected-nodes":t.selectedNodes,"ordered-node-data":t.orderedNodeData,"tpl-actions":t.tplActions,"is-edit-process-page":t.isEditProcessPage},on:{updateTaskSchemeList:t.updateTaskSchemeList,onExportScheme:t.onExportScheme,selectScheme:t.selectScheme,importTextScheme:t.importTextScheme,togglePreviewMode:t.togglePreviewMode}})],1),t._v(" "),t.isEditProcessPage?n("div",{staticClass:"action-wrapper",attrs:{slot:"action-wrapper"},slot:"action-wrapper"},[n("bk-button",{staticClass:"next-button",attrs:{theme:"primary"},on:{click:t.onGotoParamFill}},[t._v("\n            "+t._s(t.$t("下一步"))+"\n        ")]),t._v(" "),t.isSchemeShow?n("bk-button",{on:{click:t.onExportScheme}},[t._v(t._s(t.$t("导出当前方案")))]):t._e()],1):t._e()])}),[],!1,null,"a26b2dfc",null));e.a=L.exports},992:function(t,e,n){"use strict";n(26),n(38),n(37),n(49),n(50);var i=n(0),o=n.n(i),s=n(5),a=n.n(s),r=(n(67),n(22),n(80),n(7)),l=n(1);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){a()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={name:"SelectProjectModal",props:{title:String,show:Boolean,project:Number,confirmLoading:{type:Boolean,default:!1},confirmCursor:{type:Boolean,default:!1}},data:function(){return{id:this.project,hasError:!1}},computed:u(u({},Object(r.e)("project",{projectList:function(t){return o()(this,void 0),t.userProjectList}.bind(void 0)})),{},{projects:function(){var t=this,e=[],n=[{name:l.a.t("业务"),id:1,children:[]},{id:2,name:l.a.t("项目"),children:[]}];return this.projectList.forEach(function(e){o()(this,t),e.from_cmdb?n[0].children.push(e):n[1].children.push(e)}.bind(this)),n.forEach(function(n){o()(this,t),n.children.length&&e.push(n)}.bind(this)),e}}),watch:{project:function(t){this.id=t}},methods:{handleProjectSelect:function(t){var e=this;this.id=t,this.hasError=!1;var n=this.projectList.find(function(t){return o()(this,e),t.id===this.id}.bind(this));this.$emit("onChange",n)},handleConfirm:function(){var t=this;if(!this.confirmLoading)if("number"==typeof this.id){var e=this.projectList.find(function(e){return o()(this,t),e.id===this.id}.bind(this));this.$emit("onConfirm",e)}else this.hasError=!0},handleCancel:function(){this.id="",this.hasError=!1,this.$emit("onCancel")}}},h=(n(911),n(9)),p=Object(h.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-dialog",{attrs:{width:"600","render-directive":"if","ext-cls":"common-dialog",title:t.title,"header-position":"left","mask-close":!1,"auto-close":!1,value:t.show},on:{cancel:t.handleCancel}},[n("div",{staticClass:"select-wrapper"},[n("bk-form",[n("bk-form-item",{attrs:{label:t.$t("选择项目")}},[n("bk-select",{staticClass:"project-select",attrs:{clearable:!1,searchable:!0,value:t.id},on:{change:t.handleProjectSelect}},t._l(t.projects,(function(e,i){return n("bk-option-group",{key:i,attrs:{name:e.name}},t._l(e.children,(function(t){return n("bk-option",{key:t.id,staticClass:"project-item",attrs:{id:t.id,name:t.name}})})),1)})),1),t._v(" "),t.hasError?n("div",{staticClass:"common-error-tip error-msg"},[t._v(t._s(t.$t("请选择项目")))]):t._e()],1)],1)],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:t.confirmCursor},expression:"{ active: confirmCursor }"}],class:{"btn-permission-disable":t.confirmCursor},attrs:{theme:"primary",loading:t.confirmLoading},on:{click:t.handleConfirm}},[t._v("\n            "+t._s(t.$t("确定"))+"\n        ")]),t._v(" "),n("bk-button",{on:{click:t.handleCancel}},[t._v(t._s(t.$t("取消")))])],1)])}),[],!1,null,"35e47392",null);e.a=p.exports},993:function(t,e,n){"use strict";n(26),n(38),n(37),n(49),n(22),n(50);var i=n(0),o=n.n(i),s=n(5),a=n.n(s),r=(n(23),n(314),n(7)),l=n(6);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){a()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={name:"conditionEdit",components:{CodeEditor:n(751).a},props:{isShow:Boolean,conditionData:Object,backToVariablePanel:Boolean,isReadonly:{type:Boolean,default:!1}},data:function(){var t=this.conditionData;return{conditionName:t.name,expression:t.value,conditionRule:{required:!0,max:20,regex:l.e},expressionRule:{required:!0}}},watch:{conditionData:function(t){var e=t.name,n=t.value;this.conditionName=e,this.expression=n}},methods:u(u({},Object(r.d)("template/",["setBranchCondition"])),{},{onDataChange:function(t){this.expression=t},onBeforeClose:function(){if(this.isReadonly)return this.close(),!0;var t=this.conditionData,e=t.name,n=t.value;if(this.conditionName===e&&this.expression===n)return this.close(),!0;this.$emit("onBeforeClose")},confirm:function(){var t=this;this.$validator.validateAll().then(function(e){if(o()(this,t),e){var n=this.conditionData,i={id:n.id,nodeId:n.nodeId,overlayId:n.overlayId,value:this.expression.trim(),name:this.conditionName};this.setBranchCondition(i),this.$emit("updataCanvasCondition",i),this.close()}}.bind(this))},close:function(t){this.$emit("close",t)}})},h=(n(970),n(9)),p=Object(h.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-sideslider",{attrs:{width:800,"is-show":t.isShow,"quick-close":!0,"before-close":t.onBeforeClose}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("div",{staticClass:"config-header"},[t.backToVariablePanel?n("i",{staticClass:"bk-icon icon-arrows-left variable-back-icon",on:{click:function(e){return t.close(!0)}}}):t._e(),t._v("\n            "+t._s(t.$t("分支条件"))+"\n        ")])]),t._v(" "),n("div",{staticClass:"condition-form",attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"form-wrap"},[n("div",{staticClass:"form-item"},[n("label",{staticClass:"label"},[t._v("\n                    "+t._s(t.$t("分支名称"))+"\n                    "),n("span",{staticClass:"required"},[t._v("*")])]),t._v(" "),n("bk-input",{directives:[{name:"validate",rawName:"v-validate",value:t.conditionRule,expression:"conditionRule"}],attrs:{readonly:t.isReadonly,name:"conditionName"},model:{value:t.conditionName,callback:function(e){t.conditionName="string"==typeof e?e.trim():e},expression:"conditionName"}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.veeErrors.has("conditionName"),expression:"veeErrors.has('conditionName')"}],staticClass:"common-error-tip error-msg"},[t._v(t._s(t.veeErrors.first("conditionName")))])],1),t._v(" "),n("div",{staticClass:"form-item"},[n("label",{staticClass:"label"},[t._v("\n                    "+t._s(t.$t("表达式"))+"\n                    "),n("span",{staticClass:"required"},[t._v("*")])]),t._v(" "),n("div",{staticClass:"code-wrapper"},[n("div",{staticClass:"condition-tips"},[n("p",[t._v(t._s(t.$t('支持 "==、!=、>、>=、<、<=、in、notin" 等二元操作符和 "and、or、True/true、False/false" 等关键字语法，还支持通过 ${key} 方式引用全局变量。')))]),t._v(" "),n("p",[t._v(t._s(t.$t("示例：")))]),t._v(" "),n("p",[t._v(t._s(t.$t("字符串比较："))+' "${key}" == "my string"')]),t._v(" "),n("p",[t._v(t._s(t.$t("数值比较："))+" ${int(key)} >= 3")])]),t._v(" "),n("code-editor",{directives:[{name:"validate",rawName:"v-validate",value:t.expressionRule,expression:"expressionRule"}],attrs:{name:"expression",value:t.expression,options:{language:"python",readOnly:t.isReadonly}},on:{input:t.onDataChange}})],1),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.veeErrors.has("expression"),expression:"veeErrors.has('expression')"}],staticClass:"common-error-tip error-msg"},[t._v(t._s(t.veeErrors.first("expression")))])])]),t._v(" "),n("div",{staticClass:"btn-wrap"},[t.isReadonly?t._e():n("bk-button",{staticClass:"save-btn",attrs:{theme:"primary"},on:{click:t.confirm}},[t._v(t._s(t.$t("保存")))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.close}},[t._v(t._s(t.isReadonly?t.$t("关闭"):t.$t("取消")))])],1)])])}),[],!1,null,"7cb8192e",null);e.a=p.exports},996:function(t,e,n){"use strict";var i={name:"NotifyInfo",props:{content:{type:String},show:{type:Boolean,default:!0},theme:{type:String,default:"danger"}},data:function(){return{visible:this.show}},watch:{show:function(t){this.visible=t}},methods:{onHide:function(){this.$emit("update:show",!1)}}},o=(n(910),n(9)),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",[t.show?n("div",{class:["notify-info",t.theme]},[n("i",{staticClass:"bk-icon icon-exclamation-circle tips-icon"}),t._v(" "),n("div",{staticClass:"content-area"},[t._t("default",(function(){return[n("div",{staticClass:"content",attrs:{title:t.content}},[t._v(t._s(t.content))])]}))],2),t._v(" "),n("div",{staticClass:"button-area"},[t._t("buttons",(function(){return[n("bk-button",{attrs:{text:!0,size:"small"},on:{click:t.onHide}},[t._v("\n                    "+t._s(t.$t("收起"))+"\n                ")])]}))],2)]):t._e()])}),[],!1,null,"331d8e12",null);e.a=s.exports}}]);